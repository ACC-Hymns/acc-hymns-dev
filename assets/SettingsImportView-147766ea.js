import{d as j,r as E,ai as q,b as G,L as C,aj as l,T as K,j as c,k as e,a4 as Q,a5 as Y,p as m,F as k,q as $,s as x,w as h,l as r,a2 as B,v as a,m as b,af as T,Q as D,a9 as z,R as I,E as J,G as X,ak as N,H as Z,I as tt,Y as H,al as et,am as st,an as nt,ao as ot,ap as at,aq as it,ae as lt,ar as ct,K as rt}from"./index-fdf012b7.js";import{_ as dt}from"./chevron-back-outline-3b18af6c.js";import{_ as ut}from"./close-d0f2b920.js";import{_ as _t}from"./home-outline-fa9c027b.js";import{_ as mt}from"./settings-5944a888.js";import{T as i}from"./index-d91c961e.js";import{u as ht}from"./navigator-887972bc.js";import{u as pt}from"./preferences-a55c7b4c.js";const ft="/acchymns-dev/assets/enter-outline.svg",vt="/acchymns-dev/assets/arrow-down-circle-outline.svg",wt="/acchymns-dev/assets/trash-outline.svg",o=v=>(J("data-v-48732881"),v=v(),X(),v),yt={class:"menu"},gt={class:"title"},kt=o(()=>e("h1",{class:"title--center"},"Import Hymnals",-1)),xt={class:"main-content"},bt={class:"input-option reference-option"},Dt=["disabled"],It=o(()=>e("img",{class:"ionicon enter-button-icon",src:ft},null,-1)),St=[It],Et={key:0},Ct={key:1,class:"warning-label-container"},$t=o(()=>e("img",{class:"ionicon warning-icon",src:N},null,-1)),Tt=o(()=>e("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Pt=[$t,Tt],Ot=["onClick"],Rt=o(()=>e("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:ct},null,-1)),Bt=[Rt],Ht={key:2},Nt={key:3,class:"warning-label-container"},Vt=o(()=>e("img",{class:"ionicon warning-icon",src:N},null,-1)),Lt=o(()=>e("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Mt=[Vt,Lt],At={class:"button-array"},Ut=["onClick"],Ft=o(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:vt},null,-1)),Wt=[Ft],jt=["onClick"],qt=o(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:ut},null,-1)),Gt=[qt],Kt={key:4},Qt={class:"button-array"},Yt=["onClick"],zt=o(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:wt},null,-1)),Jt=[zt],Xt=o(()=>e("div",{style:{"padding-bottom":"200px"}},null,-1)),Zt={class:"nav"},te=o(()=>e("img",{class:"ionicon nav__icon",src:_t},null,-1)),ee=o(()=>e("span",{class:"nav__text"},"Home",-1)),se=o(()=>e("img",{class:"ionicon nav__icon",src:Z},null,-1)),ne=o(()=>e("span",{class:"nav__text"},"Search",-1)),oe=o(()=>e("img",{class:"ionicon nav__icon",src:tt},null,-1)),ae=o(()=>e("span",{class:"nav__text"},"Bookmarks",-1)),ie=o(()=>e("img",{class:"ionicon nav__icon--active",src:mt},null,-1)),le=o(()=>e("span",{class:"nav__text"},"Settings",-1)),ce=j({__name:"SettingsImportView",setup(v){ht();let d=E(new Map),p=E(new Map);q(async()=>{p.value.forEach(async(t,n)=>{await t.cancel(),d.value.delete(n)})});const f=pt("bookSources",[]);let P=G("import_books_tooltip_complete",!1);const w=C(()=>f.value.filter(n=>n.status==l.PREVIEW)),S=C(()=>f.value.filter(t=>t.status==l.IMPORTED)),O=C(()=>f.value.filter(t=>t.status==l.DOWNLOADED)),y=E("");async function R(t,n=!0){let s=f.value.find(_=>_.id==t.id);if(s==null)return!1;if((await H.getStatus()).connected)D.getPlatform()!=="web"&&await et(s);else return await i.show({text:"No internet connection."}),!1;let g=null;try{const _=new AbortController,W=setTimeout(()=>_.abort(),2e3);g=await fetch(s.src+"/summary.json",{method:"HEAD",signal:_.signal}),clearTimeout(W)}catch(_){if(_.name=="TypeError")return await i.show({text:"Failed to load hymnal!"}),!1;if(_.name!="AbortError")throw _}return g==null||!g.ok||g.status!=200?(await i.show({text:"Failed to load hymnal!"}),!1):s.status!=l.IMPORTED?(s.status=l.IMPORTED,n&&await i.show({text:"Successfully imported hymnal!"}),!0):(await i.show({text:"Hymnal already imported!"}),!1)}async function V(t){if(t in B){const n=f.value.find(s=>s.id==t);if(n==null)return;n.status==l.IMPORTED||n.status==l.DOWNLOADED?await i.show({text:`Hymnal (${t}) already imported!`}):await R(n,!1)&&await i.show({text:`Successfully imported hymnal (${t})!`})}else await i.show({text:`Unknown hymnal reference (${t})!`})}async function L(t){if((await H.getStatus()).connected){let n=st(t,(s,u)=>M(s,u),(s,u)=>A(s,u));p.value.set(t.id,n)}else await i.show({text:"No internet connection."});console.log("Downloads:",p.value)}async function M(t,n){d.value.set(t.id,n)}async function A(t,n){t.src=n,t.status=l.DOWNLOADED,await i.show({text:"Successfully downloaded hymnal!"})}K(()=>{P.value||(P.value=!0)});async function U(t){var n;t.status=Object.keys(nt).includes(t.id)?l.PREVIEW:l.HIDDEN,p.value.has(t.id)&&((n=p.value.get(t.id))==null||n.cancel(),d.value.delete(t.id)),D.getPlatform()!=="web"&&await ot(t),await i.show({text:"Successfully removed hymnal!"})}async function F(t){t.status=l.IMPORTED,t.src=B[t.id],await at.rmdir({directory:it.Documents,path:`Hymnals/${t.id}`,recursive:!0}),d.value.delete(t.id),lt(),await i.show({text:"Successfully deleted hymnal!"})}return(t,n)=>(a(),c(k,null,[e("div",yt,[e("div",gt,[e("img",{onClick:n[0]||(n[0]=s=>t.$router.back()),class:"ionicon title--left",src:dt}),kt])]),e("div",xt,[e("div",bt,[Q(e("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>y.value=s),type:"text",class:"search-bar",placeholder:"Reference"},null,512),[[Y,y.value,void 0,{trim:!0}]]),e("a",{disabled:y.value.length===0,onClick:n[2]||(n[2]=s=>V(y.value)),class:"reference-button"},St,8,Dt)]),w.value.length!=0?(a(),c("h2",Et,"Available Hymnals")):m("",!0),w.value.length!=0?(a(),c("div",Ct,Pt)):m("",!0),e("div",null,[(a(!0),c(k,null,$(w.value,s=>(a(),b(T,{key:s.id,src:s.src,"with-link":!1},{default:h(()=>[e("button",{onClick:u=>R(s)},Bt,8,Ot)]),_:2},1032,["src"]))),128))]),S.value.length!=0?(a(),c("h2",Ht,"Imported Hymnals")):m("",!0),S.value.length!=0&&w.value.length==0?(a(),c("div",Nt,Mt)):m("",!0),e("div",null,[(a(!0),c(k,null,$(S.value,s=>(a(),b(T,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:h(()=>[e("div",At,[(r(d).get(s.id)||0)<1&&r(D).getPlatform()!=="web"?(a(),c("button",{key:0,onClick:u=>L(s)},Wt,8,Ut)):m("",!0),(r(d).get(s.id||"")||0)>=1&&(r(d).get(s.id||"")||0)<100&&r(D).getPlatform()!=="web"?(a(),b(z,{key:1,radius:15,progress:r(d).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress","transform"])):m("",!0),e("button",{onClick:u=>U(s)},Gt,8,jt)])]),_:2},1032,["src"]))),128))]),O.value.length!=0?(a(),c("h2",Kt,"Downloaded Hymnals")):m("",!0),e("div",null,[(a(!0),c(k,null,$(O.value,s=>(a(),b(T,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:h(()=>[e("div",Qt,[e("button",{onClick:u=>F(s)},Jt,8,Yt)])]),_:2},1032,["src"]))),128))]),Xt]),e("nav",Zt,[x(r(I),{to:"/",class:"nav__link"},{default:h(()=>[te,ee]),_:1}),x(r(I),{to:"/search",class:"nav__link"},{default:h(()=>[se,ne]),_:1}),x(r(I),{to:"/bookmarks",class:"nav__link"},{default:h(()=>[oe,ae]),_:1}),x(r(I),{to:"/settings",class:"nav__link nav__link--active"},{default:h(()=>[ie,le]),_:1})])],64))}});const ve=rt(ce,[["__scopeId","data-v-48732881"]]);export{ve as default};
