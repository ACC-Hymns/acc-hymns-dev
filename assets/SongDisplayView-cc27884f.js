var ar=Object.defineProperty;var cr=(r,e,t)=>e in r?ar(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var st=(r,e,t)=>(cr(r,typeof e!="symbol"?e+"":e,t),t),$t=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var _=(r,e,t)=>($t(r,e,"read from private field"),t?t.call(r):e.get(r)),re=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},ye=(r,e,t,n)=>($t(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var pt=(r,e,t,n)=>({set _(s){ye(r,e,s,t)},get _(){return _(r,e,n)}}),me=(r,e,t)=>($t(r,e,"access private method"),t);import{_ as _imports_0$1}from"./chevron-back-outline-3b18af6c.js";import{d as defineComponent,r as ref,c as onMounted,K as Capacitor,h as createElementBlock,s as openBlock,L as useMediaQuery,b as useLocalStorage,G as computed,M as readonly,g as getAllBookMetaData,N as onUpdated,j as unref,k as createBlock,l as isRef,O as normalizeClass,m as createCommentVNode,y as pushScopeId,z as popScopeId,i as createBaseVNode,E as _export_sfc,u as useRouter,e as getSongMetaData,P as onUnmounted,t as toDisplayString,F as Fragment,C as _imports_2,q as createVNode,Q as _imports_2$1}from"./index-54d718f8.js";import{_ as _imports_3}from"./bookmark-22c9903e.js";import{_ as _imports_0}from"./wifi_off-0a29b492.js";import{T as Toast}from"./index-23a7d332.js";import{u as useCapacitorPreferences}from"./preferences-89a5b8b1.js";const _imports_1="/acchymns-dev/assets/musical-notes-outline.svg";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function getAugmentedNamespace(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var wheel$1={exports:{}};wheel$1.exports=addWheelListener;wheel$1.exports.addWheelListener=addWheelListener;wheel$1.exports.removeWheelListener=removeWheelListener;function addWheelListener(r,e,t){r.addEventListener("wheel",e,t)}function removeWheelListener(r,e,t){r.removeEventListener("wheel",e,t)}var wheelExports=wheel$1.exports,amator={exports:{}},NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1),float32ArraySupported=typeof Float32Array=="function";function A(r,e){return 1-3*e+3*r}function B(r,e){return 3*e-6*r}function C(r){return 3*r}function calcBezier(r,e,t){return((A(e,t)*r+B(e,t))*r+C(e))*r}function getSlope(r,e,t){return 3*A(e,t)*r*r+2*B(e,t)*r+C(e)}function binarySubdivide(r,e,t,n,s){var i,o,a=0;do o=e+(t-e)/2,i=calcBezier(o,n,s)-r,i>0?t=o:e=o;while(Math.abs(i)>SUBDIVISION_PRECISION&&++a<SUBDIVISION_MAX_ITERATIONS);return o}function newtonRaphsonIterate(r,e,t,n){for(var s=0;s<NEWTON_ITERATIONS;++s){var i=getSlope(e,t,n);if(i===0)return e;var o=calcBezier(e,t,n)-r;e-=o/i}return e}function LinearEasing(r){return r}var src=function(e,t,n,s){if(!(0<=e&&e<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&n===s)return LinearEasing;for(var i=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize),o=0;o<kSplineTableSize;++o)i[o]=calcBezier(o*kSampleStepSize,e,n);function a(l){for(var c=0,u=1,p=kSplineTableSize-1;u!==p&&i[u]<=l;++u)c+=kSampleStepSize;--u;var g=(l-i[u])/(i[u+1]-i[u]),y=c+g*kSampleStepSize,h=getSlope(y,e,n);return h>=NEWTON_MIN_SLOPE?newtonRaphsonIterate(l,y,e,n):h===0?y:binarySubdivide(l,c,c+kSampleStepSize,e,n)}return function(c){return c===0?0:c===1?1:calcBezier(a(c),t,s)}},BezierEasing=src,animations={ease:BezierEasing(.25,.1,.25,1),easeIn:BezierEasing(.42,0,1,1),easeOut:BezierEasing(0,0,.58,1),easeInOut:BezierEasing(.42,0,.58,1),linear:BezierEasing(0,0,1,1)};amator.exports=animate$1;amator.exports.makeAggregateRaf=makeAggregateRaf;amator.exports.sharedScheduler=makeAggregateRaf();function animate$1(r,e,t){var n=Object.create(null),s=Object.create(null);t=t||{};var i=typeof t.easing=="function"?t.easing:animations[t.easing];i||(t.easing&&console.warn("Unknown easing function in amator: "+t.easing),i=animations.ease);var o=typeof t.step=="function"?t.step:noop$2,a=typeof t.done=="function"?t.done:noop$2,l=getScheduler(t.scheduler),c=Object.keys(e);c.forEach(function(v){n[v]=r[v],s[v]=e[v]-r[v]});var u=typeof t.duration=="number"?t.duration:400,p=Math.max(1,u*.06),g,y=0;return g=l.next(d),{cancel:h};function h(){l.cancel(g),g=0}function d(){var v=i(y/p);y+=1,f(v),y<=p?(g=l.next(d),o(r)):(g=0,setTimeout(function(){a(r)},0))}function f(v){c.forEach(function(T){r[T]=s[T]*v+n[T]})}}function noop$2(){}function getScheduler(r){if(!r){var e=typeof window<"u"&&window.requestAnimationFrame;return e?rafScheduler():timeoutScheduler()}if(typeof r.next!="function")throw new Error("Scheduler is supposed to have next(cb) function");if(typeof r.cancel!="function")throw new Error("Scheduler is supposed to have cancel(handle) function");return r}function rafScheduler(){return{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}}function timeoutScheduler(){return{next:function(r){return setTimeout(r,1e3/60)},cancel:function(r){return clearTimeout(r)}}}function makeAggregateRaf(){var r=new Set,e=new Set,t=0;return{next:s,cancel:s,clearAll:n};function n(){r.clear(),e.clear(),cancelAnimationFrame(t),t=0}function s(a){e.add(a),i()}function i(){t||(t=requestAnimationFrame(o))}function o(){t=0;var a=e;e=r,r=a,r.forEach(function(l){l()}),r.clear()}}var amatorExports=amator.exports,ngraph_events=function(e){validateSubject(e);var t=createEventsStorage(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e};function createEventsStorage(r){var e=Object.create(null);return{on:function(t,n,s){if(typeof n!="function")throw new Error("callback is expected to be a function");var i=e[t];return i||(i=e[t]=[]),i.push({callback:n,ctx:s}),r},off:function(t,n){var s=typeof t>"u";if(s)return e=Object.create(null),r;if(e[t]){var i=typeof n!="function";if(i)delete e[t];else for(var o=e[t],a=0;a<o.length;++a)o[a].callback===n&&o.splice(a,1)}return r},fire:function(t){var n=e[t];if(!n)return r;var s;arguments.length>1&&(s=Array.prototype.splice.call(arguments,1));for(var i=0;i<n.length;++i){var o=n[i];o.callback.apply(o.ctx,s)}return r}}}function validateSubject(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],t=0;t<e.length;++t)if(r.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var kinetic_1=kinetic$1;function kinetic$1(r,e,t){typeof t!="object"&&(t={});var n=typeof t.minVelocity=="number"?t.minVelocity:5,s=typeof t.amplitude=="number"?t.amplitude:.25,i=typeof t.cancelAnimationFrame=="function"?t.cancelAnimationFrame:getCancelAnimationFrame(),o=typeof t.requestAnimationFrame=="function"?t.requestAnimationFrame:getRequestAnimationFrame(),a,l,c=342,u,p,g,y,h,d,f,v;return{start:R,stop:m,cancel:T};function T(){i(u),i(v)}function R(){a=r(),y=f=p=h=0,l=new Date,i(u),i(v),u=o(N)}function N(){var P=Date.now(),x=P-l;l=P;var S=r(),w=S.x-a.x,E=S.y-a.y;a=S;var V=1e3/(1+x);p=.8*w*V+.2*p,h=.8*E*V+.2*h,u=o(N)}function m(){i(u),i(v);var P=r();g=P.x,d=P.y,l=Date.now(),(p<-n||p>n)&&(y=s*p,g+=y),(h<-n||h>n)&&(f=s*h,d+=f),v=o(b)}function b(){var P=Date.now()-l,x=!1,S=0,w=0;y&&(S=-y*Math.exp(-P/c),S>.5||S<-.5?x=!0:S=y=0),f&&(w=-f*Math.exp(-P/c),w>.5||w<-.5?x=!0:w=f=0),x&&(e(g+S,d+w),v=o(b))}}function getCancelAnimationFrame(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function getRequestAnimationFrame(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(r){return setTimeout(r,16)}}var createTextSelectionInterceptor_1=createTextSelectionInterceptor$1;function createTextSelectionInterceptor$1(r){if(r)return{capture:noop$1,release:noop$1};var e,t,n,s=!1;return{capture:i,release:o};function i(a){s=!0,t=window.document.onselectstart,n=window.document.ondragstart,window.document.onselectstart=disabled,e=a,e.ondragstart=disabled}function o(){s&&(s=!1,window.document.onselectstart=t,e&&(e.ondragstart=n))}}function disabled(r){return r.stopPropagation(),!1}function noop$1(){}var transform,hasRequiredTransform;function requireTransform(){if(hasRequiredTransform)return transform;hasRequiredTransform=1,transform=r;function r(){this.x=0,this.y=0,this.scale=1}return transform}var svgController={exports:{}},hasRequiredSvgController;function requireSvgController(){if(hasRequiredSvgController)return svgController.exports;hasRequiredSvgController=1,svgController.exports=r,svgController.exports.canAttach=e;function r(t,n){if(!e(t))throw new Error("svg element is required for svg.panzoom to work");var s=t.ownerSVGElement;if(!s)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");n.disableKeyboardInteraction||s.setAttribute("tabindex",0);var i={getBBox:a,getScreenCTM:l,getOwner:o,applyTransform:u,initTransform:c};return i;function o(){return s}function a(){var p=t.getBBox();return{left:p.x,top:p.y,width:p.width,height:p.height}}function l(){var p=s.getCTM();return p||s.getScreenCTM()}function c(p){var g=t.getCTM();g===null&&(g=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),p.x=g.e,p.y=g.f,p.scale=g.a,s.removeAttributeNS(null,"viewBox")}function u(p){t.setAttribute("transform","matrix("+p.scale+" 0 0 "+p.scale+" "+p.x+" "+p.y+")")}}function e(t){return t&&t.ownerSVGElement&&t.getCTM}return svgController.exports}var domController={exports:{}},hasRequiredDomController;function requireDomController(){if(hasRequiredDomController)return domController.exports;hasRequiredDomController=1,domController.exports=r,domController.exports.canAttach=e;function r(t,n){var s=e(t);if(!s)throw new Error("panzoom requires DOM element to be attached to the DOM tree");var i=t.parentElement;t.scrollTop=0,n.disableKeyboardInteraction||i.setAttribute("tabindex",0);var o={getBBox:l,getOwner:a,applyTransform:c};return o;function a(){return i}function l(){return{left:0,top:0,width:t.clientWidth,height:t.clientHeight}}function c(u){t.style.transformOrigin="0 0 0",t.style.transform="matrix("+u.scale+", 0, 0, "+u.scale+", "+u.x+", "+u.y+")"}}function e(t){return t&&t.parentElement&&t.style}return domController.exports}var wheel=wheelExports,animate=amatorExports,eventify=ngraph_events,kinetic=kinetic_1,createTextSelectionInterceptor=createTextSelectionInterceptor_1,domTextSelectionInterceptor=createTextSelectionInterceptor(),fakeTextSelectorInterceptor=createTextSelectionInterceptor(!0),Transform=requireTransform(),makeSvgController=requireSvgController(),makeDomController=requireDomController(),defaultZoomSpeed=1,defaultDoubleTapZoomSpeed=1.75,doubleTapSpeedInMS=300,clickEventTimeInMS=200,panzoom=createPanZoom,initialWidth=0,initialHeight=0;function createPanZoom(r,e){initialWidth=r.offsetWidth,initialHeight=r.offsetHeight,e=e||{};var t=e.controller;if(t||(makeSvgController.canAttach(r)?t=makeSvgController(r,e):makeDomController.canAttach(r)&&(t=makeDomController(r,e))),!t)throw new Error("Cannot create panzoom for the current type of dom element");var n=t.getOwner(),s={x:0,y:0},i=!1,o=new Transform;t.initTransform&&t.initTransform(o);var a=typeof e.filterKey=="function"?e.filterKey:noop,l=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,c=e.bounds,u=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,p=typeof e.minZoom=="number"?e.minZoom:0,g=typeof e.boundsPadding=="number"?e.boundsPadding:.05,y=typeof e.zoomDoubleClickSpeed=="number"?e.zoomDoubleClickSpeed:defaultDoubleTapZoomSpeed,h=e.beforeWheel||noop,d=e.beforeMouseDown||noop,f=typeof e.zoomSpeed=="number"?e.zoomSpeed:defaultZoomSpeed,v=parseTransformOrigin(e.transformOrigin),T=e.enableTextSelection?fakeTextSelectorInterceptor:domTextSelectionInterceptor;validateBounds(c),e.autocenter&&Ee();var R,N=0,m=0,b=0,P=null,x=new Date,S,w=!1,E=!0,V=!0,$=!1,j,D,Y,G,X,Z;"smoothScroll"in e&&!e.smoothScroll?Z=rigidScroll():Z=kinetic(Ve,et,e.smoothScroll);var ne,ie,be,Q=!1;M();var O={dispose:fe,moveBy:Ie,moveTo:Ge,smoothMoveTo:Re,centerOn:oe,zoomTo:At,zoomAbs:ce,smoothZoom:lt,smoothZoomAbs:ht,showRectangle:se,pause:U,resume:te,isPaused:ve,getTransform:Oe,getMinZoom:Me,setMinZoom:we,getMaxZoom:Ue,setMaxZoom:Ne,setVerticalPan:ue,setHorizontalPan:pe,getInitWidth:K,getInitHeight:L,getTransformOrigin:Ae,setTransformOrigin:de,getZoomSpeed:Te,setZoomSpeed:_e};eventify(O);var k=typeof e.initialX=="number"?e.initialX:o.x,F=typeof e.initialY=="number"?e.initialY:o.y,z=typeof e.initialZoom=="number"?e.initialZoom:o.scale;return(k!=o.x||F!=o.y||z!=o.scale)&&ce(k,F,z),O;function L(){return initialHeight}function K(){return initialWidth}function U(){ee(),Q=!0}function te(){Q&&(M(),Q=!1)}function pe(Ce){E=Ce}function ue(Ce){V=Ce}function ve(){return Q}function se(Ce){var De=n.getBoundingClientRect(),Be=ge(De.width,De.height),Xe=Ce.right-Ce.left,rt=Ce.bottom-Ce.top;if(!Number.isFinite(Xe)||!Number.isFinite(rt))throw new Error("Invalid rectangle");var it=Be.x/Xe,ot=Be.y/rt,ut=Math.min(it,ot);o.x=-(Ce.left+Xe/2)*ut+Be.x/2,o.y=-(Ce.top+rt/2)*ut+Be.y/2,o.scale=ut}function ge(Ce,De){if(t.getScreenCTM){var Be=t.getScreenCTM(),Xe=Be.a,rt=Be.d,it=Be.e,ot=Be.f;s.x=Ce*Xe-it,s.y=De*rt-ot}else s.x=Ce,s.y=De;return s}function Ee(){var Ce,De,Be=0,Xe=0,rt=Ze();if(rt)Be=rt.left,Xe=rt.top,Ce=rt.right-rt.left,De=rt.bottom-rt.top;else{var it=n.getBoundingClientRect();Ce=it.width,De=it.height}var ot=t.getBBox();if(!(ot.width===0||ot.height===0)){var ut=De/ot.height,St=Ce/ot.width,vt=Math.min(St,ut);o.x=-(ot.left+ot.width/2)*vt+Ce/2+Be,o.y=-(ot.top+ot.height/2)*vt+De/2+Xe,o.scale=vt}}function Oe(){return o}function Me(){return p}function we(Ce){p=Ce}function Ue(){return u}function Ne(Ce){u=Ce}function Ae(){return v}function de(Ce){v=parseTransformOrigin(Ce)}function Te(){return f}function _e(Ce){if(!Number.isFinite(Ce))throw new Error("Zoom speed should be a number");f=Ce}function Ve(){return{x:o.x,y:o.y}}function Ge(Ce,De){o.x=Ce,o.y=De,$e(),bt("pan"),Ye()}function Ke(Ce,De){Ge(E?o.x+Ce:o.x,V?o.y+De:o.y)}function $e(){var Ce=Ze();if(Ce){var De=!1,Be=Qe(),Xe=Ce.left-Be.right;return Xe>0&&(o.x+=Xe,De=!0),Xe=Ce.right-Be.left,Xe<0&&(o.x+=Xe,De=!0),V&&(Xe=Ce.top-Be.bottom,Xe>0&&(o.y+=Xe,De=!0),Xe=Ce.bottom-Be.top,Xe<0&&(o.y+=Xe,De=!0)),De}}function Ze(){if(c){if(typeof c=="boolean"){var Ce=n.getBoundingClientRect(),De=Ce.width,Be=Ce.height;return{left:De*g,top:Be*g,right:De*(1-g),bottom:Be*(1-g)}}return c}}function Qe(){var Ce=t.getBBox(),De=qe(Ce.left,Ce.top);return{left:De.x,top:De.y,right:Ce.width*o.scale+De.x,bottom:Ce.height*o.scale+De.y}}function qe(Ce,De){return{x:Ce*o.scale+o.x,y:De*o.scale+o.y}}function Ye(){i=!0,R=window.requestAnimationFrame(he)}function Se(Ce,De,Be){if(isNaN$1(Ce)||isNaN$1(De)||isNaN$1(Be))throw new Error("zoom requires valid numbers");var Xe=o.scale*Be;if(Xe<p){if(o.scale===p)return;Be=p/o.scale}if(Xe>u){if(o.scale===u)return;Be=u/o.scale}var rt=ge(Ce,De);if(o.x=rt.x-Be*(rt.x-o.x),o.y=rt.y-Be*(rt.y-o.y),c&&g===1&&p===1)o.scale*=Be,$e();else{var it=$e();it||(o.scale*=Be)}bt("zoom"),Ye()}function ce(Ce,De,Be){var Xe=Be/o.scale;Se(Ce,De,Xe)}function oe(Ce){var De=Ce.ownerSVGElement;if(!De)throw new Error("ui element is required to be within the scene");var Be=Ce.getBoundingClientRect(),Xe=Be.left+Be.width/2,rt=Be.top+Be.height/2,it=De.getBoundingClientRect(),ot=it.width/2-Xe,ut=it.height/2-rt;Ie(ot,ut,!0)}function Re(Ce,De){Ie(Ce-o.x,De-o.y,!0)}function Ie(Ce,De,Be){if(!Be)return Ke(Ce,De);ne&&ne.cancel();var Xe={x:0,y:0},rt={x:Ce,y:De},it=0,ot=0;ne=animate(Xe,rt,{step:function(ut){Ke(ut.x-it,ut.y-ot),it=ut.x,ot=ut.y}})}function et(Ce,De){gt(),Ge(Ce,De)}function fe(){ee()}function M(){n.addEventListener("mousedown",ze,{passive:!1}),n.addEventListener("dblclick",Le,{passive:!1}),n.addEventListener("touchstart",q,{passive:!1}),n.addEventListener("keydown",W,{passive:!1}),wheel.addWheelListener(n,nt,{passive:!1}),Ye()}function ee(){wheel.removeWheelListener(n,nt),n.removeEventListener("mousedown",ze),n.removeEventListener("keydown",W),n.removeEventListener("dblclick",Le),n.removeEventListener("touchstart",q),R&&(window.cancelAnimationFrame(R),R=0),Z.cancel(),tt(),at(),T.release(),zt()}function he(){i&&ae()}function ae(){i=!1,t.applyTransform(o),bt("transform"),R=0}function W(Ce){var De=0,Be=0,Xe=0;if(Ce.keyCode===38?Be=1:Ce.keyCode===40?Be=-1:Ce.keyCode===37?De=1:Ce.keyCode===39?De=-1:Ce.keyCode===189||Ce.keyCode===109?Xe=1:(Ce.keyCode===187||Ce.keyCode===107)&&(Xe=-1),!a(Ce,De,Be,Xe)){if(De||Be){Ce.preventDefault(),Ce.stopPropagation();var rt=n.getBoundingClientRect(),it=Math.min(rt.width,rt.height),ot=.05,ut=it*ot*De,St=it*ot*Be;Ie(ut,St)}if(Xe){var vt=_t(Xe*100),it=v?dt():I();At(it.x,it.y,vt)}}}function I(){var Ce=n.getBoundingClientRect();return{x:Ce.width/2,y:Ce.height/2}}function q(Ce){if(H(Ce),We(),Ce.touches.length===1)return le(Ce,Ce.touches[0]);Ce.touches.length===2&&(X=Fe(Ce.touches[0],Ce.touches[1]),be=!0,xe())}function H(Ce){e.onTouch&&!e.onTouch(Ce)||(Ce.stopPropagation(),Ce.preventDefault())}function J(Ce){We(),!(e.onDoubleClick&&!e.onDoubleClick(Ce))&&(Ce.preventDefault(),Ce.stopPropagation())}function le(Ce){m=new Date;var De=Ce.touches[0],Be=ct(De);S=Be;var Xe=ge(Be.x,Be.y);j=Xe.x,D=Xe.y,Y=j,G=D,Z.cancel(),xe()}function xe(){w||(w=!0,document.addEventListener("touchmove",Pe),document.addEventListener("touchend",He),document.addEventListener("touchcancel",He))}function Pe(Ce){if(Ce.touches.length===1){Ce.stopPropagation();var De=Ce.touches[0],Be=ct(De),Xe=ge(Be.x,Be.y),rt=Xe.x-j,it=Xe.y-D;rt!==0&&it!==0&&bn(),j=Xe.x,D=Xe.y,Ie(rt,it)}else if(Ce.touches.length===2){be=!0;var ot=Ce.touches[0],ut=Ce.touches[1],St=Fe(ot,ut),vt=1+(St/X-1)*l,Sn=ct(ot),Tn=ct(ut);if(j=(Sn.x+Tn.x)/2,D=(Sn.y+Tn.y)/2,v){var Be=dt();j=Be.x,D=Be.y}At(j,D,vt),X=St,Ce.stopPropagation(),Ce.preventDefault()}}function We(){b&&(clearTimeout(b),b=0)}function ke(Ce){if(e.onClick){We();var De=j-Y,Be=D-G,Xe=Math.sqrt(De*De+Be*Be);Xe>5||(b=setTimeout(function(){b=0,e.onClick(Ce)},doubleTapSpeedInMS))}}function He(Ce){if(We(),Ce.touches.length>0){var De=ct(Ce.touches[0]),Be=ge(De.x,De.y);j=Be.x,D=Be.y}else{var Xe=new Date;if(Xe-N<doubleTapSpeedInMS)if(v){var De=dt();lt(De.x,De.y,y)}else lt(S.x,S.y,y);else Xe-m<clickEventTimeInMS&&ke(Ce);N=Xe,zt(),at()}}function Fe(Ce,De){var Be=Ce.clientX-De.clientX,Xe=Ce.clientY-De.clientY;return Math.sqrt(Be*Be+Xe*Xe)}function Le(Ce){J(Ce);var De=ct(Ce);v&&(De=dt()),lt(De.x,De.y,y)}function ze(Ce){if(We(),!d(Ce)){if(P=Ce,x=new Date,w)return Ce.stopPropagation(),!1;var De=Ce.button===1&&window.event!==null||Ce.button===0;if(De){Z.cancel();var Be=ct(Ce),Xe=ge(Be.x,Be.y);return Y=j=Xe.x,G=D=Xe.y,document.addEventListener("mousemove",je),document.addEventListener("mouseup",Je),T.capture(Ce.target||Ce.srcElement),!1}}}function je(Ce){if(!w){bn();var De=ct(Ce),Be=ge(De.x,De.y),Xe=Be.x-j,rt=Be.y-D;j=Be.x,D=Be.y,Ie(Xe,rt)}}function Je(){var Ce=new Date;Ce-x<clickEventTimeInMS&&ke(P),T.release(),zt(),tt()}function tt(){document.removeEventListener("mousemove",je),document.removeEventListener("mouseup",Je),$=!1}function at(){document.removeEventListener("touchmove",Pe),document.removeEventListener("touchend",He),document.removeEventListener("touchcancel",He),$=!1,be=!1,w=!1}function nt(Ce){if(!h(Ce)){Z.cancel();var De=Ce.deltaY;Ce.deltaMode>0&&(De*=100);var Be=_t(De);if(Be!==1){var Xe=v?dt():ct(Ce);At(Xe.x,Xe.y,Be),Ce.preventDefault()}}}function ct(Ce){var De,Be,Xe=n.getBoundingClientRect();return De=Ce.clientX-Xe.left,Be=Ce.clientY-Xe.top,{x:De,y:Be}}function lt(Ce,De,Be){var Xe=o.scale,rt={scale:Xe},it={scale:Be*Xe};Z.cancel(),gt(),ie=animate(rt,it,{step:function(ot){ce(Ce,De,ot.scale)},done:or})}function ht(Ce,De,Be){var Xe=o.scale,rt={scale:Xe},it={scale:Be};Z.cancel(),gt(),ie=animate(rt,it,{step:function(ot){ce(Ce,De,ot.scale)}})}function dt(){var Ce=n.getBoundingClientRect();return{x:Ce.width*v.x,y:Ce.height*v.y}}function At(Ce,De,Be){return Z.cancel(),gt(),Se(Ce,De,Be)}function gt(){ie&&(ie.cancel(),ie=null)}function _t(Ce){var De=Math.sign(Ce),Be=Math.min(.25,Math.abs(f*Ce/128));return 1-De*Be}function bn(){$||(bt("panstart"),$=!0,Z.start())}function zt(){$&&(be||Z.stop(),bt("panend"))}function or(){bt("zoomend")}function bt(Ce){O.fire(Ce,O)}}function parseTransformOrigin(r){if(r){if(typeof r=="object")return(!isNumber$1(r.x)||!isNumber$1(r.y))&&failTransformOrigin(r),r;failTransformOrigin()}}function failTransformOrigin(r){throw console.error(r),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function noop(){}function validateBounds(r){var e=typeof r;if(!(e==="undefined"||e==="boolean")){var t=isNumber$1(r.left)&&isNumber$1(r.top)&&isNumber$1(r.bottom)&&isNumber$1(r.right);if(!t)throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}}function isNumber$1(r){return Number.isFinite(r)}function isNaN$1(r){return Number.isNaN?Number.isNaN(r):r!==r}function rigidScroll(){return{start:noop,stop:noop,cancel:noop}}function autoRun(){if(typeof document>"u")return;var r=document.getElementsByTagName("script");if(!r)return;for(var e,t=0;t<r.length;++t){var n=r[t];if(n.src&&n.src.match(/\bpanzoom(\.min)?\.js/)){e=n;break}}if(!e)return;var s=e.getAttribute("query");if(!s)return;var i=e.getAttribute("name")||"pz",o=Date.now();a();function a(){var u=document.querySelector(s);if(!u){var p=Date.now(),g=p-o;if(g<2e3){setTimeout(a,100);return}console.error("Cannot find the panzoom element",i);return}var y=l(e);console.log(y),window[i]=createPanZoom(u,y)}function l(u){for(var p=u.attributes,g={},y=0;y<p.length;++y){var h=p[y],d=c(h);d&&(g[d.name]=d.value)}return g}function c(u){if(u.name){var p=u.name[0]==="p"&&u.name[1]==="z"&&u.name[2]==="-";if(p){var g=u.name.substr(3),y=JSON.parse(u.value);return{name:g,value:y}}}}}autoRun();const createPanZoom$1=getDefaultExportFromCjs(panzoom);function commonjsRequire(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$6=getAugmentedNamespace(__viteBrowserExternal$1);var path2dPolyfill_esm={},hasRequiredPath2dPolyfill_esm;function requirePath2dPolyfill_esm(){if(hasRequiredPath2dPolyfill_esm)return path2dPolyfill_esm;hasRequiredPath2dPolyfill_esm=1;function r(h,d,f){if(f||arguments.length===2)for(var v=0,T=d.length,R;v<T;v++)(R||!(v in d))&&(R||(R=Array.prototype.slice.call(d,0,v)),R[v]=d[v]);return h.concat(R||Array.prototype.slice.call(d))}var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/gi,n=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function s(h){var d=h.match(n);return d?d.map(Number):[]}function i(h){var d=[],f=String(h).trim();return f[0]!=="M"&&f[0]!=="m"||f.replace(t,function(v,T,R){var N=s(R),m=T.toLowerCase(),b=T;if(m==="m"&&N.length>2&&(d.push(r([b],N.splice(0,2),!0)),m="l",b=b==="m"?"l":"L"),N.length<e[m])return"";for(d.push(r([b],N.splice(0,e[m]),!0));N.length>=e[m]&&N.length&&e[m];)d.push(r([b],N.splice(0,e[m]),!0));return""}),d}function o(h,d){var f=h.x*Math.cos(d)-h.y*Math.sin(d),v=h.y*Math.cos(d)+h.x*Math.sin(d);h.x=f,h.y=v}function a(h,d,f){h.x+=d,h.y+=f}function l(h,d){h.x*=d,h.y*=d}var c=function(){function h(d){var f;this.commands=[],d&&d instanceof h?(f=this.commands).push.apply(f,d.commands):d&&(this.commands=i(d))}return h.prototype.addPath=function(d){var f;d&&d instanceof h&&(f=this.commands).push.apply(f,d.commands)},h.prototype.moveTo=function(d,f){this.commands.push(["M",d,f])},h.prototype.lineTo=function(d,f){this.commands.push(["L",d,f])},h.prototype.arc=function(d,f,v,T,R,N){this.commands.push(["AC",d,f,v,T,R,!!N])},h.prototype.arcTo=function(d,f,v,T,R){this.commands.push(["AT",d,f,v,T,R])},h.prototype.ellipse=function(d,f,v,T,R,N,m,b){this.commands.push(["E",d,f,v,T,R,N,m,!!b])},h.prototype.closePath=function(){this.commands.push(["Z"])},h.prototype.bezierCurveTo=function(d,f,v,T,R,N){this.commands.push(["C",d,f,v,T,R,N])},h.prototype.quadraticCurveTo=function(d,f,v,T){this.commands.push(["Q",d,f,v,T])},h.prototype.rect=function(d,f,v,T){this.commands.push(["R",d,f,v,T])},h.prototype.roundRect=function(d,f,v,T,R){typeof R>"u"?this.commands.push(["RR",d,f,v,T,0]):this.commands.push(["RR",d,f,v,T,R])},h}();function u(h,d){var f=0,v=0,T,R,N,m,b,P,x,S,w,E,V,$,j,D,Y,G,X,Z,ne,ie,be,Q=null,O=null,k=null,F=null,z=null,L=null;h.beginPath();for(var K=0;K<d.length;++K){Z=d[K][0],Z!=="S"&&Z!=="s"&&Z!=="C"&&Z!=="c"&&(Q=null,O=null),Z!=="T"&&Z!=="t"&&Z!=="Q"&&Z!=="q"&&(k=null,F=null);var U=void 0;switch(Z){case"m":case"M":U=d[K],Z==="m"?(f+=U[1],v+=U[2]):(f=U[1],v=U[2]),(Z==="M"||!z)&&(z={x:f,y:v}),h.moveTo(f,v);break;case"l":U=d[K],f+=U[1],v+=U[2],h.lineTo(f,v);break;case"L":U=d[K],f=U[1],v=U[2],h.lineTo(f,v);break;case"H":U=d[K],f=U[1],h.lineTo(f,v);break;case"h":U=d[K],f+=U[1],h.lineTo(f,v);break;case"V":U=d[K],v=U[1],h.lineTo(f,v);break;case"v":U=d[K],v+=U[1],h.lineTo(f,v);break;case"a":case"A":if(U=d[K],L===null)throw new Error("This should never happen");Z==="a"?(f+=U[6],v+=U[7]):(f=U[6],v=U[7]),D=U[1],Y=U[2],x=U[3]*Math.PI/180,N=!!U[4],m=!!U[5],b={x:f,y:v},P={x:(L.x-b.x)/2,y:(L.y-b.y)/2},o(P,-x),S=P.x*P.x/(D*D)+P.y*P.y/(Y*Y),S>1&&(S=Math.sqrt(S),D*=S,Y*=S),ne={x:D*P.y/Y,y:-(Y*P.x)/D},w=D*D*Y*Y,E=D*D*P.y*P.y+Y*Y*P.x*P.x,m!==N?l(ne,Math.sqrt((w-E)/E)||0):l(ne,-Math.sqrt((w-E)/E)||0),R=Math.atan2((P.y-ne.y)/Y,(P.x-ne.x)/D),T=Math.atan2(-(P.y+ne.y)/Y,-(P.x+ne.x)/D),o(ne,x),a(ne,(b.x+L.x)/2,(b.y+L.y)/2),h.save(),h.translate(ne.x,ne.y),h.rotate(x),h.scale(D,Y),h.arc(0,0,1,R,T,!m),h.restore();break;case"C":U=d[K],Q=U[3],O=U[4],f=U[5],v=U[6],h.bezierCurveTo(U[1],U[2],Q,O,f,v);break;case"c":U=d[K],h.bezierCurveTo(U[1]+f,U[2]+v,U[3]+f,U[4]+v,U[5]+f,U[6]+v),Q=U[3]+f,O=U[4]+v,f+=U[5],v+=U[6];break;case"S":U=d[K],(Q===null||O===null)&&(Q=f,O=v),h.bezierCurveTo(2*f-Q,2*v-O,U[1],U[2],U[3],U[4]),Q=U[1],O=U[2],f=U[3],v=U[4];break;case"s":U=d[K],(Q===null||O===null)&&(Q=f,O=v),h.bezierCurveTo(2*f-Q,2*v-O,U[1]+f,U[2]+v,U[3]+f,U[4]+v),Q=U[1]+f,O=U[2]+v,f+=U[3],v+=U[4];break;case"Q":U=d[K],k=U[1],F=U[2],f=U[3],v=U[4],h.quadraticCurveTo(k,F,f,v);break;case"q":U=d[K],k=U[1]+f,F=U[2]+v,f+=U[3],v+=U[4],h.quadraticCurveTo(k,F,f,v);break;case"T":U=d[K],(k===null||F===null)&&(k=f,F=v),k=2*f-k,F=2*v-F,f=U[1],v=U[2],h.quadraticCurveTo(k,F,f,v);break;case"t":U=d[K],(k===null||F===null)&&(k=f,F=v),k=2*f-k,F=2*v-F,f+=U[1],v+=U[2],h.quadraticCurveTo(k,F,f,v);break;case"z":case"Z":z&&(f=z.x,v=z.y),z=null,h.closePath();break;case"AC":U=d[K],f=U[1],v=U[2],j=U[3],R=U[4],T=U[5],ie=U[6],h.arc(f,v,j,R,T,ie);break;case"AT":U=d[K],V=U[1],$=U[2],f=U[3],v=U[4],j=U[5],h.arcTo(V,$,f,v,j);break;case"E":U=d[K],f=U[1],v=U[2],D=U[3],Y=U[4],x=U[5],R=U[6],T=U[7],ie=U[8],h.save(),h.translate(f,v),h.rotate(x),h.scale(D,Y),h.arc(0,0,1,R,T,ie),h.restore();break;case"R":U=d[K],f=U[1],v=U[2],G=U[3],X=U[4],z={x:f,y:v},h.rect(f,v,G,X);break;case"RR":U=d[K],f=U[1],v=U[2],G=U[3],X=U[4],be=U[5],z={x:f,y:v},h.roundRect(f,v,G,X,be);break}L?(L.x=f,L.y=v):L={x:f,y:v}}}function p(h){if(!(!h||!h.CanvasRenderingContext2D||h.Path2D)){var d=h.CanvasRenderingContext2D,f=d.prototype.fill,v=d.prototype.stroke,T=d.prototype.isPointInPath;d.prototype.fill=function(){for(var N=[],m=0;m<arguments.length;m++)N[m]=arguments[m];if(N[0]instanceof c){var b=N[0],P=N[1]||"nonzero";u(this,b.commands),f.apply(this,[P])}else{var P=N[0]||"nonzero";return f.apply(this,[P])}},d.prototype.stroke=function(N){N&&u(this,N.commands),v.apply(this)},d.prototype.isPointInPath=function(){for(var N=[],m=0;m<arguments.length;m++)N[m]=arguments[m];if(N[0]instanceof c){var b=N[0],P=N[1],x=N[2],S=N[3]||"nonzero";return u(this,b.commands),T.apply(this,[P,x,S])}else return T.apply(this,N)},h.Path2D=c}}function g(h,d,f,v,T){var R=this;if(T===void 0&&(T=0),typeof T=="number"&&(T=[T]),Array.isArray(T)){if(T.length===0||T.length>4)throw new RangeError("Failed to execute 'roundRect' on '".concat(this.constructor.name,"': ").concat(T.length," radii provided. Between one and four radii are necessary."));T.forEach(function(S){if(S<0)throw new RangeError("Failed to execute 'roundRect' on '".concat(R.constructor.name,"': Radius value ").concat(S," is negative."))})}else return;if(T.length===1&&T[0]===0)return this.rect(h,d,f,v);var N=Math.min(f,v)/2,m,b,P,x=m=b=P=Math.min(N,T[0]);T.length===2&&(m=P=Math.min(N,T[1])),T.length===3&&(m=P=Math.min(N,T[1]),b=Math.min(N,T[2])),T.length===4&&(m=Math.min(N,T[1]),b=Math.min(N,T[2]),P=Math.min(N,T[3])),this.moveTo(h,d+v-P),this.arcTo(h,d,h+x,d,x),this.arcTo(h+f,d,h+f,d+m,m),this.arcTo(h+f,d+v,h+f-b,d+v,b),this.arcTo(h,d+v,h,d+v-P,P),this.moveTo(h,d)}function y(h){if(!(!h||!h.CanvasRenderingContext2D)){var d=h.CanvasRenderingContext2D,f=h.Path2D;d&&!d.prototype.roundRect&&(d.prototype.roundRect=g),f&&!f.prototype.roundRect&&(f.prototype.roundRect=g)}}return p(window),y(window),path2dPolyfill_esm}(function(module,exports){(function(e,t){module.exports=t()})(globalThis,()=>(()=>{var __webpack_modules__=[,(r,e,t)=>{var Ye;Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.TextRenderingMode=e.RenderingIntentFlag=e.PromiseCapability=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.MAX_IMAGE_SIZE_TO_CACHE=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.BASELINE_FACTOR=e.AnnotationType=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.assert=ne,e.bytesToString=pe,e.createValidAbsoluteUrl=be,e.getModificationDate=Ge,e.getUuid=qe,e.getVerbosityLevel=Y,e.info=G,e.isArrayBuffer=_e,e.isArrayEqual=Ve,e.isNodeJS=void 0,e.normalizeUnicode=Qe,e.objectFromMap=ge,e.objectSize=se,e.setVerbosityLevel=D,e.shadow=Q,e.string32=ve,e.stringToBytes=ue,e.stringToPDFString=Ae,e.stringToUTF8String=de,e.unreachable=Z,e.utf8StringToString=Te,e.warn=X,t(2),t(84),t(86),t(87),t(89),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);const n=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=n;const s=[1,0,0,1,0,0];e.IDENTITY_MATRIX=s;const i=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=i;const o=1e7;e.MAX_IMAGE_SIZE_TO_CACHE=o;const a=1.35;e.LINE_FACTOR=a;const l=.35;e.LINE_DESCENT_FACTOR=l;const c=l/a;e.BASELINE_FACTOR=c;const u={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=u;const p={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=p;const g="pdfjs_internal_editor_";e.AnnotationEditorPrefix=g;const y={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};e.AnnotationEditorType=y;const h={RESIZE:1,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};e.AnnotationEditorParamsType=h;const d={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=d;const f={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=f;const v={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=v;const T={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=T;const R={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=R;const N={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=N;const m={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=m;const b={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=b;const P={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=P;const x={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=x;const S={O:"PageOpen",C:"PageClose"};e.PageActionEventType=S;const w={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=w;const E={NONE:0,BINARY:1};e.CMapCompressionType=E;const V={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=V;const $={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=$;let j=w.WARNINGS;function D(Se){Number.isInteger(Se)&&(j=Se)}function Y(){return j}function G(Se){j>=w.INFOS&&console.log(`Info: ${Se}`)}function X(Se){j>=w.WARNINGS&&console.log(`Warning: ${Se}`)}function Z(Se){throw new Error(Se)}function ne(Se,ce){Se||Z(ce)}function ie(Se){switch(Se==null?void 0:Se.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function be(Se){let ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!Se)return null;try{if(oe&&typeof Se=="string"){if(oe.addDefaultProtocol&&Se.startsWith("www.")){const Ie=Se.match(/\./g);(Ie==null?void 0:Ie.length)>=2&&(Se=`http://${Se}`)}if(oe.tryConvertEncoding)try{Se=de(Se)}catch{}}const Re=ce?new URL(Se,ce):new URL(Se);if(ie(Re))return Re}catch{}return null}function Q(Se,ce,oe){let Re=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return Object.defineProperty(Se,ce,{value:oe,enumerable:!Re,configurable:!0,writable:!1}),oe}const O=function(){function ce(oe,Re){this.constructor===ce&&Z("Cannot initialize BaseException."),this.message=oe,this.name=Re}return ce.prototype=new Error,ce.constructor=ce,ce}();e.BaseException=O;class k extends O{constructor(ce,oe){super(ce,"PasswordException"),this.code=oe}}e.PasswordException=k;class F extends O{constructor(ce,oe){super(ce,"UnknownErrorException"),this.details=oe}}e.UnknownErrorException=F;class z extends O{constructor(ce){super(ce,"InvalidPDFException")}}e.InvalidPDFException=z;class L extends O{constructor(ce){super(ce,"MissingPDFException")}}e.MissingPDFException=L;class K extends O{constructor(ce,oe){super(ce,"UnexpectedResponseException"),this.status=oe}}e.UnexpectedResponseException=K;class U extends O{constructor(ce){super(ce,"FormatError")}}e.FormatError=U;class te extends O{constructor(ce){super(ce,"AbortException")}}e.AbortException=te;function pe(Se){(typeof Se!="object"||(Se==null?void 0:Se.length)===void 0)&&Z("Invalid argument for bytesToString");const ce=Se.length,oe=8192;if(ce<oe)return String.fromCharCode.apply(null,Se);const Re=[];for(let Ie=0;Ie<ce;Ie+=oe){const et=Math.min(Ie+oe,ce),fe=Se.subarray(Ie,et);Re.push(String.fromCharCode.apply(null,fe))}return Re.join("")}function ue(Se){typeof Se!="string"&&Z("Invalid argument for stringToBytes");const ce=Se.length,oe=new Uint8Array(ce);for(let Re=0;Re<ce;++Re)oe[Re]=Se.charCodeAt(Re)&255;return oe}function ve(Se){return String.fromCharCode(Se>>24&255,Se>>16&255,Se>>8&255,Se&255)}function se(Se){return Object.keys(Se).length}function ge(Se){const ce=Object.create(null);for(const[oe,Re]of Se)ce[oe]=Re;return ce}function Ee(){const Se=new Uint8Array(4);return Se[0]=1,new Uint32Array(Se.buffer,0,1)[0]===1}function Oe(){try{return new Function(""),!0}catch{return!1}}class Me{static get isLittleEndian(){return Q(this,"isLittleEndian",Ee())}static get isEvalSupported(){return Q(this,"isEvalSupported",Oe())}static get isOffscreenCanvasSupported(){return Q(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?Q(this,"platform",{isWin:!1,isMac:!1}):Q(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}e.FeatureTest=Me;const we=[...Array(256).keys()].map(Se=>Se.toString(16).padStart(2,"0"));class Ue{static makeHexColor(ce,oe,Re){return`#${we[ce]}${we[oe]}${we[Re]}`}static scaleMinMax(ce,oe){let Re;ce[0]?(ce[0]<0&&(Re=oe[0],oe[0]=oe[1],oe[1]=Re),oe[0]*=ce[0],oe[1]*=ce[0],ce[3]<0&&(Re=oe[2],oe[2]=oe[3],oe[3]=Re),oe[2]*=ce[3],oe[3]*=ce[3]):(Re=oe[0],oe[0]=oe[2],oe[2]=Re,Re=oe[1],oe[1]=oe[3],oe[3]=Re,ce[1]<0&&(Re=oe[2],oe[2]=oe[3],oe[3]=Re),oe[2]*=ce[1],oe[3]*=ce[1],ce[2]<0&&(Re=oe[0],oe[0]=oe[1],oe[1]=Re),oe[0]*=ce[2],oe[1]*=ce[2]),oe[0]+=ce[4],oe[1]+=ce[4],oe[2]+=ce[5],oe[3]+=ce[5]}static transform(ce,oe){return[ce[0]*oe[0]+ce[2]*oe[1],ce[1]*oe[0]+ce[3]*oe[1],ce[0]*oe[2]+ce[2]*oe[3],ce[1]*oe[2]+ce[3]*oe[3],ce[0]*oe[4]+ce[2]*oe[5]+ce[4],ce[1]*oe[4]+ce[3]*oe[5]+ce[5]]}static applyTransform(ce,oe){const Re=ce[0]*oe[0]+ce[1]*oe[2]+oe[4],Ie=ce[0]*oe[1]+ce[1]*oe[3]+oe[5];return[Re,Ie]}static applyInverseTransform(ce,oe){const Re=oe[0]*oe[3]-oe[1]*oe[2],Ie=(ce[0]*oe[3]-ce[1]*oe[2]+oe[2]*oe[5]-oe[4]*oe[3])/Re,et=(-ce[0]*oe[1]+ce[1]*oe[0]+oe[4]*oe[1]-oe[5]*oe[0])/Re;return[Ie,et]}static getAxialAlignedBoundingBox(ce,oe){const Re=this.applyTransform(ce,oe),Ie=this.applyTransform(ce.slice(2,4),oe),et=this.applyTransform([ce[0],ce[3]],oe),fe=this.applyTransform([ce[2],ce[1]],oe);return[Math.min(Re[0],Ie[0],et[0],fe[0]),Math.min(Re[1],Ie[1],et[1],fe[1]),Math.max(Re[0],Ie[0],et[0],fe[0]),Math.max(Re[1],Ie[1],et[1],fe[1])]}static inverseTransform(ce){const oe=ce[0]*ce[3]-ce[1]*ce[2];return[ce[3]/oe,-ce[1]/oe,-ce[2]/oe,ce[0]/oe,(ce[2]*ce[5]-ce[4]*ce[3])/oe,(ce[4]*ce[1]-ce[5]*ce[0])/oe]}static singularValueDecompose2dScale(ce){const oe=[ce[0],ce[2],ce[1],ce[3]],Re=ce[0]*oe[0]+ce[1]*oe[2],Ie=ce[0]*oe[1]+ce[1]*oe[3],et=ce[2]*oe[0]+ce[3]*oe[2],fe=ce[2]*oe[1]+ce[3]*oe[3],M=(Re+fe)/2,ee=Math.sqrt((Re+fe)**2-4*(Re*fe-et*Ie))/2,he=M+ee||1,ae=M-ee||1;return[Math.sqrt(he),Math.sqrt(ae)]}static normalizeRect(ce){const oe=ce.slice(0);return ce[0]>ce[2]&&(oe[0]=ce[2],oe[2]=ce[0]),ce[1]>ce[3]&&(oe[1]=ce[3],oe[3]=ce[1]),oe}static intersect(ce,oe){const Re=Math.max(Math.min(ce[0],ce[2]),Math.min(oe[0],oe[2])),Ie=Math.min(Math.max(ce[0],ce[2]),Math.max(oe[0],oe[2]));if(Re>Ie)return null;const et=Math.max(Math.min(ce[1],ce[3]),Math.min(oe[1],oe[3])),fe=Math.min(Math.max(ce[1],ce[3]),Math.max(oe[1],oe[3]));return et>fe?null:[Re,et,Ie,fe]}static bezierBoundingBox(ce,oe,Re,Ie,et,fe,M,ee){const he=[],ae=[[],[]];let W,I,q,H,J,le,xe,Pe;for(let Fe=0;Fe<2;++Fe){if(Fe===0?(I=6*ce-12*Re+6*et,W=-3*ce+9*Re-9*et+3*M,q=3*Re-3*ce):(I=6*oe-12*Ie+6*fe,W=-3*oe+9*Ie-9*fe+3*ee,q=3*Ie-3*oe),Math.abs(W)<1e-12){if(Math.abs(I)<1e-12)continue;H=-q/I,0<H&&H<1&&he.push(H);continue}xe=I*I-4*q*W,Pe=Math.sqrt(xe),!(xe<0)&&(J=(-I+Pe)/(2*W),0<J&&J<1&&he.push(J),le=(-I-Pe)/(2*W),0<le&&le<1&&he.push(le))}let We=he.length,ke;const He=We;for(;We--;)H=he[We],ke=1-H,ae[0][We]=ke*ke*ke*ce+3*ke*ke*H*Re+3*ke*H*H*et+H*H*H*M,ae[1][We]=ke*ke*ke*oe+3*ke*ke*H*Ie+3*ke*H*H*fe+H*H*H*ee;return ae[0][He]=ce,ae[1][He]=oe,ae[0][He+1]=M,ae[1][He+1]=ee,ae[0].length=ae[1].length=He+2,[Math.min(...ae[0]),Math.min(...ae[1]),Math.max(...ae[0]),Math.max(...ae[1])]}}e.Util=Ue;const Ne=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Ae(Se){if(Se[0]>="ï"){let oe;if(Se[0]==="þ"&&Se[1]==="ÿ"?oe="utf-16be":Se[0]==="ÿ"&&Se[1]==="þ"?oe="utf-16le":Se[0]==="ï"&&Se[1]==="»"&&Se[2]==="¿"&&(oe="utf-8"),oe)try{const Re=new TextDecoder(oe,{fatal:!0}),Ie=ue(Se);return Re.decode(Ie)}catch(Re){X(`stringToPDFString: "${Re}".`)}}const ce=[];for(let oe=0,Re=Se.length;oe<Re;oe++){const Ie=Ne[Se.charCodeAt(oe)];ce.push(Ie?String.fromCharCode(Ie):Se.charAt(oe))}return ce.join("")}function de(Se){return decodeURIComponent(escape(Se))}function Te(Se){return unescape(encodeURIComponent(Se))}function _e(Se){return typeof Se=="object"&&(Se==null?void 0:Se.byteLength)!==void 0}function Ve(Se,ce){if(Se.length!==ce.length)return!1;for(let oe=0,Re=Se.length;oe<Re;oe++)if(Se[oe]!==ce[oe])return!1;return!0}function Ge(){let Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Date;return[Se.getUTCFullYear().toString(),(Se.getUTCMonth()+1).toString().padStart(2,"0"),Se.getUTCDate().toString().padStart(2,"0"),Se.getUTCHours().toString().padStart(2,"0"),Se.getUTCMinutes().toString().padStart(2,"0"),Se.getUTCSeconds().toString().padStart(2,"0")].join("")}class Ke{constructor(){re(this,Ye,!1);this.promise=new Promise((ce,oe)=>{this.resolve=Re=>{ye(this,Ye,!0),ce(Re)},this.reject=Re=>{ye(this,Ye,!0),oe(Re)}})}get settled(){return _(this,Ye)}}Ye=new WeakMap,e.PromiseCapability=Ke;let $e=null,Ze=null;function Qe(Se){return $e||($e=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ze=new Map([["ﬅ","ſt"]])),Se.replaceAll($e,(ce,oe,Re)=>oe?oe.normalize("NFKC"):Ze.get(Re))}function qe(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Se=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Se);else for(let ce=0;ce<32;ce++)Se[ce]=Math.floor(Math.random()*255);return pe(Se)}},(r,e,t)=>{var n=t(3),s=t(4),i=t(69),o=t(70),a="WebAssembly",l=s[a],c=Error("e",{cause:7}).cause!==7,u=function(g,y){var h={};h[g]=o(g,y,c),n({global:!0,constructor:!0,arity:1,forced:c},h)},p=function(g,y){if(l&&l[g]){var h={};h[g]=o(a+"."+g,y,c),n({target:a,stat:!0,constructor:!0,arity:1,forced:c},h)}};u("Error",function(g){return function(h){return i(g,this,arguments)}}),u("EvalError",function(g){return function(h){return i(g,this,arguments)}}),u("RangeError",function(g){return function(h){return i(g,this,arguments)}}),u("ReferenceError",function(g){return function(h){return i(g,this,arguments)}}),u("SyntaxError",function(g){return function(h){return i(g,this,arguments)}}),u("TypeError",function(g){return function(h){return i(g,this,arguments)}}),u("URIError",function(g){return function(h){return i(g,this,arguments)}}),p("CompileError",function(g){return function(h){return i(g,this,arguments)}}),p("LinkError",function(g){return function(h){return i(g,this,arguments)}}),p("RuntimeError",function(g){return function(h){return i(g,this,arguments)}})},(r,e,t)=>{var n=t(4),s=t(5).f,i=t(44),o=t(48),a=t(38),l=t(56),c=t(68);r.exports=function(u,p){var g=u.target,y=u.global,h=u.stat,d,f,v,T,R,N;if(y?f=n:h?f=n[g]||a(g,{}):f=(n[g]||{}).prototype,f)for(v in p){if(R=p[v],u.dontCallGetSet?(N=s(f,v),T=N&&N.value):T=f[v],d=c(y?v:g+(h?".":"#")+v,u.forced),!d&&T!==void 0){if(typeof R==typeof T)continue;l(R,T)}(u.sham||T&&T.sham)&&i(R,"sham",!0),o(f,v,R,u)}}},function(r){var e=function(t){return t&&t.Math==Math&&t};r.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||this||Function("return this")()},(r,e,t)=>{var n=t(6),s=t(8),i=t(10),o=t(11),a=t(12),l=t(18),c=t(39),u=t(42),p=Object.getOwnPropertyDescriptor;e.f=n?p:function(y,h){if(y=a(y),h=l(h),u)try{return p(y,h)}catch{}if(c(y,h))return o(!s(i.f,y,h),y[h])}},(r,e,t)=>{var n=t(7);r.exports=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},r=>{r.exports=function(e){try{return!!e()}catch{return!0}}},(r,e,t)=>{var n=t(9),s=Function.prototype.call;r.exports=n?s.bind(s):function(){return s.apply(s,arguments)}},(r,e,t)=>{var n=t(7);r.exports=!n(function(){var s=(function(){}).bind();return typeof s!="function"||s.hasOwnProperty("prototype")})},(r,e)=>{var t={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,s=n&&!t.call({1:2},1);e.f=s?function(o){var a=n(this,o);return!!a&&a.enumerable}:t},r=>{r.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},(r,e,t)=>{var n=t(13),s=t(16);r.exports=function(i){return n(s(i))}},(r,e,t)=>{var n=t(14),s=t(7),i=t(15),o=Object,a=n("".split);r.exports=s(function(){return!o("z").propertyIsEnumerable(0)})?function(l){return i(l)=="String"?a(l,""):o(l)}:o},(r,e,t)=>{var n=t(9),s=Function.prototype,i=s.call,o=n&&s.bind.bind(i,i);r.exports=n?o:function(a){return function(){return i.apply(a,arguments)}}},(r,e,t)=>{var n=t(14),s=n({}.toString),i=n("".slice);r.exports=function(o){return i(s(o),8,-1)}},(r,e,t)=>{var n=t(17),s=TypeError;r.exports=function(i){if(n(i))throw s("Can't call method on "+i);return i}},r=>{r.exports=function(e){return e==null}},(r,e,t)=>{var n=t(19),s=t(23);r.exports=function(i){var o=n(i,"string");return s(o)?o:o+""}},(r,e,t)=>{var n=t(8),s=t(20),i=t(23),o=t(30),a=t(33),l=t(34),c=TypeError,u=l("toPrimitive");r.exports=function(p,g){if(!s(p)||i(p))return p;var y=o(p,u),h;if(y){if(g===void 0&&(g="default"),h=n(y,p,g),!s(h)||i(h))return h;throw c("Can't convert object to primitive value")}return g===void 0&&(g="number"),a(p,g)}},(r,e,t)=>{var n=t(21),s=t(22),i=s.all;r.exports=s.IS_HTMLDDA?function(o){return typeof o=="object"?o!==null:n(o)||o===i}:function(o){return typeof o=="object"?o!==null:n(o)}},(r,e,t)=>{var n=t(22),s=n.all;r.exports=n.IS_HTMLDDA?function(i){return typeof i=="function"||i===s}:function(i){return typeof i=="function"}},r=>{var e=typeof document=="object"&&document.all,t=typeof e>"u"&&e!==void 0;r.exports={all:e,IS_HTMLDDA:t}},(r,e,t)=>{var n=t(24),s=t(21),i=t(25),o=t(26),a=Object;r.exports=o?function(l){return typeof l=="symbol"}:function(l){var c=n("Symbol");return s(c)&&i(c.prototype,a(l))}},(r,e,t)=>{var n=t(4),s=t(21),i=function(o){return s(o)?o:void 0};r.exports=function(o,a){return arguments.length<2?i(n[o]):n[o]&&n[o][a]}},(r,e,t)=>{var n=t(14);r.exports=n({}.isPrototypeOf)},(r,e,t)=>{var n=t(27);r.exports=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},(r,e,t)=>{var n=t(28),s=t(7),i=t(4),o=i.String;r.exports=!!Object.getOwnPropertySymbols&&!s(function(){var a=Symbol();return!o(a)||!(Object(a)instanceof Symbol)||!Symbol.sham&&n&&n<41})},(r,e,t)=>{var n=t(4),s=t(29),i=n.process,o=n.Deno,a=i&&i.versions||o&&o.version,l=a&&a.v8,c,u;l&&(c=l.split("."),u=c[0]>0&&c[0]<4?1:+(c[0]+c[1])),!u&&s&&(c=s.match(/Edge\/(\d+)/),(!c||c[1]>=74)&&(c=s.match(/Chrome\/(\d+)/),c&&(u=+c[1]))),r.exports=u},r=>{r.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},(r,e,t)=>{var n=t(31),s=t(17);r.exports=function(i,o){var a=i[o];return s(a)?void 0:n(a)}},(r,e,t)=>{var n=t(21),s=t(32),i=TypeError;r.exports=function(o){if(n(o))return o;throw i(s(o)+" is not a function")}},r=>{var e=String;r.exports=function(t){try{return e(t)}catch{return"Object"}}},(r,e,t)=>{var n=t(8),s=t(21),i=t(20),o=TypeError;r.exports=function(a,l){var c,u;if(l==="string"&&s(c=a.toString)&&!i(u=n(c,a))||s(c=a.valueOf)&&!i(u=n(c,a))||l!=="string"&&s(c=a.toString)&&!i(u=n(c,a)))return u;throw o("Can't convert object to primitive value")}},(r,e,t)=>{var n=t(4),s=t(35),i=t(39),o=t(41),a=t(27),l=t(26),c=n.Symbol,u=s("wks"),p=l?c.for||c:c&&c.withoutSetter||o;r.exports=function(g){return i(u,g)||(u[g]=a&&i(c,g)?c[g]:p("Symbol."+g)),u[g]}},(r,e,t)=>{var n=t(36),s=t(37);(r.exports=function(i,o){return s[i]||(s[i]=o!==void 0?o:{})})("versions",[]).push({version:"3.31.1",mode:n?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"})},r=>{r.exports=!1},(r,e,t)=>{var n=t(4),s=t(38),i="__core-js_shared__",o=n[i]||s(i,{});r.exports=o},(r,e,t)=>{var n=t(4),s=Object.defineProperty;r.exports=function(i,o){try{s(n,i,{value:o,configurable:!0,writable:!0})}catch{n[i]=o}return o}},(r,e,t)=>{var n=t(14),s=t(40),i=n({}.hasOwnProperty);r.exports=Object.hasOwn||function(a,l){return i(s(a),l)}},(r,e,t)=>{var n=t(16),s=Object;r.exports=function(i){return s(n(i))}},(r,e,t)=>{var n=t(14),s=0,i=Math.random(),o=n(1 .toString);r.exports=function(a){return"Symbol("+(a===void 0?"":a)+")_"+o(++s+i,36)}},(r,e,t)=>{var n=t(6),s=t(7),i=t(43);r.exports=!n&&!s(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!=7})},(r,e,t)=>{var n=t(4),s=t(20),i=n.document,o=s(i)&&s(i.createElement);r.exports=function(a){return o?i.createElement(a):{}}},(r,e,t)=>{var n=t(6),s=t(45),i=t(11);r.exports=n?function(o,a,l){return s.f(o,a,i(1,l))}:function(o,a,l){return o[a]=l,o}},(r,e,t)=>{var n=t(6),s=t(42),i=t(46),o=t(47),a=t(18),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,p="enumerable",g="configurable",y="writable";e.f=n?i?function(d,f,v){if(o(d),f=a(f),o(v),typeof d=="function"&&f==="prototype"&&"value"in v&&y in v&&!v[y]){var T=u(d,f);T&&T[y]&&(d[f]=v.value,v={configurable:g in v?v[g]:T[g],enumerable:p in v?v[p]:T[p],writable:!1})}return c(d,f,v)}:c:function(d,f,v){if(o(d),f=a(f),o(v),s)try{return c(d,f,v)}catch{}if("get"in v||"set"in v)throw l("Accessors not supported");return"value"in v&&(d[f]=v.value),d}},(r,e,t)=>{var n=t(6),s=t(7);r.exports=n&&s(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},(r,e,t)=>{var n=t(20),s=String,i=TypeError;r.exports=function(o){if(n(o))return o;throw i(s(o)+" is not an object")}},(r,e,t)=>{var n=t(21),s=t(45),i=t(49),o=t(38);r.exports=function(a,l,c,u){u||(u={});var p=u.enumerable,g=u.name!==void 0?u.name:l;if(n(c)&&i(c,g,u),u.global)p?a[l]=c:o(l,c);else{try{u.unsafe?a[l]&&(p=!0):delete a[l]}catch{}p?a[l]=c:s.f(a,l,{value:c,enumerable:!1,configurable:!u.nonConfigurable,writable:!u.nonWritable})}return a}},(r,e,t)=>{var n=t(14),s=t(7),i=t(21),o=t(39),a=t(6),l=t(50).CONFIGURABLE,c=t(51),u=t(52),p=u.enforce,g=u.get,y=String,h=Object.defineProperty,d=n("".slice),f=n("".replace),v=n([].join),T=a&&!s(function(){return h(function(){},"length",{value:8}).length!==8}),R=String(String).split("String"),N=r.exports=function(m,b,P){d(y(b),0,7)==="Symbol("&&(b="["+f(y(b),/^Symbol\(([^)]*)\)/,"$1")+"]"),P&&P.getter&&(b="get "+b),P&&P.setter&&(b="set "+b),(!o(m,"name")||l&&m.name!==b)&&(a?h(m,"name",{value:b,configurable:!0}):m.name=b),T&&P&&o(P,"arity")&&m.length!==P.arity&&h(m,"length",{value:P.arity});try{P&&o(P,"constructor")&&P.constructor?a&&h(m,"prototype",{writable:!1}):m.prototype&&(m.prototype=void 0)}catch{}var x=p(m);return o(x,"source")||(x.source=v(R,typeof b=="string"?b:"")),m};Function.prototype.toString=N(function(){return i(this)&&g(this).source||c(this)},"toString")},(r,e,t)=>{var n=t(6),s=t(39),i=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=s(i,"name"),l=a&&(function(){}).name==="something",c=a&&(!n||n&&o(i,"name").configurable);r.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},(r,e,t)=>{var n=t(14),s=t(21),i=t(37),o=n(Function.toString);s(i.inspectSource)||(i.inspectSource=function(a){return o(a)}),r.exports=i.inspectSource},(r,e,t)=>{var n=t(53),s=t(4),i=t(20),o=t(44),a=t(39),l=t(37),c=t(54),u=t(55),p="Object already initialized",g=s.TypeError,y=s.WeakMap,h,d,f,v=function(m){return f(m)?d(m):h(m,{})},T=function(m){return function(b){var P;if(!i(b)||(P=d(b)).type!==m)throw g("Incompatible receiver, "+m+" required");return P}};if(n||l.state){var R=l.state||(l.state=new y);R.get=R.get,R.has=R.has,R.set=R.set,h=function(m,b){if(R.has(m))throw g(p);return b.facade=m,R.set(m,b),b},d=function(m){return R.get(m)||{}},f=function(m){return R.has(m)}}else{var N=c("state");u[N]=!0,h=function(m,b){if(a(m,N))throw g(p);return b.facade=m,o(m,N,b),b},d=function(m){return a(m,N)?m[N]:{}},f=function(m){return a(m,N)}}r.exports={set:h,get:d,has:f,enforce:v,getterFor:T}},(r,e,t)=>{var n=t(4),s=t(21),i=n.WeakMap;r.exports=s(i)&&/native code/.test(String(i))},(r,e,t)=>{var n=t(35),s=t(41),i=n("keys");r.exports=function(o){return i[o]||(i[o]=s(o))}},r=>{r.exports={}},(r,e,t)=>{var n=t(39),s=t(57),i=t(5),o=t(45);r.exports=function(a,l,c){for(var u=s(l),p=o.f,g=i.f,y=0;y<u.length;y++){var h=u[y];!n(a,h)&&!(c&&n(c,h))&&p(a,h,g(l,h))}}},(r,e,t)=>{var n=t(24),s=t(14),i=t(58),o=t(67),a=t(47),l=s([].concat);r.exports=n("Reflect","ownKeys")||function(u){var p=i.f(a(u)),g=o.f;return g?l(p,g(u)):p}},(r,e,t)=>{var n=t(59),s=t(66),i=s.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(a){return n(a,i)}},(r,e,t)=>{var n=t(14),s=t(39),i=t(12),o=t(60).indexOf,a=t(55),l=n([].push);r.exports=function(c,u){var p=i(c),g=0,y=[],h;for(h in p)!s(a,h)&&s(p,h)&&l(y,h);for(;u.length>g;)s(p,h=u[g++])&&(~o(y,h)||l(y,h));return y}},(r,e,t)=>{var n=t(12),s=t(61),i=t(64),o=function(a){return function(l,c,u){var p=n(l),g=i(p),y=s(u,g),h;if(a&&c!=c){for(;g>y;)if(h=p[y++],h!=h)return!0}else for(;g>y;y++)if((a||y in p)&&p[y]===c)return a||y||0;return!a&&-1}};r.exports={includes:o(!0),indexOf:o(!1)}},(r,e,t)=>{var n=t(62),s=Math.max,i=Math.min;r.exports=function(o,a){var l=n(o);return l<0?s(l+a,0):i(l,a)}},(r,e,t)=>{var n=t(63);r.exports=function(s){var i=+s;return i!==i||i===0?0:n(i)}},r=>{var e=Math.ceil,t=Math.floor;r.exports=Math.trunc||function(s){var i=+s;return(i>0?t:e)(i)}},(r,e,t)=>{var n=t(65);r.exports=function(s){return n(s.length)}},(r,e,t)=>{var n=t(62),s=Math.min;r.exports=function(i){return i>0?s(n(i),9007199254740991):0}},r=>{r.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},(r,e)=>{e.f=Object.getOwnPropertySymbols},(r,e,t)=>{var n=t(7),s=t(21),i=/#|\.prototype\./,o=function(p,g){var y=l[a(p)];return y==u?!0:y==c?!1:s(g)?n(g):!!g},a=o.normalize=function(p){return String(p).replace(i,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";r.exports=o},(r,e,t)=>{var n=t(9),s=Function.prototype,i=s.apply,o=s.call;r.exports=typeof Reflect=="object"&&Reflect.apply||(n?o.bind(i):function(){return o.apply(i,arguments)})},(r,e,t)=>{var n=t(24),s=t(39),i=t(44),o=t(25),a=t(71),l=t(56),c=t(74),u=t(75),p=t(76),g=t(80),y=t(81),h=t(6),d=t(36);r.exports=function(f,v,T,R){var N="stackTraceLimit",m=R?2:1,b=f.split("."),P=b[b.length-1],x=n.apply(null,b);if(x){var S=x.prototype;if(!d&&s(S,"cause")&&delete S.cause,!T)return x;var w=n("Error"),E=v(function(V,$){var j=p(R?$:V,void 0),D=R?new x(V):new x;return j!==void 0&&i(D,"message",j),y(D,E,D.stack,2),this&&o(S,this)&&u(D,this,E),arguments.length>m&&g(D,arguments[m]),D});if(E.prototype=S,P!=="Error"?a?a(E,w):l(E,w,{name:!0}):h&&N in x&&(c(E,x,N),c(E,x,"prepareStackTrace")),l(E,x),!d)try{S.name!==P&&i(S,"name",P),S.constructor=E}catch{}return E}}},(r,e,t)=>{var n=t(72),s=t(47),i=t(73);r.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,a={},l;try{l=n(Object.prototype,"__proto__","set"),l(a,[]),o=a instanceof Array}catch{}return function(u,p){return s(u),i(p),o?l(u,p):u.__proto__=p,u}}():void 0)},(r,e,t)=>{var n=t(14),s=t(31);r.exports=function(i,o,a){try{return n(s(Object.getOwnPropertyDescriptor(i,o)[a]))}catch{}}},(r,e,t)=>{var n=t(21),s=String,i=TypeError;r.exports=function(o){if(typeof o=="object"||n(o))return o;throw i("Can't set "+s(o)+" as a prototype")}},(r,e,t)=>{var n=t(45).f;r.exports=function(s,i,o){o in s||n(s,o,{configurable:!0,get:function(){return i[o]},set:function(a){i[o]=a}})}},(r,e,t)=>{var n=t(21),s=t(20),i=t(71);r.exports=function(o,a,l){var c,u;return i&&n(c=a.constructor)&&c!==l&&s(u=c.prototype)&&u!==l.prototype&&i(o,u),o}},(r,e,t)=>{var n=t(77);r.exports=function(s,i){return s===void 0?arguments.length<2?"":i:n(s)}},(r,e,t)=>{var n=t(78),s=String;r.exports=function(i){if(n(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return s(i)}},(r,e,t)=>{var n=t(79),s=t(21),i=t(15),o=t(34),a=o("toStringTag"),l=Object,c=i(function(){return arguments}())=="Arguments",u=function(p,g){try{return p[g]}catch{}};r.exports=n?i:function(p){var g,y,h;return p===void 0?"Undefined":p===null?"Null":typeof(y=u(g=l(p),a))=="string"?y:c?i(g):(h=i(g))=="Object"&&s(g.callee)?"Arguments":h}},(r,e,t)=>{var n=t(34),s=n("toStringTag"),i={};i[s]="z",r.exports=String(i)==="[object z]"},(r,e,t)=>{var n=t(20),s=t(44);r.exports=function(i,o){n(o)&&"cause"in o&&s(i,"cause",o.cause)}},(r,e,t)=>{var n=t(44),s=t(82),i=t(83),o=Error.captureStackTrace;r.exports=function(a,l,c,u){i&&(o?o(a,l):n(a,"stack",s(c,u)))}},(r,e,t)=>{var n=t(14),s=Error,i=n("".replace),o=function(c){return String(s(c).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(o);r.exports=function(c,u){if(l&&typeof c=="string"&&!s.prepareStackTrace)for(;u--;)c=i(c,a,"");return c}},(r,e,t)=>{var n=t(7),s=t(11);r.exports=!n(function(){var i=Error("a");return"stack"in i?(Object.defineProperty(i,"stack",s(1,7)),i.stack!==7):!0})},(r,e,t)=>{var n=t(48),s=t(14),i=t(77),o=t(85),a=URLSearchParams,l=a.prototype,c=s(l.append),u=s(l.delete),p=s(l.forEach),g=s([].push),y=new a("a=1&a=2");y.delete("a",1),y+""!="a=2"&&n(l,"delete",function(h){var d=arguments.length,f=d<2?void 0:arguments[1];if(d&&f===void 0)return u(this,h);var v=[];p(this,function(S,w){g(v,{key:w,value:S})}),o(d,1);for(var T=i(h),R=i(f),N=0,m=0,b=!1,P=v.length,x;N<P;)x=v[N++],b||x.key===T?(b=!0,u(this,x.key)):m++;for(;m<P;)x=v[m++],x.key===T&&x.value===R||c(this,x.key,x.value)},{enumerable:!0,unsafe:!0})},r=>{var e=TypeError;r.exports=function(t,n){if(t<n)throw e("Not enough arguments");return t}},(r,e,t)=>{var n=t(48),s=t(14),i=t(77),o=t(85),a=URLSearchParams,l=a.prototype,c=s(l.getAll),u=s(l.has),p=new a("a=1");p.has("a",2)&&n(l,"has",function(y){var h=arguments.length,d=h<2?void 0:arguments[1];if(h&&d===void 0)return u(this,y);var f=c(this,y);o(h,1);for(var v=i(d),T=0;T<f.length;)if(f[T++]===v)return!0;return!1},{enumerable:!0,unsafe:!0})},(r,e,t)=>{var n=t(6),s=t(14),i=t(88),o=URLSearchParams.prototype,a=s(o.forEach);n&&!("size"in o)&&i(o,"size",{get:function(){var c=0;return a(this,function(){c++}),c},configurable:!0,enumerable:!0})},(r,e,t)=>{var n=t(49),s=t(45);r.exports=function(i,o,a){return a.get&&n(a.get,o,{getter:!0}),a.set&&n(a.set,o,{setter:!0}),s.f(i,o,a)}},(r,e,t)=>{var n=t(3),s=t(40),i=t(64),o=t(90),a=t(92),l=t(7),c=l(function(){return[].push.call({length:4294967296},1)!==4294967297}),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(g){return g instanceof TypeError}},p=c||!u();n({target:"Array",proto:!0,arity:1,forced:p},{push:function(y){var h=s(this),d=i(h),f=arguments.length;a(d+f);for(var v=0;v<f;v++)h[d]=arguments[v],d++;return o(h,d),d}})},(r,e,t)=>{var n=t(6),s=t(91),i=TypeError,o=Object.getOwnPropertyDescriptor,a=n&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(l){return l instanceof TypeError}}();r.exports=a?function(l,c){if(s(l)&&!o(l,"length").writable)throw i("Cannot set read only .length");return l.length=c}:function(l,c){return l.length=c}},(r,e,t)=>{var n=t(15);r.exports=Array.isArray||function(i){return n(i)=="Array"}},r=>{var e=TypeError,t=9007199254740991;r.exports=function(n){if(n>t)throw e("Maximum allowed index exceeded");return n}},(r,e,t)=>{var n=t(94),s=t(98).findLast,i=n.aTypedArray,o=n.exportTypedArrayMethod;o("findLast",function(l){return s(i(this),l,arguments.length>1?arguments[1]:void 0)})},(r,e,t)=>{var n=t(95),s=t(6),i=t(4),o=t(21),a=t(20),l=t(39),c=t(78),u=t(32),p=t(44),g=t(48),y=t(88),h=t(25),d=t(96),f=t(71),v=t(34),T=t(41),R=t(52),N=R.enforce,m=R.get,b=i.Int8Array,P=b&&b.prototype,x=i.Uint8ClampedArray,S=x&&x.prototype,w=b&&d(b),E=P&&d(P),V=Object.prototype,$=i.TypeError,j=v("toStringTag"),D=T("TYPED_ARRAY_TAG"),Y="TypedArrayConstructor",G=n&&!!f&&c(i.opera)!=="Opera",X=!1,Z,ne,ie,be={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Q={BigInt64Array:8,BigUint64Array:8},O=function(pe){if(!a(pe))return!1;var ue=c(pe);return ue==="DataView"||l(be,ue)||l(Q,ue)},k=function(te){var pe=d(te);if(a(pe)){var ue=m(pe);return ue&&l(ue,Y)?ue[Y]:k(pe)}},F=function(te){if(!a(te))return!1;var pe=c(te);return l(be,pe)||l(Q,pe)},z=function(te){if(F(te))return te;throw $("Target is not a typed array")},L=function(te){if(o(te)&&(!f||h(w,te)))return te;throw $(u(te)+" is not a typed array constructor")},K=function(te,pe,ue,ve){if(s){if(ue)for(var se in be){var ge=i[se];if(ge&&l(ge.prototype,te))try{delete ge.prototype[te]}catch{try{ge.prototype[te]=pe}catch{}}}(!E[te]||ue)&&g(E,te,ue?pe:G&&P[te]||pe,ve)}},U=function(te,pe,ue){var ve,se;if(s){if(f){if(ue){for(ve in be)if(se=i[ve],se&&l(se,te))try{delete se[te]}catch{}}if(!w[te]||ue)try{return g(w,te,ue?pe:G&&w[te]||pe)}catch{}else return}for(ve in be)se=i[ve],se&&(!se[te]||ue)&&g(se,te,pe)}};for(Z in be)ne=i[Z],ie=ne&&ne.prototype,ie?N(ie)[Y]=ne:G=!1;for(Z in Q)ne=i[Z],ie=ne&&ne.prototype,ie&&(N(ie)[Y]=ne);if((!G||!o(w)||w===Function.prototype)&&(w=function(){throw $("Incorrect invocation")},G))for(Z in be)i[Z]&&f(i[Z],w);if((!G||!E||E===V)&&(E=w.prototype,G))for(Z in be)i[Z]&&f(i[Z].prototype,E);if(G&&d(S)!==E&&f(S,E),s&&!l(E,j)){X=!0,y(E,j,{configurable:!0,get:function(){return a(this)?this[D]:void 0}});for(Z in be)i[Z]&&p(i[Z],D,Z)}r.exports={NATIVE_ARRAY_BUFFER_VIEWS:G,TYPED_ARRAY_TAG:X&&D,aTypedArray:z,aTypedArrayConstructor:L,exportTypedArrayMethod:K,exportTypedArrayStaticMethod:U,getTypedArrayConstructor:k,isView:O,isTypedArray:F,TypedArray:w,TypedArrayPrototype:E}},r=>{r.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},(r,e,t)=>{var n=t(39),s=t(21),i=t(40),o=t(54),a=t(97),l=o("IE_PROTO"),c=Object,u=c.prototype;r.exports=a?c.getPrototypeOf:function(p){var g=i(p);if(n(g,l))return g[l];var y=g.constructor;return s(y)&&g instanceof y?y.prototype:g instanceof c?u:null}},(r,e,t)=>{var n=t(7);r.exports=!n(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype})},(r,e,t)=>{var n=t(99),s=t(13),i=t(40),o=t(64),a=function(l){var c=l==1;return function(u,p,g){for(var y=i(u),h=s(y),d=n(p,g),f=o(h),v,T;f-- >0;)if(v=h[f],T=d(v,f,y),T)switch(l){case 0:return v;case 1:return f}return c?-1:void 0}};r.exports={findLast:a(0),findLastIndex:a(1)}},(r,e,t)=>{var n=t(100),s=t(31),i=t(9),o=n(n.bind);r.exports=function(a,l){return s(a),l===void 0?a:i?o(a,l):function(){return a.apply(l,arguments)}}},(r,e,t)=>{var n=t(15),s=t(14);r.exports=function(i){if(n(i)==="Function")return s(i)}},(r,e,t)=>{var n=t(94),s=t(98).findLastIndex,i=n.aTypedArray,o=n.exportTypedArrayMethod;o("findLastIndex",function(l){return s(i(this),l,arguments.length>1?arguments[1]:void 0)})},(r,e,t)=>{var n=t(4),s=t(8),i=t(94),o=t(64),a=t(103),l=t(40),c=t(7),u=n.RangeError,p=n.Int8Array,g=p&&p.prototype,y=g&&g.set,h=i.aTypedArray,d=i.exportTypedArrayMethod,f=!c(function(){var T=new Uint8ClampedArray(2);return s(y,T,{length:1,0:3},1),T[1]!==3}),v=f&&i.NATIVE_ARRAY_BUFFER_VIEWS&&c(function(){var T=new p(2);return T.set(1),T.set("2",1),T[0]!==0||T[1]!==2});d("set",function(R){h(this);var N=a(arguments.length>1?arguments[1]:void 0,1),m=l(R);if(f)return s(y,this,m,N);var b=this.length,P=o(m),x=0;if(P+N>b)throw u("Wrong length");for(;x<P;)this[N+x]=m[x++]},!f||v)},(r,e,t)=>{var n=t(104),s=RangeError;r.exports=function(i,o){var a=n(i);if(a%o)throw s("Wrong offset");return a}},(r,e,t)=>{var n=t(62),s=RangeError;r.exports=function(i){var o=n(i);if(o<0)throw s("The argument can't be less than 0");return o}},(r,e,t)=>{var n=t(106),s=t(94),i=s.aTypedArray,o=s.exportTypedArrayMethod,a=s.getTypedArrayConstructor;o("toReversed",function(){return n(i(this),a(this))})},(r,e,t)=>{var n=t(64);r.exports=function(s,i){for(var o=n(s),a=new i(o),l=0;l<o;l++)a[l]=s[o-l-1];return a}},(r,e,t)=>{var n=t(94),s=t(14),i=t(31),o=t(108),a=n.aTypedArray,l=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,u=s(n.TypedArrayPrototype.sort);c("toSorted",function(g){g!==void 0&&i(g);var y=a(this),h=o(l(y),y);return u(h,g)})},(r,e,t)=>{var n=t(64);r.exports=function(s,i){for(var o=0,a=n(i),l=new s(a);a>o;)l[o]=i[o++];return l}},(r,e,t)=>{var n=t(110),s=t(94),i=t(111),o=t(62),a=t(112),l=s.aTypedArray,c=s.getTypedArrayConstructor,u=s.exportTypedArrayMethod,p=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(g){return g===8}}();u("with",function(g,y){var h=l(this),d=o(g),f=i(h)?a(y):+y;return n(h,c(h),d,f)},!p)},(r,e,t)=>{var n=t(64),s=t(62),i=RangeError;r.exports=function(o,a,l,c){var u=n(o),p=s(l),g=p<0?u+p:p;if(g>=u||g<0)throw i("Incorrect index");for(var y=new a(u),h=0;h<u;h++)y[h]=h===g?c:o[h];return y}},(r,e,t)=>{var n=t(78);r.exports=function(s){var i=n(s);return i=="BigInt64Array"||i=="BigUint64Array"}},(r,e,t)=>{var n=t(19),s=TypeError;r.exports=function(i){var o=n(i,"number");if(typeof o=="number")throw s("Can't convert number to bigint");return BigInt(o)}},(r,e,t)=>{var n=t(6),s=t(88),i=t(114),o=ArrayBuffer.prototype;n&&!("detached"in o)&&s(o,"detached",{configurable:!0,get:function(){return i(this)}})},(r,e,t)=>{var n=t(14),s=t(115),i=n(ArrayBuffer.prototype.slice);r.exports=function(o){if(s(o)!==0)return!1;try{return i(o,0,0),!1}catch{return!0}}},(r,e,t)=>{var n=t(72),s=t(15),i=TypeError;r.exports=n(ArrayBuffer.prototype,"byteLength","get")||function(o){if(s(o)!="ArrayBuffer")throw i("ArrayBuffer expected");return o.byteLength}},(r,e,t)=>{var n=t(3),s=t(117);s&&n({target:"ArrayBuffer",proto:!0},{transfer:function(){return s(this,arguments.length?arguments[0]:void 0,!0)}})},(r,e,t)=>{var n=t(4),s=t(14),i=t(72),o=t(118),a=t(114),l=t(115),c=t(119),u=n.TypeError,p=n.structuredClone,g=n.ArrayBuffer,y=n.DataView,h=Math.min,d=g.prototype,f=y.prototype,v=s(d.slice),T=i(d,"resizable","get"),R=i(d,"maxByteLength","get"),N=s(f.getInt8),m=s(f.setInt8);r.exports=c&&function(b,P,x){var S=l(b),w=P===void 0?S:o(P),E=!T||!T(b);if(a(b))throw u("ArrayBuffer is detached");var V=p(b,{transfer:[b]});if(S==w&&(x||E))return V;if(S>=w&&(!x||E))return v(V,0,w);for(var $=x&&!E&&R?{maxByteLength:R(V)}:void 0,j=new g(w,$),D=new y(V),Y=new y(j),G=h(w,S),X=0;X<G;X++)m(Y,X,N(D,X));return j}},(r,e,t)=>{var n=t(62),s=t(65),i=RangeError;r.exports=function(o){if(o===void 0)return 0;var a=n(o),l=s(a);if(a!==l)throw i("Wrong length or index");return l}},(r,e,t)=>{var n=t(4),s=t(7),i=t(28),o=t(120),a=t(121),l=t(122),c=n.structuredClone;r.exports=!!c&&!s(function(){if(a&&i>92||l&&i>94||o&&i>97)return!1;var u=new ArrayBuffer(8),p=c(u,{transfer:[u]});return u.byteLength!=0||p.byteLength!=8})},(r,e,t)=>{var n=t(121),s=t(122);r.exports=!n&&!s&&typeof window=="object"&&typeof document=="object"},r=>{r.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},(r,e,t)=>{var n=t(15);r.exports=typeof process<"u"&&n(process)=="process"},(r,e,t)=>{var n=t(3),s=t(117);s&&n({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return s(this,arguments.length?arguments[0]:void 0,!1)}})},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var r,t,n,s,Tt,o,Mt,l,c,u,p,g,y,h,d,f,Ht,T,R,Xt,m,b;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0,__w_pdfjs_require__(84),__w_pdfjs_require__(86),__w_pdfjs_require__(87),__w_pdfjs_require__(2),__w_pdfjs_require__(93),__w_pdfjs_require__(101),__w_pdfjs_require__(102),__w_pdfjs_require__(105),__w_pdfjs_require__(107),__w_pdfjs_require__(109),__w_pdfjs_require__(113),__w_pdfjs_require__(116),__w_pdfjs_require__(123),__w_pdfjs_require__(89),__w_pdfjs_require__(125),__w_pdfjs_require__(135),__w_pdfjs_require__(137),__w_pdfjs_require__(140),__w_pdfjs_require__(142),__w_pdfjs_require__(144),__w_pdfjs_require__(146),__w_pdfjs_require__(148),__w_pdfjs_require__(151);var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(162),_display_utils=__w_pdfjs_require__(167),_font_loader=__w_pdfjs_require__(170),_displayNode_utils=__w_pdfjs_require__(171),_canvas=__w_pdfjs_require__(172),_worker_options=__w_pdfjs_require__(175),_message_handler=__w_pdfjs_require__(176),_metadata=__w_pdfjs_require__(177),_optional_content_config=__w_pdfjs_require__(178),_transport_stream=__w_pdfjs_require__(179),_displayFetch_stream=__w_pdfjs_require__(180),_displayNetwork=__w_pdfjs_require__(183),_displayNode_stream=__w_pdfjs_require__(184),_displaySvg=__w_pdfjs_require__(185),_xfa_text=__w_pdfjs_require__(193);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(x){if(typeof x=="string"||x instanceof URL?x={url:x}:(0,_util.isArrayBuffer)(x)&&(x={data:x}),typeof x!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!x.url&&!x.data&&!x.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const S=new PDFDocumentLoadingTask,{docId:w}=S,E=x.url?getUrlProp(x.url):null,V=x.data?getDataProp(x.data):null,$=x.httpHeaders||null,j=x.withCredentials===!0,D=x.password??null,Y=x.range instanceof PDFDataRangeTransport?x.range:null,G=Number.isInteger(x.rangeChunkSize)&&x.rangeChunkSize>0?x.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let X=x.worker instanceof PDFWorker?x.worker:null;const Z=x.verbosity,ne=typeof x.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(x.docBaseUrl)?x.docBaseUrl:null,ie=typeof x.cMapUrl=="string"?x.cMapUrl:null,be=x.cMapPacked!==!1,Q=x.CMapReaderFactory||DefaultCMapReaderFactory,O=typeof x.standardFontDataUrl=="string"?x.standardFontDataUrl:null,k=x.StandardFontDataFactory||DefaultStandardFontDataFactory,F=x.stopAtErrors!==!0,z=Number.isInteger(x.maxImageSize)&&x.maxImageSize>-1?x.maxImageSize:-1,L=x.isEvalSupported!==!1,K=typeof x.isOffscreenCanvasSupported=="boolean"?x.isOffscreenCanvasSupported:!_util.isNodeJS,U=Number.isInteger(x.canvasMaxAreaInBytes)?x.canvasMaxAreaInBytes:-1,te=typeof x.disableFontFace=="boolean"?x.disableFontFace:_util.isNodeJS,pe=x.fontExtraProperties===!0,ue=x.enableXfa===!0,ve=x.ownerDocument||globalThis.document,se=x.disableRange===!0,ge=x.disableStream===!0,Ee=x.disableAutoFetch===!0,Oe=x.pdfBug===!0,Me=Y?Y.length:x.length??NaN,we=typeof x.useSystemFonts=="boolean"?x.useSystemFonts:!_util.isNodeJS&&!te,Ue=typeof x.useWorkerFetch=="boolean"?x.useWorkerFetch:Q===_display_utils.DOMCMapReaderFactory&&k===_display_utils.DOMStandardFontDataFactory&&ie&&O&&(0,_display_utils.isValidFetchUrl)(ie,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(O,document.baseURI),Ne=x.canvasFactory||new DefaultCanvasFactory({ownerDocument:ve}),Ae=x.filterFactory||new DefaultFilterFactory({docId:w,ownerDocument:ve}),de=null;(0,_util.setVerbosityLevel)(Z);const Te={canvasFactory:Ne,filterFactory:Ae};if(Ue||(Te.cMapReaderFactory=new Q({baseUrl:ie,isCompressed:be}),Te.standardFontDataFactory=new k({baseUrl:O})),!X){const Ge={verbosity:Z,port:_worker_options.GlobalWorkerOptions.workerPort};X=Ge.port?PDFWorker.fromPort(Ge):new PDFWorker(Ge),S._worker=X}const _e={docId:w,apiVersion:"3.9.179",data:V,password:D,disableAutoFetch:Ee,rangeChunkSize:G,length:Me,docBaseUrl:ne,enableXfa:ue,evaluatorOptions:{maxImageSize:z,disableFontFace:te,ignoreErrors:F,isEvalSupported:L,isOffscreenCanvasSupported:K,canvasMaxAreaInBytes:U,fontExtraProperties:pe,useSystemFonts:we,cMapUrl:Ue?ie:null,standardFontDataUrl:Ue?O:null}},Ve={ignoreErrors:F,isEvalSupported:L,disableFontFace:te,fontExtraProperties:pe,enableXfa:ue,ownerDocument:ve,disableAutoFetch:Ee,pdfBug:Oe,styleElement:de};return X.promise.then(function(){if(S.destroyed)throw new Error("Loading aborted");const Ge=_fetchDocument(X,_e),Ke=new Promise(function($e){let Ze;Y?Ze=new _transport_stream.PDFDataTransportStream({length:Me,initialData:Y.initialData,progressiveDone:Y.progressiveDone,contentDispositionFilename:Y.contentDispositionFilename,disableRange:se,disableStream:ge},Y):V||(Ze=(qe=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(qe):(0,_display_utils.isValidFetchUrl)(qe.url)?new _displayFetch_stream.PDFFetchStream(qe):new _displayNetwork.PDFNetworkStream(qe))({url:E,length:Me,httpHeaders:$,withCredentials:j,rangeChunkSize:G,disableRange:se,disableStream:ge})),$e(Ze)});return Promise.all([Ge,Ke]).then(function($e){let[Ze,Qe]=$e;if(S.destroyed)throw new Error("Loading aborted");const qe=new _message_handler.MessageHandler(w,Ze,X.port),Ye=new WorkerTransport(qe,S,Qe,Ve,Te);S._transport=Ye,qe.send("Ready",null)})}).catch(S._capability.reject),S}async function _fetchDocument(x,S){if(x.destroyed)throw new Error("Worker was destroyed");const w=await x.messageHandler.sendWithPromise("GetDocRequest",S,S.data?[S.data.buffer]:null);if(x.destroyed)throw new Error("Worker was destroyed");return w}function getUrlProp(x){if(x instanceof URL)return x.href;try{return new URL(x,window.location).href}catch{if(_util.isNodeJS&&typeof x=="string")return x}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(x){if(_util.isNodeJS&&typeof Buffer<"u"&&x instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(x instanceof Uint8Array&&x.byteLength===x.buffer.byteLength)return x;if(typeof x=="string")return(0,_util.stringToBytes)(x);if(typeof x=="object"&&!isNaN(x==null?void 0:x.length)||(0,_util.isArrayBuffer)(x))return new Uint8Array(x);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const e=class e{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${pt(e,r)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var S;this.destroyed=!0,await((S=this._transport)==null?void 0:S.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};r=new WeakMap,re(e,r,0);let PDFDocumentLoadingTask=e;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(S,w){let E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,V=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this.length=S,this.initialData=w,this.progressiveDone=E,this.contentDispositionFilename=V,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(S){this._rangeListeners.push(S)}addProgressListener(S){this._progressListeners.push(S)}addProgressiveReadListener(S){this._progressiveReadListeners.push(S)}addProgressiveDoneListener(S){this._progressiveDoneListeners.push(S)}onDataRange(S,w){for(const E of this._rangeListeners)E(S,w)}onDataProgress(S,w){this._readyCapability.promise.then(()=>{for(const E of this._progressListeners)E(S,w)})}onDataProgressiveRead(S){this._readyCapability.promise.then(()=>{for(const w of this._progressiveReadListeners)w(S)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const S of this._progressiveDoneListeners)S()})}transportReady(){this._readyCapability.resolve()}requestDataRange(S,w){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(S,w){this._pdfInfo=S,this._transport=w}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(S){return this._transport.getPage(S)}getPageIndex(S){return this._transport.getPageIndex(S)}getDestinations(){return this._transport.getDestinations()}getDestination(S){return this._transport.getDestination(S)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this._transport.startCleanup(S||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(S,w,E){re(this,s);re(this,o);re(this,t,null);re(this,n,!1);let V=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this._pageIndex=S,this._pageInfo=w,this._transport=E,this._stats=V?new _display_utils.StatTimer:null,this._pdfBug=V,this.commonObjs=E.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:S,rotation:w=this.rotate,offsetX:E=0,offsetY:V=0,dontFlip:$=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:S,rotation:w,offsetX:E,offsetY:V,dontFlip:$})}getAnnotations(){let{intent:S="display"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const w=this._transport.getRenderingIntent(S);return this._transport.getAnnotations(this._pageIndex,w.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var S;return((S=this._transport._htmlForXfa)==null?void 0:S.children[this._pageIndex])||null}render(S){var F,z;let{canvasContext:w,viewport:E,intent:V="display",annotationMode:$=_util.AnnotationMode.ENABLE,transform:j=null,background:D=null,optionalContentConfigPromise:Y=null,annotationCanvasMap:G=null,pageColors:X=null,printAnnotationStorage:Z=null}=S;(F=this._stats)==null||F.time("Overall");const ne=this._transport.getRenderingIntent(V,$,Z);ye(this,n,!1),me(this,o,Mt).call(this),Y||(Y=this._transport.getOptionalContentConfig());let ie=this._intentStates.get(ne.cacheKey);ie||(ie=Object.create(null),this._intentStates.set(ne.cacheKey,ie)),ie.streamReaderCancelTimeout&&(clearTimeout(ie.streamReaderCancelTimeout),ie.streamReaderCancelTimeout=null);const be=!!(ne.renderingIntent&_util.RenderingIntentFlag.PRINT);ie.displayReadyCapability||(ie.displayReadyCapability=new _util.PromiseCapability,ie.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(z=this._stats)==null||z.time("Page Request"),this._pumpOperatorList(ne));const Q=L=>{var K,U;ie.renderTasks.delete(O),(this._maybeCleanupAfterRender||be)&&ye(this,n,!0),me(this,s,Tt).call(this,!be),L?(O.capability.reject(L),this._abortOperatorList({intentState:ie,reason:L instanceof Error?L:new Error(L)})):O.capability.resolve(),(K=this._stats)==null||K.timeEnd("Rendering"),(U=this._stats)==null||U.timeEnd("Overall")},O=new InternalRenderTask({callback:Q,params:{canvasContext:w,viewport:E,transform:j,background:D},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:G,operatorList:ie.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!be,pdfBug:this._pdfBug,pageColors:X});(ie.renderTasks||(ie.renderTasks=new Set)).add(O);const k=O.task;return Promise.all([ie.displayReadyCapability.promise,Y]).then(L=>{var te;let[K,U]=L;if(this.destroyed){Q();return}(te=this._stats)==null||te.time("Rendering"),O.initializeGraphics({transparency:K,optionalContentConfig:U}),O.operatorListChanged()}).catch(Q),k}getOperatorList(){var Y;let{intent:S="display",annotationMode:w=_util.AnnotationMode.ENABLE,printAnnotationStorage:E=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};function V(){j.operatorList.lastChunk&&(j.opListReadCapability.resolve(j.operatorList),j.renderTasks.delete(D))}const $=this._transport.getRenderingIntent(S,w,E,!0);let j=this._intentStates.get($.cacheKey);j||(j=Object.create(null),this._intentStates.set($.cacheKey,j));let D;return j.opListReadCapability||(D=Object.create(null),D.operatorListChanged=V,j.opListReadCapability=new _util.PromiseCapability,(j.renderTasks||(j.renderTasks=new Set)).add(D),j.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Y=this._stats)==null||Y.time("Page Request"),this._pumpOperatorList($)),j.opListReadCapability.promise}streamTextContent(){let{includeMarkedContent:S=!1,disableNormalization:w=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const E=100;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:S===!0,disableNormalization:w===!0},{highWaterMark:E,size(V){return V.items.length}})}getTextContent(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then(E=>_xfa_text.XfaText.textContent(E));const w=this.streamTextContent(S);return new Promise(function(E,V){function $(){j.read().then(function(Y){let{value:G,done:X}=Y;if(X){E(D);return}Object.assign(D.styles,G.styles),D.items.push(...G.items),$()},V)}const j=w.getReader(),D={items:[],styles:Object.create(null)};$()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const S=[];for(const w of this._intentStates.values())if(this._abortOperatorList({intentState:w,reason:new Error("Page was destroyed."),force:!0}),!w.opListReadCapability)for(const E of w.renderTasks)S.push(E.completed),E.cancel();return this.objs.clear(),ye(this,n,!1),me(this,o,Mt).call(this),Promise.all(S)}cleanup(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;ye(this,n,!0);const w=me(this,s,Tt).call(this,!1);return S&&w&&this._stats&&(this._stats=new _display_utils.StatTimer),w}_startRenderPage(S,w){var V,$;const E=this._intentStates.get(w);E&&((V=this._stats)==null||V.timeEnd("Page Request"),($=E.displayReadyCapability)==null||$.resolve(S))}_renderPageChunk(S,w){for(let E=0,V=S.length;E<V;E++)w.operatorList.fnArray.push(S.fnArray[E]),w.operatorList.argsArray.push(S.argsArray[E]);w.operatorList.lastChunk=S.lastChunk,w.operatorList.separateAnnots=S.separateAnnots;for(const E of w.renderTasks)E.operatorListChanged();S.lastChunk&&me(this,s,Tt).call(this,!0)}_pumpOperatorList(S){let{renderingIntent:w,cacheKey:E,annotationStorageSerializable:V}=S;const{map:$,transfers:j}=V,Y=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:w,cacheKey:E,annotationStorage:$},j).getReader(),G=this._intentStates.get(E);G.streamReader=Y;const X=()=>{Y.read().then(Z=>{let{value:ne,done:ie}=Z;if(ie){G.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(ne,G),X())},Z=>{if(G.streamReader=null,!this._transport.destroyed){if(G.operatorList){G.operatorList.lastChunk=!0;for(const ne of G.renderTasks)ne.operatorListChanged();me(this,s,Tt).call(this,!0)}if(G.displayReadyCapability)G.displayReadyCapability.reject(Z);else if(G.opListReadCapability)G.opListReadCapability.reject(Z);else throw Z}})};X()}_abortOperatorList(S){let{intentState:w,reason:E,force:V=!1}=S;if(w.streamReader){if(w.streamReaderCancelTimeout&&(clearTimeout(w.streamReaderCancelTimeout),w.streamReaderCancelTimeout=null),!V){if(w.renderTasks.size>0)return;if(E instanceof _display_utils.RenderingCancelledException){let $=RENDERING_CANCELLED_TIMEOUT;E.extraDelay>0&&E.extraDelay<1e3&&($+=E.extraDelay),w.streamReaderCancelTimeout=setTimeout(()=>{w.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:w,reason:E,force:!0})},$);return}}if(w.streamReader.cancel(new _util.AbortException(E.message)).catch(()=>{}),w.streamReader=null,!this._transport.destroyed){for(const[$,j]of this._intentStates)if(j===w){this._intentStates.delete($);break}this.cleanup()}}}get stats(){return this._stats}}t=new WeakMap,n=new WeakMap,s=new WeakSet,Tt=function(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(me(this,o,Mt).call(this),!_(this,n)||this.destroyed)return!1;if(S)return ye(this,t,setTimeout(()=>{ye(this,t,null),me(this,s,Tt).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:w,operatorList:E}of this._intentStates.values())if(w.size>0||!E.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),ye(this,n,!1),!0},o=new WeakSet,Mt=function(){_(this,t)&&(clearTimeout(_(this,t)),ye(this,t,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){re(this,l,new Set);re(this,c,Promise.resolve())}postMessage(S,w){const E={data:structuredClone(S,null)};_(this,c).then(()=>{for(const V of _(this,l))V.call(this,E)})}addEventListener(S,w){_(this,l).add(w)}removeEventListener(S,w){_(this,l).delete(w)}terminate(){_(this,l).clear()}}l=new WeakMap,c=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const x=(u=document==null?void 0:document.currentScript)==null?void 0:u.src;x&&(PDFWorkerUtil.fallbackWorkerSrc=x.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(x,S){let w;try{if(w=new URL(x),!w.origin||w.origin==="null")return!1}catch{return!1}const E=new URL(S,w);return w.origin===E.origin},PDFWorkerUtil.createCDNWrapper=function(x){const S=`importScripts("${x}");`;return URL.createObjectURL(new Blob([S]))}}const _PDFWorker=class _PDFWorker{constructor(){let{name:x=null,port:S=null,verbosity:w=(0,_util.getVerbosityLevel)()}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(S&&_(_PDFWorker,p).has(S))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=x,this.destroyed=!1,this.verbosity=w,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,S){_(_PDFWorker,p).set(S,this),this._initializeFromPort(S);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(x){this._port=x,this._messageHandler=new _message_handler.MessageHandler("main","worker",x),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:x}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,x)||(x=PDFWorkerUtil.createCDNWrapper(new URL(x,window.location).href));const S=new Worker(x),w=new _message_handler.MessageHandler("main","worker",S),E=()=>{S.removeEventListener("error",V),w.destroy(),S.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},V=()=>{this._webWorker||E()};S.addEventListener("error",V),w.on("test",j=>{if(S.removeEventListener("error",V),this.destroyed){E();return}j?(this._messageHandler=w,this._port=S,this._webWorker=S,this._readyCapability.resolve(),w.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),w.destroy(),S.terminate())}),w.on("ready",j=>{if(S.removeEventListener("error",V),this.destroyed){E();return}try{$()}catch{this._setupFakeWorker()}});const $=()=>{const j=new Uint8Array;w.send("test",j,[j.buffer])};$();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(x=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const S=new LoopbackPort;this._port=S;const w=`fake${PDFWorkerUtil.fakeWorkerId++}`,E=new _message_handler.MessageHandler(w+"_worker",w,S);x.setup(E,S);const V=new _message_handler.MessageHandler(w,w+"_worker",S);this._messageHandler=V,this._readyCapability.resolve(),V.send("configure",{verbosity:this.verbosity})}).catch(x=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${x.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),_(_PDFWorker,p).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(x){if(!(x!=null&&x.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return _(this,p).has(x.port)?_(this,p).get(x.port):new _PDFWorker(x)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var x;try{return((x=globalThis.pdfjsWorker)==null?void 0:x.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};p=new WeakMap,re(_PDFWorker,p,new WeakMap);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(S,w,E,V,$){re(this,f);re(this,g,new Map);re(this,y,new Map);re(this,h,new Map);re(this,d,null);this.messageHandler=S,this.loadingTask=w,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:V.ownerDocument,styleElement:V.styleElement}),this._params=V,this.canvasFactory=$.canvasFactory,this.filterFactory=$.filterFactory,this.cMapReaderFactory=$.cMapReaderFactory,this.standardFontDataFactory=$.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=E,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(S){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_util.AnnotationMode.ENABLE,E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,V=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,$=_util.RenderingIntentFlag.DISPLAY,j=_annotation_storage.SerializableEmpty;switch(S){case"any":$=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":$=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${S}`)}switch(w){case _util.AnnotationMode.DISABLE:$+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:$+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:$+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,j=($&_util.RenderingIntentFlag.PRINT&&E instanceof _annotation_storage.PrintAnnotationStorage?E:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${w}`)}return V&&($+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:$,cacheKey:`${$}_${j.hash}`,annotationStorageSerializable:j}}destroy(){var E;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(E=_(this,d))==null||E.reject(new Error("Worker was destroyed during onPassword callback"));const S=[];for(const V of _(this,y).values())S.push(V._destroy());_(this,y).clear(),_(this,h).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const w=this.messageHandler.sendWithPromise("Terminate",null);return S.push(w),Promise.all(S).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),_(this,g).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:S,loadingTask:w}=this;S.on("GetReader",(E,V)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=$=>{this._lastProgress={loaded:$.loaded,total:$.total}},V.onPull=()=>{this._fullReader.read().then(function($){let{value:j,done:D}=$;if(D){V.close();return}(0,_util.assert)(j instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),V.enqueue(new Uint8Array(j),1,[j])}).catch($=>{V.error($)})},V.onCancel=$=>{this._fullReader.cancel($),V.ready.catch(j=>{if(!this.destroyed)throw j})}}),S.on("ReaderHeadersReady",E=>{const V=new _util.PromiseCapability,$=this._fullReader;return $.headersReady.then(()=>{var j;(!$.isStreamingSupported||!$.isRangeSupported)&&(this._lastProgress&&((j=w.onProgress)==null||j.call(w,this._lastProgress)),$.onProgress=D=>{var Y;(Y=w.onProgress)==null||Y.call(w,{loaded:D.loaded,total:D.total})}),V.resolve({isStreamingSupported:$.isStreamingSupported,isRangeSupported:$.isRangeSupported,contentLength:$.contentLength})},V.reject),V.promise}),S.on("GetRangeReader",(E,V)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const $=this._networkStream.getRangeReader(E.begin,E.end);if(!$){V.close();return}V.onPull=()=>{$.read().then(function(j){let{value:D,done:Y}=j;if(Y){V.close();return}(0,_util.assert)(D instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),V.enqueue(new Uint8Array(D),1,[D])}).catch(j=>{V.error(j)})},V.onCancel=j=>{$.cancel(j),V.ready.catch(D=>{if(!this.destroyed)throw D})}}),S.on("GetDoc",E=>{let{pdfInfo:V}=E;this._numPages=V.numPages,this._htmlForXfa=V.htmlForXfa,delete V.htmlForXfa,w._capability.resolve(new PDFDocumentProxy(V,this))}),S.on("DocException",function(E){let V;switch(E.name){case"PasswordException":V=new _util.PasswordException(E.message,E.code);break;case"InvalidPDFException":V=new _util.InvalidPDFException(E.message);break;case"MissingPDFException":V=new _util.MissingPDFException(E.message);break;case"UnexpectedResponseException":V=new _util.UnexpectedResponseException(E.message,E.status);break;case"UnknownErrorException":V=new _util.UnknownErrorException(E.message,E.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}w._capability.reject(V)}),S.on("PasswordRequest",E=>{if(ye(this,d,new _util.PromiseCapability),w.onPassword){const V=$=>{$ instanceof Error?_(this,d).reject($):_(this,d).resolve({password:$})};try{w.onPassword(V,E.code)}catch($){_(this,d).reject($)}}else _(this,d).reject(new _util.PasswordException(E.message,E.code));return _(this,d).promise}),S.on("DataLoaded",E=>{var V;(V=w.onProgress)==null||V.call(w,{loaded:E.length,total:E.length}),this.downloadInfoCapability.resolve(E)}),S.on("StartRenderPage",E=>{if(this.destroyed)return;_(this,y).get(E.pageIndex)._startRenderPage(E.transparency,E.cacheKey)}),S.on("commonobj",E=>{var D;let[V,$,j]=E;if(!this.destroyed&&!this.commonObjs.has(V))switch($){case"Font":const Y=this._params;if("error"in j){const Z=j.error;(0,_util.warn)(`Error during font loading: ${Z}`),this.commonObjs.resolve(V,Z);break}const G=Y.pdfBug&&((D=globalThis.FontInspector)!=null&&D.enabled)?(Z,ne)=>globalThis.FontInspector.fontAdded(Z,ne):null,X=new _font_loader.FontFaceObject(j,{isEvalSupported:Y.isEvalSupported,disableFontFace:Y.disableFontFace,ignoreErrors:Y.ignoreErrors,inspectFont:G});this.fontLoader.bind(X).catch(Z=>S.sendWithPromise("FontFallback",{id:V})).finally(()=>{!Y.fontExtraProperties&&X.data&&(X.data=null),this.commonObjs.resolve(V,X)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(V,j);break;default:throw new Error(`Got unknown common object type ${$}`)}}),S.on("obj",E=>{var G;let[V,$,j,D]=E;if(this.destroyed)return;const Y=_(this,y).get($);if(!Y.objs.has(V))switch(j){case"Image":if(Y.objs.resolve(V,D),D){let X;if(D.bitmap){const{width:Z,height:ne}=D;X=Z*ne*4}else X=((G=D.data)==null?void 0:G.length)||0;X>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Y._maybeCleanupAfterRender=!0)}break;case"Pattern":Y.objs.resolve(V,D);break;default:throw new Error(`Got unknown object type ${j}`)}}),S.on("DocProgress",E=>{var V;this.destroyed||(V=w.onProgress)==null||V.call(w,{loaded:E.loaded,total:E.total})}),S.on("FetchBuiltInCMap",E=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(E):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),S.on("FetchStandardFontData",E=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(E):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var E;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:S,transfers:w}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:S,filename:((E=this._fullReader)==null?void 0:E.filename)??null},w).finally(()=>{this.annotationStorage.resetModified()})}getPage(S){if(!Number.isInteger(S)||S<=0||S>this._numPages)return Promise.reject(new Error("Invalid page request."));const w=S-1,E=_(this,h).get(w);if(E)return E;const V=this.messageHandler.sendWithPromise("GetPage",{pageIndex:w}).then($=>{if(this.destroyed)throw new Error("Transport destroyed");const j=new PDFPageProxy(w,$,this,this._params.pdfBug);return _(this,y).set(w,j),j});return _(this,h).set(w,V),V}getPageIndex(S){return typeof S!="object"||S===null||!Number.isInteger(S.num)||S.num<0||!Number.isInteger(S.gen)||S.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:S.num,gen:S.gen})}getAnnotations(S,w){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:S,intent:w})}getFieldObjects(){return me(this,f,Ht).call(this,"GetFieldObjects")}hasJSActions(){return me(this,f,Ht).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(S){return typeof S!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:S})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(S){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:S})}getStructTree(S){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:S})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(S=>new _optional_content_config.OptionalContentConfig(S))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const S="GetMetadata",w=_(this,g).get(S);if(w)return w;const E=this.messageHandler.sendWithPromise(S,null).then(V=>{var $,j;return{info:V[0],metadata:V[1]?new _metadata.Metadata(V[1]):null,contentDispositionFilename:(($=this._fullReader)==null?void 0:$.filename)??null,contentLength:((j=this._fullReader)==null?void 0:j.contentLength)??null}});return _(this,g).set(S,E),E}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const w of _(this,y).values())if(!w.cleanup())throw new Error(`startCleanup: Page ${w.pageNumber} is currently rendering.`);this.commonObjs.clear(),S||this.fontLoader.clear(),_(this,g).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:S,enableXfa:w}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:S,enableXfa:w})}}g=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakSet,Ht=function(S){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const E=_(this,g).get(S);if(E)return E;const V=this.messageHandler.sendWithPromise(S,w);return _(this,g).set(S,V),V};class PDFObjects{constructor(){re(this,R);re(this,T,Object.create(null))}get(S){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(w){const V=me(this,R,Xt).call(this,S);return V.capability.promise.then(()=>w(V.data)),null}const E=_(this,T)[S];if(!(E!=null&&E.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${S}.`);return E.data}has(S){const w=_(this,T)[S];return(w==null?void 0:w.capability.settled)||!1}resolve(S){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const E=me(this,R,Xt).call(this,S);E.data=w,E.capability.resolve()}clear(){var S;for(const w in _(this,T)){const{data:E}=_(this,T)[w];(S=E==null?void 0:E.bitmap)==null||S.close()}ye(this,T,Object.create(null))}}T=new WeakMap,R=new WeakSet,Xt=function(S){const w=_(this,T)[S];return w||(_(this,T)[S]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(S){re(this,m,null);ye(this,m,S),this.onContinue=null}get promise(){return _(this,m).capability.promise}cancel(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;_(this,m).cancel(null,S)}get separateAnnots(){const{separateAnnots:S}=_(this,m).operatorList;if(!S)return!1;const{annotationCanvasMap:w}=_(this,m);return S.form||S.canvas&&(w==null?void 0:w.size)>0}}m=new WeakMap,exports.RenderTask=RenderTask;const P=class P{constructor(S){let{callback:w,params:E,objs:V,commonObjs:$,annotationCanvasMap:j,operatorList:D,pageIndex:Y,canvasFactory:G,filterFactory:X,useRequestAnimationFrame:Z=!1,pdfBug:ne=!1,pageColors:ie=null}=S;this.callback=w,this.params=E,this.objs=V,this.commonObjs=$,this.annotationCanvasMap=j,this.operatorListIdx=null,this.operatorList=D,this._pageIndex=Y,this.canvasFactory=G,this.filterFactory=X,this._pdfBug=ne,this.pageColors=ie,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=Z===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=E.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics(S){var Y,G;let{transparency:w=!1,optionalContentConfig:E}=S;if(this.cancelled)return;if(this._canvas){if(_(P,b).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");_(P,b).add(this._canvas)}this._pdfBug&&((Y=globalThis.StepperManager)!=null&&Y.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:V,viewport:$,transform:j,background:D}=this.params;this.gfx=new _canvas.CanvasGraphics(V,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:E},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:j,viewport:$,transparency:w,background:D}),this.operatorListIdx=0,this.graphicsReady=!0,(G=this.graphicsReadyCallback)==null||G.call(this)}cancel(){var E;let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.running=!1,this.cancelled=!0,(E=this.gfx)==null||E.endDrawing(),this._canvas&&_(P,b).delete(this._canvas),this.callback(S||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,w))}operatorListChanged(){var S;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(S=this.stepper)==null||S.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&_(P,b).delete(this._canvas),this.callback())))}};b=new WeakMap,re(P,b,new WeakSet);let InternalRenderTask=P;const version="3.9.179";exports.version=version;const build="1ef6fbc52";exports.build=build},(r,e,t)=>{var n=t(3),s=t(126),i=t(134);n({target:"Set",proto:!0,real:!0,forced:!i("difference")},{difference:s})},(r,e,t)=>{var n=t(127),s=t(128),i=t(129),o=t(132),a=t(133),l=t(130),c=t(131),u=s.has,p=s.remove;r.exports=function(y){var h=n(this),d=a(y),f=i(h);return o(h)<=d.size?l(h,function(v){d.includes(v)&&p(f,v)}):c(d.getIterator(),function(v){u(h,v)&&p(f,v)}),f}},(r,e,t)=>{var n=t(128).has;r.exports=function(s){return n(s),s}},(r,e,t)=>{var n=t(14),s=Set.prototype;r.exports={Set,add:n(s.add),has:n(s.has),remove:n(s.delete),proto:s}},(r,e,t)=>{var n=t(128),s=t(130),i=n.Set,o=n.add;r.exports=function(a){var l=new i;return s(a,function(c){o(l,c)}),l}},(r,e,t)=>{var n=t(14),s=t(131),i=t(128),o=i.Set,a=i.proto,l=n(a.forEach),c=n(a.keys),u=c(new o).next;r.exports=function(p,g,y){return y?s(c(p),g,u):l(p,g)}},(r,e,t)=>{var n=t(8);r.exports=function(s,i,o){for(var a=o||s.next,l,c;!(l=n(a,s)).done;)if(c=i(l.value),c!==void 0)return c}},(r,e,t)=>{var n=t(72),s=t(128);r.exports=n(s.proto,"size","get")||function(i){return i.size}},(r,e,t)=>{var n=t(31),s=t(47),i=t(8),o=t(62),a=TypeError,l=Math.max,c=function(u,p,g,y){this.set=u,this.size=p,this.has=g,this.keys=y};c.prototype={getIterator:function(){return s(i(this.keys,this.set))},includes:function(u){return i(this.has,this.set,u)}},r.exports=function(u){s(u);var p=+u.size;if(p!=p)throw a("Invalid size");return new c(u,l(o(p),0),n(u.has),n(u.keys))}},(r,e,t)=>{var n=t(24),s=function(){return{size:0,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};r.exports=function(i){try{var o=n("Set");return new o()[i](s()),!0}catch{return!1}}},(r,e,t)=>{var n=t(3),s=t(7),i=t(136),o=t(134),a=!o("intersection")||s(function(){return Array.from(new Set([1,2,3]).intersection(new Set([3,2])))!="3,2"});n({target:"Set",proto:!0,real:!0,forced:a},{intersection:i})},(r,e,t)=>{var n=t(127),s=t(128),i=t(132),o=t(133),a=t(130),l=t(131),c=s.Set,u=s.add,p=s.has;r.exports=function(y){var h=n(this),d=o(y),f=new c;return i(h)>d.size?l(d.getIterator(),function(v){p(h,v)&&u(f,v)}):a(h,function(v){d.includes(v)&&u(f,v)}),f}},(r,e,t)=>{var n=t(3),s=t(138),i=t(134);n({target:"Set",proto:!0,real:!0,forced:!i("isDisjointFrom")},{isDisjointFrom:s})},(r,e,t)=>{var n=t(127),s=t(128).has,i=t(132),o=t(133),a=t(130),l=t(131),c=t(139);r.exports=function(p){var g=n(this),y=o(p);if(i(g)<=y.size)return a(g,function(d){if(y.includes(d))return!1},!0)!==!1;var h=y.getIterator();return l(h,function(d){if(s(g,d))return c(h,"normal",!1)})!==!1}},(r,e,t)=>{var n=t(8),s=t(47),i=t(30);r.exports=function(o,a,l){var c,u;s(o);try{if(c=i(o,"return"),!c){if(a==="throw")throw l;return l}c=n(c,o)}catch(p){u=!0,c=p}if(a==="throw")throw l;if(u)throw c;return s(c),l}},(r,e,t)=>{var n=t(3),s=t(141),i=t(134);n({target:"Set",proto:!0,real:!0,forced:!i("isSubsetOf")},{isSubsetOf:s})},(r,e,t)=>{var n=t(127),s=t(132),i=t(130),o=t(133);r.exports=function(l){var c=n(this),u=o(l);return s(c)>u.size?!1:i(c,function(p){if(!u.includes(p))return!1},!0)!==!1}},(r,e,t)=>{var n=t(3),s=t(143),i=t(134);n({target:"Set",proto:!0,real:!0,forced:!i("isSupersetOf")},{isSupersetOf:s})},(r,e,t)=>{var n=t(127),s=t(128).has,i=t(132),o=t(133),a=t(131),l=t(139);r.exports=function(u){var p=n(this),g=o(u);if(i(p)<g.size)return!1;var y=g.getIterator();return a(y,function(h){if(!s(p,h))return l(y,"normal",!1)})!==!1}},(r,e,t)=>{var n=t(3),s=t(145),i=t(134);n({target:"Set",proto:!0,real:!0,forced:!i("symmetricDifference")},{symmetricDifference:s})},(r,e,t)=>{var n=t(127),s=t(128),i=t(129),o=t(133),a=t(131),l=s.add,c=s.has,u=s.remove;r.exports=function(g){var y=n(this),h=o(g).getIterator(),d=i(y);return a(h,function(f){c(y,f)?u(d,f):l(d,f)}),d}},(r,e,t)=>{var n=t(3),s=t(147),i=t(134);n({target:"Set",proto:!0,real:!0,forced:!i("union")},{union:s})},(r,e,t)=>{var n=t(127),s=t(128).add,i=t(129),o=t(133),a=t(131);r.exports=function(c){var u=n(this),p=o(c).getIterator(),g=i(u);return a(p,function(y){s(g,y)}),g}},(r,e,t)=>{var n=t(3),s=t(4),i=t(24),o=t(11),a=t(45).f,l=t(39),c=t(149),u=t(75),p=t(76),g=t(150),y=t(82),h=t(6),d=t(36),f="DOMException",v=i("Error"),T=i(f),R=function(){c(this,N);var Y=arguments.length,G=p(Y<1?void 0:arguments[0]),X=p(Y<2?void 0:arguments[1],"Error"),Z=new T(G,X),ne=v(G);return ne.name=f,a(Z,"stack",o(1,y(ne.stack,1))),u(Z,this,R),Z},N=R.prototype=T.prototype,m="stack"in v(f),b="stack"in new T(1,2),P=T&&h&&Object.getOwnPropertyDescriptor(s,f),x=!!P&&!(P.writable&&P.configurable),S=m&&!x&&!b;n({global:!0,constructor:!0,forced:d||S},{DOMException:S?R:T});var w=i(f),E=w.prototype;if(E.constructor!==w){d||a(E,"constructor",o(1,w));for(var V in g)if(l(g,V)){var $=g[V],j=$.s;l(w,j)||a(w,j,o(6,$.c))}}},(r,e,t)=>{var n=t(25),s=TypeError;r.exports=function(i,o){if(n(o,i))return i;throw s("Incorrect invocation")}},r=>{r.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},(r,e,t)=>{var n=t(36),s=t(3),i=t(4),o=t(24),a=t(14),l=t(7),c=t(41),u=t(21),p=t(152),g=t(17),y=t(20),h=t(23),d=t(153),f=t(47),v=t(78),T=t(39),R=t(158),N=t(44),m=t(64),b=t(85),P=t(159),x=t(161),S=t(128),w=t(83),E=t(119),V=i.Object,$=i.Array,j=i.Date,D=i.Error,Y=i.EvalError,G=i.RangeError,X=i.ReferenceError,Z=i.SyntaxError,ne=i.TypeError,ie=i.URIError,be=i.PerformanceMark,Q=i.WebAssembly,O=Q&&Q.CompileError||D,k=Q&&Q.LinkError||D,F=Q&&Q.RuntimeError||D,z=o("DOMException"),L=x.Map,K=x.has,U=x.get,te=x.set,pe=S.Set,ue=S.add,ve=o("Object","keys"),se=a([].push),ge=a((!0).valueOf),Ee=a(1 .valueOf),Oe=a("".valueOf),Me=a(j.prototype.getTime),we=c("structuredClone"),Ue="DataCloneError",Ne="Transferring",Ae=function(fe){return!l(function(){var M=new i.Set([7]),ee=fe(M),he=fe(V(7));return ee==M||!ee.has(7)||typeof he!="object"||he!=7})&&fe},de=function(fe,M){return!l(function(){var ee=new M,he=fe({a:ee,b:ee});return!(he&&he.a===he.b&&he.a instanceof M&&he.a.stack===ee.stack)})},Te=function(fe){return!l(function(){var M=fe(new i.AggregateError([1],we,{cause:3}));return M.name!="AggregateError"||M.errors[0]!=1||M.message!=we||M.cause!=3})},_e=i.structuredClone,Ve=n||!de(_e,D)||!de(_e,z)||!Te(_e),Ge=!_e&&Ae(function(fe){return new be(we,{detail:fe}).detail}),Ke=Ae(_e)||Ge,$e=function(fe){throw new z("Uncloneable type: "+fe,Ue)},Ze=function(fe,M){throw new z((M||"Cloning")+" of "+fe+" cannot be properly polyfilled in this engine",Ue)},Qe=function(fe,M){return Ke||Ze(M),Ke(fe)},qe=function(){var fe;try{fe=new i.DataTransfer}catch{try{fe=new i.ClipboardEvent("").clipboardData}catch{}}return fe&&fe.items&&fe.files?fe:null},Ye=function(fe,M,ee){if(K(M,fe))return U(M,fe);var he=ee||v(fe),ae,W,I,q,H,J;if(he==="SharedArrayBuffer")Ke?ae=Ke(fe):ae=fe;else{var le=i.DataView;!le&&typeof fe.slice!="function"&&Ze("ArrayBuffer");try{if(typeof fe.slice=="function"&&!fe.resizable)ae=fe.slice(0);else for(W=fe.byteLength,I=("maxByteLength"in fe)?{maxByteLength:fe.maxByteLength}:void 0,ae=new ArrayBuffer(W,I),q=new le(fe),H=new le(ae),J=0;J<W;J++)H.setUint8(J,q.getUint8(J))}catch{throw new z("ArrayBuffer is detached",Ue)}}return te(M,fe,ae),ae},Se=function(fe,M,ee,he,ae){var W=i[M];return y(W)||Ze(M),new W(Ye(fe.buffer,ae),ee,he)},ce=function(fe,M,ee){this.object=fe,this.type=M,this.metadata=ee},oe=function(fe,M,ee){if(h(fe)&&$e("Symbol"),!y(fe))return fe;if(M){if(K(M,fe))return U(M,fe)}else M=new L;var he=v(fe),ae,W,I,q,H,J,le,xe;switch(he){case"Array":I=$(m(fe));break;case"Object":I={};break;case"Map":I=new L;break;case"Set":I=new pe;break;case"RegExp":I=new RegExp(fe.source,P(fe));break;case"Error":switch(W=fe.name,W){case"AggregateError":I=o("AggregateError")([]);break;case"EvalError":I=Y();break;case"RangeError":I=G();break;case"ReferenceError":I=X();break;case"SyntaxError":I=Z();break;case"TypeError":I=ne();break;case"URIError":I=ie();break;case"CompileError":I=O();break;case"LinkError":I=k();break;case"RuntimeError":I=F();break;default:I=D()}break;case"DOMException":I=new z(fe.message,fe.name);break;case"ArrayBuffer":case"SharedArrayBuffer":I=ee?new ce(fe,he):Ye(fe,M,he);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":J=he==="DataView"?fe.byteLength:fe.length,I=ee?new ce(fe,he,{offset:fe.byteOffset,length:J}):Se(fe,he,fe.byteOffset,J,M);break;case"DOMQuad":try{I=new DOMQuad(oe(fe.p1,M,ee),oe(fe.p2,M,ee),oe(fe.p3,M,ee),oe(fe.p4,M,ee))}catch{I=Qe(fe,he)}break;case"File":if(Ke)try{I=Ke(fe),v(I)!==he&&(I=void 0)}catch{}if(!I)try{I=new File([fe],fe.name,fe)}catch{}I||Ze(he);break;case"FileList":if(q=qe(),q){for(H=0,J=m(fe);H<J;H++)q.items.add(oe(fe[H],M,ee));I=q.files}else I=Qe(fe,he);break;case"ImageData":try{I=new ImageData(oe(fe.data,M,ee),fe.width,fe.height,{colorSpace:fe.colorSpace})}catch{I=Qe(fe,he)}break;default:if(Ke)I=Ke(fe);else switch(he){case"BigInt":I=V(fe.valueOf());break;case"Boolean":I=V(ge(fe));break;case"Number":I=V(Ee(fe));break;case"String":I=V(Oe(fe));break;case"Date":I=new j(Me(fe));break;case"Blob":try{I=fe.slice(0,fe.size,fe.type)}catch{Ze(he)}break;case"DOMPoint":case"DOMPointReadOnly":ae=i[he];try{I=ae.fromPoint?ae.fromPoint(fe):new ae(fe.x,fe.y,fe.z,fe.w)}catch{Ze(he)}break;case"DOMRect":case"DOMRectReadOnly":ae=i[he];try{I=ae.fromRect?ae.fromRect(fe):new ae(fe.x,fe.y,fe.width,fe.height)}catch{Ze(he)}break;case"DOMMatrix":case"DOMMatrixReadOnly":ae=i[he];try{I=ae.fromMatrix?ae.fromMatrix(fe):new ae(fe)}catch{Ze(he)}break;case"AudioData":case"VideoFrame":u(fe.clone)||Ze(he);try{I=fe.clone()}catch{$e(he)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":Ze(he);default:$e(he)}}switch(te(M,fe,I),he){case"Array":case"Object":for(le=ve(fe),H=0,J=m(le);H<J;H++)xe=le[H],R(I,xe,oe(fe[xe],M,ee));break;case"Map":fe.forEach(function(Pe,We){te(I,oe(We,M,ee),oe(Pe,M,ee))});break;case"Set":fe.forEach(function(Pe){ue(I,oe(Pe,M,ee))});break;case"Error":N(I,"message",oe(fe.message,M,ee)),T(fe,"cause")&&N(I,"cause",oe(fe.cause,M,ee)),W=="AggregateError"&&(I.errors=oe(fe.errors,M,ee));case"DOMException":w&&N(I,"stack",oe(fe.stack,M,ee))}return I},Re=function(fe,M){if(!y(fe))return fe;if(K(M,fe))return U(M,fe);var ee,he,ae,W,I,q,H,J;if(fe instanceof ce)switch(ee=fe.type,he=fe.object,ee){case"ArrayBuffer":case"SharedArrayBuffer":J=Ye(he,M,ee);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":ae=fe.metadata,J=Se(he,ee,ae.offset,ae.length,M)}else switch(v(fe)){case"Array":case"Object":for(q=ve(fe),W=0,I=m(q);W<I;W++)H=q[W],fe[H]=Re(fe[H],M);break;case"Map":J=new L,fe.forEach(function(le,xe){te(J,Re(xe,M),Re(le,M))});break;case"Set":J=new pe,fe.forEach(function(le){ue(J,Re(le,M))});break;case"Error":fe.message=Re(fe.message,M),T(fe,"cause")&&(fe.cause=Re(fe.cause,M)),fe.name=="AggregateError"&&(fe.errors=Re(fe.errors,M));case"DOMException":w&&(fe.stack=Re(fe.stack,M))}return te(M,fe,J||fe),J||fe},Ie=function(fe,M){if(!y(fe))throw ne("Transfer option cannot be converted to a sequence");var ee=[];d(fe,function(Pe){se(ee,f(Pe))});for(var he=0,ae=m(ee),W=[],I,q,H,J,le,xe;he<ae;){if(I=ee[he++],q=v(I),q==="ArrayBuffer"){se(W,I);continue}if(K(M,I))throw new z("Duplicate transferable",Ue);if(E)J=_e(I,{transfer:[I]});else switch(q){case"ImageBitmap":H=i.OffscreenCanvas,p(H)||Ze(q,Ne);try{le=new H(I.width,I.height),xe=le.getContext("bitmaprenderer"),xe.transferFromImageBitmap(I),J=le.transferToImageBitmap()}catch{}break;case"AudioData":case"VideoFrame":(!u(I.clone)||!u(I.close))&&Ze(q,Ne);try{J=I.clone(),I.close()}catch{}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":Ze(q,Ne)}if(J===void 0)throw new z("This object cannot be transferred: "+q,Ue);te(M,I,J)}return W},et=function(fe,M){for(var ee=0,he=m(fe),ae,W;ee<he;){if(ae=fe[ee++],K(M,ae))throw new z("Duplicate transferable",Ue);E?W=_e(ae,{transfer:[ae]}):(u(ae.transfer)||Ze("ArrayBuffer",Ne),W=ae.transfer()),te(M,ae,W)}};s({global:!0,enumerable:!0,sham:!E,forced:Ve},{structuredClone:function(M){var ee=b(arguments.length,1)>1&&!g(arguments[1])?f(arguments[1]):void 0,he=ee?ee.transfer:void 0,ae=!1,W,I;he!==void 0&&(W=new L,I=Ie(he,W),ae=!!m(I));var q=oe(M,W,ae);return ae&&(W=new L,et(he,W),q=Re(q,W)),q}})},(r,e,t)=>{var n=t(14),s=t(7),i=t(21),o=t(78),a=t(24),l=t(51),c=function(){},u=[],p=a("Reflect","construct"),g=/^\s*(?:class|function)\b/,y=n(g.exec),h=!g.exec(c),d=function(T){if(!i(T))return!1;try{return p(c,u,T),!0}catch{return!1}},f=function(T){if(!i(T))return!1;switch(o(T)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!y(g,l(T))}catch{return!0}};f.sham=!0,r.exports=!p||s(function(){var v;return d(d.call)||!d(Object)||!d(function(){v=!0})||v})?f:d},(r,e,t)=>{var n=t(99),s=t(8),i=t(47),o=t(32),a=t(154),l=t(64),c=t(25),u=t(156),p=t(157),g=t(139),y=TypeError,h=function(f,v){this.stopped=f,this.result=v},d=h.prototype;r.exports=function(f,v,T){var R=T&&T.that,N=!!(T&&T.AS_ENTRIES),m=!!(T&&T.IS_RECORD),b=!!(T&&T.IS_ITERATOR),P=!!(T&&T.INTERRUPTED),x=n(v,R),S,w,E,V,$,j,D,Y=function(X){return S&&g(S,"normal",X),new h(!0,X)},G=function(X){return N?(i(X),P?x(X[0],X[1],Y):x(X[0],X[1])):P?x(X,Y):x(X)};if(m)S=f.iterator;else if(b)S=f;else{if(w=p(f),!w)throw y(o(f)+" is not iterable");if(a(w)){for(E=0,V=l(f);V>E;E++)if($=G(f[E]),$&&c(d,$))return $;return new h(!1)}S=u(f,w)}for(j=m?f.next:S.next;!(D=s(j,S)).done;){try{$=G(D.value)}catch(X){g(S,"throw",X)}if(typeof $=="object"&&$&&c(d,$))return $}return new h(!1)}},(r,e,t)=>{var n=t(34),s=t(155),i=n("iterator"),o=Array.prototype;r.exports=function(a){return a!==void 0&&(s.Array===a||o[i]===a)}},r=>{r.exports={}},(r,e,t)=>{var n=t(8),s=t(31),i=t(47),o=t(32),a=t(157),l=TypeError;r.exports=function(c,u){var p=arguments.length<2?a(c):u;if(s(p))return i(n(p,c));throw l(o(c)+" is not iterable")}},(r,e,t)=>{var n=t(78),s=t(30),i=t(17),o=t(155),a=t(34),l=a("iterator");r.exports=function(c){if(!i(c))return s(c,l)||s(c,"@@iterator")||o[n(c)]}},(r,e,t)=>{var n=t(18),s=t(45),i=t(11);r.exports=function(o,a,l){var c=n(a);c in o?s.f(o,c,i(0,l)):o[c]=l}},(r,e,t)=>{var n=t(8),s=t(39),i=t(25),o=t(160),a=RegExp.prototype;r.exports=function(l){var c=l.flags;return c===void 0&&!("flags"in a)&&!s(l,"flags")&&i(a,l)?n(o,l):c}},(r,e,t)=>{var n=t(47);r.exports=function(){var s=n(this),i="";return s.hasIndices&&(i+="d"),s.global&&(i+="g"),s.ignoreCase&&(i+="i"),s.multiline&&(i+="m"),s.dotAll&&(i+="s"),s.unicode&&(i+="u"),s.unicodeSets&&(i+="v"),s.sticky&&(i+="y"),i}},(r,e,t)=>{var n=t(14),s=Map.prototype;r.exports={Map,set:n(s.set),get:n(s.get),has:n(s.has),remove:n(s.delete),proto:s}},(r,e,t)=>{var c,u,p,Cn,y;Object.defineProperty(e,"__esModule",{value:!0}),e.SerializableEmpty=e.PrintAnnotationStorage=e.AnnotationStorage=void 0,t(89),t(148),t(151);var n=t(1),s=t(163),i=t(169);const o=Object.freeze({map:null,hash:"",transfers:void 0});e.SerializableEmpty=o;class a{constructor(){re(this,p);re(this,c,!1);re(this,u,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(d,f){const v=_(this,u).get(d);return v===void 0?f:Object.assign(f,v)}getRawValue(d){return _(this,u).get(d)}remove(d){if(_(this,u).delete(d),_(this,u).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const f of _(this,u).values())if(f instanceof s.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(d,f){const v=_(this,u).get(d);let T=!1;if(v!==void 0)for(const[R,N]of Object.entries(f))v[R]!==N&&(T=!0,v[R]=N);else T=!0,_(this,u).set(d,f);T&&me(this,p,Cn).call(this),f instanceof s.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(f.constructor._type)}has(d){return _(this,u).has(d)}getAll(){return _(this,u).size>0?(0,n.objectFromMap)(_(this,u)):null}setAll(d){for(const[f,v]of Object.entries(d))this.setValue(f,v)}get size(){return _(this,u).size}resetModified(){_(this,c)&&(ye(this,c,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new l(this)}get serializable(){if(_(this,u).size===0)return o;const d=new Map,f=new i.MurmurHash3_64,v=[],T=Object.create(null);let R=!1;for(const[N,m]of _(this,u)){const b=m instanceof s.AnnotationEditor?m.serialize(!1,T):m;b&&(d.set(N,b),f.update(`${N}:${JSON.stringify(b)}`),R||(R=!!b.bitmap))}if(R)for(const N of d.values())N.bitmap&&v.push(N.bitmap);return d.size>0?{map:d,hash:f.hexdigest(),transfers:v}:o}}c=new WeakMap,u=new WeakMap,p=new WeakSet,Cn=function(){_(this,c)||(ye(this,c,!0),typeof this.onSetModified=="function"&&this.onSetModified())},e.AnnotationStorage=a;class l extends a{constructor(f){super();re(this,y,void 0);const{map:v,hash:T,transfers:R}=f.serializable,N=structuredClone(v,null);ye(this,y,{map:N,hash:T,transfers:R})}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return _(this,y)}}y=new WeakMap,e.PrintAnnotationStorage=l},(r,e,t)=>{var a,l,c,u,p,g,y,h,d,f,Yt,T,En,N,xn,b,wn;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0,t(89),t(2);var n=t(1),s=t(164);const x=class x{constructor(w){re(this,f);re(this,T);re(this,N);re(this,b);re(this,a,!1);re(this,l,null);re(this,c,null);re(this,u,this.focusin.bind(this));re(this,p,this.focusout.bind(this));re(this,g,!1);re(this,y,!1);re(this,h,!1);st(this,"_uiManager",null);re(this,d,x._zIndex++);this.constructor===x&&(0,n.unreachable)("Cannot initialize AnnotationEditor."),this.parent=w.parent,this.id=w.id,this.width=this.height=null,this.pageIndex=w.parent.pageIndex,this.name=w.name,this.div=null,this._uiManager=w.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1;const{rotation:E,rawDims:{pageWidth:V,pageHeight:$,pageX:j,pageY:D}}=this.parent.viewport;this.rotation=E,this.pageRotation=(360+E-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[V,$],this.pageTranslation=[j,D];const[Y,G]=this.parentDimensions;this.x=w.x/Y,this.y=w.y/G,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,n.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(w){const E=new o({id:w.parent.getNextId(),parent:w.parent,uiManager:w._uiManager});E.annotationElementId=w.annotationElementId,E.deleted=!0,E._uiManager.addToAnnotationStorage(E)}static initialize(w){}static updateDefaultParams(w,E){}static get defaultPropertiesToUpdate(){return[]}get propertiesToUpdate(){return[]}addCommands(w){this._uiManager.addCommands(w)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=_(this,d)}setParent(w){w!==null&&(this.pageIndex=w.pageIndex,this.pageDimensions=w.pageDimensions),this.parent=w}focusin(w){_(this,g)?ye(this,g,!1):this.parent.setSelected(this)}focusout(w){var V;if(!this.isAttachedToDOM)return;const E=w.relatedTarget;E!=null&&E.closest(`#${this.id}`)||(w.preventDefault(),(V=this.parent)!=null&&V.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(w){const E=this.parent.div.getBoundingClientRect();this.startX=w.clientX-E.x,this.startY=w.clientY-E.y,w.dataTransfer.setData("text/plain",this.id),w.dataTransfer.effectAllowed="move"}setAt(w,E,V,$){const[j,D]=this.parentDimensions;[V,$]=this.screenToPageTranslation(V,$),this.x=(w+V)/j,this.y=(E+$)/D,this.fixAndSetPosition()}translate(w,E){me(this,f,Yt).call(this,this.parentDimensions,w,E)}translateInPage(w,E){me(this,f,Yt).call(this,this.pageDimensions,w,E),this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[w,E]=this.pageDimensions;let{x:V,y:$,width:j,height:D}=this;switch(j*=w,D*=E,V*=w,$*=E,this.rotation){case 0:V=Math.max(0,Math.min(w-j,V)),$=Math.max(0,Math.min(E-D,$));break;case 90:V=Math.max(0,Math.min(w-D,V)),$=Math.min(E,Math.max(j,$));break;case 180:V=Math.min(w,Math.max(j,V)),$=Math.min(E,Math.max(D,$));break;case 270:V=Math.min(w,Math.max(D,V)),$=Math.max(0,Math.min(E-j,$));break}this.x=V/w,this.y=$/E,this.div.style.left=`${(100*this.x).toFixed(2)}%`,this.div.style.top=`${(100*this.y).toFixed(2)}%`}screenToPageTranslation(w,E){switch(this.parentRotation){case 90:return[E,-w];case 180:return[-w,-E];case 270:return[-E,w];default:return[w,E]}}pageTranslationToScreen(w,E){switch(this.parentRotation){case 90:return[-E,w];case 180:return[-w,-E];case 270:return[E,-w];default:return[w,E]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{realScale:w}=this._uiManager.viewParameters,[E,V]=this.pageDimensions;return[E*w,V*w]}setDims(w,E){const[V,$]=this.parentDimensions;this.div.style.width=`${(100*w/V).toFixed(2)}%`,_(this,a)||(this.div.style.height=`${(100*E/$).toFixed(2)}%`)}fixDims(){const{style:w}=this.div,{height:E,width:V}=w,$=V.endsWith("%"),j=!_(this,a)&&E.endsWith("%");if($&&j)return;const[D,Y]=this.parentDimensions;$||(w.width=`${(100*parseFloat(V)/D).toFixed(2)}%`),!_(this,a)&&!j&&(w.height=`${(100*parseFloat(E)/Y).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",_(this,u)),this.div.addEventListener("focusout",_(this,p));const[w,E]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*E/w).toFixed(2)}%`,this.div.style.maxHeight=`${(100*w/E).toFixed(2)}%`);const[V,$]=this.getInitialTranslation();return this.translate(V,$),(0,s.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(w){const{isMac:E}=n.FeatureTest.platform;if(w.button!==0||w.ctrlKey&&E){w.preventDefault();return}w.ctrlKey&&!E||w.shiftKey||w.metaKey&&E?this.parent.toggleSelected(this):this.parent.setSelected(this),ye(this,g,!0)}getRect(w,E){const V=this.parentScale,[$,j]=this.pageDimensions,[D,Y]=this.pageTranslation,G=w/V,X=E/V,Z=this.x*$,ne=this.y*j,ie=this.width*$,be=this.height*j;switch(this.rotation){case 0:return[Z+G+D,j-ne-X-be+Y,Z+G+ie+D,j-ne-X+Y];case 90:return[Z+X+D,j-ne+G+Y,Z+X+be+D,j-ne+G+ie+Y];case 180:return[Z-G-ie+D,j-ne+X+Y,Z-G+D,j-ne+X+be+Y];case 270:return[Z-X-be+D,j-ne-G-ie+Y,Z-X+D,j-ne-G+Y];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(w,E){const[V,$,j,D]=w,Y=j-V,G=D-$;switch(this.rotation){case 0:return[V,E-D,Y,G];case 90:return[V,E-$,G,Y];case 180:return[j,E-$,Y,G];case 270:return[j,E-D,G,Y];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){ye(this,h,!0)}disableEditMode(){ye(this,h,!1)}isInEditMode(){return _(this,h)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var w,E;(w=this.div)==null||w.addEventListener("focusin",_(this,u)),(E=this.div)==null||E.addEventListener("focusout",_(this,p))}serialize(){(0,n.unreachable)("An editor must be serializable")}static deserialize(w,E,V){const $=new this.prototype.constructor({parent:E,id:E.getNextId(),uiManager:V});$.rotation=w.rotation;const[j,D]=$.pageDimensions,[Y,G,X,Z]=$.getRectInCurrentCoords(w.rect,D);return $.x=Y/j,$.y=G/D,$.width=X/j,$.height=Z/D,$}remove(){this.div.removeEventListener("focusin",_(this,u)),this.div.removeEventListener("focusout",_(this,p)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this)}get isResizable(){return!1}makeResizable(){this.isResizable&&(me(this,T,En).call(this),_(this,l).classList.remove("hidden"))}select(){var w;this.makeResizable(),(w=this.div)==null||w.classList.add("selectedEditor")}unselect(){var w,E,V;(w=_(this,l))==null||w.classList.add("hidden"),(E=this.div)==null||E.classList.remove("selectedEditor"),(V=this.div)!=null&&V.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(w,E){}disableEditing(){}enableEditing(){}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return _(this,y)}set isEditing(w){ye(this,y,w),this.parent&&(w?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(w,E){ye(this,a,!0);const V=w/E,{style:$}=this.div;$.aspectRatio=V,$.height="auto"}static get MIN_SIZE(){return 16}};a=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakSet,Yt=function(w,E,V){let[$,j]=w;[E,V]=this.screenToPageTranslation(E,V),this.x+=E/$,this.y+=V/j,this.fixAndSetPosition()},T=new WeakSet,En=function(){if(_(this,l))return;ye(this,l,document.createElement("div")),_(this,l).classList.add("resizers");const w=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||w.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const E of w){const V=document.createElement("div");_(this,l).append(V),V.classList.add("resizer",E),V.addEventListener("pointerdown",me(this,N,xn).bind(this,E))}this.div.prepend(_(this,l))},N=new WeakSet,xn=function(w,E){E.preventDefault(),ye(this,c,[E.clientX,E.clientY]);const V=me(this,b,wn).bind(this,w),$=this.div.draggable;this.div.draggable=!1;const j=`resizing${w.charAt(0).toUpperCase()}${w.slice(1)}`;this.parent.div.classList.add(j);const D={passive:!0,capture:!0};window.addEventListener("pointermove",V,D);const Y=()=>{this._uiManager.stopUndoAccumulation(),this.div.draggable=$,this.parent.div.classList.remove(j),window.removeEventListener("pointermove",V,D)};window.addEventListener("pointerup",Y,{once:!0})},b=new WeakSet,wn=function(w,E){const{clientX:V,clientY:$}=E,j=V-_(this,c)[0],D=$-_(this,c)[1];_(this,c)[0]=V,_(this,c)[1]=$;const[Y,G]=this.parentDimensions,X=this.x,Z=this.y,ne=this.width,ie=this.height,be=x.MIN_SIZE/Y,Q=x.MIN_SIZE/G;let O;const k=L=>Math.round(L*1e4)/1e4,F=(L,K)=>{const[U,te]=this.parentDimensions;this.setDims(U*L,te*K),this.fixAndSetPosition()},z=()=>{this.width=ne,this.height=ie,this.x=X,this.y=Z,F(ne,ie)};switch(w){case"topLeft":{if(Math.sign(j)*Math.sign(D)<0)return;const L=Math.hypot(j,D),K=Math.hypot(ne*Y,ie*G),U=k(X+ne),te=k(Z+ie),pe=Math.max(Math.min(1-Math.sign(j)*(L/K),1/ne,1/ie),be/ne,Q/ie),ue=k(ne*pe),ve=k(ie*pe),se=U-ue,ge=te-ve;O=()=>{this.width=ue,this.height=ve,this.x=se,this.y=ge,F(ue,ve)};break}case"topMiddle":{const L=k(this.y+ie),K=k(Math.max(Q,Math.min(1,ie-D/G))),U=L-K;O=()=>{this.height=K,this.y=U,F(ne,K)};break}case"topRight":{if(Math.sign(j)*Math.sign(D)>0)return;const L=Math.hypot(j,D),K=Math.hypot(this.width*Y,this.height*G),U=k(Z+this.height),te=Math.max(Math.min(1+Math.sign(j)*(L/K),1/ne,1/ie),be/ne,Q/ie),pe=k(ne*te),ue=k(ie*te),ve=U-ue;O=()=>{this.width=pe,this.height=ue,this.y=ve,F(pe,ue)};break}case"middleRight":{const L=k(Math.max(be,Math.min(1,ne+j/Y)));O=()=>{this.width=L,F(L,ie)};break}case"bottomRight":{if(Math.sign(j)*Math.sign(D)<0)return;const L=Math.hypot(j,D),K=Math.hypot(this.width*Y,this.height*G),U=Math.max(Math.min(1+Math.sign(j)*(L/K),1/ne,1/ie),be/ne,Q/ie),te=k(ne*U),pe=k(ie*U);O=()=>{this.width=te,this.height=pe,F(te,pe)};break}case"bottomMiddle":{const L=k(Math.max(Q,Math.min(1,ie+D/G)));O=()=>{this.height=L,F(ne,L)};break}case"bottomLeft":{if(Math.sign(j)*Math.sign(D)>0)return;const L=Math.hypot(j,D),K=Math.hypot(this.width*Y,this.height*G),U=k(X+this.width),te=Math.max(Math.min(1-Math.sign(j)*(L/K),1/ne,1/ie),be/ne,Q/ie),pe=k(ne*te),ue=k(ie*te),ve=U-pe;O=()=>{this.width=pe,this.height=ue,this.x=ve,F(pe,ue)};break}case"middleLeft":{const L=k(X+ne),K=k(Math.max(be,Math.min(1,ne-j/Y))),U=L-K;O=()=>{this.width=K,this.x=U,F(K,ie)};break}}this.addCommands({cmd:O,undo:z,mustExec:!0,type:n.AnnotationEditorParamsType.RESIZE,overwriteIfSameType:!0,keepUndo:!0})},st(x,"_colorManager",new s.ColorManager),st(x,"_zIndex",1);let i=x;e.AnnotationEditor=i;class o extends i{constructor(w){super(w),this.annotationElementId=w.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(r,e,t)=>{var y,h,d,f,v,jt,R,N,m,b,P,_n,w,E,V,$,j,D,Y,G,X,Z,ne,ie,be,Q,O,k,F,z,L,K,U,te,pe,ue,ve,se,ge,Ee,Oe,Nn,we,Kt,Ne,kn,de,On,_e,ft,Ge,Nt,$e,Pn,Qe,Rn,Ye,Zt,ce,kt,Re,Qt;Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=i,e.opacityToHex=o,t(2),t(89),t(125),t(135),t(137),t(140),t(142),t(144),t(146),t(165);var n=t(1),s=t(167);function i(fe,M,ee){for(const he of ee)M.addEventListener(he,fe[he].bind(fe))}function o(fe){return Math.round(Math.min(255,Math.max(1,255*fe))).toString(16).padStart(2,"0")}class a{constructor(){re(this,y,0)}getId(){return`${n.AnnotationEditorPrefix}${pt(this,y)._++}`}}y=new WeakMap;class l{constructor(){re(this,v);re(this,h,(0,n.getUuid)());re(this,d,0);re(this,f,null)}async getFromFile(M){const{lastModified:ee,name:he,size:ae,type:W}=M;return me(this,v,jt).call(this,`${ee}_${he}_${ae}_${W}`,M)}async getFromUrl(M){return me(this,v,jt).call(this,M,M)}async getFromId(M){_(this,f)||ye(this,f,new Map);const ee=_(this,f).get(M);return ee?ee.bitmap?(ee.refCounter+=1,ee):ee.file?this.getFromFile(ee.file):this.getFromUrl(ee.url):null}getSvgUrl(M){const ee=_(this,f).get(M);return ee!=null&&ee.isSvg?ee.svgUrl:null}deleteId(M){_(this,f)||ye(this,f,new Map);const ee=_(this,f).get(M);ee&&(ee.refCounter-=1,ee.refCounter===0&&(ee.bitmap=null))}isValidId(M){return M.startsWith(`image_${_(this,h)}_`)}}h=new WeakMap,d=new WeakMap,f=new WeakMap,v=new WeakSet,jt=async function(M,ee){_(this,f)||ye(this,f,new Map);let he=_(this,f).get(M);if(he===null)return null;if(he!=null&&he.bitmap)return he.refCounter+=1,he;try{he||(he={bitmap:null,id:`image_${_(this,h)}_${pt(this,d)._++}`,refCounter:0,isSvg:!1});let ae;if(typeof ee=="string"){he.url=ee;const W=await fetch(ee);if(!W.ok)throw new Error(W.statusText);ae=await W.blob()}else ae=he.file=ee;if(ae.type==="image/svg+xml"){const W=new FileReader,I=new Image,q=new Promise((H,J)=>{I.onload=()=>{he.bitmap=I,he.isSvg=!0,H()},W.onload=()=>{I.src=he.svgUrl=W.result},I.onerror=W.onerror=J});W.readAsDataURL(ae),await q}else he.bitmap=await createImageBitmap(ae);he.refCounter=1}catch(ae){console.error(ae),he=null}return _(this,f).set(M,he),he&&_(this,f).set(he.id,he),he};class c{constructor(){re(this,R,[]);re(this,N,!1);re(this,m,void 0);re(this,b,-1);let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:128;ye(this,m,M)}add(M){let{cmd:ee,undo:he,mustExec:ae,type:W=NaN,overwriteIfSameType:I=!1,keepUndo:q=!1}=M;if(ae&&ee(),_(this,N))return;const H={cmd:ee,undo:he,type:W};if(_(this,b)===-1){_(this,R).length>0&&(_(this,R).length=0),ye(this,b,0),_(this,R).push(H);return}if(I&&_(this,R)[_(this,b)].type===W){q&&(H.undo=_(this,R)[_(this,b)].undo),_(this,R)[_(this,b)]=H;return}const J=_(this,b)+1;J===_(this,m)?_(this,R).splice(0,1):(ye(this,b,J),J<_(this,R).length&&_(this,R).splice(J)),_(this,R).push(H)}stopUndoAccumulation(){_(this,b)!==-1&&(_(this,R)[_(this,b)].type=NaN)}undo(){_(this,b)!==-1&&(ye(this,N,!0),_(this,R)[_(this,b)].undo(),ye(this,N,!1),ye(this,b,_(this,b)-1))}redo(){_(this,b)<_(this,R).length-1&&(ye(this,b,_(this,b)+1),ye(this,N,!0),_(this,R)[_(this,b)].cmd(),ye(this,N,!1))}hasSomethingToUndo(){return _(this,b)!==-1}hasSomethingToRedo(){return _(this,b)<_(this,R).length-1}destroy(){ye(this,R,null)}}R=new WeakMap,N=new WeakMap,m=new WeakMap,b=new WeakMap,e.CommandManager=c;class u{constructor(M){re(this,P);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:ee}=n.FeatureTest.platform;for(const[he,ae,W={}]of M)for(const I of he){const q=I.startsWith("mac+");ee&&q?(this.callbacks.set(I.slice(4),{callback:ae,options:W}),this.allKeys.add(I.split("+").at(-1))):!ee&&!q&&(this.callbacks.set(I,{callback:ae,options:W}),this.allKeys.add(I.split("+").at(-1)))}}exec(M,ee){if(!this.allKeys.has(ee.key))return;const he=this.callbacks.get(me(this,P,_n).call(this,ee));if(!he)return;const{callback:ae,options:{bubbles:W=!1,args:I=[],checker:q=null}}=he;q&&!q(M,ee)||(ae.bind(M,...I)(),W||(ee.stopPropagation(),ee.preventDefault()))}}P=new WeakSet,_n=function(M){M.altKey&&this.buffer.push("alt"),M.ctrlKey&&this.buffer.push("ctrl"),M.metaKey&&this.buffer.push("meta"),M.shiftKey&&this.buffer.push("shift"),this.buffer.push(M.key);const ee=this.buffer.join("+");return this.buffer.length=0,ee},e.KeyboardManager=u;const S=class S{get _colors(){const M=new Map([["CanvasText",null],["Canvas",null]]);return(0,s.getColorValues)(M),(0,n.shadow)(this,"_colors",M)}convert(M){const ee=(0,s.getRGB)(M);if(!window.matchMedia("(forced-colors: active)").matches)return ee;for(const[he,ae]of this._colors)if(ae.every((W,I)=>W===ee[I]))return S._colorsMapping.get(he);return ee}getHexCode(M){const ee=this._colors.get(M);return ee?n.Util.makeHexColor(...ee):M}};st(S,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let p=S;e.ColorManager=p;const et=class et{constructor(M,ee,he,ae){re(this,Oe);re(this,we);re(this,Ne);re(this,de);re(this,_e);re(this,Ge);re(this,$e);re(this,Qe);re(this,Ye);re(this,ce);re(this,Re);re(this,w,null);re(this,E,new Map);re(this,V,new Map);re(this,$,null);re(this,j,new c);re(this,D,0);re(this,Y,new Set);re(this,G,null);re(this,X,new Set);re(this,Z,null);re(this,ne,null);re(this,ie,new a);re(this,be,!1);re(this,Q,n.AnnotationEditorType.NONE);re(this,O,new Set);re(this,k,null);re(this,F,this.copy.bind(this));re(this,z,this.cut.bind(this));re(this,L,this.paste.bind(this));re(this,K,this.keydown.bind(this));re(this,U,this.onEditingAction.bind(this));re(this,te,this.onPageChanging.bind(this));re(this,pe,this.onScaleChanging.bind(this));re(this,ue,this.onRotationChanging.bind(this));re(this,ve,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});re(this,se,[0,0]);re(this,ge,null);re(this,Ee,null);ye(this,Ee,M),ye(this,Z,ee),_(this,Z)._on("editingaction",_(this,U)),_(this,Z)._on("pagechanging",_(this,te)),_(this,Z)._on("scalechanging",_(this,pe)),_(this,Z)._on("rotationchanging",_(this,ue)),ye(this,$,he.annotationStorage),ye(this,ne,he.filterFactory),ye(this,k,ae),this.viewParameters={realScale:s.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const M=et.prototype,ee=W=>{const{activeElement:I}=document;return I&&_(W,Ee).contains(I)&&W.hasSomethingToControl()},he=this.TRANSLATE_SMALL,ae=this.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new u([[["ctrl+a","mac+meta+a"],M.selectAll],[["ctrl+z","mac+meta+z"],M.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],M.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],M.delete],[["Escape","mac+Escape"],M.unselectAll],[["ArrowLeft","mac+ArrowLeft"],M.translateSelectedEditors,{args:[-he,0],checker:ee}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],M.translateSelectedEditors,{args:[-ae,0],checker:ee}],[["ArrowRight","mac+ArrowRight"],M.translateSelectedEditors,{args:[he,0],checker:ee}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],M.translateSelectedEditors,{args:[ae,0],checker:ee}],[["ArrowUp","mac+ArrowUp"],M.translateSelectedEditors,{args:[0,-he],checker:ee}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],M.translateSelectedEditors,{args:[0,-ae],checker:ee}],[["ArrowDown","mac+ArrowDown"],M.translateSelectedEditors,{args:[0,he],checker:ee}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],M.translateSelectedEditors,{args:[0,ae],checker:ee}]]))}destroy(){me(this,we,Kt).call(this),_(this,Z)._off("editingaction",_(this,U)),_(this,Z)._off("pagechanging",_(this,te)),_(this,Z)._off("scalechanging",_(this,pe)),_(this,Z)._off("rotationchanging",_(this,ue));for(const M of _(this,V).values())M.destroy();_(this,V).clear(),_(this,E).clear(),_(this,X).clear(),ye(this,w,null),_(this,O).clear(),_(this,j).destroy()}get hcmFilter(){return(0,n.shadow)(this,"hcmFilter",_(this,k)?_(this,ne).addHCMFilter(_(this,k).foreground,_(this,k).background):"none")}onPageChanging(M){let{pageNumber:ee}=M;ye(this,D,ee-1)}focusMainContainer(){_(this,Ee).focus()}addShouldRescale(M){_(this,X).add(M)}removeShouldRescale(M){_(this,X).delete(M)}onScaleChanging(M){let{scale:ee}=M;this.commitOrRemove(),this.viewParameters.realScale=ee*s.PixelsPerInch.PDF_TO_CSS_UNITS;for(const he of _(this,X))he.onScaleChanging()}onRotationChanging(M){let{pagesRotation:ee}=M;this.commitOrRemove(),this.viewParameters.rotation=ee}addToAnnotationStorage(M){!M.isEmpty()&&_(this,$)&&!_(this,$).has(M.id)&&_(this,$).setValue(M.id,M)}copy(M){if(M.preventDefault(),_(this,w)&&_(this,w).commitOrRemove(),!this.hasSelection)return;const ee=[];for(const he of _(this,O)){const ae=he.serialize(!0);ae&&ee.push(ae)}ee.length!==0&&M.clipboardData.setData("application/pdfjs",JSON.stringify(ee))}cut(M){this.copy(M),this.delete()}paste(M){M.preventDefault();let ee=M.clipboardData.getData("application/pdfjs");if(!ee)return;try{ee=JSON.parse(ee)}catch(ae){(0,n.warn)(`paste: "${ae.message}".`);return}if(!Array.isArray(ee))return;this.unselectAll();const he=this.currentLayer;try{const ae=[];for(const q of ee){const H=he.deserialize(q);if(!H)return;ae.push(H)}const W=()=>{for(const q of ae)me(this,Ye,Zt).call(this,q);me(this,Re,Qt).call(this,ae)},I=()=>{for(const q of ae)q.remove()};this.addCommands({cmd:W,undo:I,mustExec:!0})}catch(ae){(0,n.warn)(`paste: "${ae.message}".`)}}keydown(M){var ee;(ee=this.getActive())!=null&&ee.shouldGetKeyboardEvents()||et._keyboardManager.exec(this,M)}onEditingAction(M){["undo","redo","delete","selectAll"].includes(M.name)&&this[M.name]()}setEditingState(M){M?(me(this,Oe,Nn).call(this),me(this,Ne,kn).call(this),me(this,_e,ft).call(this,{isEditing:_(this,Q)!==n.AnnotationEditorType.NONE,isEmpty:me(this,ce,kt).call(this),hasSomethingToUndo:_(this,j).hasSomethingToUndo(),hasSomethingToRedo:_(this,j).hasSomethingToRedo(),hasSelectedEditor:!1})):(me(this,we,Kt).call(this),me(this,de,On).call(this),me(this,_e,ft).call(this,{isEditing:!1}))}registerEditorTypes(M){if(!_(this,G)){ye(this,G,M);for(const ee of _(this,G))me(this,Ge,Nt).call(this,ee.defaultPropertiesToUpdate)}}getId(){return _(this,ie).getId()}get currentLayer(){return _(this,V).get(_(this,D))}get currentPageIndex(){return _(this,D)}addLayer(M){_(this,V).set(M.pageIndex,M),_(this,be)?M.enable():M.disable()}removeLayer(M){_(this,V).delete(M.pageIndex)}updateMode(M){let ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(ye(this,Q,M),M===n.AnnotationEditorType.NONE){this.setEditingState(!1),me(this,Qe,Rn).call(this);return}this.setEditingState(!0),me(this,$e,Pn).call(this);for(const he of _(this,V).values())he.updateMode(M);if(ee){for(const he of _(this,E).values())if(he.annotationElementId===ee){this.setSelected(he),he.enterInEditMode();break}}}updateToolbar(M){M!==_(this,Q)&&_(this,Z).dispatch("switchannotationeditormode",{source:this,mode:M})}updateParams(M,ee){if(_(this,G)){for(const he of _(this,O))he.updateParams(M,ee);for(const he of _(this,G))he.updateDefaultParams(M,ee)}}getEditors(M){const ee=[];for(const he of _(this,E).values())he.pageIndex===M&&ee.push(he);return ee}getEditor(M){return _(this,E).get(M)}addEditor(M){_(this,E).set(M.id,M)}removeEditor(M){var ee;_(this,E).delete(M.id),this.unselect(M),(!M.annotationElementId||!_(this,Y).has(M.annotationElementId))&&((ee=_(this,$))==null||ee.remove(M.id))}addDeletedAnnotationElement(M){_(this,Y).add(M.annotationElementId),M.deleted=!0}isDeletedAnnotationElement(M){return _(this,Y).has(M)}removeDeletedAnnotationElement(M){_(this,Y).delete(M.annotationElementId),M.deleted=!1}setActiveEditor(M){_(this,w)!==M&&(ye(this,w,M),M&&me(this,Ge,Nt).call(this,M.propertiesToUpdate))}toggleSelected(M){if(_(this,O).has(M)){_(this,O).delete(M),M.unselect(),me(this,_e,ft).call(this,{hasSelectedEditor:this.hasSelection});return}_(this,O).add(M),M.select(),me(this,Ge,Nt).call(this,M.propertiesToUpdate),me(this,_e,ft).call(this,{hasSelectedEditor:!0})}setSelected(M){for(const ee of _(this,O))ee!==M&&ee.unselect();_(this,O).clear(),_(this,O).add(M),M.select(),me(this,Ge,Nt).call(this,M.propertiesToUpdate),me(this,_e,ft).call(this,{hasSelectedEditor:!0})}isSelected(M){return _(this,O).has(M)}unselect(M){M.unselect(),_(this,O).delete(M),me(this,_e,ft).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return _(this,O).size!==0}stopUndoAccumulation(){_(this,j).stopUndoAccumulation()}undo(){_(this,j).undo(),me(this,_e,ft).call(this,{hasSomethingToUndo:_(this,j).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:me(this,ce,kt).call(this)})}redo(){_(this,j).redo(),me(this,_e,ft).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:_(this,j).hasSomethingToRedo(),isEmpty:me(this,ce,kt).call(this)})}addCommands(M){_(this,j).add(M),me(this,_e,ft).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:me(this,ce,kt).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const M=[..._(this,O)],ee=()=>{for(const ae of M)ae.remove()},he=()=>{for(const ae of M)me(this,Ye,Zt).call(this,ae)};this.addCommands({cmd:ee,undo:he,mustExec:!0})}commitOrRemove(){var M;(M=_(this,w))==null||M.commitOrRemove()}hasSomethingToControl(){return _(this,w)||this.hasSelection}selectAll(){for(const M of _(this,O))M.commit();me(this,Re,Qt).call(this,_(this,E).values())}unselectAll(){if(_(this,w)){_(this,w).commitOrRemove();return}if(this.hasSelection){for(const M of _(this,O))M.unselect();_(this,O).clear(),me(this,_e,ft).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(M,ee){if((arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1)||this.commitOrRemove(),!this.hasSelection)return;_(this,se)[0]+=M,_(this,se)[1]+=ee;const[ae,W]=_(this,se),I=[..._(this,O)],q=1e3;_(this,ge)&&clearTimeout(_(this,ge)),ye(this,ge,setTimeout(()=>{ye(this,ge,null),_(this,se)[0]=_(this,se)[1]=0,this.addCommands({cmd:()=>{for(const H of I)_(this,E).has(H.id)&&H.translateInPage(ae,W)},undo:()=>{for(const H of I)_(this,E).has(H.id)&&H.translateInPage(-ae,-W)},mustExec:!1})},q));for(const H of I)H.translateInPage(M,ee)}isActive(M){return _(this,w)===M}getActive(){return _(this,w)}getMode(){return _(this,Q)}get imageManager(){return(0,n.shadow)(this,"imageManager",new l)}};w=new WeakMap,E=new WeakMap,V=new WeakMap,$=new WeakMap,j=new WeakMap,D=new WeakMap,Y=new WeakMap,G=new WeakMap,X=new WeakMap,Z=new WeakMap,ne=new WeakMap,ie=new WeakMap,be=new WeakMap,Q=new WeakMap,O=new WeakMap,k=new WeakMap,F=new WeakMap,z=new WeakMap,L=new WeakMap,K=new WeakMap,U=new WeakMap,te=new WeakMap,pe=new WeakMap,ue=new WeakMap,ve=new WeakMap,se=new WeakMap,ge=new WeakMap,Ee=new WeakMap,Oe=new WeakSet,Nn=function(){window.addEventListener("keydown",_(this,K),{capture:!0})},we=new WeakSet,Kt=function(){window.removeEventListener("keydown",_(this,K),{capture:!0})},Ne=new WeakSet,kn=function(){document.addEventListener("copy",_(this,F)),document.addEventListener("cut",_(this,z)),document.addEventListener("paste",_(this,L))},de=new WeakSet,On=function(){document.removeEventListener("copy",_(this,F)),document.removeEventListener("cut",_(this,z)),document.removeEventListener("paste",_(this,L))},_e=new WeakSet,ft=function(M){Object.entries(M).some(he=>{let[ae,W]=he;return _(this,ve)[ae]!==W})&&_(this,Z).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(_(this,ve),M)})},Ge=new WeakSet,Nt=function(M){_(this,Z).dispatch("annotationeditorparamschanged",{source:this,details:M})},$e=new WeakSet,Pn=function(){if(!_(this,be)){ye(this,be,!0);for(const M of _(this,V).values())M.enable()}},Qe=new WeakSet,Rn=function(){if(this.unselectAll(),_(this,be)){ye(this,be,!1);for(const M of _(this,V).values())M.disable()}},Ye=new WeakSet,Zt=function(M){const ee=_(this,V).get(M.pageIndex);ee?ee.addOrRebuild(M):this.addEditor(M)},ce=new WeakSet,kt=function(){if(_(this,E).size===0)return!0;if(_(this,E).size===1)for(const M of _(this,E).values())return M.isEmpty();return!1},Re=new WeakSet,Qt=function(M){_(this,O).clear();for(const ee of M)ee.isEmpty()||(_(this,O).add(ee),ee.select());me(this,_e,ft).call(this,{hasSelectedEditor:!0})},st(et,"TRANSLATE_SMALL",1),st(et,"TRANSLATE_BIG",10);let g=et;e.AnnotationEditorUIManager=g},(r,e,t)=>{var n=t(3),s=t(6),i=t(4),o=t(24),a=t(14),l=t(8),c=t(21),u=t(20),p=t(91),g=t(39),y=t(77),h=t(64),d=t(158),f=t(7),v=t(166),T=t(27),R=i.JSON,N=i.Number,m=i.SyntaxError,b=R&&R.parse,P=o("Object","keys"),x=Object.getOwnPropertyDescriptor,S=a("".charAt),w=a("".slice),E=a(/./.exec),V=a([].push),$=/^\d$/,j=/^[1-9]$/,D=/^(-|\d)$/,Y=/^[\t\n\r ]$/,G=0,X=1,Z=function(F,z){F=y(F);var L=new Q(F,0),K=L.parse(),U=K.value,te=L.skip(Y,K.end);if(te<F.length)throw m('Unexpected extra character: "'+S(F,te)+'" after the parsed data at: '+te);return c(z)?ne({"":U},"",z,K):U},ne=function(F,z,L,K){var U=F[z],te=K&&U===K.value,pe=te&&typeof K.source=="string"?{source:K.source}:{},ue,ve,se,ge,Ee;if(u(U)){var Oe=p(U),Me=te?K.nodes:Oe?[]:{};if(Oe)for(ue=Me.length,se=h(U),ge=0;ge<se;ge++)ie(U,ge,ne(U,""+ge,L,ge<ue?Me[ge]:void 0));else for(ve=P(U),se=h(ve),ge=0;ge<se;ge++)Ee=ve[ge],ie(U,Ee,ne(U,Ee,L,g(Me,Ee)?Me[Ee]:void 0))}return l(L,F,z,U,pe)},ie=function(F,z,L){if(s){var K=x(F,z);if(K&&!K.configurable)return}L===void 0?delete F[z]:d(F,z,L)},be=function(F,z,L,K){this.value=F,this.end=z,this.source=L,this.nodes=K},Q=function(F,z){this.source=F,this.index=z};Q.prototype={fork:function(F){return new Q(this.source,F)},parse:function(){var F=this.source,z=this.skip(Y,this.index),L=this.fork(z),K=S(F,z);if(E(D,K))return L.number();switch(K){case"{":return L.object();case"[":return L.array();case'"':return L.string();case"t":return L.keyword(!0);case"f":return L.keyword(!1);case"n":return L.keyword(null)}throw m('Unexpected character: "'+K+'" at: '+z)},node:function(F,z,L,K,U){return new be(z,K,F?null:w(this.source,L,K),U)},object:function(){for(var F=this.source,z=this.index+1,L=!1,K={},U={};z<F.length;){if(z=this.until(['"',"}"],z),S(F,z)=="}"&&!L){z++;break}var te=this.fork(z).string(),pe=te.value;z=te.end,z=this.until([":"],z)+1,z=this.skip(Y,z),te=this.fork(z).parse(),d(U,pe,te),d(K,pe,te.value),z=this.until([",","}"],te.end);var ue=S(F,z);if(ue==",")L=!0,z++;else if(ue=="}"){z++;break}}return this.node(X,K,this.index,z,U)},array:function(){for(var F=this.source,z=this.index+1,L=!1,K=[],U=[];z<F.length;){if(z=this.skip(Y,z),S(F,z)=="]"&&!L){z++;break}var te=this.fork(z).parse();if(V(U,te),V(K,te.value),z=this.until([",","]"],te.end),S(F,z)==",")L=!0,z++;else if(S(F,z)=="]"){z++;break}}return this.node(X,K,this.index,z,U)},string:function(){var F=this.index,z=v(this.source,this.index+1);return this.node(G,z.value,F,z.end)},number:function(){var F=this.source,z=this.index,L=z;if(S(F,L)=="-"&&L++,S(F,L)=="0")L++;else if(E(j,S(F,L)))L=this.skip($,++L);else throw m("Failed to parse number at: "+L);if(S(F,L)=="."&&(L=this.skip($,++L)),S(F,L)=="e"||S(F,L)=="E"){L++,(S(F,L)=="+"||S(F,L)=="-")&&L++;var K=L;if(L=this.skip($,L),K==L)throw m("Failed to parse number's exponent value at: "+L)}return this.node(G,N(w(F,z,L)),z,L)},keyword:function(F){var z=""+F,L=this.index,K=L+z.length;if(w(this.source,L,K)!=z)throw m("Failed to parse value at: "+L);return this.node(G,F,L,K)},skip:function(F,z){for(var L=this.source;z<L.length&&E(F,S(L,z));z++);return z},until:function(F,z){z=this.skip(Y,z);for(var L=S(this.source,z),K=0;K<F.length;K++)if(F[K]==L)return z;throw m('Unexpected character: "'+L+'" at: '+z)}};var O=f(function(){var F="9007199254740993",z;return b(F,function(L,K,U){z=U.source}),z!==F}),k=T&&!f(function(){return 1/b("-0 	")!==-1/0});n({target:"JSON",stat:!0,forced:O},{parse:function(z,L){return k&&!c(L)?b(z):Z(z,L)}})},(r,e,t)=>{var n=t(14),s=t(39),i=SyntaxError,o=parseInt,a=String.fromCharCode,l=n("".charAt),c=n("".slice),u=n(/./.exec),p={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},g=/^[\da-f]{4}$/i,y=/^[\u0000-\u001F]$/;r.exports=function(h,d){for(var f=!0,v="";d<h.length;){var T=l(h,d);if(T=="\\"){var R=c(h,d,d+2);if(s(p,R))v+=p[R],d+=2;else if(R=="\\u"){d+=2;var N=c(h,d,d+4);if(!u(g,N))throw i("Bad Unicode escape at: "+d);v+=a(o(N,16)),d+=4}else throw i('Unknown escape sequence: "'+R+'"')}else if(T=='"'){f=!1,d++;break}else{if(u(y,T))throw i("Bad control character in string literal at: "+d);v+=T,d++}}if(f)throw i("Unterminated string at: "+d);return{value:v,end:d}}},(r,e,t)=>{var G,X,Z,ne,ie,be,Q,O,k,F,z,L,Ct,U,Et,pe,qt,ve,Ft,ge,Dt,Oe,Ot,we,Pt;Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMFilterFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=P,e.getColorValues=V,e.getCurrentTransform=$,e.getCurrentTransformInverse=j,e.getFilenameFromUrl=T,e.getPdfFilenameFromUrl=R,e.getRGB=E,e.getXfaPageViewport=w,e.isDataScheme=f,e.isPdfFile=v,e.isValidFetchUrl=m,e.loadScript=b,e.setLayerDimensions=D,t(2),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89),t(84),t(86),t(87);var n=t(168),s=t(1);const i="http://www.w3.org/2000/svg",o="pdfjs_internal_id_";e.AnnotationPrefix=o;const Y=class Y{};st(Y,"CSS",96),st(Y,"PDF",72),st(Y,"PDF_TO_CSS_UNITS",Y.CSS/Y.PDF);let a=Y;e.PixelsPerInch=a;class l extends n.BaseFilterFactory{constructor(){let{docId:de,ownerDocument:Te=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super();re(this,L);re(this,U);re(this,pe);re(this,ve);re(this,ge);re(this,Oe);re(this,we);re(this,G,void 0);re(this,X,void 0);re(this,Z,void 0);re(this,ne,void 0);re(this,ie,void 0);re(this,be,void 0);re(this,Q,void 0);re(this,O,void 0);re(this,k,void 0);re(this,F,void 0);re(this,z,0);ye(this,Z,de),ye(this,ne,Te)}addFilter(de){if(!de)return"none";let Te=_(this,L,Ct).get(de);if(Te)return Te;let _e,Ve,Ge,Ke;if(de.length===1){const qe=de[0],Ye=new Array(256);for(let Se=0;Se<256;Se++)Ye[Se]=qe[Se]/255;Ke=_e=Ve=Ge=Ye.join(",")}else{const[qe,Ye,Se]=de,ce=new Array(256),oe=new Array(256),Re=new Array(256);for(let Ie=0;Ie<256;Ie++)ce[Ie]=qe[Ie]/255,oe[Ie]=Ye[Ie]/255,Re[Ie]=Se[Ie]/255;_e=ce.join(","),Ve=oe.join(","),Ge=Re.join(","),Ke=`${_e}${Ve}${Ge}`}if(Te=_(this,L,Ct).get(Ke),Te)return _(this,L,Ct).set(de,Te),Te;const $e=`g_${_(this,Z)}_transfer_map_${pt(this,z)._++}`,Ze=`url(#${$e})`;_(this,L,Ct).set(de,Ze),_(this,L,Ct).set(Ke,Ze);const Qe=me(this,ve,Ft).call(this,$e);return me(this,Oe,Ot).call(this,_e,Ve,Ge,Qe),Ze}addHCMFilter(de,Te){var Ye;const _e=`${de}-${Te}`;if(_(this,be)===_e)return _(this,Q);if(ye(this,be,_e),ye(this,Q,"none"),(Ye=_(this,ie))==null||Ye.remove(),!de||!Te)return _(this,Q);const Ve=me(this,we,Pt).call(this,de);de=s.Util.makeHexColor(...Ve);const Ge=me(this,we,Pt).call(this,Te);if(Te=s.Util.makeHexColor(...Ge),_(this,U,Et).style.color="",de==="#000000"&&Te==="#ffffff"||de===Te)return _(this,Q);const Ke=new Array(256);for(let Se=0;Se<=255;Se++){const ce=Se/255;Ke[Se]=ce<=.03928?ce/12.92:((ce+.055)/1.055)**2.4}const $e=Ke.join(","),Ze=`g_${_(this,Z)}_hcm_filter`,Qe=ye(this,O,me(this,ve,Ft).call(this,Ze));me(this,Oe,Ot).call(this,$e,$e,$e,Qe),me(this,pe,qt).call(this,Qe);const qe=(Se,ce)=>{const oe=Ve[Se]/255,Re=Ge[Se]/255,Ie=new Array(ce+1);for(let et=0;et<=ce;et++)Ie[et]=oe+et/ce*(Re-oe);return Ie.join(",")};return me(this,Oe,Ot).call(this,qe(0,5),qe(1,5),qe(2,5),Qe),ye(this,Q,`url(#${Ze})`),_(this,Q)}addHighlightHCMFilter(de,Te,_e,Ve){var Re;const Ge=`${de}-${Te}-${_e}-${Ve}`;if(_(this,k)===Ge)return _(this,F);if(ye(this,k,Ge),ye(this,F,"none"),(Re=_(this,O))==null||Re.remove(),!de||!Te)return _(this,F);const[Ke,$e]=[de,Te].map(me(this,we,Pt).bind(this));let Ze=Math.round(.2126*Ke[0]+.7152*Ke[1]+.0722*Ke[2]),Qe=Math.round(.2126*$e[0]+.7152*$e[1]+.0722*$e[2]),[qe,Ye]=[_e,Ve].map(me(this,we,Pt).bind(this));Qe<Ze&&([Ze,Qe,qe,Ye]=[Qe,Ze,Ye,qe]),_(this,U,Et).style.color="";const Se=(Ie,et,fe)=>{const M=new Array(256),ee=(Qe-Ze)/fe,he=Ie/255,ae=(et-Ie)/(255*fe);let W=0;for(let I=0;I<=fe;I++){const q=Math.round(Ze+I*ee),H=he+I*ae;for(let J=W;J<=q;J++)M[J]=H;W=q+1}for(let I=W;I<256;I++)M[I]=M[W-1];return M.join(",")},ce=`g_${_(this,Z)}_hcm_highlight_filter`,oe=ye(this,O,me(this,ve,Ft).call(this,ce));return me(this,pe,qt).call(this,oe),me(this,Oe,Ot).call(this,Se(qe[0],Ye[0],5),Se(qe[1],Ye[1],5),Se(qe[2],Ye[2],5),oe),ye(this,F,`url(#${ce})`),_(this,F)}destroy(){arguments.length>0&&arguments[0]!==void 0&&arguments[0]&&(_(this,Q)||_(this,F))||(_(this,X)&&(_(this,X).parentNode.parentNode.remove(),ye(this,X,null)),_(this,G)&&(_(this,G).clear(),ye(this,G,null)),ye(this,z,0))}}G=new WeakMap,X=new WeakMap,Z=new WeakMap,ne=new WeakMap,ie=new WeakMap,be=new WeakMap,Q=new WeakMap,O=new WeakMap,k=new WeakMap,F=new WeakMap,z=new WeakMap,L=new WeakSet,Ct=function(){return _(this,G)||ye(this,G,new Map)},U=new WeakSet,Et=function(){if(!_(this,X)){const de=_(this,ne).createElement("div"),{style:Te}=de;Te.visibility="hidden",Te.contain="strict",Te.width=Te.height=0,Te.position="absolute",Te.top=Te.left=0,Te.zIndex=-1;const _e=_(this,ne).createElementNS(i,"svg");_e.setAttribute("width",0),_e.setAttribute("height",0),ye(this,X,_(this,ne).createElementNS(i,"defs")),de.append(_e),_e.append(_(this,X)),_(this,ne).body.append(de)}return _(this,X)},pe=new WeakSet,qt=function(de){const Te=_(this,ne).createElementNS(i,"feColorMatrix");Te.setAttribute("type","matrix"),Te.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),de.append(Te)},ve=new WeakSet,Ft=function(de){const Te=_(this,ne).createElementNS(i,"filter");return Te.setAttribute("color-interpolation-filters","sRGB"),Te.setAttribute("id",de),_(this,U,Et).append(Te),Te},ge=new WeakSet,Dt=function(de,Te,_e){const Ve=_(this,ne).createElementNS(i,Te);Ve.setAttribute("type","discrete"),Ve.setAttribute("tableValues",_e),de.append(Ve)},Oe=new WeakSet,Ot=function(de,Te,_e,Ve){const Ge=_(this,ne).createElementNS(i,"feComponentTransfer");Ve.append(Ge),me(this,ge,Dt).call(this,Ge,"feFuncR",de),me(this,ge,Dt).call(this,Ge,"feFuncG",Te),me(this,ge,Dt).call(this,Ge,"feFuncB",_e)},we=new WeakSet,Pt=function(de){return _(this,U,Et).style.color=de,E(getComputedStyle(_(this,U,Et)).getPropertyValue("color"))},e.DOMFilterFactory=l;class c extends n.BaseCanvasFactory{constructor(){let{ownerDocument:Ae=globalThis.document}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._document=Ae}_createCanvas(Ae,de){const Te=this._document.createElement("canvas");return Te.width=Ae,Te.height=de,Te}}e.DOMCanvasFactory=c;async function u(Ne){let Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(m(Ne,document.baseURI)){const de=await fetch(Ne);if(!de.ok)throw new Error(de.statusText);return Ae?new Uint8Array(await de.arrayBuffer()):(0,s.stringToBytes)(await de.text())}return new Promise((de,Te)=>{const _e=new XMLHttpRequest;_e.open("GET",Ne,!0),Ae&&(_e.responseType="arraybuffer"),_e.onreadystatechange=()=>{if(_e.readyState===XMLHttpRequest.DONE){if(_e.status===200||_e.status===0){let Ve;if(Ae&&_e.response?Ve=new Uint8Array(_e.response):!Ae&&_e.responseText&&(Ve=(0,s.stringToBytes)(_e.responseText)),Ve){de(Ve);return}}Te(new Error(_e.statusText))}},_e.send(null)})}class p extends n.BaseCMapReaderFactory{_fetchData(Ae,de){return u(Ae,this.isCompressed).then(Te=>({cMapData:Te,compressionType:de}))}}e.DOMCMapReaderFactory=p;class g extends n.BaseStandardFontDataFactory{_fetchData(Ae){return u(Ae,!0)}}e.DOMStandardFontDataFactory=g;class y extends n.BaseSVGFactory{_createSVG(Ae){return document.createElementNS(i,Ae)}}e.DOMSVGFactory=y;class h{constructor(Ae){let{viewBox:de,scale:Te,rotation:_e,offsetX:Ve=0,offsetY:Ge=0,dontFlip:Ke=!1}=Ae;this.viewBox=de,this.scale=Te,this.rotation=_e,this.offsetX=Ve,this.offsetY=Ge;const $e=(de[2]+de[0])/2,Ze=(de[3]+de[1])/2;let Qe,qe,Ye,Se;switch(_e%=360,_e<0&&(_e+=360),_e){case 180:Qe=-1,qe=0,Ye=0,Se=1;break;case 90:Qe=0,qe=1,Ye=1,Se=0;break;case 270:Qe=0,qe=-1,Ye=-1,Se=0;break;case 0:Qe=1,qe=0,Ye=0,Se=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Ke&&(Ye=-Ye,Se=-Se);let ce,oe,Re,Ie;Qe===0?(ce=Math.abs(Ze-de[1])*Te+Ve,oe=Math.abs($e-de[0])*Te+Ge,Re=(de[3]-de[1])*Te,Ie=(de[2]-de[0])*Te):(ce=Math.abs($e-de[0])*Te+Ve,oe=Math.abs(Ze-de[1])*Te+Ge,Re=(de[2]-de[0])*Te,Ie=(de[3]-de[1])*Te),this.transform=[Qe*Te,qe*Te,Ye*Te,Se*Te,ce-Qe*Te*$e-Ye*Te*Ze,oe-qe*Te*$e-Se*Te*Ze],this.width=Re,this.height=Ie}get rawDims(){const{viewBox:Ae}=this;return(0,s.shadow)(this,"rawDims",{pageWidth:Ae[2]-Ae[0],pageHeight:Ae[3]-Ae[1],pageX:Ae[0],pageY:Ae[1]})}clone(){let{scale:Ae=this.scale,rotation:de=this.rotation,offsetX:Te=this.offsetX,offsetY:_e=this.offsetY,dontFlip:Ve=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new h({viewBox:this.viewBox.slice(),scale:Ae,rotation:de,offsetX:Te,offsetY:_e,dontFlip:Ve})}convertToViewportPoint(Ae,de){return s.Util.applyTransform([Ae,de],this.transform)}convertToViewportRectangle(Ae){const de=s.Util.applyTransform([Ae[0],Ae[1]],this.transform),Te=s.Util.applyTransform([Ae[2],Ae[3]],this.transform);return[de[0],de[1],Te[0],Te[1]]}convertToPdfPoint(Ae,de){return s.Util.applyInverseTransform([Ae,de],this.transform)}}e.PageViewport=h;class d extends s.BaseException{constructor(Ae){let de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(Ae,"RenderingCancelledException"),this.extraDelay=de}}e.RenderingCancelledException=d;function f(Ne){const Ae=Ne.length;let de=0;for(;de<Ae&&Ne[de].trim()==="";)de++;return Ne.substring(de,de+5).toLowerCase()==="data:"}function v(Ne){return typeof Ne=="string"&&/\.pdf$/i.test(Ne)}function T(Ne){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)||([Ne]=Ne.split(/[#?]/,1)),Ne.substring(Ne.lastIndexOf("/")+1)}function R(Ne){let Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"document.pdf";if(typeof Ne!="string")return Ae;if(f(Ne))return(0,s.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),Ae;const de=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,Te=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,_e=de.exec(Ne);let Ve=Te.exec(_e[1])||Te.exec(_e[2])||Te.exec(_e[3]);if(Ve&&(Ve=Ve[0],Ve.includes("%")))try{Ve=Te.exec(decodeURIComponent(Ve))[0]}catch{}return Ve||Ae}class N{constructor(){st(this,"started",Object.create(null));st(this,"times",[])}time(Ae){Ae in this.started&&(0,s.warn)(`Timer is already running for ${Ae}`),this.started[Ae]=Date.now()}timeEnd(Ae){Ae in this.started||(0,s.warn)(`Timer has not been started for ${Ae}`),this.times.push({name:Ae,start:this.started[Ae],end:Date.now()}),delete this.started[Ae]}toString(){const Ae=[];let de=0;for(const{name:Te}of this.times)de=Math.max(Te.length,de);for(const{name:Te,start:_e,end:Ve}of this.times)Ae.push(`${Te.padEnd(de)} ${Ve-_e}ms
`);return Ae.join("")}}e.StatTimer=N;function m(Ne,Ae){try{const{protocol:de}=Ae?new URL(Ne,Ae):new URL(Ne);return de==="http:"||de==="https:"}catch{return!1}}function b(Ne){let Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new Promise((de,Te)=>{const _e=document.createElement("script");_e.src=Ne,_e.onload=function(Ve){Ae&&_e.remove(),de(Ve)},_e.onerror=function(){Te(new Error(`Cannot load script at: ${_e.src}`))},(document.head||document.documentElement).append(_e)})}function P(Ne){console.log("Deprecated API usage: "+Ne)}let x;class S{static toDateObject(Ae){if(!Ae||typeof Ae!="string")return null;x||(x=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const de=x.exec(Ae);if(!de)return null;const Te=parseInt(de[1],10);let _e=parseInt(de[2],10);_e=_e>=1&&_e<=12?_e-1:0;let Ve=parseInt(de[3],10);Ve=Ve>=1&&Ve<=31?Ve:1;let Ge=parseInt(de[4],10);Ge=Ge>=0&&Ge<=23?Ge:0;let Ke=parseInt(de[5],10);Ke=Ke>=0&&Ke<=59?Ke:0;let $e=parseInt(de[6],10);$e=$e>=0&&$e<=59?$e:0;const Ze=de[7]||"Z";let Qe=parseInt(de[8],10);Qe=Qe>=0&&Qe<=23?Qe:0;let qe=parseInt(de[9],10)||0;return qe=qe>=0&&qe<=59?qe:0,Ze==="-"?(Ge+=Qe,Ke+=qe):Ze==="+"&&(Ge-=Qe,Ke-=qe),new Date(Date.UTC(Te,_e,Ve,Ge,Ke,$e))}}e.PDFDateString=S;function w(Ne,Ae){let{scale:de=1,rotation:Te=0}=Ae;const{width:_e,height:Ve}=Ne.attributes.style,Ge=[0,0,parseInt(_e),parseInt(Ve)];return new h({viewBox:Ge,scale:de,rotation:Te})}function E(Ne){if(Ne.startsWith("#")){const Ae=parseInt(Ne.slice(1),16);return[(Ae&16711680)>>16,(Ae&65280)>>8,Ae&255]}return Ne.startsWith("rgb(")?Ne.slice(4,-1).split(",").map(Ae=>parseInt(Ae)):Ne.startsWith("rgba(")?Ne.slice(5,-1).split(",").map(Ae=>parseInt(Ae)).slice(0,3):((0,s.warn)(`Not a valid color format: "${Ne}"`),[0,0,0])}function V(Ne){const Ae=document.createElement("span");Ae.style.visibility="hidden",document.body.append(Ae);for(const de of Ne.keys()){Ae.style.color=de;const Te=window.getComputedStyle(Ae).color;Ne.set(de,E(Te))}Ae.remove()}function $(Ne){const{a:Ae,b:de,c:Te,d:_e,e:Ve,f:Ge}=Ne.getTransform();return[Ae,de,Te,_e,Ve,Ge]}function j(Ne){const{a:Ae,b:de,c:Te,d:_e,e:Ve,f:Ge}=Ne.getTransform().invertSelf();return[Ae,de,Te,_e,Ve,Ge]}function D(Ne,Ae){let de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,Te=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;if(Ae instanceof h){const{pageWidth:_e,pageHeight:Ve}=Ae.rawDims,{style:Ge}=Ne,Ke=`calc(var(--scale-factor) * ${_e}px)`,$e=`calc(var(--scale-factor) * ${Ve}px)`;!de||Ae.rotation%180===0?(Ge.width=Ke,Ge.height=$e):(Ge.width=$e,Ge.height=Ke)}Te&&Ne.setAttribute("data-main-rotation",Ae.rotation)}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseFilterFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0,t(2);var n=t(1);class s{constructor(){this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(u){return"none"}addHCMFilter(u,p){return"none"}addHighlightHCMFilter(u,p,g,y){return"none"}destroy(){}}e.BaseFilterFactory=s;class i{constructor(){this.constructor===i&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(u,p){if(u<=0||p<=0)throw new Error("Invalid canvas size");const g=this._createCanvas(u,p);return{canvas:g,context:g.getContext("2d")}}reset(u,p,g){if(!u.canvas)throw new Error("Canvas is not specified");if(p<=0||g<=0)throw new Error("Invalid canvas size");u.canvas.width=p,u.canvas.height=g}destroy(u){if(!u.canvas)throw new Error("Canvas is not specified");u.canvas.width=0,u.canvas.height=0,u.canvas=null,u.context=null}_createCanvas(u,p){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=i;class o{constructor(u){let{baseUrl:p=null,isCompressed:g=!0}=u;this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=p,this.isCompressed=g}async fetch(u){let{name:p}=u;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!p)throw new Error("CMap name must be specified.");const g=this.baseUrl+p+(this.isCompressed?".bcmap":""),y=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(g,y).catch(h=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${g}`)})}_fetchData(u,p){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=o;class a{constructor(u){let{baseUrl:p=null}=u;this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=p}async fetch(u){let{filename:p}=u;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!p)throw new Error("Font filename must be specified.");const g=`${this.baseUrl}${p}`;return this._fetchData(g).catch(y=>{throw new Error(`Unable to load font data at: ${g}`)})}_fetchData(u){(0,n.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=a;class l{constructor(){this.constructor===l&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(u,p){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(u<=0||p<=0)throw new Error("Invalid SVG dimensions");const y=this._createSVG("svg:svg");return y.setAttribute("version","1.1"),g||(y.setAttribute("width",`${u}px`),y.setAttribute("height",`${p}px`)),y.setAttribute("preserveAspectRatio","none"),y.setAttribute("viewBox",`0 0 ${u} ${p}`),y}createElement(u){if(typeof u!="string")throw new Error("Invalid SVG element type");return this._createSVG(u)}_createSVG(u){(0,n.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=l},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(2);var n=t(1);const s=3285377520,i=4294901760,o=65535;class a{constructor(c){this.h1=c?c&4294967295:s,this.h2=c?c&4294967295:s}update(c){let u,p;if(typeof c=="string"){u=new Uint8Array(c.length*2),p=0;for(let P=0,x=c.length;P<x;P++){const S=c.charCodeAt(P);S<=255?u[p++]=S:(u[p++]=S>>>8,u[p++]=S&255)}}else if((0,n.isArrayBuffer)(c))u=c.slice(),p=u.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const g=p>>2,y=p-g*4,h=new Uint32Array(u.buffer,0,g);let d=0,f=0,v=this.h1,T=this.h2;const R=3432918353,N=461845907,m=R&o,b=N&o;for(let P=0;P<g;P++)P&1?(d=h[P],d=d*R&i|d*m&o,d=d<<15|d>>>17,d=d*N&i|d*b&o,v^=d,v=v<<13|v>>>19,v=v*5+3864292196):(f=h[P],f=f*R&i|f*m&o,f=f<<15|f>>>17,f=f*N&i|f*b&o,T^=f,T=T<<13|T>>>19,T=T*5+3864292196);switch(d=0,y){case 3:d^=u[g*4+2]<<16;case 2:d^=u[g*4+1]<<8;case 1:d^=u[g*4],d=d*R&i|d*m&o,d=d<<15|d>>>17,d=d*N&i|d*b&o,g&1?v^=d:T^=d}this.h1=v,this.h2=T}hexdigest(){let c=this.h1,u=this.h2;return c^=u>>>1,c=c*3981806797&i|c*36045&o,u=u*4283543511&i|((u<<16|c>>>16)*2950163797&i)>>>16,c^=u>>>1,c=c*444984403&i|c*60499&o,u=u*3301882366&i|((u<<16|c>>>16)*3120437893&i)>>>16,c^=u>>>1,(c>>>0).toString(16).padStart(8,"0")+(u>>>0).toString(16).padStart(8,"0")}}e.MurmurHash3_64=a},(r,e,t)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0,t(125),t(135),t(137),t(140),t(142),t(144),t(146),t(89),t(148);var n=t(1);class s{constructor(l){re(this,o,new Set);let{ownerDocument:c=globalThis.document,styleElement:u=null}=l;this._document=c,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(l){this.nativeFontFaces.add(l),this._document.fonts.add(l)}removeNativeFontFace(l){this.nativeFontFaces.delete(l),this._document.fonts.delete(l)}insertRule(l){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const c=this.styleElement.sheet;c.insertRule(l,c.cssRules.length)}clear(){for(const l of this.nativeFontFaces)this._document.fonts.delete(l);this.nativeFontFaces.clear(),_(this,o).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(l){if(!(!l||_(this,o).has(l.loadedName))){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:c,src:u,style:p}=l,g=new FontFace(c,u,p);this.addNativeFontFace(g);try{await g.load(),_(this,o).add(c)}catch{(0,n.warn)(`Cannot load system font: ${l.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(g)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(l){if(l.attached||l.missingFile&&!l.systemFontInfo)return;if(l.attached=!0,l.systemFontInfo){await this.loadSystemFont(l.systemFontInfo);return}if(this.isFontLoadingAPISupported){const u=l.createNativeFontFace();if(u){this.addNativeFontFace(u);try{await u.loaded}catch(p){throw(0,n.warn)(`Failed to load font '${u.family}': '${p}'.`),l.disableFontFace=!0,p}}return}const c=l.createFontFaceRule();if(c){if(this.insertRule(c),this.isSyncFontLoadingSupported)return;await new Promise(u=>{const p=this._queueLoadingCallback(u);this._prepareFontLoadEvent(l,p)})}}get isFontLoadingAPISupported(){var c;const l=!!((c=this._document)!=null&&c.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",l)}get isSyncFontLoadingSupported(){let l=!1;return(n.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(l=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",l)}_queueLoadingCallback(l){function c(){for((0,n.assert)(!p.done,"completeRequest() cannot be called twice."),p.done=!0;u.length>0&&u[0].done;){const g=u.shift();setTimeout(g.callback,0)}}const{loadingRequests:u}=this,p={done:!1,complete:c,callback:l};return u.push(p),p}get _loadTestFont(){const l=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",l)}_prepareFontLoadEvent(l,c){function u(E,V){return E.charCodeAt(V)<<24|E.charCodeAt(V+1)<<16|E.charCodeAt(V+2)<<8|E.charCodeAt(V+3)&255}function p(E,V,$,j){const D=E.substring(0,V),Y=E.substring(V+$);return D+j+Y}let g,y;const h=this._document.createElement("canvas");h.width=1,h.height=1;const d=h.getContext("2d");let f=0;function v(E,V){if(++f>30){(0,n.warn)("Load test font never loaded."),V();return}if(d.font="30px "+E,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){V();return}setTimeout(v.bind(null,E,V))}const T=`lt${Date.now()}${this.loadTestFontId++}`;let R=this._loadTestFont;R=p(R,976,T.length,T);const m=16,b=1482184792;let P=u(R,m);for(g=0,y=T.length-3;g<y;g+=4)P=P-b+u(T,g)|0;g<T.length&&(P=P-b+u(T+"XXX",g)|0),R=p(R,m,4,(0,n.string32)(P));const x=`url(data:font/opentype;base64,${btoa(R)});`,S=`@font-face {font-family:"${T}";src:${x}}`;this.insertRule(S);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const E of[l.loadedName,T]){const V=this._document.createElement("span");V.textContent="Hi",V.style.fontFamily=E,w.append(V)}this._document.body.append(w),v(T,()=>{w.remove(),c.complete()})}}o=new WeakMap,e.FontLoader=s;class i{constructor(l,c){let{isEvalSupported:u=!0,disableFontFace:p=!1,ignoreErrors:g=!1,inspectFont:y=null}=c;this.compiledGlyphs=Object.create(null);for(const h in l)this[h]=l[h];this.isEvalSupported=u!==!1,this.disableFontFace=p===!0,this.ignoreErrors=g===!0,this._inspectFont=y}createNativeFontFace(){var c;if(!this.data||this.disableFontFace)return null;let l;if(!this.cssFontInfo)l=new FontFace(this.loadedName,this.data,{});else{const u={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(u.style=`oblique ${this.cssFontInfo.italicAngle}deg`),l=new FontFace(this.cssFontInfo.fontFamily,this.data,u)}return(c=this._inspectFont)==null||c.call(this,this),l}createFontFaceRule(){var p;if(!this.data||this.disableFontFace)return null;const l=(0,n.bytesToString)(this.data),c=`url(data:${this.mimetype};base64,${btoa(l)});`;let u;if(!this.cssFontInfo)u=`@font-face {font-family:"${this.loadedName}";src:${c}}`;else{let g=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(g+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),u=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${g}src:${c}}`}return(p=this._inspectFont)==null||p.call(this,this,c),u}getPathGenerator(l,c){if(this.compiledGlyphs[c]!==void 0)return this.compiledGlyphs[c];let u;try{u=l.get(this.loadedName+"_path_"+c)}catch(p){if(!this.ignoreErrors)throw p;return(0,n.warn)(`getPathGenerator - ignoring character: "${p}".`),this.compiledGlyphs[c]=function(g,y){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const p=[];for(const g of u){const y=g.args!==void 0?g.args.join(","):"";p.push("c.",g.cmd,"(",y,`);
`)}return this.compiledGlyphs[c]=new Function("c","size",p.join(""))}return this.compiledGlyphs[c]=function(p,g){for(const y of u)y.cmd==="scale"&&(y.args=[g,-g]),p[y.cmd].apply(p,y.args)}}}e.FontFaceObject=i},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeFilterFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0,t(2),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);var n=t(168),s=t(1);(function(){if(!(globalThis.DOMMatrix||!s.isNodeJS))try{globalThis.DOMMatrix=require$$6.DOMMatrix}catch(p){(0,s.warn)(`Cannot polyfill \`DOMMatrix\`, rendering may be broken: "${p}".`)}})(),function(){if(!(globalThis.Path2D||!s.isNodeJS))try{const{CanvasRenderingContext2D:p}=require$$6,{polyfillPath2D:g}=requirePath2dPolyfill_esm();globalThis.CanvasRenderingContext2D=p,g(globalThis)}catch(p){(0,s.warn)(`Cannot polyfill \`Path2D\`, rendering may be broken: "${p}".`)}}();const i=function(u){return new Promise((p,g)=>{require$$6.readFile(u,(h,d)=>{if(h||!d){g(new Error(h));return}p(new Uint8Array(d))})})};class o extends n.BaseFilterFactory{}e.NodeFilterFactory=o;class a extends n.BaseCanvasFactory{_createCanvas(p,g){return require$$6.createCanvas(p,g)}}e.NodeCanvasFactory=a;class l extends n.BaseCMapReaderFactory{_fetchData(p,g){return i(p).then(y=>({cMapData:y,compressionType:g}))}}e.NodeCMapReaderFactory=l;class c extends n.BaseStandardFontDataFactory{_fetchData(p){return i(p)}}e.NodeStandardFontDataFactory=c},(r,e,t)=>{var X,Jt,ne,en;Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0,t(2),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89);var n=t(1),s=t(167),i=t(173),o=t(174);const a=16,l=100,c=4096,u=15,p=10,g=1e3,y=16;function h(Q,O){if(Q._removeMirroring)throw new Error("Context is already forwarding operations.");Q.__originalSave=Q.save,Q.__originalRestore=Q.restore,Q.__originalRotate=Q.rotate,Q.__originalScale=Q.scale,Q.__originalTranslate=Q.translate,Q.__originalTransform=Q.transform,Q.__originalSetTransform=Q.setTransform,Q.__originalResetTransform=Q.resetTransform,Q.__originalClip=Q.clip,Q.__originalMoveTo=Q.moveTo,Q.__originalLineTo=Q.lineTo,Q.__originalBezierCurveTo=Q.bezierCurveTo,Q.__originalRect=Q.rect,Q.__originalClosePath=Q.closePath,Q.__originalBeginPath=Q.beginPath,Q._removeMirroring=()=>{Q.save=Q.__originalSave,Q.restore=Q.__originalRestore,Q.rotate=Q.__originalRotate,Q.scale=Q.__originalScale,Q.translate=Q.__originalTranslate,Q.transform=Q.__originalTransform,Q.setTransform=Q.__originalSetTransform,Q.resetTransform=Q.__originalResetTransform,Q.clip=Q.__originalClip,Q.moveTo=Q.__originalMoveTo,Q.lineTo=Q.__originalLineTo,Q.bezierCurveTo=Q.__originalBezierCurveTo,Q.rect=Q.__originalRect,Q.closePath=Q.__originalClosePath,Q.beginPath=Q.__originalBeginPath,delete Q._removeMirroring},Q.save=function(){O.save(),this.__originalSave()},Q.restore=function(){O.restore(),this.__originalRestore()},Q.translate=function(F,z){O.translate(F,z),this.__originalTranslate(F,z)},Q.scale=function(F,z){O.scale(F,z),this.__originalScale(F,z)},Q.transform=function(F,z,L,K,U,te){O.transform(F,z,L,K,U,te),this.__originalTransform(F,z,L,K,U,te)},Q.setTransform=function(F,z,L,K,U,te){O.setTransform(F,z,L,K,U,te),this.__originalSetTransform(F,z,L,K,U,te)},Q.resetTransform=function(){O.resetTransform(),this.__originalResetTransform()},Q.rotate=function(F){O.rotate(F),this.__originalRotate(F)},Q.clip=function(F){O.clip(F),this.__originalClip(F)},Q.moveTo=function(k,F){O.moveTo(k,F),this.__originalMoveTo(k,F)},Q.lineTo=function(k,F){O.lineTo(k,F),this.__originalLineTo(k,F)},Q.bezierCurveTo=function(k,F,z,L,K,U){O.bezierCurveTo(k,F,z,L,K,U),this.__originalBezierCurveTo(k,F,z,L,K,U)},Q.rect=function(k,F,z,L){O.rect(k,F,z,L),this.__originalRect(k,F,z,L)},Q.closePath=function(){O.closePath(),this.__originalClosePath()},Q.beginPath=function(){O.beginPath(),this.__originalBeginPath()}}class d{constructor(O){this.canvasFactory=O,this.cache=Object.create(null)}getCanvas(O,k,F){let z;return this.cache[O]!==void 0?(z=this.cache[O],this.canvasFactory.reset(z,k,F)):(z=this.canvasFactory.create(k,F),this.cache[O]=z),z}delete(O){delete this.cache[O]}clear(){for(const O in this.cache){const k=this.cache[O];this.canvasFactory.destroy(k),delete this.cache[O]}}}function f(Q,O,k,F,z,L,K,U,te,pe){const[ue,ve,se,ge,Ee,Oe]=(0,s.getCurrentTransform)(Q);if(ve===0&&se===0){const Ue=K*ue+Ee,Ne=Math.round(Ue),Ae=U*ge+Oe,de=Math.round(Ae),Te=(K+te)*ue+Ee,_e=Math.abs(Math.round(Te)-Ne)||1,Ve=(U+pe)*ge+Oe,Ge=Math.abs(Math.round(Ve)-de)||1;return Q.setTransform(Math.sign(ue),0,0,Math.sign(ge),Ne,de),Q.drawImage(O,k,F,z,L,0,0,_e,Ge),Q.setTransform(ue,ve,se,ge,Ee,Oe),[_e,Ge]}if(ue===0&&ge===0){const Ue=U*se+Ee,Ne=Math.round(Ue),Ae=K*ve+Oe,de=Math.round(Ae),Te=(U+pe)*se+Ee,_e=Math.abs(Math.round(Te)-Ne)||1,Ve=(K+te)*ve+Oe,Ge=Math.abs(Math.round(Ve)-de)||1;return Q.setTransform(0,Math.sign(ve),Math.sign(se),0,Ne,de),Q.drawImage(O,k,F,z,L,0,0,Ge,_e),Q.setTransform(ue,ve,se,ge,Ee,Oe),[Ge,_e]}Q.drawImage(O,k,F,z,L,K,U,te,pe);const Me=Math.hypot(ue,ve),we=Math.hypot(se,ge);return[Me*te,we*pe]}function v(Q){const{width:O,height:k}=Q;if(O>g||k>g)return null;const F=1e3,z=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),L=O+1;let K=new Uint8Array(L*(k+1)),U,te,pe;const ue=O+7&-8;let ve=new Uint8Array(ue*k),se=0;for(const we of Q.data){let Ue=128;for(;Ue>0;)ve[se++]=we&Ue?0:255,Ue>>=1}let ge=0;for(se=0,ve[se]!==0&&(K[0]=1,++ge),te=1;te<O;te++)ve[se]!==ve[se+1]&&(K[te]=ve[se]?2:1,++ge),se++;for(ve[se]!==0&&(K[te]=2,++ge),U=1;U<k;U++){se=U*ue,pe=U*L,ve[se-ue]!==ve[se]&&(K[pe]=ve[se]?1:8,++ge);let we=(ve[se]?4:0)+(ve[se-ue]?8:0);for(te=1;te<O;te++)we=(we>>2)+(ve[se+1]?4:0)+(ve[se-ue+1]?8:0),z[we]&&(K[pe+te]=z[we],++ge),se++;if(ve[se-ue]!==ve[se]&&(K[pe+te]=ve[se]?2:4,++ge),ge>F)return null}for(se=ue*(k-1),pe=U*L,ve[se]!==0&&(K[pe]=8,++ge),te=1;te<O;te++)ve[se]!==ve[se+1]&&(K[pe+te]=ve[se]?4:8,++ge),se++;if(ve[se]!==0&&(K[pe+te]=4,++ge),ge>F)return null;const Ee=new Int32Array([0,L,-1,0,-L,0,0,0,1]),Oe=new Path2D;for(U=0;ge&&U<=k;U++){let we=U*L;const Ue=we+O;for(;we<Ue&&!K[we];)we++;if(we===Ue)continue;Oe.moveTo(we%L,U);const Ne=we;let Ae=K[we];do{const de=Ee[Ae];do we+=de;while(!K[we]);const Te=K[we];Te!==5&&Te!==10?(Ae=Te,K[we]=0):(Ae=Te&51*Ae>>4,K[we]&=Ae>>2|Ae<<2),Oe.lineTo(we%L,we/L|0),K[we]||--ge}while(Ne!==we);--U}return ve=null,K=null,function(we){we.save(),we.scale(1/O,-1/k),we.translate(0,-k),we.fill(Oe),we.beginPath(),we.restore()}}class T{constructor(O,k){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,O,k])}clone(){const O=Object.create(this);return O.clipBox=this.clipBox.slice(),O}setCurrentPoint(O,k){this.x=O,this.y=k}updatePathMinMax(O,k,F){[k,F]=n.Util.applyTransform([k,F],O),this.minX=Math.min(this.minX,k),this.minY=Math.min(this.minY,F),this.maxX=Math.max(this.maxX,k),this.maxY=Math.max(this.maxY,F)}updateRectMinMax(O,k){const F=n.Util.applyTransform(k,O),z=n.Util.applyTransform(k.slice(2),O);this.minX=Math.min(this.minX,F[0],z[0]),this.minY=Math.min(this.minY,F[1],z[1]),this.maxX=Math.max(this.maxX,F[0],z[0]),this.maxY=Math.max(this.maxY,F[1],z[1])}updateScalingPathMinMax(O,k){n.Util.scaleMinMax(O,k),this.minX=Math.min(this.minX,k[0]),this.maxX=Math.max(this.maxX,k[1]),this.minY=Math.min(this.minY,k[2]),this.maxY=Math.max(this.maxY,k[3])}updateCurvePathMinMax(O,k,F,z,L,K,U,te,pe,ue){const ve=n.Util.bezierBoundingBox(k,F,z,L,K,U,te,pe);if(ue){ue[0]=Math.min(ue[0],ve[0],ve[2]),ue[1]=Math.max(ue[1],ve[0],ve[2]),ue[2]=Math.min(ue[2],ve[1],ve[3]),ue[3]=Math.max(ue[3],ve[1],ve[3]);return}this.updateRectMinMax(O,ve)}getPathBoundingBox(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const F=[this.minX,this.minY,this.maxX,this.maxY];if(O===i.PathType.STROKE){k||(0,n.unreachable)("Stroke bounding box must include transform.");const z=n.Util.singularValueDecompose2dScale(k),L=z[0]*this.lineWidth/2,K=z[1]*this.lineWidth/2;F[0]-=L,F[1]-=K,F[2]+=L,F[3]+=K}return F}updateClipFromPath(){const O=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(O||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(O){this.clipBox=O,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i.PathType.FILL,k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return n.Util.intersect(this.clipBox,this.getPathBoundingBox(O,k))}}function R(Q,O){if(typeof ImageData<"u"&&O instanceof ImageData){Q.putImageData(O,0,0);return}const k=O.height,F=O.width,z=k%y,L=(k-z)/y,K=z===0?L:L+1,U=Q.createImageData(F,y);let te=0,pe;const ue=O.data,ve=U.data;let se,ge,Ee,Oe;if(O.kind===n.ImageKind.GRAYSCALE_1BPP){const Me=ue.byteLength,we=new Uint32Array(ve.buffer,0,ve.byteLength>>2),Ue=we.length,Ne=F+7>>3,Ae=4294967295,de=n.FeatureTest.isLittleEndian?4278190080:255;for(se=0;se<K;se++){for(Ee=se<L?y:z,pe=0,ge=0;ge<Ee;ge++){const Te=Me-te;let _e=0;const Ve=Te>Ne?F:Te*8-7,Ge=Ve&-8;let Ke=0,$e=0;for(;_e<Ge;_e+=8)$e=ue[te++],we[pe++]=$e&128?Ae:de,we[pe++]=$e&64?Ae:de,we[pe++]=$e&32?Ae:de,we[pe++]=$e&16?Ae:de,we[pe++]=$e&8?Ae:de,we[pe++]=$e&4?Ae:de,we[pe++]=$e&2?Ae:de,we[pe++]=$e&1?Ae:de;for(;_e<Ve;_e++)Ke===0&&($e=ue[te++],Ke=128),we[pe++]=$e&Ke?Ae:de,Ke>>=1}for(;pe<Ue;)we[pe++]=0;Q.putImageData(U,0,se*y)}}else if(O.kind===n.ImageKind.RGBA_32BPP){for(ge=0,Oe=F*y*4,se=0;se<L;se++)ve.set(ue.subarray(te,te+Oe)),te+=Oe,Q.putImageData(U,0,ge),ge+=y;se<K&&(Oe=F*z*4,ve.set(ue.subarray(te,te+Oe)),Q.putImageData(U,0,ge))}else if(O.kind===n.ImageKind.RGB_24BPP)for(Ee=y,Oe=F*Ee,se=0;se<K;se++){for(se>=L&&(Ee=z,Oe=F*Ee),pe=0,ge=Oe;ge--;)ve[pe++]=ue[te++],ve[pe++]=ue[te++],ve[pe++]=ue[te++],ve[pe++]=255;Q.putImageData(U,0,se*y)}else throw new Error(`bad image kind: ${O.kind}`)}function N(Q,O){if(O.bitmap){Q.drawImage(O.bitmap,0,0);return}const k=O.height,F=O.width,z=k%y,L=(k-z)/y,K=z===0?L:L+1,U=Q.createImageData(F,y);let te=0;const pe=O.data,ue=U.data;for(let ve=0;ve<K;ve++){const se=ve<L?y:z;({srcPos:te}=(0,o.convertBlackAndWhiteToRGBA)({src:pe,srcPos:te,dest:ue,width:F,height:se,nonBlackColor:0})),Q.putImageData(U,0,ve*y)}}function m(Q,O){const k=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const F of k)Q[F]!==void 0&&(O[F]=Q[F]);Q.setLineDash!==void 0&&(O.setLineDash(Q.getLineDash()),O.lineDashOffset=Q.lineDashOffset)}function b(Q){if(Q.strokeStyle=Q.fillStyle="#000000",Q.fillRule="nonzero",Q.globalAlpha=1,Q.lineWidth=1,Q.lineCap="butt",Q.lineJoin="miter",Q.miterLimit=10,Q.globalCompositeOperation="source-over",Q.font="10px sans-serif",Q.setLineDash!==void 0&&(Q.setLineDash([]),Q.lineDashOffset=0),!n.isNodeJS){const{filter:O}=Q;O!=="none"&&O!==""&&(Q.filter="none")}}function P(Q,O,k,F){const z=Q.length;for(let L=3;L<z;L+=4){const K=Q[L];if(K===0)Q[L-3]=O,Q[L-2]=k,Q[L-1]=F;else if(K<255){const U=255-K;Q[L-3]=Q[L-3]*K+O*U>>8,Q[L-2]=Q[L-2]*K+k*U>>8,Q[L-1]=Q[L-1]*K+F*U>>8}}}function x(Q,O,k){const F=Q.length,z=1/255;for(let L=3;L<F;L+=4){const K=k?k[Q[L]]:Q[L];O[L]=O[L]*K*z|0}}function S(Q,O,k){const F=Q.length;for(let z=3;z<F;z+=4){const L=Q[z-3]*77+Q[z-2]*152+Q[z-1]*28;O[z]=k?O[z]*k[L>>8]>>8:O[z]*L>>16}}function w(Q,O,k,F,z,L,K,U,te,pe,ue){const ve=!!L,se=ve?L[0]:0,ge=ve?L[1]:0,Ee=ve?L[2]:0,Oe=z==="Luminosity"?S:x,we=Math.min(F,Math.ceil(1048576/k));for(let Ue=0;Ue<F;Ue+=we){const Ne=Math.min(we,F-Ue),Ae=Q.getImageData(U-pe,Ue+(te-ue),k,Ne),de=O.getImageData(U,Ue+te,k,Ne);ve&&P(Ae.data,se,ge,Ee),Oe(Ae.data,de.data,K),O.putImageData(de,U,Ue+te)}}function E(Q,O,k,F){const z=F[0],L=F[1],K=F[2]-z,U=F[3]-L;K===0||U===0||(w(O.context,k,K,U,O.subtype,O.backdrop,O.transferMap,z,L,O.offsetX,O.offsetY),Q.save(),Q.globalAlpha=1,Q.globalCompositeOperation="source-over",Q.setTransform(1,0,0,1,0,0),Q.drawImage(k.canvas,0,0),Q.restore())}function V(Q,O){const k=n.Util.singularValueDecompose2dScale(Q);k[0]=Math.fround(k[0]),k[1]=Math.fround(k[1]);const F=Math.fround((globalThis.devicePixelRatio||1)*s.PixelsPerInch.PDF_TO_CSS_UNITS);return O!==void 0?O:k[0]<=F||k[1]<=F}const $=["butt","round","square"],j=["miter","round","bevel"],D={},Y={},be=class be{constructor(O,k,F,z,L,K,U,te){re(this,X);re(this,ne);let{optionalContentConfig:pe,markedContentStack:ue=null}=K;this.ctx=O,this.current=new T(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=k,this.objs=F,this.canvasFactory=z,this.filterFactory=L,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=ue||[],this.optionalContentConfig=pe,this.cachedCanvases=new d(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=U,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=te,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(O){let k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof O=="string"?O.startsWith("g_")?this.commonObjs.get(O):this.objs.get(O):k}beginDrawing(O){let{transform:k,viewport:F,transparency:z=!1,background:L=null}=O;const K=this.ctx.canvas.width,U=this.ctx.canvas.height,te=this.ctx.fillStyle;if(this.ctx.fillStyle=L||"#ffffff",this.ctx.fillRect(0,0,K,U),this.ctx.fillStyle=te,z){const pe=this.cachedCanvases.getCanvas("transparent",K,U);this.compositeCtx=this.ctx,this.transparentCanvas=pe.canvas,this.ctx=pe.context,this.ctx.save(),this.ctx.transform(...(0,s.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),b(this.ctx),k&&(this.ctx.transform(...k),this.outputScaleX=k[0],this.outputScaleY=k[0]),this.ctx.transform(...F.transform),this.viewportScale=F.scale,this.baseTransform=(0,s.getCurrentTransform)(this.ctx)}executeOperatorList(O,k,F,z){const L=O.argsArray,K=O.fnArray;let U=k||0;const te=L.length;if(te===U)return U;const pe=te-U>p&&typeof F=="function",ue=pe?Date.now()+u:0;let ve=0;const se=this.commonObjs,ge=this.objs;let Ee;for(;;){if(z!==void 0&&U===z.nextBreakPoint)return z.breakIt(U,F),U;if(Ee=K[U],Ee!==n.OPS.dependency)this[Ee].apply(this,L[U]);else for(const Oe of L[U]){const Me=Oe.startsWith("g_")?se:ge;if(!Me.has(Oe))return Me.get(Oe,F),U}if(U++,U===te)return U;if(pe&&++ve>p){if(Date.now()>ue)return F(),U;ve=0}}}endDrawing(){me(this,X,Jt).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const O of this._cachedBitmapsMap.values()){for(const k of O.values())typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement&&(k.width=k.height=0);O.clear()}this._cachedBitmapsMap.clear(),me(this,ne,en).call(this)}_scaleImage(O,k){const F=O.width,z=O.height;let L=Math.max(Math.hypot(k[0],k[1]),1),K=Math.max(Math.hypot(k[2],k[3]),1),U=F,te=z,pe="prescale1",ue,ve;for(;L>2&&U>1||K>2&&te>1;){let se=U,ge=te;L>2&&U>1&&(se=U>=16384?Math.floor(U/2)-1||1:Math.ceil(U/2),L/=U/se),K>2&&te>1&&(ge=te>=16384?Math.floor(te/2)-1||1:Math.ceil(te)/2,K/=te/ge),ue=this.cachedCanvases.getCanvas(pe,se,ge),ve=ue.context,ve.clearRect(0,0,se,ge),ve.drawImage(O,0,0,U,te,0,0,se,ge),O=ue.canvas,U=se,te=ge,pe=pe==="prescale1"?"prescale2":"prescale1"}return{img:O,paintWidth:U,paintHeight:te}}_createMaskCanvas(O){const k=this.ctx,{width:F,height:z}=O,L=this.current.fillColor,K=this.current.patternFill,U=(0,s.getCurrentTransform)(k);let te,pe,ue,ve;if((O.bitmap||O.data)&&O.count>1){const _e=O.bitmap||O.data.buffer;pe=JSON.stringify(K?U:[U.slice(0,4),L]),te=this._cachedBitmapsMap.get(_e),te||(te=new Map,this._cachedBitmapsMap.set(_e,te));const Ve=te.get(pe);if(Ve&&!K){const Ge=Math.round(Math.min(U[0],U[2])+U[4]),Ke=Math.round(Math.min(U[1],U[3])+U[5]);return{canvas:Ve,offsetX:Ge,offsetY:Ke}}ue=Ve}ue||(ve=this.cachedCanvases.getCanvas("maskCanvas",F,z),N(ve.context,O));let se=n.Util.transform(U,[1/F,0,0,-1/z,0,0]);se=n.Util.transform(se,[1,0,0,1,0,-z]);const ge=n.Util.applyTransform([0,0],se),Ee=n.Util.applyTransform([F,z],se),Oe=n.Util.normalizeRect([ge[0],ge[1],Ee[0],Ee[1]]),Me=Math.round(Oe[2]-Oe[0])||1,we=Math.round(Oe[3]-Oe[1])||1,Ue=this.cachedCanvases.getCanvas("fillCanvas",Me,we),Ne=Ue.context,Ae=Math.min(ge[0],Ee[0]),de=Math.min(ge[1],Ee[1]);Ne.translate(-Ae,-de),Ne.transform(...se),ue||(ue=this._scaleImage(ve.canvas,(0,s.getCurrentTransformInverse)(Ne)),ue=ue.img,te&&K&&te.set(pe,ue)),Ne.imageSmoothingEnabled=V((0,s.getCurrentTransform)(Ne),O.interpolate),f(Ne,ue,0,0,ue.width,ue.height,0,0,F,z),Ne.globalCompositeOperation="source-in";const Te=n.Util.transform((0,s.getCurrentTransformInverse)(Ne),[1,0,0,1,-Ae,-de]);return Ne.fillStyle=K?L.getPattern(k,this,Te,i.PathType.FILL):L,Ne.fillRect(0,0,F,z),te&&!K&&(this.cachedCanvases.delete("fillCanvas"),te.set(pe,Ue.canvas)),{canvas:Ue.canvas,offsetX:Math.round(Ae),offsetY:Math.round(de)}}setLineWidth(O){O!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=O,this.ctx.lineWidth=O}setLineCap(O){this.ctx.lineCap=$[O]}setLineJoin(O){this.ctx.lineJoin=j[O]}setMiterLimit(O){this.ctx.miterLimit=O}setDash(O,k){const F=this.ctx;F.setLineDash!==void 0&&(F.setLineDash(O),F.lineDashOffset=k)}setRenderingIntent(O){}setFlatness(O){}setGState(O){for(const[k,F]of O)switch(k){case"LW":this.setLineWidth(F);break;case"LC":this.setLineCap(F);break;case"LJ":this.setLineJoin(F);break;case"ML":this.setMiterLimit(F);break;case"D":this.setDash(F[0],F[1]);break;case"RI":this.setRenderingIntent(F);break;case"FL":this.setFlatness(F);break;case"Font":this.setFont(F[0],F[1]);break;case"CA":this.current.strokeAlpha=F;break;case"ca":this.current.fillAlpha=F,this.ctx.globalAlpha=F;break;case"BM":this.ctx.globalCompositeOperation=F;break;case"SMask":this.current.activeSMask=F?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(F);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const O=this.inSMaskMode;this.current.activeSMask&&!O?this.beginSMaskMode():!this.current.activeSMask&&O&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const O=this.ctx.canvas.width,k=this.ctx.canvas.height,F="smaskGroupAt"+this.groupLevel,z=this.cachedCanvases.getCanvas(F,O,k);this.suspendedCtx=this.ctx,this.ctx=z.context;const L=this.ctx;L.setTransform(...(0,s.getCurrentTransform)(this.suspendedCtx)),m(this.suspendedCtx,L),h(L,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),m(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(O){if(!this.current.activeSMask)return;O?(O[0]=Math.floor(O[0]),O[1]=Math.floor(O[1]),O[2]=Math.ceil(O[2]),O[3]=Math.ceil(O[3])):O=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const k=this.current.activeSMask,F=this.suspendedCtx;E(F,k,this.ctx,O),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(m(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const O=this.current;this.stateStack.push(O),this.current=O.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),m(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(O,k,F,z,L,K){this.ctx.transform(O,k,F,z,L,K),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(O,k,F){const z=this.ctx,L=this.current;let K=L.x,U=L.y,te,pe;const ue=(0,s.getCurrentTransform)(z),ve=ue[0]===0&&ue[3]===0||ue[1]===0&&ue[2]===0,se=ve?F.slice(0):null;for(let ge=0,Ee=0,Oe=O.length;ge<Oe;ge++)switch(O[ge]|0){case n.OPS.rectangle:K=k[Ee++],U=k[Ee++];const Me=k[Ee++],we=k[Ee++],Ue=K+Me,Ne=U+we;z.moveTo(K,U),Me===0||we===0?z.lineTo(Ue,Ne):(z.lineTo(Ue,U),z.lineTo(Ue,Ne),z.lineTo(K,Ne)),ve||L.updateRectMinMax(ue,[K,U,Ue,Ne]),z.closePath();break;case n.OPS.moveTo:K=k[Ee++],U=k[Ee++],z.moveTo(K,U),ve||L.updatePathMinMax(ue,K,U);break;case n.OPS.lineTo:K=k[Ee++],U=k[Ee++],z.lineTo(K,U),ve||L.updatePathMinMax(ue,K,U);break;case n.OPS.curveTo:te=K,pe=U,K=k[Ee+4],U=k[Ee+5],z.bezierCurveTo(k[Ee],k[Ee+1],k[Ee+2],k[Ee+3],K,U),L.updateCurvePathMinMax(ue,te,pe,k[Ee],k[Ee+1],k[Ee+2],k[Ee+3],K,U,se),Ee+=6;break;case n.OPS.curveTo2:te=K,pe=U,z.bezierCurveTo(K,U,k[Ee],k[Ee+1],k[Ee+2],k[Ee+3]),L.updateCurvePathMinMax(ue,te,pe,K,U,k[Ee],k[Ee+1],k[Ee+2],k[Ee+3],se),K=k[Ee+2],U=k[Ee+3],Ee+=4;break;case n.OPS.curveTo3:te=K,pe=U,K=k[Ee+2],U=k[Ee+3],z.bezierCurveTo(k[Ee],k[Ee+1],K,U,K,U),L.updateCurvePathMinMax(ue,te,pe,k[Ee],k[Ee+1],K,U,K,U,se),Ee+=4;break;case n.OPS.closePath:z.closePath();break}ve&&L.updateScalingPathMinMax(ue,se),L.setCurrentPoint(K,U)}closePath(){this.ctx.closePath()}stroke(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const k=this.ctx,F=this.current.strokeColor;k.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof F=="object"&&(F!=null&&F.getPattern)?(k.save(),k.strokeStyle=F.getPattern(k,this,(0,s.getCurrentTransformInverse)(k),i.PathType.STROKE),this.rescaleAndStroke(!1),k.restore()):this.rescaleAndStroke(!0)),O&&this.consumePath(this.current.getClippedPathBoundingBox()),k.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const k=this.ctx,F=this.current.fillColor,z=this.current.patternFill;let L=!1;z&&(k.save(),k.fillStyle=F.getPattern(k,this,(0,s.getCurrentTransformInverse)(k),i.PathType.FILL),L=!0);const K=this.current.getClippedPathBoundingBox();this.contentVisible&&K!==null&&(this.pendingEOFill?(k.fill("evenodd"),this.pendingEOFill=!1):k.fill()),L&&k.restore(),O&&this.consumePath(K)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=D}eoClip(){this.pendingClip=Y}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const O=this.pendingTextPaths,k=this.ctx;if(O===void 0){k.beginPath();return}k.save(),k.beginPath();for(const F of O)k.setTransform(...F.transform),k.translate(F.x,F.y),F.addToPath(k,F.fontSize);k.restore(),k.clip(),k.beginPath(),delete this.pendingTextPaths}setCharSpacing(O){this.current.charSpacing=O}setWordSpacing(O){this.current.wordSpacing=O}setHScale(O){this.current.textHScale=O/100}setLeading(O){this.current.leading=-O}setFont(O,k){var ue;const F=this.commonObjs.get(O),z=this.current;if(!F)throw new Error(`Can't find font for ${O}`);if(z.fontMatrix=F.fontMatrix||n.FONT_IDENTITY_MATRIX,(z.fontMatrix[0]===0||z.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+O),k<0?(k=-k,z.fontDirection=-1):z.fontDirection=1,this.current.font=F,this.current.fontSize=k,F.isType3Font)return;const L=F.loadedName||"sans-serif",K=((ue=F.systemFontInfo)==null?void 0:ue.css)||`"${L}", ${F.fallbackName}`;let U="normal";F.black?U="900":F.bold&&(U="bold");const te=F.italic?"italic":"normal";let pe=k;k<a?pe=a:k>l&&(pe=l),this.current.fontSizeScale=k/pe,this.ctx.font=`${te} ${U} ${pe}px ${K}`}setTextRenderingMode(O){this.current.textRenderingMode=O}setTextRise(O){this.current.textRise=O}moveText(O,k){this.current.x=this.current.lineX+=O,this.current.y=this.current.lineY+=k}setLeadingMoveText(O,k){this.setLeading(-k),this.moveText(O,k)}setTextMatrix(O,k,F,z,L,K){this.current.textMatrix=[O,k,F,z,L,K],this.current.textMatrixScale=Math.hypot(O,k),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(O,k,F,z){const L=this.ctx,K=this.current,U=K.font,te=K.textRenderingMode,pe=K.fontSize/K.fontSizeScale,ue=te&n.TextRenderingMode.FILL_STROKE_MASK,ve=!!(te&n.TextRenderingMode.ADD_TO_PATH_FLAG),se=K.patternFill&&!U.missingFile;let ge;(U.disableFontFace||ve||se)&&(ge=U.getPathGenerator(this.commonObjs,O)),U.disableFontFace||se?(L.save(),L.translate(k,F),L.beginPath(),ge(L,pe),z&&L.setTransform(...z),(ue===n.TextRenderingMode.FILL||ue===n.TextRenderingMode.FILL_STROKE)&&L.fill(),(ue===n.TextRenderingMode.STROKE||ue===n.TextRenderingMode.FILL_STROKE)&&L.stroke(),L.restore()):((ue===n.TextRenderingMode.FILL||ue===n.TextRenderingMode.FILL_STROKE)&&L.fillText(O,k,F),(ue===n.TextRenderingMode.STROKE||ue===n.TextRenderingMode.FILL_STROKE)&&L.strokeText(O,k,F)),ve&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,s.getCurrentTransform)(L),x:k,y:F,fontSize:pe,addToPath:ge})}get isFontSubpixelAAEnabled(){const{context:O}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);O.scale(1.5,1),O.fillText("I",0,10);const k=O.getImageData(0,0,10,10).data;let F=!1;for(let z=3;z<k.length;z+=4)if(k[z]>0&&k[z]<255){F=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",F)}showText(O){const k=this.current,F=k.font;if(F.isType3Font)return this.showType3Text(O);const z=k.fontSize;if(z===0)return;const L=this.ctx,K=k.fontSizeScale,U=k.charSpacing,te=k.wordSpacing,pe=k.fontDirection,ue=k.textHScale*pe,ve=O.length,se=F.vertical,ge=se?1:-1,Ee=F.defaultVMetrics,Oe=z*k.fontMatrix[0],Me=k.textRenderingMode===n.TextRenderingMode.FILL&&!F.disableFontFace&&!k.patternFill;L.save(),L.transform(...k.textMatrix),L.translate(k.x,k.y+k.textRise),pe>0?L.scale(ue,-1):L.scale(ue,1);let we;if(k.patternFill){L.save();const Te=k.fillColor.getPattern(L,this,(0,s.getCurrentTransformInverse)(L),i.PathType.FILL);we=(0,s.getCurrentTransform)(L),L.restore(),L.fillStyle=Te}let Ue=k.lineWidth;const Ne=k.textMatrixScale;if(Ne===0||Ue===0){const Te=k.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(Te===n.TextRenderingMode.STROKE||Te===n.TextRenderingMode.FILL_STROKE)&&(Ue=this.getSinglePixelWidth())}else Ue/=Ne;if(K!==1&&(L.scale(K,K),Ue/=K),L.lineWidth=Ue,F.isInvalidPDFjsFont){const Te=[];let _e=0;for(const Ve of O)Te.push(Ve.unicode),_e+=Ve.width;L.fillText(Te.join(""),0,0),k.x+=_e*Oe*ue,L.restore(),this.compose();return}let Ae=0,de;for(de=0;de<ve;++de){const Te=O[de];if(typeof Te=="number"){Ae+=ge*Te*z/1e3;continue}let _e=!1;const Ve=(Te.isSpace?te:0)+U,Ge=Te.fontChar,Ke=Te.accent;let $e,Ze,Qe=Te.width;if(se){const Ye=Te.vmetric||Ee,Se=-(Te.vmetric?Ye[1]:Qe*.5)*Oe,ce=Ye[2]*Oe;Qe=Ye?-Ye[0]:Qe,$e=Se/K,Ze=(Ae+ce)/K}else $e=Ae/K,Ze=0;if(F.remeasure&&Qe>0){const Ye=L.measureText(Ge).width*1e3/z*K;if(Qe<Ye&&this.isFontSubpixelAAEnabled){const Se=Qe/Ye;_e=!0,L.save(),L.scale(Se,1),$e/=Se}else Qe!==Ye&&($e+=(Qe-Ye)/2e3*z/K)}if(this.contentVisible&&(Te.isInFont||F.missingFile)){if(Me&&!Ke)L.fillText(Ge,$e,Ze);else if(this.paintChar(Ge,$e,Ze,we),Ke){const Ye=$e+z*Ke.offset.x/K,Se=Ze-z*Ke.offset.y/K;this.paintChar(Ke.fontChar,Ye,Se,we)}}const qe=se?Qe*Oe-Ve*pe:Qe*Oe+Ve*pe;Ae+=qe,_e&&L.restore()}se?k.y-=Ae:k.x+=Ae*ue,L.restore(),this.compose()}showType3Text(O){const k=this.ctx,F=this.current,z=F.font,L=F.fontSize,K=F.fontDirection,U=z.vertical?1:-1,te=F.charSpacing,pe=F.wordSpacing,ue=F.textHScale*K,ve=F.fontMatrix||n.FONT_IDENTITY_MATRIX,se=O.length,ge=F.textRenderingMode===n.TextRenderingMode.INVISIBLE;let Ee,Oe,Me,we;if(!(ge||L===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,k.save(),k.transform(...F.textMatrix),k.translate(F.x,F.y),k.scale(ue,K),Ee=0;Ee<se;++Ee){if(Oe=O[Ee],typeof Oe=="number"){we=U*Oe*L/1e3,this.ctx.translate(we,0),F.x+=we*ue;continue}const Ue=(Oe.isSpace?pe:0)+te,Ne=z.charProcOperatorList[Oe.operatorListId];if(!Ne){(0,n.warn)(`Type3 character "${Oe.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=Oe,this.save(),k.scale(L,L),k.transform(...ve),this.executeOperatorList(Ne),this.restore()),Me=n.Util.applyTransform([Oe.width,0],ve)[0]*L+Ue,k.translate(Me,0),F.x+=Me*ue}k.restore(),this.processingType3=null}}setCharWidth(O,k){}setCharWidthAndBounds(O,k,F,z,L,K){this.ctx.rect(F,z,L-F,K-z),this.ctx.clip(),this.endPath()}getColorN_Pattern(O){let k;if(O[0]==="TilingPattern"){const F=O[1],z=this.baseTransform||(0,s.getCurrentTransform)(this.ctx),L={createCanvasGraphics:K=>new be(K,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};k=new i.TilingPattern(O,F,this.ctx,L,z)}else k=this._getPattern(O[1],O[2]);return k}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(O,k,F){const z=n.Util.makeHexColor(O,k,F);this.ctx.strokeStyle=z,this.current.strokeColor=z}setFillRGBColor(O,k,F){const z=n.Util.makeHexColor(O,k,F);this.ctx.fillStyle=z,this.current.fillColor=z,this.current.patternFill=!1}_getPattern(O){let k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,F;return this.cachedPatterns.has(O)?F=this.cachedPatterns.get(O):(F=(0,i.getShadingPattern)(this.getObject(O)),this.cachedPatterns.set(O,F)),k&&(F.matrix=k),F}shadingFill(O){if(!this.contentVisible)return;const k=this.ctx;this.save();const F=this._getPattern(O);k.fillStyle=F.getPattern(k,this,(0,s.getCurrentTransformInverse)(k),i.PathType.SHADING);const z=(0,s.getCurrentTransformInverse)(k);if(z){const{width:L,height:K}=k.canvas,[U,te,pe,ue]=n.Util.getAxialAlignedBoundingBox([0,0,L,K],z);this.ctx.fillRect(U,te,pe-U,ue-te)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(O,k){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(O)&&O.length===6&&this.transform(...O),this.baseTransform=(0,s.getCurrentTransform)(this.ctx),k)){const F=k[2]-k[0],z=k[3]-k[1];this.ctx.rect(k[0],k[1],F,z),this.current.updateRectMinMax((0,s.getCurrentTransform)(this.ctx),k),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(O){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const k=this.ctx;O.isolated||(0,n.info)("TODO: Support non-isolated groups."),O.knockout&&(0,n.warn)("Knockout groups not supported.");const F=(0,s.getCurrentTransform)(k);if(O.matrix&&k.transform(...O.matrix),!O.bbox)throw new Error("Bounding box is required.");let z=n.Util.getAxialAlignedBoundingBox(O.bbox,(0,s.getCurrentTransform)(k));const L=[0,0,k.canvas.width,k.canvas.height];z=n.Util.intersect(z,L)||[0,0,0,0];const K=Math.floor(z[0]),U=Math.floor(z[1]);let te=Math.max(Math.ceil(z[2])-K,1),pe=Math.max(Math.ceil(z[3])-U,1),ue=1,ve=1;te>c&&(ue=te/c,te=c),pe>c&&(ve=pe/c,pe=c),this.current.startNewPathAndClipBox([0,0,te,pe]);let se="groupAt"+this.groupLevel;O.smask&&(se+="_smask_"+this.smaskCounter++%2);const ge=this.cachedCanvases.getCanvas(se,te,pe),Ee=ge.context;Ee.scale(1/ue,1/ve),Ee.translate(-K,-U),Ee.transform(...F),O.smask?this.smaskStack.push({canvas:ge.canvas,context:Ee,offsetX:K,offsetY:U,scaleX:ue,scaleY:ve,subtype:O.smask.subtype,backdrop:O.smask.backdrop,transferMap:O.smask.transferMap||null,startTransformInverse:null}):(k.setTransform(1,0,0,1,0,0),k.translate(K,U),k.scale(ue,ve),k.save()),m(k,Ee),this.ctx=Ee,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(k),this.groupLevel++}endGroup(O){if(!this.contentVisible)return;this.groupLevel--;const k=this.ctx,F=this.groupStack.pop();if(this.ctx=F,this.ctx.imageSmoothingEnabled=!1,O.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const z=(0,s.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...z);const L=n.Util.getAxialAlignedBoundingBox([0,0,k.canvas.width,k.canvas.height],z);this.ctx.drawImage(k.canvas,0,0),this.ctx.restore(),this.compose(L)}}beginAnnotation(O,k,F,z,L){if(me(this,X,Jt).call(this),b(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(k)&&k.length===4){const K=k[2]-k[0],U=k[3]-k[1];if(L&&this.annotationCanvasMap){F=F.slice(),F[4]-=k[0],F[5]-=k[1],k=k.slice(),k[0]=k[1]=0,k[2]=K,k[3]=U;const[te,pe]=n.Util.singularValueDecompose2dScale((0,s.getCurrentTransform)(this.ctx)),{viewportScale:ue}=this,ve=Math.ceil(K*this.outputScaleX*ue),se=Math.ceil(U*this.outputScaleY*ue);this.annotationCanvas=this.canvasFactory.create(ve,se);const{canvas:ge,context:Ee}=this.annotationCanvas;this.annotationCanvasMap.set(O,ge),this.annotationCanvas.savedCtx=this.ctx,this.ctx=Ee,this.ctx.save(),this.ctx.setTransform(te,0,0,-pe,0,U*pe),b(this.ctx)}else b(this.ctx),this.ctx.rect(k[0],k[1],K,U),this.ctx.clip(),this.endPath()}this.current=new T(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...F),this.transform(...z)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),me(this,ne,en).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(O){if(!this.contentVisible)return;const k=O.count;O=this.getObject(O.data,O),O.count=k;const F=this.ctx,z=this.processingType3;if(z&&(z.compiled===void 0&&(z.compiled=v(O)),z.compiled)){z.compiled(F);return}const L=this._createMaskCanvas(O),K=L.canvas;F.save(),F.setTransform(1,0,0,1,0,0),F.drawImage(K,L.offsetX,L.offsetY),F.restore(),this.compose()}paintImageMaskXObjectRepeat(O,k){let F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,z=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,L=arguments.length>4?arguments[4]:void 0,K=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;O=this.getObject(O.data,O);const U=this.ctx;U.save();const te=(0,s.getCurrentTransform)(U);U.transform(k,F,z,L,0,0);const pe=this._createMaskCanvas(O);U.setTransform(1,0,0,1,pe.offsetX-te[4],pe.offsetY-te[5]);for(let ue=0,ve=K.length;ue<ve;ue+=2){const se=n.Util.transform(te,[k,F,z,L,K[ue],K[ue+1]]),[ge,Ee]=n.Util.applyTransform([0,0],se);U.drawImage(pe.canvas,ge,Ee)}U.restore(),this.compose()}paintImageMaskXObjectGroup(O){if(!this.contentVisible)return;const k=this.ctx,F=this.current.fillColor,z=this.current.patternFill;for(const L of O){const{data:K,width:U,height:te,transform:pe}=L,ue=this.cachedCanvases.getCanvas("maskCanvas",U,te),ve=ue.context;ve.save();const se=this.getObject(K,L);N(ve,se),ve.globalCompositeOperation="source-in",ve.fillStyle=z?F.getPattern(ve,this,(0,s.getCurrentTransformInverse)(k),i.PathType.FILL):F,ve.fillRect(0,0,U,te),ve.restore(),k.save(),k.transform(...pe),k.scale(1,-1),f(k,ue.canvas,0,0,U,te,0,-1,1,1),k.restore()}this.compose()}paintImageXObject(O){if(!this.contentVisible)return;const k=this.getObject(O);if(!k){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(k)}paintImageXObjectRepeat(O,k,F,z){if(!this.contentVisible)return;const L=this.getObject(O);if(!L){(0,n.warn)("Dependent image isn't ready yet");return}const K=L.width,U=L.height,te=[];for(let pe=0,ue=z.length;pe<ue;pe+=2)te.push({transform:[k,0,0,F,z[pe],z[pe+1]],x:0,y:0,w:K,h:U});this.paintInlineImageXObjectGroup(L,te)}applyTransferMapsToCanvas(O){return this.current.transferMaps!=="none"&&(O.filter=this.current.transferMaps,O.drawImage(O.canvas,0,0),O.filter="none"),O.canvas}applyTransferMapsToBitmap(O){if(this.current.transferMaps==="none")return O.bitmap;const{bitmap:k,width:F,height:z}=O,L=this.cachedCanvases.getCanvas("inlineImage",F,z),K=L.context;return K.filter=this.current.transferMaps,K.drawImage(k,0,0),K.filter="none",L.canvas}paintInlineImageXObject(O){if(!this.contentVisible)return;const k=O.width,F=O.height,z=this.ctx;if(this.save(),!n.isNodeJS){const{filter:U}=z;U!=="none"&&U!==""&&(z.filter="none")}z.scale(1/k,-1/F);let L;if(O.bitmap)L=this.applyTransferMapsToBitmap(O);else if(typeof HTMLElement=="function"&&O instanceof HTMLElement||!O.data)L=O;else{const te=this.cachedCanvases.getCanvas("inlineImage",k,F).context;R(te,O),L=this.applyTransferMapsToCanvas(te)}const K=this._scaleImage(L,(0,s.getCurrentTransformInverse)(z));z.imageSmoothingEnabled=V((0,s.getCurrentTransform)(z),O.interpolate),f(z,K.img,0,0,K.paintWidth,K.paintHeight,0,-F,k,F),this.compose(),this.restore()}paintInlineImageXObjectGroup(O,k){if(!this.contentVisible)return;const F=this.ctx;let z;if(O.bitmap)z=O.bitmap;else{const L=O.width,K=O.height,te=this.cachedCanvases.getCanvas("inlineImage",L,K).context;R(te,O),z=this.applyTransferMapsToCanvas(te)}for(const L of k)F.save(),F.transform(...L.transform),F.scale(1,-1),f(F,z,L.x,L.y,L.w,L.h,0,-1,1,1),F.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(O){}markPointProps(O,k){}beginMarkedContent(O){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(O,k){O==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(k)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(O){const k=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(O);const F=this.ctx;this.pendingClip&&(k||(this.pendingClip===Y?F.clip("evenodd"):F.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),F.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const O=(0,s.getCurrentTransform)(this.ctx);if(O[1]===0&&O[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(O[0]),Math.abs(O[3]));else{const k=Math.abs(O[0]*O[3]-O[2]*O[1]),F=Math.hypot(O[0],O[2]),z=Math.hypot(O[1],O[3]);this._cachedGetSinglePixelWidth=Math.max(F,z)/k}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:O}=this.current,{a:k,b:F,c:z,d:L}=this.ctx.getTransform();let K,U;if(F===0&&z===0){const te=Math.abs(k),pe=Math.abs(L);if(te===pe)if(O===0)K=U=1/te;else{const ue=te*O;K=U=ue<1?1/ue:1}else if(O===0)K=1/te,U=1/pe;else{const ue=te*O,ve=pe*O;K=ue<1?1/ue:1,U=ve<1?1/ve:1}}else{const te=Math.abs(k*L-F*z),pe=Math.hypot(k,F),ue=Math.hypot(z,L);if(O===0)K=ue/te,U=pe/te;else{const ve=O*te;K=ue>ve?ue/ve:1,U=pe>ve?pe/ve:1}}this._cachedScaleForStroking[0]=K,this._cachedScaleForStroking[1]=U}return this._cachedScaleForStroking}rescaleAndStroke(O){const{ctx:k}=this,{lineWidth:F}=this.current,[z,L]=this.getScaleForStroking();if(k.lineWidth=F||1,z===1&&L===1){k.stroke();return}const K=k.getLineDash();if(O&&k.save(),k.scale(z,L),K.length>0){const U=Math.max(z,L);k.setLineDash(K.map(te=>te/U)),k.lineDashOffset/=U}k.stroke(),O&&k.restore()}isContentVisible(){for(let O=this.markedContentStack.length-1;O>=0;O--)if(!this.markedContentStack[O].visible)return!1;return!0}};X=new WeakSet,Jt=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},ne=new WeakSet,en=function(){if(this.pageColors){const O=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(O!=="none"){const k=this.ctx.filter;this.ctx.filter=O,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=k}}};let G=be;e.CanvasGraphics=G;for(const Q in n.OPS)G.prototype[Q]!==void 0&&(G.prototype[n.OPS[Q]]=G.prototype[Q])},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=y,t(2);var n=t(1),s=t(167);const i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=i;function o(v,T){if(!T)return;const R=T[2]-T[0],N=T[3]-T[1],m=new Path2D;m.rect(T[0],T[1],R,N),v.clip(m)}class a{constructor(){this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class l extends a{constructor(T){super(),this._type=T[1],this._bbox=T[2],this._colorStops=T[3],this._p0=T[4],this._p1=T[5],this._r0=T[6],this._r1=T[7],this.matrix=null}_createGradient(T){let R;this._type==="axial"?R=T.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(R=T.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const N of this._colorStops)R.addColorStop(N[0],N[1]);return R}getPattern(T,R,N,m){let b;if(m===i.STROKE||m===i.FILL){const P=R.current.getClippedPathBoundingBox(m,(0,s.getCurrentTransform)(T))||[0,0,0,0],x=Math.ceil(P[2]-P[0])||1,S=Math.ceil(P[3]-P[1])||1,w=R.cachedCanvases.getCanvas("pattern",x,S,!0),E=w.context;E.clearRect(0,0,E.canvas.width,E.canvas.height),E.beginPath(),E.rect(0,0,E.canvas.width,E.canvas.height),E.translate(-P[0],-P[1]),N=n.Util.transform(N,[1,0,0,1,P[0],P[1]]),E.transform(...R.baseTransform),this.matrix&&E.transform(...this.matrix),o(E,this._bbox),E.fillStyle=this._createGradient(E),E.fill(),b=T.createPattern(w.canvas,"no-repeat");const V=new DOMMatrix(N);b.setTransform(V)}else o(T,this._bbox),b=this._createGradient(T);return b}}function c(v,T,R,N,m,b,P,x){const S=T.coords,w=T.colors,E=v.data,V=v.width*4;let $;S[R+1]>S[N+1]&&($=R,R=N,N=$,$=b,b=P,P=$),S[N+1]>S[m+1]&&($=N,N=m,m=$,$=P,P=x,x=$),S[R+1]>S[N+1]&&($=R,R=N,N=$,$=b,b=P,P=$);const j=(S[R]+T.offsetX)*T.scaleX,D=(S[R+1]+T.offsetY)*T.scaleY,Y=(S[N]+T.offsetX)*T.scaleX,G=(S[N+1]+T.offsetY)*T.scaleY,X=(S[m]+T.offsetX)*T.scaleX,Z=(S[m+1]+T.offsetY)*T.scaleY;if(D>=Z)return;const ne=w[b],ie=w[b+1],be=w[b+2],Q=w[P],O=w[P+1],k=w[P+2],F=w[x],z=w[x+1],L=w[x+2],K=Math.round(D),U=Math.round(Z);let te,pe,ue,ve,se,ge,Ee,Oe;for(let Me=K;Me<=U;Me++){if(Me<G){const de=Me<D?0:(D-Me)/(D-G);te=j-(j-Y)*de,pe=ne-(ne-Q)*de,ue=ie-(ie-O)*de,ve=be-(be-k)*de}else{let de;Me>Z?de=1:G===Z?de=0:de=(G-Me)/(G-Z),te=Y-(Y-X)*de,pe=Q-(Q-F)*de,ue=O-(O-z)*de,ve=k-(k-L)*de}let we;Me<D?we=0:Me>Z?we=1:we=(D-Me)/(D-Z),se=j-(j-X)*we,ge=ne-(ne-F)*we,Ee=ie-(ie-z)*we,Oe=be-(be-L)*we;const Ue=Math.round(Math.min(te,se)),Ne=Math.round(Math.max(te,se));let Ae=V*Me+Ue*4;for(let de=Ue;de<=Ne;de++)we=(te-de)/(te-se),we<0?we=0:we>1&&(we=1),E[Ae++]=pe-(pe-ge)*we|0,E[Ae++]=ue-(ue-Ee)*we|0,E[Ae++]=ve-(ve-Oe)*we|0,E[Ae++]=255}}function u(v,T,R){const N=T.coords,m=T.colors;let b,P;switch(T.type){case"lattice":const x=T.verticesPerRow,S=Math.floor(N.length/x)-1,w=x-1;for(b=0;b<S;b++){let E=b*x;for(let V=0;V<w;V++,E++)c(v,R,N[E],N[E+1],N[E+x],m[E],m[E+1],m[E+x]),c(v,R,N[E+x+1],N[E+1],N[E+x],m[E+x+1],m[E+1],m[E+x])}break;case"triangles":for(b=0,P=N.length;b<P;b+=3)c(v,R,N[b],N[b+1],N[b+2],m[b],m[b+1],m[b+2]);break;default:throw new Error("illegal figure")}}class p extends a{constructor(T){super(),this._coords=T[2],this._colors=T[3],this._figures=T[4],this._bounds=T[5],this._bbox=T[7],this._background=T[8],this.matrix=null}_createMeshCanvas(T,R,N){const x=Math.floor(this._bounds[0]),S=Math.floor(this._bounds[1]),w=Math.ceil(this._bounds[2])-x,E=Math.ceil(this._bounds[3])-S,V=Math.min(Math.ceil(Math.abs(w*T[0]*1.1)),3e3),$=Math.min(Math.ceil(Math.abs(E*T[1]*1.1)),3e3),j=w/V,D=E/$,Y={coords:this._coords,colors:this._colors,offsetX:-x,offsetY:-S,scaleX:1/j,scaleY:1/D},G=V+2*2,X=$+2*2,Z=N.getCanvas("mesh",G,X,!1),ne=Z.context,ie=ne.createImageData(V,$);if(R){const Q=ie.data;for(let O=0,k=Q.length;O<k;O+=4)Q[O]=R[0],Q[O+1]=R[1],Q[O+2]=R[2],Q[O+3]=255}for(const Q of this._figures)u(ie,Q,Y);return ne.putImageData(ie,2,2),{canvas:Z.canvas,offsetX:x-2*j,offsetY:S-2*D,scaleX:j,scaleY:D}}getPattern(T,R,N,m){o(T,this._bbox);let b;if(m===i.SHADING)b=n.Util.singularValueDecompose2dScale((0,s.getCurrentTransform)(T));else if(b=n.Util.singularValueDecompose2dScale(R.baseTransform),this.matrix){const x=n.Util.singularValueDecompose2dScale(this.matrix);b=[b[0]*x[0],b[1]*x[1]]}const P=this._createMeshCanvas(b,m===i.SHADING?null:this._background,R.cachedCanvases);return m!==i.SHADING&&(T.setTransform(...R.baseTransform),this.matrix&&T.transform(...this.matrix)),T.translate(P.offsetX,P.offsetY),T.scale(P.scaleX,P.scaleY),T.createPattern(P.canvas,"no-repeat")}}class g extends a{getPattern(){return"hotpink"}}function y(v){switch(v[0]){case"RadialAxial":return new l(v);case"Mesh":return new p(v);case"Dummy":return new g}throw new Error(`Unknown IR type: ${v[0]}`)}const h={COLORED:1,UNCOLORED:2},f=class f{constructor(T,R,N,m,b){this.operatorList=T[2],this.matrix=T[3]||[1,0,0,1,0,0],this.bbox=T[4],this.xstep=T[5],this.ystep=T[6],this.paintType=T[7],this.tilingType=T[8],this.color=R,this.ctx=N,this.canvasGraphicsFactory=m,this.baseTransform=b}createPatternCanvas(T){const R=this.operatorList,N=this.bbox,m=this.xstep,b=this.ystep,P=this.paintType,x=this.tilingType,S=this.color,w=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+x);const E=N[0],V=N[1],$=N[2],j=N[3],D=n.Util.singularValueDecompose2dScale(this.matrix),Y=n.Util.singularValueDecompose2dScale(this.baseTransform),G=[D[0]*Y[0],D[1]*Y[1]],X=this.getSizeAndScale(m,this.ctx.canvas.width,G[0]),Z=this.getSizeAndScale(b,this.ctx.canvas.height,G[1]),ne=T.cachedCanvases.getCanvas("pattern",X.size,Z.size,!0),ie=ne.context,be=w.createCanvasGraphics(ie);be.groupLevel=T.groupLevel,this.setFillAndStrokeStyleToContext(be,P,S);let Q=E,O=V,k=$,F=j;return E<0&&(Q=0,k+=Math.abs(E)),V<0&&(O=0,F+=Math.abs(V)),ie.translate(-(X.scale*Q),-(Z.scale*O)),be.transform(X.scale,0,0,Z.scale,0,0),ie.save(),this.clipBbox(be,Q,O,k,F),be.baseTransform=(0,s.getCurrentTransform)(be.ctx),be.executeOperatorList(R),be.endDrawing(),{canvas:ne.canvas,scaleX:X.scale,scaleY:Z.scale,offsetX:Q,offsetY:O}}getSizeAndScale(T,R,N){T=Math.abs(T);const m=Math.max(f.MAX_PATTERN_SIZE,R);let b=Math.ceil(T*N);return b>=m?b=m:N=b/T,{scale:N,size:b}}clipBbox(T,R,N,m,b){const P=m-R,x=b-N;T.ctx.rect(R,N,P,x),T.current.updateRectMinMax((0,s.getCurrentTransform)(T.ctx),[R,N,m,b]),T.clip(),T.endPath()}setFillAndStrokeStyleToContext(T,R,N){const m=T.ctx,b=T.current;switch(R){case h.COLORED:const P=this.ctx;m.fillStyle=P.fillStyle,m.strokeStyle=P.strokeStyle,b.fillColor=P.fillStyle,b.strokeColor=P.strokeStyle;break;case h.UNCOLORED:const x=n.Util.makeHexColor(N[0],N[1],N[2]);m.fillStyle=x,m.strokeStyle=x,b.fillColor=x,b.strokeColor=x;break;default:throw new n.FormatError(`Unsupported paint type: ${R}`)}}getPattern(T,R,N,m){let b=N;m!==i.SHADING&&(b=n.Util.transform(b,R.baseTransform),this.matrix&&(b=n.Util.transform(b,this.matrix)));const P=this.createPatternCanvas(R);let x=new DOMMatrix(b);x=x.translate(P.offsetX,P.offsetY),x=x.scale(1/P.scaleX,1/P.scaleY);const S=T.createPattern(P.canvas,"repeat");return S.setTransform(x),S}};st(f,"MAX_PATTERN_SIZE",3e3);let d=f;e.TilingPattern=d},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.convertBlackAndWhiteToRGBA=i,e.convertToRGBA=s,e.grayToRGBA=a,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);var n=t(1);function s(l){switch(l.kind){case n.ImageKind.GRAYSCALE_1BPP:return i(l);case n.ImageKind.RGB_24BPP:return o(l)}return null}function i(l){let{src:c,srcPos:u=0,dest:p,width:g,height:y,nonBlackColor:h=4294967295,inverseDecode:d=!1}=l;const f=n.FeatureTest.isLittleEndian?4278190080:255,[v,T]=d?[h,f]:[f,h],R=g>>3,N=g&7,m=c.length;p=new Uint32Array(p.buffer);let b=0;for(let P=0;P<y;P++){for(const S=u+R;u<S;u++){const w=u<m?c[u]:255;p[b++]=w&128?T:v,p[b++]=w&64?T:v,p[b++]=w&32?T:v,p[b++]=w&16?T:v,p[b++]=w&8?T:v,p[b++]=w&4?T:v,p[b++]=w&2?T:v,p[b++]=w&1?T:v}if(N===0)continue;const x=u<m?c[u++]:255;for(let S=0;S<N;S++)p[b++]=x&1<<7-S?T:v}return{srcPos:u,destPos:b}}function o(l){let{src:c,srcPos:u=0,dest:p,destPos:g=0,width:y,height:h}=l,d=0;const f=c.length>>2,v=new Uint32Array(c.buffer,u,f);if(n.FeatureTest.isLittleEndian){for(;d<f-2;d+=3,g+=4){const T=v[d],R=v[d+1],N=v[d+2];p[g]=T|4278190080,p[g+1]=T>>>24|R<<8|4278190080,p[g+2]=R>>>16|N<<16|4278190080,p[g+3]=N>>>8|4278190080}for(let T=d*4,R=c.length;T<R;T+=3)p[g++]=c[T]|c[T+1]<<8|c[T+2]<<16|4278190080}else{for(;d<f-2;d+=3,g+=4){const T=v[d],R=v[d+1],N=v[d+2];p[g]=T|255,p[g+1]=T<<24|R>>>8|255,p[g+2]=R<<16|N>>>16|255,p[g+3]=N<<8|255}for(let T=d*4,R=c.length;T<R;T+=3)p[g++]=c[T]<<24|c[T+1]<<16|c[T+2]<<8|255}return{srcPos:u,destPos:g}}function a(l,c){if(n.FeatureTest.isLittleEndian)for(let u=0,p=l.length;u<p;u++)c[u]=l[u]*65793|4278190080;else for(let u=0,p=l.length;u<p;u++)c[u]=l[u]*16843008|255}},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;const t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=null,t.workerSrc=""},(r,e,t)=>{var l,In,u,Mn,g,Lt;Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0,t(2);var n=t(1);const s={UNKNOWN:0,DATA:1,ERROR:2},i={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(h){switch(h instanceof Error||typeof h=="object"&&h!==null||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),h.name){case"AbortException":return new n.AbortException(h.message);case"MissingPDFException":return new n.MissingPDFException(h.message);case"PasswordException":return new n.PasswordException(h.message,h.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(h.message,h.status);case"UnknownErrorException":return new n.UnknownErrorException(h.message,h.details);default:return new n.UnknownErrorException(h.message,h.toString())}}class a{constructor(d,f,v){re(this,l);re(this,u);re(this,g);this.sourceName=d,this.targetName=f,this.comObj=v,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=T=>{const R=T.data;if(R.targetName!==this.sourceName)return;if(R.stream){me(this,u,Mn).call(this,R);return}if(R.callback){const m=R.callbackId,b=this.callbackCapabilities[m];if(!b)throw new Error(`Cannot resolve callback ${m}`);if(delete this.callbackCapabilities[m],R.callback===s.DATA)b.resolve(R.data);else if(R.callback===s.ERROR)b.reject(o(R.reason));else throw new Error("Unexpected callback case");return}const N=this.actionHandler[R.action];if(!N)throw new Error(`Unknown action from worker: ${R.action}`);if(R.callbackId){const m=this.sourceName,b=R.sourceName;new Promise(function(P){P(N(R.data))}).then(function(P){v.postMessage({sourceName:m,targetName:b,callback:s.DATA,callbackId:R.callbackId,data:P})},function(P){v.postMessage({sourceName:m,targetName:b,callback:s.ERROR,callbackId:R.callbackId,reason:o(P)})});return}if(R.streamId){me(this,l,In).call(this,R);return}N(R.data)},v.addEventListener("message",this._onComObjOnMessage)}on(d,f){const v=this.actionHandler;if(v[d])throw new Error(`There is already an actionName called "${d}"`);v[d]=f}send(d,f,v){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:d,data:f},v)}sendWithPromise(d,f,v){const T=this.callbackId++,R=new n.PromiseCapability;this.callbackCapabilities[T]=R;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:d,callbackId:T,data:f},v)}catch(N){R.reject(N)}return R.promise}sendWithStream(d,f,v,T){const R=this.streamId++,N=this.sourceName,m=this.targetName,b=this.comObj;return new ReadableStream({start:P=>{const x=new n.PromiseCapability;return this.streamControllers[R]={controller:P,startCall:x,pullCall:null,cancelCall:null,isClosed:!1},b.postMessage({sourceName:N,targetName:m,action:d,streamId:R,data:f,desiredSize:P.desiredSize},T),x.promise},pull:P=>{const x=new n.PromiseCapability;return this.streamControllers[R].pullCall=x,b.postMessage({sourceName:N,targetName:m,stream:i.PULL,streamId:R,desiredSize:P.desiredSize}),x.promise},cancel:P=>{(0,n.assert)(P instanceof Error,"cancel must have a valid reason");const x=new n.PromiseCapability;return this.streamControllers[R].cancelCall=x,this.streamControllers[R].isClosed=!0,b.postMessage({sourceName:N,targetName:m,stream:i.CANCEL,streamId:R,reason:o(P)}),x.promise}},v)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}l=new WeakSet,In=function(d){const f=d.streamId,v=this.sourceName,T=d.sourceName,R=this.comObj,N=this,m=this.actionHandler[d.action],b={enqueue(P){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,S=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const w=this.desiredSize;this.desiredSize-=x,w>0&&this.desiredSize<=0&&(this.sinkCapability=new n.PromiseCapability,this.ready=this.sinkCapability.promise),R.postMessage({sourceName:v,targetName:T,stream:i.ENQUEUE,streamId:f,chunk:P},S)},close(){this.isCancelled||(this.isCancelled=!0,R.postMessage({sourceName:v,targetName:T,stream:i.CLOSE,streamId:f}),delete N.streamSinks[f])},error(P){(0,n.assert)(P instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,R.postMessage({sourceName:v,targetName:T,stream:i.ERROR,streamId:f,reason:o(P)}))},sinkCapability:new n.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:d.desiredSize,ready:null};b.sinkCapability.resolve(),b.ready=b.sinkCapability.promise,this.streamSinks[f]=b,new Promise(function(P){P(m(d.data,b))}).then(function(){R.postMessage({sourceName:v,targetName:T,stream:i.START_COMPLETE,streamId:f,success:!0})},function(P){R.postMessage({sourceName:v,targetName:T,stream:i.START_COMPLETE,streamId:f,reason:o(P)})})},u=new WeakSet,Mn=function(d){const f=d.streamId,v=this.sourceName,T=d.sourceName,R=this.comObj,N=this.streamControllers[f],m=this.streamSinks[f];switch(d.stream){case i.START_COMPLETE:d.success?N.startCall.resolve():N.startCall.reject(o(d.reason));break;case i.PULL_COMPLETE:d.success?N.pullCall.resolve():N.pullCall.reject(o(d.reason));break;case i.PULL:if(!m){R.postMessage({sourceName:v,targetName:T,stream:i.PULL_COMPLETE,streamId:f,success:!0});break}m.desiredSize<=0&&d.desiredSize>0&&m.sinkCapability.resolve(),m.desiredSize=d.desiredSize,new Promise(function(b){var P;b((P=m.onPull)==null?void 0:P.call(m))}).then(function(){R.postMessage({sourceName:v,targetName:T,stream:i.PULL_COMPLETE,streamId:f,success:!0})},function(b){R.postMessage({sourceName:v,targetName:T,stream:i.PULL_COMPLETE,streamId:f,reason:o(b)})});break;case i.ENQUEUE:if((0,n.assert)(N,"enqueue should have stream controller"),N.isClosed)break;N.controller.enqueue(d.chunk);break;case i.CLOSE:if((0,n.assert)(N,"close should have stream controller"),N.isClosed)break;N.isClosed=!0,N.controller.close(),me(this,g,Lt).call(this,N,f);break;case i.ERROR:(0,n.assert)(N,"error should have stream controller"),N.controller.error(o(d.reason)),me(this,g,Lt).call(this,N,f);break;case i.CANCEL_COMPLETE:d.success?N.cancelCall.resolve():N.cancelCall.reject(o(d.reason)),me(this,g,Lt).call(this,N,f);break;case i.CANCEL:if(!m)break;new Promise(function(b){var P;b((P=m.onCancel)==null?void 0:P.call(m,o(d.reason)))}).then(function(){R.postMessage({sourceName:v,targetName:T,stream:i.CANCEL_COMPLETE,streamId:f,success:!0})},function(b){R.postMessage({sourceName:v,targetName:T,stream:i.CANCEL_COMPLETE,streamId:f,reason:o(b)})}),m.sinkCapability.reject(o(d.reason)),m.isCancelled=!0,delete this.streamSinks[f];break;default:throw new Error("Unexpected stream case")}},g=new WeakSet,Lt=async function(d,f){var v,T,R;await Promise.allSettled([(v=d.startCall)==null?void 0:v.promise,(T=d.pullCall)==null?void 0:T.promise,(R=d.cancelCall)==null?void 0:R.promise]),delete this.streamControllers[f]},e.MessageHandler=a},(r,e,t)=>{var i,o;Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var n=t(1);class s{constructor(l){re(this,i,void 0);re(this,o,void 0);let{parsedData:c,rawData:u}=l;ye(this,i,c),ye(this,o,u)}getRaw(){return _(this,o)}get(l){return _(this,i).get(l)??null}getAll(){return(0,n.objectFromMap)(_(this,i))}has(l){return _(this,i).has(l)}}i=new WeakMap,o=new WeakMap,e.Metadata=s},(r,e,t)=>{var l,c,u,p,g,y,tn;Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var n=t(1),s=t(169);const i=Symbol("INTERNAL");class o{constructor(f,v){re(this,l,!0);this.name=f,this.intent=v}get visible(){return _(this,l)}_setVisible(f,v){f!==i&&(0,n.unreachable)("Internal method `_setVisible` called."),ye(this,l,v)}}l=new WeakMap;class a{constructor(f){re(this,y);re(this,c,null);re(this,u,new Map);re(this,p,null);re(this,g,null);if(this.name=null,this.creator=null,f!==null){this.name=f.name,this.creator=f.creator,ye(this,g,f.order);for(const v of f.groups)_(this,u).set(v.id,new o(v.name,v.intent));if(f.baseState==="OFF")for(const v of _(this,u).values())v._setVisible(i,!1);for(const v of f.on)_(this,u).get(v)._setVisible(i,!0);for(const v of f.off)_(this,u).get(v)._setVisible(i,!1);ye(this,p,this.getHash())}}isVisible(f){if(_(this,u).size===0)return!0;if(!f)return(0,n.warn)("Optional content group not defined."),!0;if(f.type==="OCG")return _(this,u).has(f.id)?_(this,u).get(f.id).visible:((0,n.warn)(`Optional content group not found: ${f.id}`),!0);if(f.type==="OCMD"){if(f.expression)return me(this,y,tn).call(this,f.expression);if(!f.policy||f.policy==="AnyOn"){for(const v of f.ids){if(!_(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(_(this,u).get(v).visible)return!0}return!1}else if(f.policy==="AllOn"){for(const v of f.ids){if(!_(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(!_(this,u).get(v).visible)return!1}return!0}else if(f.policy==="AnyOff"){for(const v of f.ids){if(!_(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(!_(this,u).get(v).visible)return!0}return!1}else if(f.policy==="AllOff"){for(const v of f.ids){if(!_(this,u).has(v))return(0,n.warn)(`Optional content group not found: ${v}`),!0;if(_(this,u).get(v).visible)return!1}return!0}return(0,n.warn)(`Unknown optional content policy ${f.policy}.`),!0}return(0,n.warn)(`Unknown group type ${f.type}.`),!0}setVisibility(f){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!_(this,u).has(f)){(0,n.warn)(`Optional content group not found: ${f}`);return}_(this,u).get(f)._setVisible(i,!!v),ye(this,c,null)}get hasInitialVisibility(){return this.getHash()===_(this,p)}getOrder(){return _(this,u).size?_(this,g)?_(this,g).slice():[..._(this,u).keys()]:null}getGroups(){return _(this,u).size>0?(0,n.objectFromMap)(_(this,u)):null}getGroup(f){return _(this,u).get(f)||null}getHash(){if(_(this,c)!==null)return _(this,c);const f=new s.MurmurHash3_64;for(const[v,T]of _(this,u))f.update(`${v}:${T.visible}`);return ye(this,c,f.hexdigest())}}c=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakSet,tn=function(f){const v=f.length;if(v<2)return!0;const T=f[0];for(let R=1;R<v;R++){const N=f[R];let m;if(Array.isArray(N))m=me(this,y,tn).call(this,N);else if(_(this,u).has(N))m=_(this,u).get(N).visible;else return(0,n.warn)(`Optional content group not found: ${N}`),!0;switch(T){case"And":if(!m)return!1;break;case"Or":if(m)return!0;break;case"Not":return!m;default:return!0}}return T==="And"},e.OptionalContentConfig=a},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89);var n=t(1),s=t(167);class i{constructor(c,u){let{length:p,initialData:g,progressiveDone:y=!1,contentDispositionFilename:h=null,disableRange:d=!1,disableStream:f=!1}=c;if((0,n.assert)(u,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=y,this._contentDispositionFilename=h,(g==null?void 0:g.length)>0){const v=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(v)}this._pdfDataRangeTransport=u,this._isStreamingSupported=!f,this._isRangeSupported=!d,this._contentLength=p,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((v,T)=>{this._onReceiveData({begin:v,chunk:T})}),this._pdfDataRangeTransport.addProgressListener((v,T)=>{this._onProgress({loaded:v,total:T})}),this._pdfDataRangeTransport.addProgressiveReadListener(v=>{this._onReceiveData({chunk:v})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(c){let{begin:u,chunk:p}=c;const g=p instanceof Uint8Array&&p.byteLength===p.buffer.byteLength?p.buffer:new Uint8Array(p).buffer;if(u===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(g):this._queuedChunks.push(g);else{const y=this._rangeReaders.some(function(h){return h._begin!==u?!1:(h._enqueue(g),!0)});(0,n.assert)(y,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var c;return((c=this._fullRequestReader)==null?void 0:c._loaded)??0}_onProgress(c){var u,p,g,y;c.total===void 0?(p=(u=this._rangeReaders[0])==null?void 0:u.onProgress)==null||p.call(u,{loaded:c.loaded}):(y=(g=this._fullRequestReader)==null?void 0:g.onProgress)==null||y.call(g,{loaded:c.loaded,total:c.total})}_onProgressiveDone(){var c;(c=this._fullRequestReader)==null||c.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(c){const u=this._rangeReaders.indexOf(c);u>=0&&this._rangeReaders.splice(u,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const c=this._queuedChunks;return this._queuedChunks=null,new o(this,c,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(c,u){if(u<=this._progressiveDataLength)return null;const p=new a(this,c,u);return this._pdfDataRangeTransport.requestDataRange(c,u),this._rangeReaders.push(p),p}cancelAllRequests(c){var u;(u=this._fullRequestReader)==null||u.cancel(c);for(const p of this._rangeReaders.slice(0))p.cancel(c);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=i;class o{constructor(c,u){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;this._stream=c,this._done=p||!1,this._filename=(0,s.isPdfFile)(g)?g:null,this._queuedChunks=u||[],this._loaded=0;for(const y of this._queuedChunks)this._loaded+=y.byteLength;this._requests=[],this._headersReady=Promise.resolve(),c._fullRequestReader=this,this.onProgress=null}_enqueue(c){this._done||(this._requests.length>0?this._requests.shift().resolve({value:c,done:!1}):this._queuedChunks.push(c),this._loaded+=c.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const c=new n.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class a{constructor(c,u,p){this._stream=c,this._begin=u,this._end=p,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(c){if(!this._done){if(this._requests.length===0)this._queuedChunk=c;else{this._requests.shift().resolve({value:c,done:!1});for(const p of this._requests)p.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const u=this._queuedChunk;return this._queuedChunk=null,{value:u,done:!1}}if(this._done)return{value:void 0,done:!0};const c=new n.PromiseCapability;return this._requests.push(c),c.promise}cancel(c){this._done=!0;for(const u of this._requests)u.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0,t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(89);var n=t(1),s=t(181);function i(p,g,y){return{method:"GET",headers:p,signal:y.signal,mode:"cors",credentials:g?"include":"same-origin",redirect:"follow"}}function o(p){const g=new Headers;for(const y in p){const h=p[y];h!==void 0&&g.append(y,h)}return g}function a(p){return p instanceof Uint8Array?p.buffer:p instanceof ArrayBuffer?p:((0,n.warn)(`getArrayBuffer - unexpected data format: ${p}`),new Uint8Array(p).buffer)}class l{constructor(g){this.source=g,this.isHttp=/^https?:/i.test(g.url),this.httpHeaders=this.isHttp&&g.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var g;return((g=this._fullRequestReader)==null?void 0:g._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new c(this),this._fullRequestReader}getRangeReader(g,y){if(y<=this._progressiveDataLength)return null;const h=new u(this,g,y);return this._rangeRequestReaders.push(h),h}cancelAllRequests(g){var y;(y=this._fullRequestReader)==null||y.cancel(g);for(const h of this._rangeRequestReaders.slice(0))h.cancel(g)}}e.PDFFetchStream=l;class c{constructor(g){this._stream=g,this._reader=null,this._loaded=0,this._filename=null;const y=g.source;this._withCredentials=y.withCredentials||!1,this._contentLength=y.length,this._headersCapability=new n.PromiseCapability,this._disableRange=y.disableRange||!1,this._rangeChunkSize=y.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!y.disableStream,this._isRangeSupported=!y.disableRange,this._headers=o(this._stream.httpHeaders);const h=y.url;fetch(h,i(this._headers,this._withCredentials,this._abortController)).then(d=>{if(!(0,s.validateResponseStatus)(d.status))throw(0,s.createResponseStatusError)(d.status,h);this._reader=d.body.getReader(),this._headersCapability.resolve();const f=R=>d.headers.get(R),{allowRangeRequests:v,suggestedLength:T}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:f,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=v,this._contentLength=T||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(f),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var h;await this._headersCapability.promise;const{value:g,done:y}=await this._reader.read();return y?{value:g,done:y}:(this._loaded+=g.byteLength,(h=this.onProgress)==null||h.call(this,{loaded:this._loaded,total:this._contentLength}),{value:a(g),done:!1})}cancel(g){var y;(y=this._reader)==null||y.cancel(g),this._abortController.abort()}}class u{constructor(g,y,h){this._stream=g,this._reader=null,this._loaded=0;const d=g.source;this._withCredentials=d.withCredentials||!1,this._readCapability=new n.PromiseCapability,this._isStreamingSupported=!d.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${y}-${h-1}`);const f=d.url;fetch(f,i(this._headers,this._withCredentials,this._abortController)).then(v=>{if(!(0,s.validateResponseStatus)(v.status))throw(0,s.createResponseStatusError)(v.status,f);this._readCapability.resolve(),this._reader=v.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var h;await this._readCapability.promise;const{value:g,done:y}=await this._reader.read();return y?{value:g,done:y}:(this._loaded+=g.byteLength,(h=this.onProgress)==null||h.call(this,{loaded:this._loaded}),{value:a(g),done:!1})}cancel(g){var y;(y=this._reader)==null||y.cancel(g),this._abortController.abort()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=l,e.extractFilenameFromHeader=a,e.validateRangeRequestCapabilities=o,e.validateResponseStatus=c;var n=t(1),s=t(182),i=t(167);function o(u){let{getResponseHeader:p,isHttp:g,rangeChunkSize:y,disableRange:h}=u;const d={allowRangeRequests:!1,suggestedLength:void 0},f=parseInt(p("Content-Length"),10);return!Number.isInteger(f)||(d.suggestedLength=f,f<=2*y)||h||!g||p("Accept-Ranges")!=="bytes"||(p("Content-Encoding")||"identity")!=="identity"||(d.allowRangeRequests=!0),d}function a(u){const p=u("Content-Disposition");if(p){let g=(0,s.getFilenameFromContentDispositionHeader)(p);if(g.includes("%"))try{g=decodeURIComponent(g)}catch{}if((0,i.isPdfFile)(g))return g}return null}function l(u,p){return u===404||u===0&&p.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+p+'".'):new n.UnexpectedResponseException(`Unexpected server response (${u}) while retrieving PDF "${p}".`,u)}function c(u){return u===200||u===206}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=s,t(89),t(148);var n=t(1);function s(i){let o=!0,a=l("filename\\*","i").exec(i);if(a){a=a[1];let d=g(a);return d=unescape(d),d=y(d),d=h(d),u(d)}if(a=p(i),a){const d=h(a);return u(d)}if(a=l("filename","i").exec(i),a){a=a[1];let d=g(a);return d=h(d),u(d)}function l(d,f){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function c(d,f){if(d){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const v=new TextDecoder(d,{fatal:!0}),T=(0,n.stringToBytes)(f);f=v.decode(T),o=!1}catch{}}return f}function u(d){return o&&/[\x80-\xff]/.test(d)&&(d=c("utf-8",d),o&&(d=c("iso-8859-1",d))),d}function p(d){const f=[];let v;const T=l("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(v=T.exec(d))!==null;){let[,N,m,b]=v;if(N=parseInt(N,10),N in f){if(N===0)break;continue}f[N]=[m,b]}const R=[];for(let N=0;N<f.length&&N in f;++N){let[m,b]=f[N];b=g(b),m&&(b=unescape(b),N===0&&(b=y(b))),R.push(b)}return R.join("")}function g(d){if(d.startsWith('"')){const f=d.slice(1).split('\\"');for(let v=0;v<f.length;++v){const T=f[v].indexOf('"');T!==-1&&(f[v]=f[v].slice(0,T),f.length=v+1),f[v]=f[v].replaceAll(/\\(.)/g,"$1")}d=f.join('"')}return d}function y(d){const f=d.indexOf("'");if(f===-1)return d;const v=d.slice(0,f),R=d.slice(f+1).replace(/^[^']*'/,"");return c(v,R)}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,v,T,R){if(T==="q"||T==="Q")return R=R.replaceAll("_"," "),R=R.replaceAll(/=([0-9a-fA-F]{2})/g,function(N,m){return String.fromCharCode(parseInt(m,16))}),c(v,R);try{R=atob(R)}catch{}return c(v,R)})}return""}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0,t(89);var n=t(1),s=t(181);const i=200,o=206;function a(g){const y=g.response;return typeof y!="string"?y:(0,n.stringToBytes)(y).buffer}class l{constructor(y){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.url=y,this.isHttp=/^https?:/i.test(y),this.httpHeaders=this.isHttp&&h.httpHeaders||Object.create(null),this.withCredentials=h.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(y,h,d){const f={begin:y,end:h};for(const v in d)f[v]=d[v];return this.request(f)}requestFull(y){return this.request(y)}request(y){const h=new XMLHttpRequest,d=this.currXhrId++,f=this.pendingRequests[d]={xhr:h};h.open("GET",this.url),h.withCredentials=this.withCredentials;for(const v in this.httpHeaders){const T=this.httpHeaders[v];T!==void 0&&h.setRequestHeader(v,T)}return this.isHttp&&"begin"in y&&"end"in y?(h.setRequestHeader("Range",`bytes=${y.begin}-${y.end-1}`),f.expectedStatus=o):f.expectedStatus=i,h.responseType="arraybuffer",y.onError&&(h.onerror=function(v){y.onError(h.status)}),h.onreadystatechange=this.onStateChange.bind(this,d),h.onprogress=this.onProgress.bind(this,d),f.onHeadersReceived=y.onHeadersReceived,f.onDone=y.onDone,f.onError=y.onError,f.onProgress=y.onProgress,h.send(null),d}onProgress(y,h){var f;const d=this.pendingRequests[y];d&&((f=d.onProgress)==null||f.call(d,h))}onStateChange(y,h){var N,m,b;const d=this.pendingRequests[y];if(!d)return;const f=d.xhr;if(f.readyState>=2&&d.onHeadersReceived&&(d.onHeadersReceived(),delete d.onHeadersReceived),f.readyState!==4||!(y in this.pendingRequests))return;if(delete this.pendingRequests[y],f.status===0&&this.isHttp){(N=d.onError)==null||N.call(d,f.status);return}const v=f.status||i;if(!(v===i&&d.expectedStatus===o)&&v!==d.expectedStatus){(m=d.onError)==null||m.call(d,f.status);return}const R=a(f);if(v===o){const P=f.getResponseHeader("Content-Range"),x=/bytes (\d+)-(\d+)\/(\d+)/.exec(P);d.onDone({begin:parseInt(x[1],10),chunk:R})}else R?d.onDone({begin:0,chunk:R}):(b=d.onError)==null||b.call(d,f.status)}getRequestXhr(y){return this.pendingRequests[y].xhr}isPendingRequest(y){return y in this.pendingRequests}abortRequest(y){const h=this.pendingRequests[y].xhr;delete this.pendingRequests[y],h.abort()}}class c{constructor(y){this._source=y,this._manager=new l(y.url,{httpHeaders:y.httpHeaders,withCredentials:y.withCredentials}),this._rangeChunkSize=y.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(y){const h=this._rangeRequestReaders.indexOf(y);h>=0&&this._rangeRequestReaders.splice(h,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new u(this._manager,this._source),this._fullRequestReader}getRangeReader(y,h){const d=new p(this._manager,y,h);return d.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(d),d}cancelAllRequests(y){var h;(h=this._fullRequestReader)==null||h.cancel(y);for(const d of this._rangeRequestReaders.slice(0))d.cancel(y)}}e.PDFNetworkStream=c;class u{constructor(y,h){this._manager=y;const d={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=h.url,this._fullRequestId=y.requestFull(d),this._headersReceivedCapability=new n.PromiseCapability,this._disableRange=h.disableRange||!1,this._contentLength=h.length,this._rangeChunkSize=h.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const y=this._fullRequestId,h=this._manager.getRequestXhr(y),d=T=>h.getResponseHeader(T),{allowRangeRequests:f,suggestedLength:v}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:d,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});f&&(this._isRangeSupported=!0),this._contentLength=v||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(d),this._isRangeSupported&&this._manager.abortRequest(y),this._headersReceivedCapability.resolve()}_onDone(y){if(y&&(this._requests.length>0?this._requests.shift().resolve({value:y.chunk,done:!1}):this._cachedChunks.push(y.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(y){this._storedError=(0,s.createResponseStatusError)(y,this._url),this._headersReceivedCapability.reject(this._storedError);for(const h of this._requests)h.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(y){var h;(h=this.onProgress)==null||h.call(this,{loaded:y.loaded,total:y.lengthComputable?y.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const y=new n.PromiseCapability;return this._requests.push(y),y.promise}cancel(y){this._done=!0,this._headersReceivedCapability.reject(y);for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class p{constructor(y,h,d){this._manager=y;const f={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=y.url,this._requestId=y.requestRange(h,d,f),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var y;(y=this.onClosed)==null||y.call(this,this)}_onDone(y){const h=y.chunk;this._requests.length>0?this._requests.shift().resolve({value:h,done:!1}):this._queuedChunk=h,this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(y){this._storedError=(0,s.createResponseStatusError)(y,this._url);for(const h of this._requests)h.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(y){var h;this.isStreamingSupported||(h=this.onProgress)==null||h.call(this,{loaded:y.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const h=this._queuedChunk;return this._queuedChunk=null,{value:h,done:!1}}if(this._done)return{value:void 0,done:!0};const y=new n.PromiseCapability;return this._requests.push(y),y.promise}cancel(y){this._done=!0;for(const h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0,t(89),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123);var n=t(1),s=t(181);const i=/^file:\/\/\/[a-zA-Z]:\//;function o(d){const f=require$$6,v=f.parse(d);return v.protocol==="file:"||v.host?v:/^[a-z]:[/\\]/i.test(d)?f.parse(`file:///${d}`):(v.host||(v.protocol="file:"),v)}class a{constructor(f){this.source=f,this.url=o(f.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&f.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var f;return((f=this._fullRequestReader)==null?void 0:f._loaded)??0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new y(this):new p(this),this._fullRequestReader}getRangeReader(f,v){if(v<=this._progressiveDataLength)return null;const T=this.isFsUrl?new h(this,f,v):new g(this,f,v);return this._rangeRequestReaders.push(T),T}cancelAllRequests(f){var v;(v=this._fullRequestReader)==null||v.cancel(f);for(const T of this._rangeRequestReaders.slice(0))T.cancel(f)}}e.PDFNodeStream=a;class l{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null;const v=f.source;this._contentLength=v.length,this._loaded=0,this._filename=null,this._disableRange=v.disableRange||!1,this._rangeChunkSize=v.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!v.disableStream,this._isRangeSupported=!v.disableRange,this._readableStream=null,this._readCapability=new n.PromiseCapability,this._headersCapability=new n.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var T;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=f.length,(T=this.onProgress)==null||T.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",v=>{this._error(v)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class c{constructor(f){this._url=f.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new n.PromiseCapability;const v=f.source;this._isStreamingSupported=!v.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var T;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const f=this._readableStream.read();return f===null?(this._readCapability=new n.PromiseCapability,this.read()):(this._loaded+=f.length,(T=this.onProgress)==null||T.call(this,{loaded:this._loaded}),{value:new Uint8Array(f).buffer,done:!1})}cancel(f){if(!this._readableStream){this._error(f);return}this._readableStream.destroy(f)}_error(f){this._storedError=f,this._readCapability.resolve()}_setReadableStream(f){this._readableStream=f,f.on("readable",()=>{this._readCapability.resolve()}),f.on("end",()=>{f.destroy(),this._done=!0,this._readCapability.resolve()}),f.on("error",v=>{this._error(v)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function u(d,f){return{protocol:d.protocol,auth:d.auth,host:d.hostname,port:d.port,path:d.path,method:"GET",headers:f}}class p extends l{constructor(f){super(f);const v=T=>{if(T.statusCode===404){const b=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=b,this._headersCapability.reject(b);return}this._headersCapability.resolve(),this._setReadableStream(T);const R=b=>this._readableStream.headers[b.toLowerCase()],{allowRangeRequests:N,suggestedLength:m}=(0,s.validateRangeRequestCapabilities)({getResponseHeader:R,isHttp:f.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=N,this._contentLength=m||this._contentLength,this._filename=(0,s.extractFilenameFromHeader)(R)};if(this._request=null,this._url.protocol==="http:"){const T=require$$6;this._request=T.request(u(this._url,f.httpHeaders),v)}else{const T=require$$6;this._request=T.request(u(this._url,f.httpHeaders),v)}this._request.on("error",T=>{this._storedError=T,this._headersCapability.reject(T)}),this._request.end()}}class g extends c{constructor(f,v,T){super(f),this._httpHeaders={};for(const N in f.httpHeaders){const m=f.httpHeaders[N];m!==void 0&&(this._httpHeaders[N]=m)}this._httpHeaders.Range=`bytes=${v}-${T-1}`;const R=N=>{if(N.statusCode===404){const m=new n.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=m;return}this._setReadableStream(N)};if(this._request=null,this._url.protocol==="http:"){const N=require$$6;this._request=N.request(u(this._url,this._httpHeaders),R)}else{const N=require$$6;this._request=N.request(u(this._url,this._httpHeaders),R)}this._request.on("error",N=>{this._storedError=N}),this._request.end()}}class y extends l{constructor(f){super(f);let v=decodeURIComponent(this._url.path);i.test(this._url.href)&&(v=v.replace(/^\//,""));const T=require$$6;T.lstat(v,(R,N)=>{if(R){R.code==="ENOENT"&&(R=new n.MissingPDFException(`Missing PDF "${v}".`)),this._storedError=R,this._headersCapability.reject(R);return}this._contentLength=N.size,this._setReadableStream(T.createReadStream(v)),this._headersCapability.resolve()})}}class h extends c{constructor(f,v,T){super(f);let R=decodeURIComponent(this._url.path);i.test(this._url.href)&&(R=R.replace(/^\//,""));const N=require$$6;this._setReadableStream(N.createReadStream(R,{start:v,end:T-1}))}}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0,t(84),t(86),t(87),t(93),t(101),t(102),t(105),t(107),t(109),t(113),t(116),t(123),t(2),t(89),t(186);var n=t(167),s=t(1);const i={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},o="http://www.w3.org/XML/1998/namespace",a="http://www.w3.org/1999/xlink",l=["butt","round","square"],c=["miter","round","bevel"],u=function(N){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(URL.createObjectURL&&typeof Blob<"u"&&!b)return URL.createObjectURL(new Blob([N],{type:m}));const P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let x=`data:${m};base64,`;for(let S=0,w=N.length;S<w;S+=3){const E=N[S]&255,V=N[S+1]&255,$=N[S+2]&255,j=E>>2,D=(E&3)<<4|V>>4,Y=S+1<w?(V&15)<<2|$>>6:64,G=S+2<w?$&63:64;x+=P[j]+P[D]+P[Y]+P[G]}return x},p=function(){const N=new Uint8Array([137,80,78,71,13,10,26,10]),m=12,b=new Int32Array(256);for(let $=0;$<256;$++){let j=$;for(let D=0;D<8;D++)j=j&1?3988292384^j>>1&2147483647:j>>1&2147483647;b[$]=j}function P($,j,D){let Y=-1;for(let G=j;G<D;G++){const X=(Y^$[G])&255,Z=b[X];Y=Y>>>8^Z}return Y^-1}function x($,j,D,Y){let G=Y;const X=j.length;D[G]=X>>24&255,D[G+1]=X>>16&255,D[G+2]=X>>8&255,D[G+3]=X&255,G+=4,D[G]=$.charCodeAt(0)&255,D[G+1]=$.charCodeAt(1)&255,D[G+2]=$.charCodeAt(2)&255,D[G+3]=$.charCodeAt(3)&255,G+=4,D.set(j,G),G+=j.length;const Z=P(D,Y+4,G);D[G]=Z>>24&255,D[G+1]=Z>>16&255,D[G+2]=Z>>8&255,D[G+3]=Z&255}function S($,j,D){let Y=1,G=0;for(let X=j;X<D;++X)Y=(Y+($[X]&255))%65521,G=(G+Y)%65521;return G<<16|Y}function w($){if(!s.isNodeJS)return E($);try{const j=parseInt(process.versions.node)>=8?$:Buffer.from($),D=require$$6.deflateSync(j,{level:9});return D instanceof Uint8Array?D:new Uint8Array(D)}catch(j){(0,s.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+j)}return E($)}function E($){let j=$.length;const D=65535,Y=Math.ceil(j/D),G=new Uint8Array(2+j+Y*5+4);let X=0;G[X++]=120,G[X++]=156;let Z=0;for(;j>D;)G[X++]=0,G[X++]=255,G[X++]=255,G[X++]=0,G[X++]=0,G.set($.subarray(Z,Z+D),X),X+=D,Z+=D,j-=D;G[X++]=1,G[X++]=j&255,G[X++]=j>>8&255,G[X++]=~j&65535&255,G[X++]=(~j&65535)>>8&255,G.set($.subarray(Z),X),X+=$.length-Z;const ne=S($,0,$.length);return G[X++]=ne>>24&255,G[X++]=ne>>16&255,G[X++]=ne>>8&255,G[X++]=ne&255,G}function V($,j,D,Y){const G=$.width,X=$.height;let Z,ne,ie;const be=$.data;switch(j){case s.ImageKind.GRAYSCALE_1BPP:ne=0,Z=1,ie=G+7>>3;break;case s.ImageKind.RGB_24BPP:ne=2,Z=8,ie=G*3;break;case s.ImageKind.RGBA_32BPP:ne=6,Z=8,ie=G*4;break;default:throw new Error("invalid format")}const Q=new Uint8Array((1+ie)*X);let O=0,k=0;for(let te=0;te<X;++te)Q[O++]=0,Q.set(be.subarray(k,k+ie),O),k+=ie,O+=ie;if(j===s.ImageKind.GRAYSCALE_1BPP&&Y){O=0;for(let te=0;te<X;te++){O++;for(let pe=0;pe<ie;pe++)Q[O++]^=255}}const F=new Uint8Array([G>>24&255,G>>16&255,G>>8&255,G&255,X>>24&255,X>>16&255,X>>8&255,X&255,Z,ne,0,0,0]),z=w(Q),L=N.length+m*3+F.length+z.length,K=new Uint8Array(L);let U=0;return K.set(N,U),U+=N.length,x("IHDR",F,K,U),U+=m+F.length,x("IDATA",z,K,U),U+=m+z.length,x("IEND",new Uint8Array(0),K,U),u(K,"image/png",D)}return function(j,D,Y){const G=j.kind===void 0?s.ImageKind.GRAYSCALE_1BPP:j.kind;return V(j,G,D,Y)}}();class g{constructor(){this.fontSizeScale=1,this.fontWeight=i.fontWeight,this.fontSize=0,this.textMatrix=s.IDENTITY_MATRIX,this.fontMatrix=s.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=s.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=i.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(m,b){this.x=m,this.y=b}}function y(N){let m=[];const b=[];for(const P of N){if(P.fn==="save"){m.push({fnId:92,fn:"group",items:[]}),b.push(m),m=m.at(-1).items;continue}P.fn==="restore"?m=b.pop():m.push(P)}return m}function h(N){if(Number.isInteger(N))return N.toString();const m=N.toFixed(10);let b=m.length-1;if(m[b]!=="0")return m;do b--;while(m[b]==="0");return m.substring(0,m[b]==="."?b:b+1)}function d(N){if(N[4]===0&&N[5]===0){if(N[1]===0&&N[2]===0)return N[0]===1&&N[3]===1?"":`scale(${h(N[0])} ${h(N[3])})`;if(N[0]===N[3]&&N[1]===-N[2]){const m=Math.acos(N[0])*180/Math.PI;return`rotate(${h(m)})`}}else if(N[0]===1&&N[1]===0&&N[2]===0&&N[3]===1)return`translate(${h(N[4])} ${h(N[5])})`;return`matrix(${h(N[0])} ${h(N[1])} ${h(N[2])} ${h(N[3])} ${h(N[4])} ${h(N[5])})`}let f=0,v=0,T=0;class R{constructor(m,b){let P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new g,this.transformMatrix=s.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=m,this.objs=b,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!P,this._operatorIdMapping=[];for(const x in s.OPS)this._operatorIdMapping[s.OPS[x]]=x}getObject(m){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return typeof m=="string"?m.startsWith("g_")?this.commonObjs.get(m):this.objs.get(m):b}save(){this.transformStack.push(this.transformMatrix);const m=this.current;this.extraStack.push(m),this.current=m.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(m){this.save(),this.executeOpTree(m),this.restore()}loadDependencies(m){const b=m.fnArray,P=m.argsArray;for(let x=0,S=b.length;x<S;x++)if(b[x]===s.OPS.dependency)for(const w of P[x]){const E=w.startsWith("g_")?this.commonObjs:this.objs,V=new Promise($=>{E.get(w,$)});this.current.dependencies.push(V)}return Promise.all(this.current.dependencies)}transform(m,b,P,x,S,w){const E=[m,b,P,x,S,w];this.transformMatrix=s.Util.transform(this.transformMatrix,E),this.tgrp=null}getSVG(m,b){this.viewport=b;const P=this._initialize(b);return this.loadDependencies(m).then(()=>(this.transformMatrix=s.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(m)),P))}convertOpList(m){const b=this._operatorIdMapping,P=m.argsArray,x=m.fnArray,S=[];for(let w=0,E=x.length;w<E;w++){const V=x[w];S.push({fnId:V,fn:b[V],args:P[w]})}return y(S)}executeOpTree(m){for(const b of m){const P=b.fn,x=b.fnId,S=b.args;switch(x|0){case s.OPS.beginText:this.beginText();break;case s.OPS.dependency:break;case s.OPS.setLeading:this.setLeading(S);break;case s.OPS.setLeadingMoveText:this.setLeadingMoveText(S[0],S[1]);break;case s.OPS.setFont:this.setFont(S);break;case s.OPS.showText:this.showText(S[0]);break;case s.OPS.showSpacedText:this.showText(S[0]);break;case s.OPS.endText:this.endText();break;case s.OPS.moveText:this.moveText(S[0],S[1]);break;case s.OPS.setCharSpacing:this.setCharSpacing(S[0]);break;case s.OPS.setWordSpacing:this.setWordSpacing(S[0]);break;case s.OPS.setHScale:this.setHScale(S[0]);break;case s.OPS.setTextMatrix:this.setTextMatrix(S[0],S[1],S[2],S[3],S[4],S[5]);break;case s.OPS.setTextRise:this.setTextRise(S[0]);break;case s.OPS.setTextRenderingMode:this.setTextRenderingMode(S[0]);break;case s.OPS.setLineWidth:this.setLineWidth(S[0]);break;case s.OPS.setLineJoin:this.setLineJoin(S[0]);break;case s.OPS.setLineCap:this.setLineCap(S[0]);break;case s.OPS.setMiterLimit:this.setMiterLimit(S[0]);break;case s.OPS.setFillRGBColor:this.setFillRGBColor(S[0],S[1],S[2]);break;case s.OPS.setStrokeRGBColor:this.setStrokeRGBColor(S[0],S[1],S[2]);break;case s.OPS.setStrokeColorN:this.setStrokeColorN(S);break;case s.OPS.setFillColorN:this.setFillColorN(S);break;case s.OPS.shadingFill:this.shadingFill(S[0]);break;case s.OPS.setDash:this.setDash(S[0],S[1]);break;case s.OPS.setRenderingIntent:this.setRenderingIntent(S[0]);break;case s.OPS.setFlatness:this.setFlatness(S[0]);break;case s.OPS.setGState:this.setGState(S[0]);break;case s.OPS.fill:this.fill();break;case s.OPS.eoFill:this.eoFill();break;case s.OPS.stroke:this.stroke();break;case s.OPS.fillStroke:this.fillStroke();break;case s.OPS.eoFillStroke:this.eoFillStroke();break;case s.OPS.clip:this.clip("nonzero");break;case s.OPS.eoClip:this.clip("evenodd");break;case s.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case s.OPS.paintImageXObject:this.paintImageXObject(S[0]);break;case s.OPS.paintInlineImageXObject:this.paintInlineImageXObject(S[0]);break;case s.OPS.paintImageMaskXObject:this.paintImageMaskXObject(S[0]);break;case s.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(S[0],S[1]);break;case s.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case s.OPS.closePath:this.closePath();break;case s.OPS.closeStroke:this.closeStroke();break;case s.OPS.closeFillStroke:this.closeFillStroke();break;case s.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case s.OPS.nextLine:this.nextLine();break;case s.OPS.transform:this.transform(S[0],S[1],S[2],S[3],S[4],S[5]);break;case s.OPS.constructPath:this.constructPath(S[0],S[1]);break;case s.OPS.endPath:this.endPath();break;case 92:this.group(b.items);break;default:(0,s.warn)(`Unimplemented operator ${P}`);break}}}setWordSpacing(m){this.current.wordSpacing=m}setCharSpacing(m){this.current.charSpacing=m}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(m,b,P,x,S,w){const E=this.current;E.textMatrix=E.lineMatrix=[m,b,P,x,S,w],E.textMatrixScale=Math.hypot(m,b),E.x=E.lineX=0,E.y=E.lineY=0,E.xcoords=[],E.ycoords=[],E.tspan=this.svgFactory.createElement("svg:tspan"),E.tspan.setAttributeNS(null,"font-family",E.fontFamily),E.tspan.setAttributeNS(null,"font-size",`${h(E.fontSize)}px`),E.tspan.setAttributeNS(null,"y",h(-E.y)),E.txtElement=this.svgFactory.createElement("svg:text"),E.txtElement.append(E.tspan)}beginText(){const m=this.current;m.x=m.lineX=0,m.y=m.lineY=0,m.textMatrix=s.IDENTITY_MATRIX,m.lineMatrix=s.IDENTITY_MATRIX,m.textMatrixScale=1,m.tspan=this.svgFactory.createElement("svg:tspan"),m.txtElement=this.svgFactory.createElement("svg:text"),m.txtgrp=this.svgFactory.createElement("svg:g"),m.xcoords=[],m.ycoords=[]}moveText(m,b){const P=this.current;P.x=P.lineX+=m,P.y=P.lineY+=b,P.xcoords=[],P.ycoords=[],P.tspan=this.svgFactory.createElement("svg:tspan"),P.tspan.setAttributeNS(null,"font-family",P.fontFamily),P.tspan.setAttributeNS(null,"font-size",`${h(P.fontSize)}px`),P.tspan.setAttributeNS(null,"y",h(-P.y))}showText(m){const b=this.current,P=b.font,x=b.fontSize;if(x===0)return;const S=b.fontSizeScale,w=b.charSpacing,E=b.wordSpacing,V=b.fontDirection,$=b.textHScale*V,j=P.vertical,D=j?1:-1,Y=P.defaultVMetrics,G=x*b.fontMatrix[0];let X=0;for(const ie of m){if(ie===null){X+=V*E;continue}else if(typeof ie=="number"){X+=D*ie*x/1e3;continue}const be=(ie.isSpace?E:0)+w,Q=ie.fontChar;let O,k,F=ie.width;if(j){let L;const K=ie.vmetric||Y;L=ie.vmetric?K[1]:F*.5,L=-L*G;const U=K[2]*G;F=K?-K[0]:F,O=L/S,k=(X+U)/S}else O=X/S,k=0;(ie.isInFont||P.missingFile)&&(b.xcoords.push(b.x+O),j&&b.ycoords.push(-b.y+k),b.tspan.textContent+=Q);const z=j?F*G-be*V:F*G+be*V;X+=z}b.tspan.setAttributeNS(null,"x",b.xcoords.map(h).join(" ")),j?b.tspan.setAttributeNS(null,"y",b.ycoords.map(h).join(" ")):b.tspan.setAttributeNS(null,"y",h(-b.y)),j?b.y-=X:b.x+=X*$,b.tspan.setAttributeNS(null,"font-family",b.fontFamily),b.tspan.setAttributeNS(null,"font-size",`${h(b.fontSize)}px`),b.fontStyle!==i.fontStyle&&b.tspan.setAttributeNS(null,"font-style",b.fontStyle),b.fontWeight!==i.fontWeight&&b.tspan.setAttributeNS(null,"font-weight",b.fontWeight);const Z=b.textRenderingMode&s.TextRenderingMode.FILL_STROKE_MASK;if(Z===s.TextRenderingMode.FILL||Z===s.TextRenderingMode.FILL_STROKE?(b.fillColor!==i.fillColor&&b.tspan.setAttributeNS(null,"fill",b.fillColor),b.fillAlpha<1&&b.tspan.setAttributeNS(null,"fill-opacity",b.fillAlpha)):b.textRenderingMode===s.TextRenderingMode.ADD_TO_PATH?b.tspan.setAttributeNS(null,"fill","transparent"):b.tspan.setAttributeNS(null,"fill","none"),Z===s.TextRenderingMode.STROKE||Z===s.TextRenderingMode.FILL_STROKE){const ie=1/(b.textMatrixScale||1);this._setStrokeAttributes(b.tspan,ie)}let ne=b.textMatrix;b.textRise!==0&&(ne=ne.slice(),ne[5]+=b.textRise),b.txtElement.setAttributeNS(null,"transform",`${d(ne)} scale(${h($)}, -1)`),b.txtElement.setAttributeNS(o,"xml:space","preserve"),b.txtElement.append(b.tspan),b.txtgrp.append(b.txtElement),this._ensureTransformGroup().append(b.txtElement)}setLeadingMoveText(m,b){this.setLeading(-b),this.moveText(m,b)}addFontStyle(m){if(!m.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const b=u(m.data,m.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${m.loadedName}"; src: url(${b}); }
`}setFont(m){const b=this.current,P=this.commonObjs.get(m[0]);let x=m[1];b.font=P,this.embedFonts&&!P.missingFile&&!this.embeddedFonts[P.loadedName]&&(this.addFontStyle(P),this.embeddedFonts[P.loadedName]=P),b.fontMatrix=P.fontMatrix||s.FONT_IDENTITY_MATRIX;let S="normal";P.black?S="900":P.bold&&(S="bold");const w=P.italic?"italic":"normal";x<0?(x=-x,b.fontDirection=-1):b.fontDirection=1,b.fontSize=x,b.fontFamily=P.loadedName,b.fontWeight=S,b.fontStyle=w,b.tspan=this.svgFactory.createElement("svg:tspan"),b.tspan.setAttributeNS(null,"y",h(-b.y)),b.xcoords=[],b.ycoords=[]}endText(){var b;const m=this.current;m.textRenderingMode&s.TextRenderingMode.ADD_TO_PATH_FLAG&&((b=m.txtElement)!=null&&b.hasChildNodes())&&(m.element=m.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(m){m>0&&(this.current.lineWidth=m)}setLineCap(m){this.current.lineCap=l[m]}setLineJoin(m){this.current.lineJoin=c[m]}setMiterLimit(m){this.current.miterLimit=m}setStrokeAlpha(m){this.current.strokeAlpha=m}setStrokeRGBColor(m,b,P){this.current.strokeColor=s.Util.makeHexColor(m,b,P)}setFillAlpha(m){this.current.fillAlpha=m}setFillRGBColor(m,b,P){this.current.fillColor=s.Util.makeHexColor(m,b,P),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(m){this.current.strokeColor=this._makeColorN_Pattern(m)}setFillColorN(m){this.current.fillColor=this._makeColorN_Pattern(m)}shadingFill(m){const{width:b,height:P}=this.viewport,x=s.Util.inverseTransform(this.transformMatrix),[S,w,E,V]=s.Util.getAxialAlignedBoundingBox([0,0,b,P],x),$=this.svgFactory.createElement("svg:rect");$.setAttributeNS(null,"x",S),$.setAttributeNS(null,"y",w),$.setAttributeNS(null,"width",E-S),$.setAttributeNS(null,"height",V-w),$.setAttributeNS(null,"fill",this._makeShadingPattern(m)),this.current.fillAlpha<1&&$.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append($)}_makeColorN_Pattern(m){return m[0]==="TilingPattern"?this._makeTilingPattern(m):this._makeShadingPattern(m)}_makeTilingPattern(m){const b=m[1],P=m[2],x=m[3]||s.IDENTITY_MATRIX,[S,w,E,V]=m[4],$=m[5],j=m[6],D=m[7],Y=`shading${T++}`,[G,X,Z,ne]=s.Util.normalizeRect([...s.Util.applyTransform([S,w],x),...s.Util.applyTransform([E,V],x)]),[ie,be]=s.Util.singularValueDecompose2dScale(x),Q=$*ie,O=j*be,k=this.svgFactory.createElement("svg:pattern");k.setAttributeNS(null,"id",Y),k.setAttributeNS(null,"patternUnits","userSpaceOnUse"),k.setAttributeNS(null,"width",Q),k.setAttributeNS(null,"height",O),k.setAttributeNS(null,"x",`${G}`),k.setAttributeNS(null,"y",`${X}`);const F=this.svg,z=this.transformMatrix,L=this.current.fillColor,K=this.current.strokeColor,U=this.svgFactory.create(Z-G,ne-X);if(this.svg=U,this.transformMatrix=x,D===2){const te=s.Util.makeHexColor(...b);this.current.fillColor=te,this.current.strokeColor=te}return this.executeOpTree(this.convertOpList(P)),this.svg=F,this.transformMatrix=z,this.current.fillColor=L,this.current.strokeColor=K,k.append(U.childNodes[0]),this.defs.append(k),`url(#${Y})`}_makeShadingPattern(m){switch(typeof m=="string"&&(m=this.objs.get(m)),m[0]){case"RadialAxial":const b=`shading${T++}`,P=m[3];let x;switch(m[1]){case"axial":const S=m[4],w=m[5];x=this.svgFactory.createElement("svg:linearGradient"),x.setAttributeNS(null,"id",b),x.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),x.setAttributeNS(null,"x1",S[0]),x.setAttributeNS(null,"y1",S[1]),x.setAttributeNS(null,"x2",w[0]),x.setAttributeNS(null,"y2",w[1]);break;case"radial":const E=m[4],V=m[5],$=m[6],j=m[7];x=this.svgFactory.createElement("svg:radialGradient"),x.setAttributeNS(null,"id",b),x.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),x.setAttributeNS(null,"cx",V[0]),x.setAttributeNS(null,"cy",V[1]),x.setAttributeNS(null,"r",j),x.setAttributeNS(null,"fx",E[0]),x.setAttributeNS(null,"fy",E[1]),x.setAttributeNS(null,"fr",$);break;default:throw new Error(`Unknown RadialAxial type: ${m[1]}`)}for(const S of P){const w=this.svgFactory.createElement("svg:stop");w.setAttributeNS(null,"offset",S[0]),w.setAttributeNS(null,"stop-color",S[1]),x.append(w)}return this.defs.append(x),`url(#${b})`;case"Mesh":return(0,s.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${m[0]}`)}}setDash(m,b){this.current.dashArray=m,this.current.dashPhase=b}constructPath(m,b){const P=this.current;let x=P.x,S=P.y,w=[],E=0;for(const V of m)switch(V|0){case s.OPS.rectangle:x=b[E++],S=b[E++];const $=b[E++],j=b[E++],D=x+$,Y=S+j;w.push("M",h(x),h(S),"L",h(D),h(S),"L",h(D),h(Y),"L",h(x),h(Y),"Z");break;case s.OPS.moveTo:x=b[E++],S=b[E++],w.push("M",h(x),h(S));break;case s.OPS.lineTo:x=b[E++],S=b[E++],w.push("L",h(x),h(S));break;case s.OPS.curveTo:x=b[E+4],S=b[E+5],w.push("C",h(b[E]),h(b[E+1]),h(b[E+2]),h(b[E+3]),h(x),h(S)),E+=6;break;case s.OPS.curveTo2:w.push("C",h(x),h(S),h(b[E]),h(b[E+1]),h(b[E+2]),h(b[E+3])),x=b[E+2],S=b[E+3],E+=4;break;case s.OPS.curveTo3:x=b[E+2],S=b[E+3],w.push("C",h(b[E]),h(b[E+1]),h(x),h(S),h(x),h(S)),E+=4;break;case s.OPS.closePath:w.push("Z");break}w=w.join(" "),P.path&&m.length>0&&m[0]!==s.OPS.rectangle&&m[0]!==s.OPS.moveTo?w=P.path.getAttributeNS(null,"d")+w:(P.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(P.path)),P.path.setAttributeNS(null,"d",w),P.path.setAttributeNS(null,"fill","none"),P.element=P.path,P.setCurrentPoint(x,S)}endPath(){const m=this.current;if(m.path=null,!this.pendingClip)return;if(!m.element){this.pendingClip=null;return}const b=`clippath${f++}`,P=this.svgFactory.createElement("svg:clipPath");P.setAttributeNS(null,"id",b),P.setAttributeNS(null,"transform",d(this.transformMatrix));const x=m.element.cloneNode(!0);if(this.pendingClip==="evenodd"?x.setAttributeNS(null,"clip-rule","evenodd"):x.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,P.append(x),this.defs.append(P),m.activeClipUrl){m.clipGroup=null;for(const S of this.extraStack)S.clipGroup=null;P.setAttributeNS(null,"clip-path",m.activeClipUrl)}m.activeClipUrl=`url(#${b})`,this.tgrp=null}clip(m){this.pendingClip=m}closePath(){const m=this.current;if(m.path){const b=`${m.path.getAttributeNS(null,"d")}Z`;m.path.setAttributeNS(null,"d",b)}}setLeading(m){this.current.leading=-m}setTextRise(m){this.current.textRise=m}setTextRenderingMode(m){this.current.textRenderingMode=m}setHScale(m){this.current.textHScale=m/100}setRenderingIntent(m){}setFlatness(m){}setGState(m){for(const[b,P]of m)switch(b){case"LW":this.setLineWidth(P);break;case"LC":this.setLineCap(P);break;case"LJ":this.setLineJoin(P);break;case"ML":this.setMiterLimit(P);break;case"D":this.setDash(P[0],P[1]);break;case"RI":this.setRenderingIntent(P);break;case"FL":this.setFlatness(P);break;case"Font":this.setFont(P);break;case"CA":this.setStrokeAlpha(P);break;case"ca":this.setFillAlpha(P);break;default:(0,s.warn)(`Unimplemented graphic state operator ${b}`);break}}fill(){const m=this.current;m.element&&(m.element.setAttributeNS(null,"fill",m.fillColor),m.element.setAttributeNS(null,"fill-opacity",m.fillAlpha),this.endPath())}stroke(){const m=this.current;m.element&&(this._setStrokeAttributes(m.element),m.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(m){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const P=this.current;let x=P.dashArray;b!==1&&x.length>0&&(x=x.map(function(S){return b*S})),m.setAttributeNS(null,"stroke",P.strokeColor),m.setAttributeNS(null,"stroke-opacity",P.strokeAlpha),m.setAttributeNS(null,"stroke-miterlimit",h(P.miterLimit)),m.setAttributeNS(null,"stroke-linecap",P.lineCap),m.setAttributeNS(null,"stroke-linejoin",P.lineJoin),m.setAttributeNS(null,"stroke-width",h(b*P.lineWidth)+"px"),m.setAttributeNS(null,"stroke-dasharray",x.map(h).join(" ")),m.setAttributeNS(null,"stroke-dashoffset",h(b*P.dashPhase)+"px")}eoFill(){var m;(m=this.current.element)==null||m.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var m;(m=this.current.element)==null||m.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const m=this.svgFactory.createElement("svg:rect");m.setAttributeNS(null,"x","0"),m.setAttributeNS(null,"y","0"),m.setAttributeNS(null,"width","1px"),m.setAttributeNS(null,"height","1px"),m.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(m)}paintImageXObject(m){const b=this.getObject(m);if(!b){(0,s.warn)(`Dependent image with object ID ${m} is not ready yet`);return}this.paintInlineImageXObject(b)}paintInlineImageXObject(m,b){const P=m.width,x=m.height,S=p(m,this.forceDataSchema,!!b),w=this.svgFactory.createElement("svg:rect");w.setAttributeNS(null,"x","0"),w.setAttributeNS(null,"y","0"),w.setAttributeNS(null,"width",h(P)),w.setAttributeNS(null,"height",h(x)),this.current.element=w,this.clip("nonzero");const E=this.svgFactory.createElement("svg:image");E.setAttributeNS(a,"xlink:href",S),E.setAttributeNS(null,"x","0"),E.setAttributeNS(null,"y",h(-x)),E.setAttributeNS(null,"width",h(P)+"px"),E.setAttributeNS(null,"height",h(x)+"px"),E.setAttributeNS(null,"transform",`scale(${h(1/P)} ${h(-1/x)})`),b?b.append(E):this._ensureTransformGroup().append(E)}paintImageMaskXObject(m){const b=this.getObject(m.data,m);if(b.bitmap){(0,s.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const P=this.current,x=b.width,S=b.height,w=P.fillColor;P.maskId=`mask${v++}`;const E=this.svgFactory.createElement("svg:mask");E.setAttributeNS(null,"id",P.maskId);const V=this.svgFactory.createElement("svg:rect");V.setAttributeNS(null,"x","0"),V.setAttributeNS(null,"y","0"),V.setAttributeNS(null,"width",h(x)),V.setAttributeNS(null,"height",h(S)),V.setAttributeNS(null,"fill",w),V.setAttributeNS(null,"mask",`url(#${P.maskId})`),this.defs.append(E),this._ensureTransformGroup().append(V),this.paintInlineImageXObject(b,E)}paintFormXObjectBegin(m,b){if(Array.isArray(m)&&m.length===6&&this.transform(m[0],m[1],m[2],m[3],m[4],m[5]),b){const P=b[2]-b[0],x=b[3]-b[1],S=this.svgFactory.createElement("svg:rect");S.setAttributeNS(null,"x",b[0]),S.setAttributeNS(null,"y",b[1]),S.setAttributeNS(null,"width",h(P)),S.setAttributeNS(null,"height",h(x)),this.current.element=S,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(m){const b=this.svgFactory.create(m.width,m.height),P=this.svgFactory.createElement("svg:defs");b.append(P),this.defs=P;const x=this.svgFactory.createElement("svg:g");return x.setAttributeNS(null,"transform",d(m.transform)),b.append(x),this.svg=x,b}_ensureClipGroup(){if(!this.current.clipGroup){const m=this.svgFactory.createElement("svg:g");m.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(m),this.current.clipGroup=m}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",d(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}e.SVGGraphics=R},(r,e,t)=>{var n=t(3),s=t(187),i=t(192);n({target:"Array",proto:!0},{group:function(a){var l=arguments.length>1?arguments[1]:void 0;return s(this,a,l)}}),i("group")},(r,e,t)=>{var n=t(99),s=t(14),i=t(13),o=t(40),a=t(18),l=t(64),c=t(188),u=t(108),p=Array,g=s([].push);r.exports=function(y,h,d,f){for(var v=o(y),T=i(v),R=n(h,d),N=c(null),m=l(T),b=0,P,x,S;m>b;b++)S=T[b],x=a(R(S,b,v)),x in N?g(N[x],S):N[x]=[S];if(f&&(P=f(v),P!==p))for(x in N)N[x]=u(P,N[x]);return N}},(r,e,t)=>{var n=t(47),s=t(189),i=t(66),o=t(55),a=t(191),l=t(43),c=t(54),u=">",p="<",g="prototype",y="script",h=c("IE_PROTO"),d=function(){},f=function(m){return p+y+u+m+p+"/"+y+u},v=function(m){m.write(f("")),m.close();var b=m.parentWindow.Object;return m=null,b},T=function(){var m=l("iframe"),b="java"+y+":",P;return m.style.display="none",a.appendChild(m),m.src=String(b),P=m.contentWindow.document,P.open(),P.write(f("document.F=Object")),P.close(),P.F},R,N=function(){try{R=new ActiveXObject("htmlfile")}catch{}N=typeof document<"u"?document.domain&&R?v(R):T():v(R);for(var m=i.length;m--;)delete N[g][i[m]];return N()};o[h]=!0,r.exports=Object.create||function(b,P){var x;return b!==null?(d[g]=n(b),x=new d,d[g]=null,x[h]=b):x=N(),P===void 0?x:s.f(x,P)}},(r,e,t)=>{var n=t(6),s=t(46),i=t(45),o=t(47),a=t(12),l=t(190);e.f=n&&!s?Object.defineProperties:function(u,p){o(u);for(var g=a(p),y=l(p),h=y.length,d=0,f;h>d;)i.f(u,f=y[d++],g[f]);return u}},(r,e,t)=>{var n=t(59),s=t(66);r.exports=Object.keys||function(o){return n(o,s)}},(r,e,t)=>{var n=t(24);r.exports=n("document","documentElement")},(r,e,t)=>{var n=t(34),s=t(188),i=t(45).f,o=n("unscopables"),a=Array.prototype;a[o]==null&&i(a,o,{configurable:!0,value:s(null)}),r.exports=function(l){a[o][l]=!0}},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0,t(89);class n{static textContent(i){const o=[],a={items:o,styles:Object.create(null)};function l(c){var g;if(!c)return;let u=null;const p=c.name;if(p==="#text")u=c.value;else if(n.shouldBuildText(p))(g=c==null?void 0:c.attributes)!=null&&g.textContent?u=c.attributes.textContent:c.value&&(u=c.value);else return;if(u!==null&&o.push({str:u}),!!c.children)for(const y of c.children)l(y)}return l(i),a}static shouldBuildText(i){return!(i==="textarea"||i==="input"||i==="option"||i==="select")}}e.XfaText=n},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=d,e.updateTextLayer=f,t(89),t(2);var n=t(1),s=t(167);const i=1e5,o=30,a=.8,l=new Map;function c(v,T){let R;if(T&&n.FeatureTest.isOffscreenCanvasSupported)R=new OffscreenCanvas(v,v).getContext("2d",{alpha:!1});else{const N=document.createElement("canvas");N.width=N.height=v,R=N.getContext("2d",{alpha:!1})}return R}function u(v,T){const R=l.get(v);if(R)return R;const N=c(o,T);N.font=`${o}px ${v}`;const m=N.measureText("");let b=m.fontBoundingBoxAscent,P=Math.abs(m.fontBoundingBoxDescent);if(b){const S=b/(b+P);return l.set(v,S),N.canvas.width=N.canvas.height=0,S}N.strokeStyle="red",N.clearRect(0,0,o,o),N.strokeText("g",0,0);let x=N.getImageData(0,0,o,o).data;P=0;for(let S=x.length-1-3;S>=0;S-=4)if(x[S]>0){P=Math.ceil(S/4/o);break}N.clearRect(0,0,o,o),N.strokeText("A",0,o),x=N.getImageData(0,0,o,o).data,b=0;for(let S=0,w=x.length;S<w;S+=4)if(x[S]>0){b=o-Math.floor(S/4/o);break}if(N.canvas.width=N.canvas.height=0,b){const S=b/(b+P);return l.set(v,S),S}return l.set(v,a),a}function p(v,T,R){const N=document.createElement("span"),m={angle:0,canvasWidth:0,hasText:T.str!=="",hasEOL:T.hasEOL,fontSize:0};v._textDivs.push(N);const b=n.Util.transform(v._transform,T.transform);let P=Math.atan2(b[1],b[0]);const x=R[T.fontName];x.vertical&&(P+=Math.PI/2);const S=Math.hypot(b[2],b[3]),w=S*u(x.fontFamily,v._isOffscreenCanvasSupported);let E,V;P===0?(E=b[4],V=b[5]-w):(E=b[4]+w*Math.sin(P),V=b[5]-w*Math.cos(P));const $="calc(var(--scale-factor)*",j=N.style;v._container===v._rootContainer?(j.left=`${(100*E/v._pageWidth).toFixed(2)}%`,j.top=`${(100*V/v._pageHeight).toFixed(2)}%`):(j.left=`${$}${E.toFixed(2)}px)`,j.top=`${$}${V.toFixed(2)}px)`),j.fontSize=`${$}${S.toFixed(2)}px)`,j.fontFamily=x.fontFamily,m.fontSize=S,N.setAttribute("role","presentation"),N.textContent=T.str,N.dir=T.dir,v._fontInspectorEnabled&&(N.dataset.fontName=T.fontName),P!==0&&(m.angle=P*(180/Math.PI));let D=!1;if(T.str.length>1)D=!0;else if(T.str!==" "&&T.transform[0]!==T.transform[3]){const Y=Math.abs(T.transform[0]),G=Math.abs(T.transform[3]);Y!==G&&Math.max(Y,G)/Math.min(Y,G)>1.5&&(D=!0)}D&&(m.canvasWidth=x.vertical?T.height:T.width),v._textDivProperties.set(N,m),v._isReadableStream&&v._layoutText(N)}function g(v){const{div:T,scale:R,properties:N,ctx:m,prevFontSize:b,prevFontFamily:P}=v,{style:x}=T;let S="";if(N.canvasWidth!==0&&N.hasText){const{fontFamily:w}=x,{canvasWidth:E,fontSize:V}=N;(b!==V||P!==w)&&(m.font=`${V*R}px ${w}`,v.prevFontSize=V,v.prevFontFamily=w);const{width:$}=m.measureText(T.textContent);$>0&&(S=`scaleX(${E*R/$})`)}N.angle!==0&&(S=`rotate(${N.angle}deg) ${S}`),S.length>0&&(x.transform=S)}function y(v){if(v._canceled)return;const T=v._textDivs,R=v._capability;if(T.length>i){R.resolve();return}if(!v._isReadableStream)for(const m of T)v._layoutText(m);R.resolve()}class h{constructor(T){var j;let{textContentSource:R,container:N,viewport:m,textDivs:b,textDivProperties:P,textContentItemsStr:x,isOffscreenCanvasSupported:S}=T;this._textContentSource=R,this._isReadableStream=R instanceof ReadableStream,this._container=this._rootContainer=N,this._textDivs=b||[],this._textContentItemsStr=x||[],this._isOffscreenCanvasSupported=S,this._fontInspectorEnabled=!!((j=globalThis.FontInspector)!=null&&j.enabled),this._reader=null,this._textDivProperties=P||new WeakMap,this._canceled=!1,this._capability=new n.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:m.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:c(0,S)};const{pageWidth:w,pageHeight:E,pageX:V,pageY:$}=m.rawDims;this._transform=[1,0,0,-1,-V,$+E],this._pageWidth=w,this._pageHeight=E,(0,s.setLayerDimensions)(N,m),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(T,R){for(const N of T){if(N.str===void 0){if(N.type==="beginMarkedContentProps"||N.type==="beginMarkedContent"){const m=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),N.id!==null&&this._container.setAttribute("id",`${N.id}`),m.append(this._container)}else N.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(N.str),p(this,N,R)}}_layoutText(T){const R=this._layoutTextParams.properties=this._textDivProperties.get(T);if(this._layoutTextParams.div=T,g(this._layoutTextParams),R.hasText&&this._container.append(T),R.hasEOL){const N=document.createElement("br");N.setAttribute("role","presentation"),this._container.append(N)}}_render(){const T=new n.PromiseCapability;let R=Object.create(null);if(this._isReadableStream){const N=()=>{this._reader.read().then(m=>{let{value:b,done:P}=m;if(P){T.resolve();return}Object.assign(R,b.styles),this._processItems(b.items,R),N()},T.reject)};this._reader=this._textContentSource.getReader(),N()}else if(this._textContentSource){const{items:N,styles:m}=this._textContentSource;this._processItems(N,m),T.resolve()}else throw new Error('No "textContentSource" parameter specified.');T.promise.then(()=>{R=null,y(this)},this._capability.reject)}}e.TextLayerRenderTask=h;function d(v){!v.textContentSource&&(v.textContent||v.textContentStream)&&((0,s.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),v.textContentSource=v.textContent||v.textContentStream);const{container:T,viewport:R}=v,N=getComputedStyle(T),m=N.getPropertyValue("visibility"),b=parseFloat(N.getPropertyValue("--scale-factor"));m==="visible"&&(!b||Math.abs(b-R.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const P=new h(v);return P._render(),P}function f(v){let{container:T,viewport:R,textDivs:N,textDivProperties:m,isOffscreenCanvasSupported:b,mustRotate:P=!0,mustRescale:x=!0}=v;if(P&&(0,s.setLayerDimensions)(T,{rotation:R.rotation}),x){const S=c(0,b),E={prevFontSize:null,prevFontFamily:null,div:null,scale:R.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:S};for(const V of N)E.properties=m.get(V),E.div=V,g(E)}}},(r,e,t)=>{var p,g,y,h,d,f,v,T,R,N,m,nn,P,Fn,S,rn,E,sn;Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0,t(125),t(135),t(137),t(140),t(142),t(144),t(146);var n=t(1),s=t(163),i=t(164),o=t(196),a=t(201),l=t(167),c=t(202);const $=class ${constructor(D){re(this,m);re(this,P);re(this,S);re(this,E);re(this,p,void 0);re(this,g,!1);re(this,y,null);re(this,h,this.pointerup.bind(this));re(this,d,this.pointerdown.bind(this));re(this,f,new Map);re(this,v,!1);re(this,T,!1);re(this,R,!1);re(this,N,void 0);let{uiManager:Y,pageIndex:G,div:X,accessibilityManager:Z,annotationLayer:ne,viewport:ie,l10n:be}=D;const Q=[o.FreeTextEditor,a.InkEditor,c.StampEditor];if(!$._initialized){$._initialized=!0;for(const O of Q)O.initialize(be)}Y.registerEditorTypes(Q),ye(this,N,Y),this.pageIndex=G,this.div=X,ye(this,p,Z),ye(this,y,ne),this.viewport=ie,_(this,N).addLayer(this)}get isEmpty(){return _(this,f).size===0}updateToolbar(D){_(this,N).updateToolbar(D)}updateMode(){let D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_(this,N).getMode();me(this,E,sn).call(this),D===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),_(this,N).unselectAll(),D!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",D===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",D===n.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",D===n.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(D){if(!D&&_(this,N).getMode()!==n.AnnotationEditorType.INK)return;if(!D){for(const G of _(this,f).values())if(G.isEmpty()){G.setInBackground();return}}me(this,S,rn).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(D){_(this,N).setEditingState(D)}addCommands(D){_(this,N).addCommands(D)}enable(){this.div.style.pointerEvents="auto";const D=new Set;for(const G of _(this,f).values())G.enableEditing(),G.annotationElementId&&D.add(G.annotationElementId);if(!_(this,y))return;const Y=_(this,y).getEditableAnnotations();for(const G of Y){if(G.hide(),_(this,N).isDeletedAnnotationElement(G.data.id)||D.has(G.data.id))continue;const X=this.deserialize(G);X&&(this.addOrRebuild(X),X.enableEditing())}}disable(){var Y;ye(this,R,!0),this.div.style.pointerEvents="none";const D=new Set;for(const G of _(this,f).values()){if(G.disableEditing(),!G.annotationElementId||G.serialize()!==null){D.add(G.annotationElementId);continue}(Y=this.getEditableAnnotation(G.annotationElementId))==null||Y.show(),G.remove()}if(_(this,y)){const G=_(this,y).getEditableAnnotations();for(const X of G){const{id:Z}=X.data;D.has(Z)||_(this,N).isDeletedAnnotationElement(Z)||X.show()}}me(this,E,sn).call(this),this.isEmpty&&(this.div.hidden=!0),ye(this,R,!1)}getEditableAnnotation(D){var Y;return((Y=_(this,y))==null?void 0:Y.getEditableAnnotation(D))||null}setActiveEditor(D){_(this,N).getActive()!==D&&_(this,N).setActiveEditor(D)}enableClick(){this.div.addEventListener("pointerdown",_(this,d)),this.div.addEventListener("pointerup",_(this,h))}disableClick(){this.div.removeEventListener("pointerdown",_(this,d)),this.div.removeEventListener("pointerup",_(this,h))}attach(D){_(this,f).set(D.id,D);const{annotationElementId:Y}=D;Y&&_(this,N).isDeletedAnnotationElement(Y)&&_(this,N).removeDeletedAnnotationElement(D)}detach(D){var Y;_(this,f).delete(D.id),(Y=_(this,p))==null||Y.removePointerInTextLayer(D.contentDiv),!_(this,R)&&D.annotationElementId&&_(this,N).addDeletedAnnotationElement(D)}remove(D){this.detach(D),_(this,N).removeEditor(D),D.div.style.display="none",setTimeout(()=>{D.div.style.display="",D.div.remove(),D.isAttachedToDOM=!1,document.activeElement===document.body&&_(this,N).focusMainContainer()},0),_(this,T)||this.addInkEditorIfNeeded(!1)}add(D){if(me(this,m,nn).call(this,D),_(this,N).addEditor(D),this.attach(D),!D.isAttachedToDOM){const Y=D.render();this.div.append(Y),D.isAttachedToDOM=!0}this.moveEditorInDOM(D),D.onceAdded(),_(this,N).addToAnnotationStorage(D)}moveEditorInDOM(D){var Y;(Y=_(this,p))==null||Y.moveElementInDOM(this.div,D.div,D.contentDiv,!0)}addOrRebuild(D){D.needsToBeRebuilt()?D.rebuild():this.add(D)}addUndoableEditor(D){const Y=()=>{this.addOrRebuild(D)},G=()=>{D.remove()};this.addCommands({cmd:Y,undo:G,mustExec:!1})}getNextId(){return _(this,N).getId()}deserialize(D){switch(D.annotationType??D.annotationEditorType){case n.AnnotationEditorType.FREETEXT:return o.FreeTextEditor.deserialize(D,this,_(this,N));case n.AnnotationEditorType.INK:return a.InkEditor.deserialize(D,this,_(this,N));case n.AnnotationEditorType.STAMP:return c.StampEditor.deserialize(D,this,_(this,N))}return null}setSelected(D){_(this,N).setSelected(D)}toggleSelected(D){_(this,N).toggleSelected(D)}isSelected(D){return _(this,N).isSelected(D)}unselect(D){_(this,N).unselect(D)}pointerup(D){const{isMac:Y}=n.FeatureTest.platform;if(!(D.button!==0||D.ctrlKey&&Y)&&D.target===this.div&&_(this,v)){if(ye(this,v,!1),!_(this,g)){ye(this,g,!0);return}me(this,S,rn).call(this,D)}}pointerdown(D){if(_(this,v)){ye(this,v,!1);return}const{isMac:Y}=n.FeatureTest.platform;if(D.button!==0||D.ctrlKey&&Y||D.target!==this.div)return;ye(this,v,!0);const G=_(this,N).getActive();ye(this,g,!G||G.isEmpty())}drop(D){const Y=D.dataTransfer.getData("text/plain"),G=_(this,N).getEditor(Y);if(!G)return;D.preventDefault(),D.dataTransfer.dropEffect="move",me(this,m,nn).call(this,G);const X=this.div.getBoundingClientRect(),Z=D.clientX-X.x,ne=D.clientY-X.y;G.translate(Z-G.startX,ne-G.startY),this.moveEditorInDOM(G),G.div.focus()}dragover(D){D.preventDefault()}destroy(){var D,Y;((D=_(this,N).getActive())==null?void 0:D.parent)===this&&_(this,N).setActiveEditor(null);for(const G of _(this,f).values())(Y=_(this,p))==null||Y.removePointerInTextLayer(G.contentDiv),G.setParent(null),G.isAttachedToDOM=!1,G.div.remove();this.div=null,_(this,f).clear(),_(this,N).removeLayer(this)}render(D){let{viewport:Y}=D;this.viewport=Y,(0,l.setLayerDimensions)(this.div,Y),(0,i.bindEvents)(this,this.div,["dragover","drop"]);for(const G of _(this,N).getEditors(this.pageIndex))this.add(G);this.updateMode()}update(D){let{viewport:Y}=D;_(this,N).commitOrRemove(),this.viewport=Y,(0,l.setLayerDimensions)(this.div,{rotation:Y.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:D,pageHeight:Y}=this.viewport.rawDims;return[D,Y]}};p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,v=new WeakMap,T=new WeakMap,R=new WeakMap,N=new WeakMap,m=new WeakSet,nn=function(D){var Y;D.parent!==this&&(D.annotationElementId&&(_(this,N).addDeletedAnnotationElement(D.annotationElementId),s.AnnotationEditor.deleteAnnotationElement(D),D.annotationElementId=null),this.attach(D),(Y=D.parent)==null||Y.detach(D),D.setParent(this),D.div&&D.isAttachedToDOM&&(D.div.remove(),this.div.append(D.div)))},P=new WeakSet,Fn=function(D){switch(_(this,N).getMode()){case n.AnnotationEditorType.FREETEXT:return new o.FreeTextEditor(D);case n.AnnotationEditorType.INK:return new a.InkEditor(D);case n.AnnotationEditorType.STAMP:return new c.StampEditor(D)}return null},S=new WeakSet,rn=function(D){const Y=this.getNextId(),G=me(this,P,Fn).call(this,{parent:this,id:Y,x:D.offsetX,y:D.offsetY,uiManager:_(this,N)});return G&&this.add(G),G},E=new WeakSet,sn=function(){ye(this,T,!0);for(const D of _(this,f).values())D.isEmpty()&&D.remove();ye(this,T,!1)},st($,"_initialized",!1);let u=$;e.AnnotationEditorLayer=u},(r,e,t)=>{var l,c,u,p,g,y,h,d,f,v,Dn,R,Ln,m,Bn,P,Rt,S,on,E,Vn,$,an;Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0,t(89);var n=t(1),s=t(164),i=t(163),o=t(197);const D=class D extends i.AnnotationEditor{constructor(X){super({...X,name:"freeTextEditor"});re(this,v);re(this,R);re(this,m);re(this,P);re(this,S);re(this,E);re(this,$);re(this,l,this.editorDivBlur.bind(this));re(this,c,this.editorDivFocus.bind(this));re(this,u,this.editorDivInput.bind(this));re(this,p,this.editorDivKeydown.bind(this));re(this,g,void 0);re(this,y,"");re(this,h,`${this.id}-editor`);re(this,d,void 0);re(this,f,null);ye(this,g,X.color||D._defaultColor||i.AnnotationEditor._defaultLineColor),ye(this,d,X.fontSize||D._defaultFontSize)}static get _keyboardManager(){const X=D.prototype,Z=be=>be.isEmpty(),ne=s.AnnotationEditorUIManager.TRANSLATE_SMALL,ie=s.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,n.shadow)(this,"_keyboardManager",new s.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],X.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],X.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],X._translateEmpty,{args:[-ne,0],checker:Z}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],X._translateEmpty,{args:[-ie,0],checker:Z}],[["ArrowRight","mac+ArrowRight"],X._translateEmpty,{args:[ne,0],checker:Z}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],X._translateEmpty,{args:[ie,0],checker:Z}],[["ArrowUp","mac+ArrowUp"],X._translateEmpty,{args:[0,-ne],checker:Z}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],X._translateEmpty,{args:[0,-ie],checker:Z}],[["ArrowDown","mac+ArrowDown"],X._translateEmpty,{args:[0,ne],checker:Z}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],X._translateEmpty,{args:[0,ie],checker:Z}]]))}static initialize(X){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(ne=>[ne,X.get(ne)]));const Z=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(Z.getPropertyValue("--freetext-padding"))}static updateDefaultParams(X,Z){switch(X){case n.AnnotationEditorParamsType.FREETEXT_SIZE:D._defaultFontSize=Z;break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:D._defaultColor=Z;break}}updateParams(X,Z){switch(X){case n.AnnotationEditorParamsType.FREETEXT_SIZE:me(this,v,Dn).call(this,Z);break;case n.AnnotationEditorParamsType.FREETEXT_COLOR:me(this,R,Ln).call(this,Z);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,D._defaultFontSize],[n.AnnotationEditorParamsType.FREETEXT_COLOR,D._defaultColor||i.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.FREETEXT_SIZE,_(this,d)],[n.AnnotationEditorParamsType.FREETEXT_COLOR,_(this,g)]]}_translateEmpty(X,Z){this._uiManager.translateSelectedEditors(X,Z,!0)}getInitialTranslation(){const X=this.parentScale;return[-D._internalPadding*X,-(D._internalPadding+_(this,d))*X]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(n.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",_(this,p)),this.editorDiv.addEventListener("focus",_(this,c)),this.editorDiv.addEventListener("blur",_(this,l)),this.editorDiv.addEventListener("input",_(this,u)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",_(this,h)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",_(this,p)),this.editorDiv.removeEventListener("focus",_(this,c)),this.editorDiv.removeEventListener("blur",_(this,l)),this.editorDiv.removeEventListener("input",_(this,u)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(X){super.focusin(X),X.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){if(this.width){me(this,$,an).call(this);return}this.enableEditMode(),this.editorDiv.focus()}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const X=_(this,y),Z=ye(this,y,me(this,m,Bn).call(this).trimEnd());if(X===Z)return;const ne=ie=>{if(ye(this,y,ie),!ie){this.remove();return}me(this,S,on).call(this),this.rebuild(),me(this,P,Rt).call(this)};this.addCommands({cmd:()=>{ne(Z)},undo:()=>{ne(X)},mustExec:!1}),me(this,P,Rt).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(X){this.enterInEditMode()}keydown(X){X.target===this.div&&X.key==="Enter"&&this.enterInEditMode()}editorDivKeydown(X){D._keyboardManager.exec(this,X)}editorDivFocus(X){this.isEditing=!0}editorDivBlur(X){this.isEditing=!1}editorDivInput(X){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let X,Z;this.width&&(X=this.x,Z=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",_(this,h)),this.enableEditing(),D._l10nPromise.get("editor_free_text2_aria_label").then(ie=>{var be;return(be=this.editorDiv)==null?void 0:be.setAttribute("aria-label",ie)}),D._l10nPromise.get("free_text2_default_content").then(ie=>{var be;return(be=this.editorDiv)==null?void 0:be.setAttribute("default-content",ie)}),this.editorDiv.contentEditable=!0;const{style:ne}=this.editorDiv;if(ne.fontSize=`calc(${_(this,d)}px * var(--scale-factor))`,ne.color=_(this,g),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,s.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[ie,be]=this.parentDimensions;if(this.annotationElementId){const{position:Q}=_(this,f);let[O,k]=this.getInitialTranslation();[O,k]=this.pageTranslationToScreen(O,k);const[F,z]=this.pageDimensions,[L,K]=this.pageTranslation;let U,te;switch(this.rotation){case 0:U=X+(Q[0]-L)/F,te=Z+this.height-(Q[1]-K)/z;break;case 90:U=X+(Q[0]-L)/F,te=Z-(Q[1]-K)/z,[O,k]=[k,-O];break;case 180:U=X-this.width+(Q[0]-L)/F,te=Z-(Q[1]-K)/z,[O,k]=[-O,-k];break;case 270:U=X+(Q[0]-L-this.height*z)/F,te=Z+(Q[1]-K-this.width*F)/z,[O,k]=[-k,O];break}this.setAt(U*ie,te*be,O,k)}else this.setAt(X*ie,Z*be,this.width*ie,this.height*be);me(this,S,on).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(X,Z,ne){let ie=null;if(X instanceof o.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:Q,fontColor:O},rect:k,rotation:F,id:z},textContent:L,textPosition:K,parent:{page:{pageNumber:U}}}=X;if(!L||L.length===0)return null;ie=X={annotationType:n.AnnotationEditorType.FREETEXT,color:Array.from(O),fontSize:Q,value:L.join(`
`),position:K,pageIndex:U-1,rect:k,rotation:F,id:z,deleted:!1}}const be=super.deserialize(X,Z,ne);return ye(be,d,X.fontSize),ye(be,g,n.Util.makeHexColor(...X.color)),ye(be,y,X.value),be.annotationElementId=X.id||null,ye(be,f,ie),be}serialize(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const Z=D._internalPadding*this.parentScale,ne=this.getRect(Z,Z),ie=i.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:_(this,g)),be={annotationType:n.AnnotationEditorType.FREETEXT,color:ie,fontSize:_(this,d),value:_(this,y),pageIndex:this.pageIndex,rect:ne,rotation:this.rotation};return X?be:this.annotationElementId&&!me(this,E,Vn).call(this,be)?null:(be.id=this.annotationElementId,be)}};l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,v=new WeakSet,Dn=function(X){const Z=ie=>{this.editorDiv.style.fontSize=`calc(${ie}px * var(--scale-factor))`,this.translate(0,-(ie-_(this,d))*this.parentScale),ye(this,d,ie),me(this,P,Rt).call(this)},ne=_(this,d);this.addCommands({cmd:()=>{Z(X)},undo:()=>{Z(ne)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},R=new WeakSet,Ln=function(X){const Z=_(this,g);this.addCommands({cmd:()=>{ye(this,g,this.editorDiv.style.color=X)},undo:()=>{ye(this,g,this.editorDiv.style.color=Z)},mustExec:!0,type:n.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},m=new WeakSet,Bn=function(){const X=this.editorDiv.getElementsByTagName("div");if(X.length===0)return this.editorDiv.innerText;const Z=[];for(const ne of X)Z.push(ne.innerText.replace(/\r\n?|\n/,""));return Z.join(`
`)},P=new WeakSet,Rt=function(){const[X,Z]=this.parentDimensions;let ne;if(this.isAttachedToDOM)ne=this.div.getBoundingClientRect();else{const{currentLayer:ie,div:be}=this,Q=be.style.display;be.style.display="hidden",ie.div.append(this.div),ne=be.getBoundingClientRect(),be.remove(),be.style.display=Q}this.rotation%180===this.parentRotation%180?(this.width=ne.width/X,this.height=ne.height/Z):(this.width=ne.height/X,this.height=ne.width/Z),this.fixAndSetPosition()},S=new WeakSet,on=function(){if(this.editorDiv.replaceChildren(),!!_(this,y))for(const X of _(this,y).split(`
`)){const Z=document.createElement("div");Z.append(X?document.createTextNode(X):document.createElement("br")),this.editorDiv.append(Z)}},E=new WeakSet,Vn=function(X){const{value:Z,fontSize:ne,color:ie,rect:be,pageIndex:Q}=_(this,f);return X.value!==Z||X.fontSize!==ne||X.rect.some((O,k)=>Math.abs(O-be[k])>=1)||X.color.some((O,k)=>O!==ie[k])||X.pageIndex!==Q},$=new WeakSet,an=function(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.annotationElementId)return;if(me(this,P,Rt).call(this),!X&&(this.width===0||this.height===0)){setTimeout(()=>me(this,$,an).call(this,!0),0);return}const Z=D._internalPadding*this.parentScale;_(this,f).rect=this.getRect(Z,Z)},st(D,"_freeTextDefaultContent",""),st(D,"_l10nPromise"),st(D,"_internalPadding",0),st(D,"_defaultColor",null),st(D,"_defaultFontSize",10),st(D,"_type","freetext");let a=D;e.FreeTextEditor=a},(r,e,t)=>{var k,F,yt,L,Wn,U,te,pe,ue,ve,se,ge,Ee,Oe,Me,we,Ue,Ne,Ae,de,Te,_e,cn,Ge,ln,$e,un,Qe,qe,Ye,Se,ce,oe,Re,Ie,et,fe,Un,ee,hn;Object.defineProperty(e,"__esModule",{value:!0}),e.StampAnnotationElement=e.InkAnnotationElement=e.FreeTextAnnotationElement=e.AnnotationLayer=void 0,t(89),t(125),t(135),t(137),t(140),t(142),t(144),t(146);var n=t(1),s=t(167),i=t(162),o=t(198),a=t(199),l=t(200);const c=1e3,u=9,p=new WeakSet;function g(ae){return{width:ae[2]-ae[0],height:ae[3]-ae[1]}}class y{static create(W){switch(W.data.annotationType){case n.AnnotationType.LINK:return new d(W);case n.AnnotationType.TEXT:return new f(W);case n.AnnotationType.WIDGET:switch(W.data.fieldType){case"Tx":return new T(W);case"Btn":return W.data.radioButton?new m(W):W.data.checkBox?new N(W):new b(W);case"Ch":return new P(W);case"Sig":return new R(W)}return new v(W);case n.AnnotationType.POPUP:return new x(W);case n.AnnotationType.FREETEXT:return new w(W);case n.AnnotationType.LINE:return new E(W);case n.AnnotationType.SQUARE:return new V(W);case n.AnnotationType.CIRCLE:return new $(W);case n.AnnotationType.POLYLINE:return new j(W);case n.AnnotationType.CARET:return new Y(W);case n.AnnotationType.INK:return new G(W);case n.AnnotationType.POLYGON:return new D(W);case n.AnnotationType.HIGHLIGHT:return new X(W);case n.AnnotationType.UNDERLINE:return new Z(W);case n.AnnotationType.SQUIGGLY:return new ne(W);case n.AnnotationType.STRIKEOUT:return new ie(W);case n.AnnotationType.STAMP:return new be(W);case n.AnnotationType.FILEATTACHMENT:return new Q(W);default:return new h(W)}}}class h{constructor(W){re(this,k,!1);let{isRenderable:I=!1,ignoreBorder:q=!1,createQuadrilaterals:H=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.isRenderable=I,this.data=W.data,this.layer=W.layer,this.linkService=W.linkService,this.downloadManager=W.downloadManager,this.imageResourcesPath=W.imageResourcesPath,this.renderForms=W.renderForms,this.svgFactory=W.svgFactory,this.annotationStorage=W.annotationStorage,this.enableScripting=W.enableScripting,this.hasJSActions=W.hasJSActions,this._fieldObjects=W.fieldObjects,this.parent=W.parent,I&&(this.container=this._createContainer(q)),H&&this._createQuadrilaterals()}_createContainer(W){const{data:I,parent:{page:q,viewport:H}}=this,J=document.createElement("section");J.setAttribute("data-annotation-id",I.id),J.style.zIndex=this.parent.zIndex++,this.data.popupRef&&J.setAttribute("aria-haspopup","dialog"),I.noRotate&&J.classList.add("norotate");const{pageWidth:le,pageHeight:xe,pageX:Pe,pageY:We}=H.rawDims;if(!I.rect||this instanceof x){const{rotation:ze}=I;return!I.hasOwnCanvas&&ze!==0&&this.setRotation(ze,J),J}const{width:ke,height:He}=g(I.rect),Fe=n.Util.normalizeRect([I.rect[0],q.view[3]-I.rect[1]+q.view[1],I.rect[2],q.view[3]-I.rect[3]+q.view[1]]);if(!W&&I.borderStyle.width>0){J.style.borderWidth=`${I.borderStyle.width}px`;const ze=I.borderStyle.horizontalCornerRadius,je=I.borderStyle.verticalCornerRadius;if(ze>0||je>0){const tt=`calc(${ze}px * var(--scale-factor)) / calc(${je}px * var(--scale-factor))`;J.style.borderRadius=tt}else if(this instanceof m){const tt=`calc(${ke}px * var(--scale-factor)) / calc(${He}px * var(--scale-factor))`;J.style.borderRadius=tt}switch(I.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:J.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:J.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:J.style.borderBottomStyle="solid";break}const Je=I.borderColor||null;Je?(ye(this,k,!0),J.style.borderColor=n.Util.makeHexColor(Je[0]|0,Je[1]|0,Je[2]|0)):J.style.borderWidth=0}J.style.left=`${100*(Fe[0]-Pe)/le}%`,J.style.top=`${100*(Fe[1]-We)/xe}%`;const{rotation:Le}=I;return I.hasOwnCanvas||Le===0?(J.style.width=`${100*ke/le}%`,J.style.height=`${100*He/xe}%`):this.setRotation(Le,J),J}setRotation(W){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.container;if(!this.data.rect)return;const{pageWidth:q,pageHeight:H}=this.parent.viewport.rawDims,{width:J,height:le}=g(this.data.rect);let xe,Pe;W%180===0?(xe=100*J/q,Pe=100*le/H):(xe=100*le/q,Pe=100*J/H),I.style.width=`${xe}%`,I.style.height=`${Pe}%`,I.setAttribute("data-main-rotation",(360-W)%360)}get _commonActions(){const W=(I,q,H)=>{const J=H.detail[I];H.target.style[q]=o.ColorConverters[`${J[0]}_HTML`](J.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:I=>{const q=I.detail.display%2===1;this.container.style.visibility=q?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:q,print:I.detail.display===0||I.detail.display===3})},print:I=>{this.annotationStorage.setValue(this.data.id,{print:I.detail.print})},hidden:I=>{this.container.style.visibility=I.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:I.detail.hidden})},focus:I=>{setTimeout(()=>I.target.focus({preventScroll:!1}),0)},userName:I=>{I.target.title=I.detail.userName},readonly:I=>{I.detail.readonly?I.target.setAttribute("readonly",""):I.target.removeAttribute("readonly")},required:I=>{this._setRequired(I.target,I.detail.required)},bgColor:I=>{W("bgColor","backgroundColor",I)},fillColor:I=>{W("fillColor","backgroundColor",I)},fgColor:I=>{W("fgColor","color",I)},textColor:I=>{W("textColor","color",I)},borderColor:I=>{W("borderColor","borderColor",I)},strokeColor:I=>{W("strokeColor","borderColor",I)},rotation:I=>{const q=I.detail.rotation;this.setRotation(q),this.annotationStorage.setValue(this.data.id,{rotation:q})}})}_dispatchEventFromSandbox(W,I){const q=this._commonActions;for(const H of Object.keys(I.detail)){const J=W[H]||q[H];J==null||J(I)}}_setDefaultPropertiesFromJS(W){if(!this.enableScripting)return;const I=this.annotationStorage.getRawValue(this.data.id);if(!I)return;const q=this._commonActions;for(const[H,J]of Object.entries(I)){const le=q[H];if(le){const xe={detail:{[H]:J},target:W};le(xe),delete I[H]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:W}=this.data;if(!W)return;const[I,q,H,J]=this.data.rect;if(W.length===1){const[,{x:je,y:Je},{x:tt,y:at}]=W[0];if(H===je&&J===Je&&I===tt&&q===at)return}const{style:le}=this.container;let xe;if(_(this,k)){const{borderColor:je,borderWidth:Je}=le;le.borderWidth=0,xe=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${je}" stroke-width="${Je}">`],this.container.classList.add("hasBorder")}const Pe=H-I,We=J-q,{svgFactory:ke}=this,He=ke.createElement("svg");He.classList.add("quadrilateralsContainer"),He.setAttribute("width",0),He.setAttribute("height",0);const Fe=ke.createElement("defs");He.append(Fe);const Le=ke.createElement("clipPath"),ze=`clippath_${this.data.id}`;Le.setAttribute("id",ze),Le.setAttribute("clipPathUnits","objectBoundingBox"),Fe.append(Le);for(const[,{x:je,y:Je},{x:tt,y:at}]of W){const nt=ke.createElement("rect"),ct=(tt-I)/Pe,lt=(J-Je)/We,ht=(je-tt)/Pe,dt=(Je-at)/We;nt.setAttribute("x",ct),nt.setAttribute("y",lt),nt.setAttribute("width",ht),nt.setAttribute("height",dt),Le.append(nt),xe==null||xe.push(`<rect vector-effect="non-scaling-stroke" x="${ct}" y="${lt}" width="${ht}" height="${dt}"/>`)}_(this,k)&&(xe.push("</g></svg>')"),le.backgroundImage=xe.join("")),this.container.append(He),this.container.style.clipPath=`url(#${ze})`}_createPopup(){const{container:W,data:I}=this;W.setAttribute("aria-haspopup","dialog");const q=new x({data:{color:I.color,titleObj:I.titleObj,modificationDate:I.modificationDate,contentsObj:I.contentsObj,richText:I.richText,parentRect:I.rect,borderStyle:0,id:`popup_${I.id}`,rotation:I.rotation},parent:this.parent,elements:[this]});this.parent.div.append(q.render())}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(W){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const q=[];if(this._fieldObjects){const H=this._fieldObjects[W];if(H)for(const{page:J,id:le,exportValues:xe}of H){if(J===-1||le===I)continue;const Pe=typeof xe=="string"?xe:null,We=document.querySelector(`[data-element-id="${le}"]`);if(We&&!p.has(We)){(0,n.warn)(`_getElementsByName - element not allowed: ${le}`);continue}q.push({id:le,exportValue:Pe,domElement:We})}return q}for(const H of document.getElementsByName(W)){const{exportValue:J}=H,le=H.getAttribute("data-element-id");le!==I&&p.has(H)&&q.push({id:le,exportValue:J,domElement:H})}return q}show(){var W;this.container&&(this.container.hidden=!1),(W=this.popup)==null||W.maybeShow()}hide(){var W;this.container&&(this.container.hidden=!0),(W=this.popup)==null||W.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const W=this.getElementsToTriggerPopup();if(Array.isArray(W))for(const I of W)I.classList.add("highlightArea");else W.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:W,data:{id:I}}=this;this.container.addEventListener("dblclick",()=>{var q;(q=this.linkService.eventBus)==null||q.dispatch("switchannotationeditormode",{source:this,mode:W,editId:I})})}}k=new WeakMap;class d extends h{constructor(I){let q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;super(I,{isRenderable:!0,ignoreBorder:!!(q!=null&&q.ignoreBorder),createQuadrilaterals:!0});re(this,F);re(this,L);this.isTooltipOnly=I.data.isTooltipOnly}render(){const{data:I,linkService:q}=this,H=document.createElement("a");H.setAttribute("data-element-id",I.id);let J=!1;return I.url?(q.addLinkAttributes(H,I.url,I.newWindow),J=!0):I.action?(this._bindNamedAction(H,I.action),J=!0):I.attachment?(this._bindAttachment(H,I.attachment),J=!0):I.setOCGState?(me(this,L,Wn).call(this,H,I.setOCGState),J=!0):I.dest?(this._bindLink(H,I.dest),J=!0):(I.actions&&(I.actions.Action||I.actions["Mouse Up"]||I.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(H,I),J=!0),I.resetForm?(this._bindResetFormAction(H,I.resetForm),J=!0):this.isTooltipOnly&&!J&&(this._bindLink(H,""),J=!0)),this.container.classList.add("linkAnnotation"),J&&this.container.append(H),this.container}_bindLink(I,q){I.href=this.linkService.getDestinationHash(q),I.onclick=()=>(q&&this.linkService.goToDestination(q),!1),(q||q==="")&&me(this,F,yt).call(this)}_bindNamedAction(I,q){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeNamedAction(q),!1),me(this,F,yt).call(this)}_bindAttachment(I,q){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>{var H;return(H=this.downloadManager)==null||H.openOrDownloadData(this.container,q.content,q.filename),!1},me(this,F,yt).call(this)}_bindJSAction(I,q){I.href=this.linkService.getAnchorUrl("");const H=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const J of Object.keys(q.actions)){const le=H.get(J);le&&(I[le]=()=>{var xe;return(xe=this.linkService.eventBus)==null||xe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:q.id,name:J}}),!1})}I.onclick||(I.onclick=()=>!1),me(this,F,yt).call(this)}_bindResetFormAction(I,q){const H=I.onclick;if(H||(I.href=this.linkService.getAnchorUrl("")),me(this,F,yt).call(this),!this._fieldObjects){(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),H||(I.onclick=()=>!1);return}I.onclick=()=>{var He;H==null||H();const{fields:J,refs:le,include:xe}=q,Pe=[];if(J.length!==0||le.length!==0){const Fe=new Set(le);for(const Le of J){const ze=this._fieldObjects[Le]||[];for(const{id:je}of ze)Fe.add(je)}for(const Le of Object.values(this._fieldObjects))for(const ze of Le)Fe.has(ze.id)===xe&&Pe.push(ze)}else for(const Fe of Object.values(this._fieldObjects))Pe.push(...Fe);const We=this.annotationStorage,ke=[];for(const Fe of Pe){const{id:Le}=Fe;switch(ke.push(Le),Fe.type){case"text":{const je=Fe.defaultValue||"";We.setValue(Le,{value:je});break}case"checkbox":case"radiobutton":{const je=Fe.defaultValue===Fe.exportValues;We.setValue(Le,{value:je});break}case"combobox":case"listbox":{const je=Fe.defaultValue||"";We.setValue(Le,{value:je});break}default:continue}const ze=document.querySelector(`[data-element-id="${Le}"]`);if(ze){if(!p.has(ze)){(0,n.warn)(`_bindResetFormAction - element not allowed: ${Le}`);continue}}else continue;ze.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((He=this.linkService.eventBus)==null||He.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:ke,name:"ResetForm"}})),!1}}}F=new WeakSet,yt=function(){this.container.setAttribute("data-internal-link","")},L=new WeakSet,Wn=function(I,q){I.href=this.linkService.getAnchorUrl(""),I.onclick=()=>(this.linkService.executeSetOCGState(q),!1),me(this,F,yt).call(this)};class f extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I})}render(){this.container.classList.add("textAnnotation");const W=document.createElement("img");return W.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",W.alt="[{{type}} Annotation]",W.dataset.l10nId="text_annotation_type",W.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(W),this.container}}class v extends h{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(W){var I;this.data.hasOwnCanvas&&(((I=W.previousSibling)==null?void 0:I.nodeName)==="CANVAS"&&(W.previousSibling.hidden=!0),W.hidden=!1)}_getKeyModifier(W){const{isWin:I,isMac:q}=n.FeatureTest.platform;return I&&W.ctrlKey||q&&W.metaKey}_setEventListener(W,I,q,H){I.includes("mouse")?W.addEventListener(I,J=>{var le;(le=this.linkService.eventBus)==null||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:q,value:H(J),shift:J.shiftKey,modifier:this._getKeyModifier(J)}})}):W.addEventListener(I,J=>{var le;(le=this.linkService.eventBus)==null||le.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:q,value:H(J)}})})}_setEventListeners(W,I,q){var H;for(const[J,le]of I)(le==="Action"||(H=this.data.actions)!=null&&H[le])&&this._setEventListener(W,J,le,q)}_setBackgroundColor(W){const I=this.data.backgroundColor||null;W.style.backgroundColor=I===null?"transparent":n.Util.makeHexColor(I[0],I[1],I[2])}_setTextStyle(W){const I=["left","center","right"],{fontColor:q}=this.data.defaultAppearanceData,H=this.data.defaultAppearanceData.fontSize||u,J=W.style;let le;const xe=2,Pe=We=>Math.round(10*We)/10;if(this.data.multiLine){const We=Math.abs(this.data.rect[3]-this.data.rect[1]-xe),ke=Math.round(We/(n.LINE_FACTOR*H))||1,He=We/ke;le=Math.min(H,Pe(He/n.LINE_FACTOR))}else{const We=Math.abs(this.data.rect[3]-this.data.rect[1]-xe);le=Math.min(H,Pe(We/n.LINE_FACTOR))}J.fontSize=`calc(${le}px * var(--scale-factor))`,J.color=n.Util.makeHexColor(q[0],q[1],q[2]),this.data.textAlignment!==null&&(J.textAlign=I[this.data.textAlignment])}_setRequired(W,I){I?W.setAttribute("required",!0):W.removeAttribute("required"),W.setAttribute("aria-required",I)}}class T extends v{constructor(W){const I=W.renderForms||!W.data.hasAppearance&&!!W.data.fieldValue;super(W,{isRenderable:I})}setPropertyOnSiblings(W,I,q,H){const J=this.annotationStorage;for(const le of this._getElementsByName(W.name,W.id))le.domElement&&(le.domElement[I]=q),J.setValue(le.id,{[H]:q})}render(){var H,J;const W=this.annotationStorage,I=this.data.id;this.container.classList.add("textWidgetAnnotation");let q=null;if(this.renderForms){const le=W.getValue(I,{value:this.data.fieldValue});let xe=le.value||"";const Pe=W.getValue(I,{charLimit:this.data.maxLen}).charLimit;Pe&&xe.length>Pe&&(xe=xe.slice(0,Pe));let We=le.formattedValue||((H=this.data.textContent)==null?void 0:H.join(`
`))||null;We&&this.data.comb&&(We=We.replaceAll(/\s+/g,""));const ke={userValue:xe,formattedValue:We,lastCommittedValue:null,commitKey:1};this.data.multiLine?(q=document.createElement("textarea"),q.textContent=We??xe,this.data.doNotScroll&&(q.style.overflowY="hidden")):(q=document.createElement("input"),q.type="text",q.setAttribute("value",We??xe),this.data.doNotScroll&&(q.style.overflowX="hidden")),this.data.hasOwnCanvas&&(q.hidden=!0),p.add(q),q.setAttribute("data-element-id",I),q.disabled=this.data.readOnly,q.name=this.data.baseFieldName||this.data.fieldName,q.tabIndex=c,this._setRequired(q,this.data.required),Pe&&(q.maxLength=Pe),q.addEventListener("input",Fe=>{W.setValue(I,{value:Fe.target.value}),this.setPropertyOnSiblings(q,"value",Fe.target.value,"value"),ke.formattedValue=null}),q.addEventListener("resetform",Fe=>{const Le=this.data.defaultFieldValue??"";q.value=ke.userValue=Le,ke.formattedValue=null});let He=Fe=>{const{formattedValue:Le}=ke;Le!=null&&(Fe.target.value=Le),Fe.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){q.addEventListener("focus",Le=>{const{target:ze}=Le;ke.userValue&&(ze.value=ke.userValue),ke.lastCommittedValue=ze.value,ke.commitKey=1}),q.addEventListener("updatefromsandbox",Le=>{this.showElementAndHideCanvas(Le.target);const ze={value(je){ke.userValue=je.detail.value??"",W.setValue(I,{value:ke.userValue.toString()}),je.target.value=ke.userValue},formattedValue(je){const{formattedValue:Je}=je.detail;ke.formattedValue=Je,Je!=null&&je.target!==document.activeElement&&(je.target.value=Je),W.setValue(I,{formattedValue:Je})},selRange(je){je.target.setSelectionRange(...je.detail.selRange)},charLimit:je=>{var nt;const{charLimit:Je}=je.detail,{target:tt}=je;if(Je===0){tt.removeAttribute("maxLength");return}tt.setAttribute("maxLength",Je);let at=ke.userValue;!at||at.length<=Je||(at=at.slice(0,Je),tt.value=ke.userValue=at,W.setValue(I,{value:at}),(nt=this.linkService.eventBus)==null||nt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:at,willCommit:!0,commitKey:1,selStart:tt.selectionStart,selEnd:tt.selectionEnd}}))}};this._dispatchEventFromSandbox(ze,Le)}),q.addEventListener("keydown",Le=>{var Je;ke.commitKey=1;let ze=-1;if(Le.key==="Escape"?ze=0:Le.key==="Enter"&&!this.data.multiLine?ze=2:Le.key==="Tab"&&(ke.commitKey=3),ze===-1)return;const{value:je}=Le.target;ke.lastCommittedValue!==je&&(ke.lastCommittedValue=je,ke.userValue=je,(Je=this.linkService.eventBus)==null||Je.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:je,willCommit:!0,commitKey:ze,selStart:Le.target.selectionStart,selEnd:Le.target.selectionEnd}}))});const Fe=He;He=null,q.addEventListener("blur",Le=>{var je;if(!Le.relatedTarget)return;const{value:ze}=Le.target;ke.userValue=ze,ke.lastCommittedValue!==ze&&((je=this.linkService.eventBus)==null||je.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:ze,willCommit:!0,commitKey:ke.commitKey,selStart:Le.target.selectionStart,selEnd:Le.target.selectionEnd}})),Fe(Le)}),(J=this.data.actions)!=null&&J.Keystroke&&q.addEventListener("beforeinput",Le=>{var lt;ke.lastCommittedValue=null;const{data:ze,target:je}=Le,{value:Je,selectionStart:tt,selectionEnd:at}=je;let nt=tt,ct=at;switch(Le.inputType){case"deleteWordBackward":{const ht=Je.substring(0,tt).match(/\w*[^\w]*$/);ht&&(nt-=ht[0].length);break}case"deleteWordForward":{const ht=Je.substring(tt).match(/^[^\w]*\w*/);ht&&(ct+=ht[0].length);break}case"deleteContentBackward":tt===at&&(nt-=1);break;case"deleteContentForward":tt===at&&(ct+=1);break}Le.preventDefault(),(lt=this.linkService.eventBus)==null||lt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:Je,change:ze||"",willCommit:!1,selStart:nt,selEnd:ct}})}),this._setEventListeners(q,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Le=>Le.target.value)}if(He&&q.addEventListener("blur",He),this.data.comb){const Le=(this.data.rect[2]-this.data.rect[0])/Pe;q.classList.add("comb"),q.style.letterSpacing=`calc(${Le}px * var(--scale-factor) - 1ch)`}}else q=document.createElement("div"),q.textContent=this.data.fieldValue,q.style.verticalAlign="middle",q.style.display="table-cell";return this._setTextStyle(q),this._setBackgroundColor(q),this._setDefaultPropertiesFromJS(q),this.container.append(q),this.container}}class R extends v{constructor(W){super(W,{isRenderable:!!W.data.hasOwnCanvas})}}class N extends v{constructor(W){super(W,{isRenderable:W.renderForms})}render(){const W=this.annotationStorage,I=this.data,q=I.id;let H=W.getValue(q,{value:I.exportValue===I.fieldValue}).value;typeof H=="string"&&(H=H!=="Off",W.setValue(q,{value:H})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const J=document.createElement("input");return p.add(J),J.setAttribute("data-element-id",q),J.disabled=I.readOnly,this._setRequired(J,this.data.required),J.type="checkbox",J.name=I.baseFieldName||I.fieldName,H&&J.setAttribute("checked",!0),J.setAttribute("exportValue",I.exportValue),J.tabIndex=c,J.addEventListener("change",le=>{const{name:xe,checked:Pe}=le.target;for(const We of this._getElementsByName(xe,q)){const ke=Pe&&We.exportValue===I.exportValue;We.domElement&&(We.domElement.checked=ke),W.setValue(We.id,{value:ke})}W.setValue(q,{value:Pe})}),J.addEventListener("resetform",le=>{const xe=I.defaultFieldValue||"Off";le.target.checked=xe===I.exportValue}),this.enableScripting&&this.hasJSActions&&(J.addEventListener("updatefromsandbox",le=>{const xe={value(Pe){Pe.target.checked=Pe.detail.value!=="Off",W.setValue(q,{value:Pe.target.checked})}};this._dispatchEventFromSandbox(xe,le)}),this._setEventListeners(J,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],le=>le.target.checked)),this._setBackgroundColor(J),this._setDefaultPropertiesFromJS(J),this.container.append(J),this.container}}class m extends v{constructor(W){super(W,{isRenderable:W.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const W=this.annotationStorage,I=this.data,q=I.id;let H=W.getValue(q,{value:I.fieldValue===I.buttonValue}).value;typeof H=="string"&&(H=H!==I.buttonValue,W.setValue(q,{value:H}));const J=document.createElement("input");if(p.add(J),J.setAttribute("data-element-id",q),J.disabled=I.readOnly,this._setRequired(J,this.data.required),J.type="radio",J.name=I.baseFieldName||I.fieldName,H&&J.setAttribute("checked",!0),J.tabIndex=c,J.addEventListener("change",le=>{const{name:xe,checked:Pe}=le.target;for(const We of this._getElementsByName(xe,q))W.setValue(We.id,{value:!1});W.setValue(q,{value:Pe})}),J.addEventListener("resetform",le=>{const xe=I.defaultFieldValue;le.target.checked=xe!=null&&xe===I.buttonValue}),this.enableScripting&&this.hasJSActions){const le=I.buttonValue;J.addEventListener("updatefromsandbox",xe=>{const Pe={value:We=>{const ke=le===We.detail.value;for(const He of this._getElementsByName(We.target.name)){const Fe=ke&&He.id===q;He.domElement&&(He.domElement.checked=Fe),W.setValue(He.id,{value:Fe})}}};this._dispatchEventFromSandbox(Pe,xe)}),this._setEventListeners(J,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],xe=>xe.target.checked)}return this._setBackgroundColor(J),this._setDefaultPropertiesFromJS(J),this.container.append(J),this.container}}class b extends d{constructor(W){super(W,{ignoreBorder:W.data.hasAppearance})}render(){const W=super.render();W.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(W.title=this.data.alternativeText);const I=W.lastChild;return this.enableScripting&&this.hasJSActions&&I&&(this._setDefaultPropertiesFromJS(I),I.addEventListener("updatefromsandbox",q=>{this._dispatchEventFromSandbox({},q)})),W}}class P extends v{constructor(W){super(W,{isRenderable:W.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const W=this.annotationStorage,I=this.data.id,q=W.getValue(I,{value:this.data.fieldValue}),H=document.createElement("select");p.add(H),H.setAttribute("data-element-id",I),H.disabled=this.data.readOnly,this._setRequired(H,this.data.required),H.name=this.data.baseFieldName||this.data.fieldName,H.tabIndex=c;let J=this.data.combo&&this.data.options.length>0;this.data.combo||(H.size=this.data.options.length,this.data.multiSelect&&(H.multiple=!0)),H.addEventListener("resetform",ke=>{const He=this.data.defaultFieldValue;for(const Fe of H.options)Fe.selected=Fe.value===He});for(const ke of this.data.options){const He=document.createElement("option");He.textContent=ke.displayValue,He.value=ke.exportValue,q.value.includes(ke.exportValue)&&(He.setAttribute("selected",!0),J=!1),H.append(He)}let le=null;if(J){const ke=document.createElement("option");ke.value=" ",ke.setAttribute("hidden",!0),ke.setAttribute("selected",!0),H.prepend(ke),le=()=>{ke.remove(),H.removeEventListener("input",le),le=null},H.addEventListener("input",le)}const xe=ke=>{const He=ke?"value":"textContent",{options:Fe,multiple:Le}=H;return Le?Array.prototype.filter.call(Fe,ze=>ze.selected).map(ze=>ze[He]):Fe.selectedIndex===-1?null:Fe[Fe.selectedIndex][He]};let Pe=xe(!1);const We=ke=>{const He=ke.target.options;return Array.prototype.map.call(He,Fe=>({displayValue:Fe.textContent,exportValue:Fe.value}))};return this.enableScripting&&this.hasJSActions?(H.addEventListener("updatefromsandbox",ke=>{const He={value(Fe){le==null||le();const Le=Fe.detail.value,ze=new Set(Array.isArray(Le)?Le:[Le]);for(const je of H.options)je.selected=ze.has(je.value);W.setValue(I,{value:xe(!0)}),Pe=xe(!1)},multipleSelection(Fe){H.multiple=!0},remove(Fe){const Le=H.options,ze=Fe.detail.remove;Le[ze].selected=!1,H.remove(ze),Le.length>0&&Array.prototype.findIndex.call(Le,Je=>Je.selected)===-1&&(Le[0].selected=!0),W.setValue(I,{value:xe(!0),items:We(Fe)}),Pe=xe(!1)},clear(Fe){for(;H.length!==0;)H.remove(0);W.setValue(I,{value:null,items:[]}),Pe=xe(!1)},insert(Fe){const{index:Le,displayValue:ze,exportValue:je}=Fe.detail.insert,Je=H.children[Le],tt=document.createElement("option");tt.textContent=ze,tt.value=je,Je?Je.before(tt):H.append(tt),W.setValue(I,{value:xe(!0),items:We(Fe)}),Pe=xe(!1)},items(Fe){const{items:Le}=Fe.detail;for(;H.length!==0;)H.remove(0);for(const ze of Le){const{displayValue:je,exportValue:Je}=ze,tt=document.createElement("option");tt.textContent=je,tt.value=Je,H.append(tt)}H.options.length>0&&(H.options[0].selected=!0),W.setValue(I,{value:xe(!0),items:We(Fe)}),Pe=xe(!1)},indices(Fe){const Le=new Set(Fe.detail.indices);for(const ze of Fe.target.options)ze.selected=Le.has(ze.index);W.setValue(I,{value:xe(!0)}),Pe=xe(!1)},editable(Fe){Fe.target.disabled=!Fe.detail.editable}};this._dispatchEventFromSandbox(He,ke)}),H.addEventListener("input",ke=>{var Fe;const He=xe(!0);W.setValue(I,{value:He}),ke.preventDefault(),(Fe=this.linkService.eventBus)==null||Fe.dispatch("dispatcheventinsandbox",{source:this,detail:{id:I,name:"Keystroke",value:Pe,changeEx:He,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(H,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],ke=>ke.target.value)):H.addEventListener("input",function(ke){W.setValue(I,{value:xe(!0)})}),this.data.combo&&this._setTextStyle(H),this._setBackgroundColor(H),this._setDefaultPropertiesFromJS(H),this.container.append(H),this.container}}class x extends h{constructor(W){var J,le,xe;const{data:I,elements:q}=W,H=!!((J=I.titleObj)!=null&&J.str||(le=I.contentsObj)!=null&&le.str||(xe=I.richText)!=null&&xe.str);super(W,{isRenderable:H}),this.elements=q}render(){this.container.classList.add("popupAnnotation");const W=new S({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),I=[];for(const q of this.elements)q.popup=W,I.push(q.data.id),q.addHighlightArea();return this.container.setAttribute("aria-controls",I.join(",")),this.container}}class S{constructor(W){re(this,_e);re(this,Ge);re(this,$e);re(this,U,null);re(this,te,me(this,$e,un).bind(this));re(this,pe,me(this,Ge,ln).bind(this));re(this,ue,me(this,_e,cn).bind(this));re(this,ve,null);re(this,se,null);re(this,ge,null);re(this,Ee,null);re(this,Oe,null);re(this,Me,null);re(this,we,!1);re(this,Ue,null);re(this,Ne,null);re(this,Ae,null);re(this,de,null);re(this,Te,!1);let{container:I,color:q,elements:H,titleObj:J,modificationDate:le,contentsObj:xe,richText:Pe,parent:We,rect:ke,parentRect:He,open:Fe}=W;ye(this,se,I),ye(this,de,J),ye(this,ge,xe),ye(this,Ae,Pe),ye(this,Oe,We),ye(this,ve,q),ye(this,Ne,ke),ye(this,Me,He),ye(this,Ee,H);const Le=s.PDFDateString.toDateObject(le);Le&&ye(this,U,We.l10n.get("annotation_date_string",{date:Le.toLocaleDateString(),time:Le.toLocaleTimeString()})),this.trigger=H.flatMap(ze=>ze.getElementsToTriggerPopup());for(const ze of this.trigger)ze.addEventListener("click",_(this,ue)),ze.addEventListener("mouseenter",_(this,pe)),ze.addEventListener("mouseleave",_(this,te));_(this,se).hidden=!0,Fe&&me(this,_e,cn).call(this)}render(){if(_(this,Ue))return;const{page:{view:W},viewport:{rawDims:{pageWidth:I,pageHeight:q,pageX:H,pageY:J}}}=_(this,Oe),le=ye(this,Ue,document.createElement("div"));if(le.className="popup",_(this,ve)){const nt=le.style.outlineColor=n.Util.makeHexColor(..._(this,ve));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?le.style.backgroundColor=`color-mix(in srgb, ${nt} 30%, white)`:le.style.backgroundColor=n.Util.makeHexColor(..._(this,ve).map(lt=>Math.floor(.7*(255-lt)+lt)))}const xe=document.createElement("span");xe.className="header";const Pe=document.createElement("h1");if(xe.append(Pe),{dir:Pe.dir,str:Pe.textContent}=_(this,de),le.append(xe),_(this,U)){const nt=document.createElement("span");nt.classList.add("popupDate"),_(this,U).then(ct=>{nt.textContent=ct}),xe.append(nt)}const We=_(this,ge),ke=_(this,Ae);if(ke!=null&&ke.str&&(!(We!=null&&We.str)||We.str===ke.str))l.XfaLayer.render({xfaHtml:ke.html,intent:"richText",div:le}),le.lastChild.classList.add("richText","popupContent");else{const nt=this._formatContents(We);le.append(nt)}let He=!!_(this,Me),Fe=He?_(this,Me):_(this,Ne);for(const nt of _(this,Ee))if(!Fe||n.Util.intersect(nt.data.rect,Fe)!==null){Fe=nt.data.rect,He=!0;break}const Le=n.Util.normalizeRect([Fe[0],W[3]-Fe[1]+W[1],Fe[2],W[3]-Fe[3]+W[1]]),ze=5,je=He?Fe[2]-Fe[0]+ze:0,Je=Le[0]+je,tt=Le[1],{style:at}=_(this,se);at.left=`${100*(Je-H)/I}%`,at.top=`${100*(tt-J)/q}%`,_(this,se).append(le)}_formatContents(W){let{str:I,dir:q}=W;const H=document.createElement("p");H.classList.add("popupContent"),H.dir=q;const J=I.split(/(?:\r\n?|\n)/);for(let le=0,xe=J.length;le<xe;++le){const Pe=J[le];H.append(document.createTextNode(Pe)),le<xe-1&&H.append(document.createElement("br"))}return H}forceHide(){ye(this,Te,this.isVisible),_(this,Te)&&(_(this,se).hidden=!0)}maybeShow(){_(this,Te)&&(ye(this,Te,!1),_(this,se).hidden=!1)}get isVisible(){return _(this,se).hidden===!1}}U=new WeakMap,te=new WeakMap,pe=new WeakMap,ue=new WeakMap,ve=new WeakMap,se=new WeakMap,ge=new WeakMap,Ee=new WeakMap,Oe=new WeakMap,Me=new WeakMap,we=new WeakMap,Ue=new WeakMap,Ne=new WeakMap,Ae=new WeakMap,de=new WeakMap,Te=new WeakMap,_e=new WeakSet,cn=function(){ye(this,we,!_(this,we)),_(this,we)?(me(this,Ge,ln).call(this),_(this,se).addEventListener("click",_(this,ue))):(me(this,$e,un).call(this),_(this,se).removeEventListener("click",_(this,ue)))},Ge=new WeakSet,ln=function(){_(this,Ue)||this.render(),this.isVisible?_(this,we)&&_(this,se).classList.add("focused"):(_(this,se).hidden=!1,_(this,se).style.zIndex=parseInt(_(this,se).style.zIndex)+1e3)},$e=new WeakSet,un=function(){_(this,se).classList.remove("focused"),!(_(this,we)||!this.isVisible)&&(_(this,se).hidden=!0,_(this,se).style.zIndex=parseInt(_(this,se).style.zIndex)-1e3)};class w extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0}),this.textContent=W.data.textContent,this.textPosition=W.data.textPosition,this.annotationEditorType=n.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const W=document.createElement("div");W.classList.add("annotationTextContent"),W.setAttribute("role","comment");for(const I of this.textContent){const q=document.createElement("span");q.textContent=I,W.append(q)}this.container.append(W)}return this.data.popupRef||this._createPopup(),this._editOnDoubleClick(),this.container}}e.FreeTextAnnotationElement=w;class E extends h{constructor(I){var H,J,le;const q=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(J=I.data.contentsObj)!=null&&J.str||(le=I.data.richText)!=null&&le.str);super(I,{isRenderable:q,ignoreBorder:!0});re(this,Qe,null)}render(){this.container.classList.add("lineAnnotation");const I=this.data,{width:q,height:H}=g(I.rect),J=this.svgFactory.create(q,H,!0),le=ye(this,Qe,this.svgFactory.createElement("svg:line"));return le.setAttribute("x1",I.rect[2]-I.lineCoordinates[0]),le.setAttribute("y1",I.rect[3]-I.lineCoordinates[1]),le.setAttribute("x2",I.rect[2]-I.lineCoordinates[2]),le.setAttribute("y2",I.rect[3]-I.lineCoordinates[3]),le.setAttribute("stroke-width",I.borderStyle.width||1),le.setAttribute("stroke","transparent"),le.setAttribute("fill","transparent"),J.append(le),this.container.append(J),I.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return _(this,Qe)}addHighlightArea(){this.container.classList.add("highlightArea")}}Qe=new WeakMap;class V extends h{constructor(I){var H,J,le;const q=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(J=I.data.contentsObj)!=null&&J.str||(le=I.data.richText)!=null&&le.str);super(I,{isRenderable:q,ignoreBorder:!0});re(this,qe,null)}render(){this.container.classList.add("squareAnnotation");const I=this.data,{width:q,height:H}=g(I.rect),J=this.svgFactory.create(q,H,!0),le=I.borderStyle.width,xe=ye(this,qe,this.svgFactory.createElement("svg:rect"));return xe.setAttribute("x",le/2),xe.setAttribute("y",le/2),xe.setAttribute("width",q-le),xe.setAttribute("height",H-le),xe.setAttribute("stroke-width",le||1),xe.setAttribute("stroke","transparent"),xe.setAttribute("fill","transparent"),J.append(xe),this.container.append(J),I.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return _(this,qe)}addHighlightArea(){this.container.classList.add("highlightArea")}}qe=new WeakMap;class $ extends h{constructor(I){var H,J,le;const q=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(J=I.data.contentsObj)!=null&&J.str||(le=I.data.richText)!=null&&le.str);super(I,{isRenderable:q,ignoreBorder:!0});re(this,Ye,null)}render(){this.container.classList.add("circleAnnotation");const I=this.data,{width:q,height:H}=g(I.rect),J=this.svgFactory.create(q,H,!0),le=I.borderStyle.width,xe=ye(this,Ye,this.svgFactory.createElement("svg:ellipse"));return xe.setAttribute("cx",q/2),xe.setAttribute("cy",H/2),xe.setAttribute("rx",q/2-le/2),xe.setAttribute("ry",H/2-le/2),xe.setAttribute("stroke-width",le||1),xe.setAttribute("stroke","transparent"),xe.setAttribute("fill","transparent"),J.append(xe),this.container.append(J),I.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return _(this,Ye)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ye=new WeakMap;class j extends h{constructor(I){var H,J,le;const q=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(J=I.data.contentsObj)!=null&&J.str||(le=I.data.richText)!=null&&le.str);super(I,{isRenderable:q,ignoreBorder:!0});re(this,Se,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const I=this.data,{width:q,height:H}=g(I.rect),J=this.svgFactory.create(q,H,!0);let le=[];for(const Pe of I.vertices){const We=Pe.x-I.rect[0],ke=I.rect[3]-Pe.y;le.push(We+","+ke)}le=le.join(" ");const xe=ye(this,Se,this.svgFactory.createElement(this.svgElementName));return xe.setAttribute("points",le),xe.setAttribute("stroke-width",I.borderStyle.width||1),xe.setAttribute("stroke","transparent"),xe.setAttribute("fill","transparent"),J.append(xe),this.container.append(J),I.popupRef||this._createPopup(xe,I),this.container}getElementsToTriggerPopup(){return _(this,Se)}addHighlightArea(){this.container.classList.add("highlightArea")}}Se=new WeakMap;class D extends j{constructor(W){super(W),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Y extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class G extends h{constructor(I){var H,J,le;const q=!!(I.data.popupRef||(H=I.data.titleObj)!=null&&H.str||(J=I.data.contentsObj)!=null&&J.str||(le=I.data.richText)!=null&&le.str);super(I,{isRenderable:q,ignoreBorder:!0});re(this,ce,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=n.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const I=this.data,{width:q,height:H}=g(I.rect),J=this.svgFactory.create(q,H,!0);for(const le of I.inkLists){let xe=[];for(const We of le){const ke=We.x-I.rect[0],He=I.rect[3]-We.y;xe.push(`${ke},${He}`)}xe=xe.join(" ");const Pe=this.svgFactory.createElement(this.svgElementName);_(this,ce).push(Pe),Pe.setAttribute("points",xe),Pe.setAttribute("stroke-width",I.borderStyle.width||1),Pe.setAttribute("stroke","transparent"),Pe.setAttribute("fill","transparent"),I.popupRef||this._createPopup(Pe,I),J.append(Pe)}return this.container.append(J),this.container}getElementsToTriggerPopup(){return _(this,ce)}addHighlightArea(){this.container.classList.add("highlightArea")}}ce=new WeakMap,e.InkAnnotationElement=G;class X extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Z extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class ne extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ie extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class be extends h{constructor(W){var q,H,J;const I=!!(W.data.popupRef||(q=W.data.titleObj)!=null&&q.str||(H=W.data.contentsObj)!=null&&H.str||(J=W.data.richText)!=null&&J.str);super(W,{isRenderable:I,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}e.StampAnnotationElement=be;class Q extends h{constructor(I){var J;super(I,{isRenderable:!0});re(this,oe,null);const{filename:q,content:H}=this.data.file;this.filename=(0,s.getFilenameFromUrl)(q,!0),this.content=H,(J=this.linkService.eventBus)==null||J.dispatch("fileattachmentannotation",{source:this,filename:q,content:H})}render(){var q,H;this.container.classList.add("fileAttachmentAnnotation");let I;return this.data.hasAppearance?I=document.createElement("div"):(I=document.createElement("img"),I.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),I.classList.add("popupTriggerArea"),I.addEventListener("dblclick",this._download.bind(this)),ye(this,oe,I),!this.data.popupRef&&((q=this.data.titleObj)!=null&&q.str||(H=this.data.contentsObj)!=null&&H.str||this.data.richText)&&this._createPopup(),this.container.append(I),this.container}getElementsToTriggerPopup(){return _(this,oe)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var I;(I=this.downloadManager)==null||I.openOrDownloadData(this.container,this.content,this.filename)}}oe=new WeakMap;class O{constructor(W){re(this,fe);re(this,ee);re(this,Re,null);re(this,Ie,null);re(this,et,new Map);let{div:I,accessibilityManager:q,annotationCanvasMap:H,l10n:J,page:le,viewport:xe}=W;this.div=I,ye(this,Re,q),ye(this,Ie,H),this.l10n=J,this.page=le,this.viewport=xe,this.zIndex=0,this.l10n||(this.l10n=a.NullL10n)}async render(W){const{annotations:I}=W,q=this.div;(0,s.setLayerDimensions)(q,this.viewport);const H=new Map,J={data:null,layer:q,linkService:W.linkService,downloadManager:W.downloadManager,imageResourcesPath:W.imageResourcesPath||"",renderForms:W.renderForms!==!1,svgFactory:new s.DOMSVGFactory,annotationStorage:W.annotationStorage||new i.AnnotationStorage,enableScripting:W.enableScripting===!0,hasJSActions:W.hasJSActions,fieldObjects:W.fieldObjects,parent:this,elements:null};for(const le of I){if(le.noHTML)continue;const xe=le.annotationType===n.AnnotationType.POPUP;if(xe){const ke=H.get(le.id);if(!ke)continue;J.elements=ke}else{const{width:ke,height:He}=g(le.rect);if(ke<=0||He<=0)continue}J.data=le;const Pe=y.create(J);if(!Pe.isRenderable)continue;if(!xe&&le.popupRef){const ke=H.get(le.popupRef);ke?ke.push(Pe):H.set(le.popupRef,[Pe])}Pe.annotationEditorType>0&&_(this,et).set(Pe.data.id,Pe);const We=Pe.render();le.hidden&&(We.style.visibility="hidden"),me(this,fe,Un).call(this,We,le.id)}me(this,ee,hn).call(this),await this.l10n.translate(q)}update(W){let{viewport:I}=W;const q=this.div;this.viewport=I,(0,s.setLayerDimensions)(q,{rotation:I.rotation}),me(this,ee,hn).call(this),q.hidden=!1}getEditableAnnotations(){return Array.from(_(this,et).values())}getEditableAnnotation(W){return _(this,et).get(W)}}Re=new WeakMap,Ie=new WeakMap,et=new WeakMap,fe=new WeakSet,Un=function(W,I){var H;const q=W.firstChild||W;q.id=`${s.AnnotationPrefix}${I}`,this.div.append(W),(H=_(this,Re))==null||H.moveElementInDOM(this.div,W,q,!1)},ee=new WeakSet,hn=function(){if(!_(this,Ie))return;const W=this.div;for(const[I,q]of _(this,Ie)){const H=W.querySelector(`[data-annotation-id="${I}"]`);if(!H)continue;const{firstChild:J}=H;J?J.nodeName==="CANVAS"?J.replaceWith(q):J.before(q):H.append(q)}_(this,Ie).clear()},e.AnnotationLayer=O},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}class n{static CMYK_G(i){let[o,a,l,c]=i;return["G",1-Math.min(1,.3*o+.59*l+.11*a+c)]}static G_CMYK(i){let[o]=i;return["CMYK",0,0,0,1-o]}static G_RGB(i){let[o]=i;return["RGB",o,o,o]}static G_HTML(i){let[o]=i;const a=t(o);return`#${a}${a}${a}`}static RGB_G(i){let[o,a,l]=i;return["G",.3*o+.59*a+.11*l]}static RGB_HTML(i){let[o,a,l]=i;const c=t(o),u=t(a),p=t(l);return`#${c}${u}${p}`}static T_HTML(){return"#00000000"}static CMYK_RGB(i){let[o,a,l,c]=i;return["RGB",1-Math.min(1,o+c),1-Math.min(1,l+c),1-Math.min(1,a+c)]}static CMYK_HTML(i){const o=this.CMYK_RGB(i).slice(1);return this.RGB_HTML(o)}static RGB_CMYK(i){let[o,a,l]=i;const c=1-o,u=1-a,p=1-l,g=Math.min(c,u,p);return["CMYK",c,u,p,g]}}e.ColorConverters=n},(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NullL10n=void 0,e.getL10nFallback=n;const t={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};t.print_progress_percent="{{progress}}%";function n(o,a){switch(o){case"find_match_count":o=`find_match_count[${a.total===1?"one":"other"}]`;break;case"find_match_count_limit":o=`find_match_count_limit[${a.limit===1?"one":"other"}]`;break}return t[o]||""}function s(o,a){return a?o.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(l,c)=>c in a?a[c]:"{{"+c+"}}"):o}const i={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:n(o,a);return s(l,a)},async translate(o){}};e.NullL10n=i},(r,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0,t(89);var n=t(193);class s{static setupStorage(o,a,l,c,u){const p=c.getValue(a,{value:null});switch(l.name){case"textarea":if(p.value!==null&&(o.textContent=p.value),u==="print")break;o.addEventListener("input",g=>{c.setValue(a,{value:g.target.value})});break;case"input":if(l.attributes.type==="radio"||l.attributes.type==="checkbox"){if(p.value===l.attributes.xfaOn?o.setAttribute("checked",!0):p.value===l.attributes.xfaOff&&o.removeAttribute("checked"),u==="print")break;o.addEventListener("change",g=>{c.setValue(a,{value:g.target.checked?g.target.getAttribute("xfaOn"):g.target.getAttribute("xfaOff")})})}else{if(p.value!==null&&o.setAttribute("value",p.value),u==="print")break;o.addEventListener("input",g=>{c.setValue(a,{value:g.target.value})})}break;case"select":if(p.value!==null){o.setAttribute("value",p.value);for(const g of l.children)g.attributes.value===p.value?g.attributes.selected=!0:g.attributes.hasOwnProperty("selected")&&delete g.attributes.selected}o.addEventListener("input",g=>{const y=g.target.options,h=y.selectedIndex===-1?"":y[y.selectedIndex].value;c.setValue(a,{value:h})});break}}static setAttributes(o){let{html:a,element:l,storage:c=null,intent:u,linkService:p}=o;const{attributes:g}=l,y=a instanceof HTMLAnchorElement;g.type==="radio"&&(g.name=`${g.name}-${u}`);for(const[h,d]of Object.entries(g))if(d!=null)switch(h){case"class":d.length&&a.setAttribute(h,d.join(" "));break;case"dataId":break;case"id":a.setAttribute("data-element-id",d);break;case"style":Object.assign(a.style,d);break;case"textContent":a.textContent=d;break;default:(!y||h!=="href"&&h!=="newWindow")&&a.setAttribute(h,d)}y&&p.addLinkAttributes(a,g.href,g.newWindow),c&&g.dataId&&this.setupStorage(a,g.dataId,l,c)}static render(o){var d;const a=o.annotationStorage,l=o.linkService,c=o.xfaHtml,u=o.intent||"display",p=document.createElement(c.name);c.attributes&&this.setAttributes({html:p,element:c,intent:u,linkService:l});const g=[[c,-1,p]],y=o.div;if(y.append(p),o.viewport){const f=`matrix(${o.viewport.transform.join(",")})`;y.style.transform=f}u!=="richText"&&y.setAttribute("class","xfaLayer xfaFont");const h=[];for(;g.length>0;){const[f,v,T]=g.at(-1);if(v+1===f.children.length){g.pop();continue}const R=f.children[++g.at(-1)[1]];if(R===null)continue;const{name:N}=R;if(N==="#text"){const b=document.createTextNode(R.value);h.push(b),T.append(b);continue}const m=(d=R==null?void 0:R.attributes)!=null&&d.xmlns?document.createElementNS(R.attributes.xmlns,N):document.createElement(N);if(T.append(m),R.attributes&&this.setAttributes({html:m,element:R,storage:a,intent:u,linkService:l}),R.children&&R.children.length>0)g.push([R,-1,m]);else if(R.value){const b=document.createTextNode(R.value);n.XfaText.shouldBuildText(N)&&h.push(b),m.append(b)}}for(const f of y.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))f.setAttribute("readOnly",!0);return{textDivs:h}}static update(o){const a=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=a,o.div.hidden=!1}}e.XfaLayer=s},(r,e,t)=>{var l,c,u,p,g,y,h,d,f,v,T,R,N,m,b,P,Gn,S,zn,E,$n,$,Hn,D,dn,G,Xn,Z,fn,ie,Yn,Q,jn,k,Kn,z,Zn,K,Qn,te,mt,ue,pn,se,Bt,Ee,Vt,Me,xt,Ue,mn,Ae,Wt,Te,qn,Ve,gn,Ke,Jn,Ze,er,qe,vn,Se,Ut,oe,wt;Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,t(89),t(2);var n=t(1),s=t(163),i=t(197),o=t(164);const Ie=class Ie extends s.AnnotationEditor{constructor(M){super({...M,name:"inkEditor"});re(this,P);re(this,S);re(this,E);re(this,$);re(this,D);re(this,G);re(this,Z);re(this,ie);re(this,Q);re(this,k);re(this,z);re(this,K);re(this,te);re(this,ue);re(this,se);re(this,Ee);re(this,Me);re(this,Ue);re(this,Ae);re(this,Ze);re(this,qe);re(this,Se);re(this,oe);re(this,l,0);re(this,c,0);re(this,u,this.canvasContextMenu.bind(this));re(this,p,this.canvasPointermove.bind(this));re(this,g,this.canvasPointerleave.bind(this));re(this,y,this.canvasPointerup.bind(this));re(this,h,this.canvasPointerdown.bind(this));re(this,d,new Path2D);re(this,f,!1);re(this,v,!1);re(this,T,!1);re(this,R,null);re(this,N,0);re(this,m,0);re(this,b,null);this.color=M.color||null,this.thickness=M.thickness||null,this.opacity=M.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(M){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(ee=>[ee,M.get(ee)]))}static updateDefaultParams(M,ee){switch(M){case n.AnnotationEditorParamsType.INK_THICKNESS:Ie._defaultThickness=ee;break;case n.AnnotationEditorParamsType.INK_COLOR:Ie._defaultColor=ee;break;case n.AnnotationEditorParamsType.INK_OPACITY:Ie._defaultOpacity=ee/100;break}}updateParams(M,ee){switch(M){case n.AnnotationEditorParamsType.INK_THICKNESS:me(this,P,Gn).call(this,ee);break;case n.AnnotationEditorParamsType.INK_COLOR:me(this,S,zn).call(this,ee);break;case n.AnnotationEditorParamsType.INK_OPACITY:me(this,E,$n).call(this,ee);break}}static get defaultPropertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,Ie._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,Ie._defaultColor||s.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(Ie._defaultOpacity*100)]]}get propertiesToUpdate(){return[[n.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Ie._defaultThickness],[n.AnnotationEditorParamsType.INK_COLOR,this.color||Ie._defaultColor||s.AnnotationEditor._defaultLineColor],[n.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??Ie._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(me(this,se,Bt).call(this),me(this,Ee,Vt).call(this)),this.isAttachedToDOM||(this.parent.add(this),me(this,Me,xt).call(this)),me(this,oe,wt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,_(this,R).disconnect(),ye(this,R,null),super.remove())}setParent(M){!this.parent&&M?this._uiManager.removeShouldRescale(this):this.parent&&M===null&&this._uiManager.addShouldRescale(this),super.setParent(M)}onScaleChanging(){const[M,ee]=this.parentDimensions,he=this.width*M,ae=this.height*ee;this.setDimensions(he,ae)}enableEditMode(){_(this,f)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",_(this,h)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",_(this,h)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){_(this,f)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),ye(this,f,!0),this.div.classList.add("disabled"),me(this,oe,wt).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(M){super.focusin(M),this.enableEditMode()}canvasPointerdown(M){M.button!==0||!this.isInEditMode()||_(this,f)||(this.setInForeground(),M.preventDefault(),M.type!=="mouse"&&this.div.focus(),me(this,G,Xn).call(this,M.offsetX,M.offsetY))}canvasContextMenu(M){M.preventDefault()}canvasPointermove(M){M.preventDefault(),me(this,Z,fn).call(this,M.offsetX,M.offsetY)}canvasPointerup(M){M.preventDefault(),me(this,ue,pn).call(this,M)}canvasPointerleave(M){me(this,ue,pn).call(this,M)}get isResizable(){return!this.isEmpty()&&_(this,f)}render(){if(this.div)return this.div;let M,ee;this.width&&(M=this.x,ee=this.y),super.render(),Ie._l10nPromise.get("editor_ink2_aria_label").then(q=>{var H;return(H=this.div)==null?void 0:H.setAttribute("aria-label",q)});const[he,ae,W,I]=me(this,$,Hn).call(this);if(this.setAt(he,ae,0,0),this.setDims(W,I),me(this,se,Bt).call(this),this.width){const[q,H]=this.parentDimensions;this.setAspectRatio(this.width*q,this.height*H),this.setAt(M*q,ee*H,this.width*q,this.height*H),ye(this,T,!0),me(this,Me,xt).call(this),this.setDims(this.width*q,this.height*H),me(this,te,mt).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return me(this,Ee,Vt).call(this),this.div}setDimensions(M,ee){const he=Math.round(M),ae=Math.round(ee);if(_(this,N)===he&&_(this,m)===ae)return;ye(this,N,he),ye(this,m,ae),this.canvas.style.visibility="hidden";const[W,I]=this.parentDimensions;this.width=M/W,this.height=ee/I,this.fixAndSetPosition(),_(this,f)&&me(this,Ue,mn).call(this,M,ee),me(this,Me,xt).call(this),me(this,te,mt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(M,ee,he){var He,Fe,Le;if(M instanceof i.InkAnnotationElement)return null;const ae=super.deserialize(M,ee,he);ae.thickness=M.thickness,ae.color=n.Util.makeHexColor(...M.color),ae.opacity=M.opacity;const[W,I]=ae.pageDimensions,q=ae.width*W,H=ae.height*I,J=ae.parentScale,le=M.thickness/2;ye(ae,f,!0),ye(ae,N,Math.round(q)),ye(ae,m,Math.round(H));const{paths:xe,rect:Pe,rotation:We}=M;for(let{bezier:ze}of xe){ze=me(He=Ie,Ke,Jn).call(He,ze,Pe,We);const je=[];ae.paths.push(je);let Je=J*(ze[0]-le),tt=J*(ze[1]-le);for(let nt=2,ct=ze.length;nt<ct;nt+=6){const lt=J*(ze[nt]-le),ht=J*(ze[nt+1]-le),dt=J*(ze[nt+2]-le),At=J*(ze[nt+3]-le),gt=J*(ze[nt+4]-le),_t=J*(ze[nt+5]-le);je.push([[Je,tt],[lt,ht],[dt,At],[gt,_t]]),Je=gt,tt=_t}const at=me(this,Te,qn).call(this,je);ae.bezierPath2D.push(at)}const ke=me(Fe=ae,qe,vn).call(Fe);return ye(ae,c,Math.max(s.AnnotationEditor.MIN_SIZE,ke[2]-ke[0])),ye(ae,l,Math.max(s.AnnotationEditor.MIN_SIZE,ke[3]-ke[1])),me(Le=ae,Ue,mn).call(Le,q,H),ae}serialize(){if(this.isEmpty())return null;const M=this.getRect(0,0),ee=s.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:n.AnnotationEditorType.INK,color:ee,thickness:this.thickness,opacity:this.opacity,paths:me(this,Ze,er).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,M),pageIndex:this.pageIndex,rect:M,rotation:this.rotation}}};l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,v=new WeakMap,T=new WeakMap,R=new WeakMap,N=new WeakMap,m=new WeakMap,b=new WeakMap,P=new WeakSet,Gn=function(M){const ee=this.thickness;this.addCommands({cmd:()=>{this.thickness=M,me(this,oe,wt).call(this)},undo:()=>{this.thickness=ee,me(this,oe,wt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},S=new WeakSet,zn=function(M){const ee=this.color;this.addCommands({cmd:()=>{this.color=M,me(this,te,mt).call(this)},undo:()=>{this.color=ee,me(this,te,mt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},E=new WeakSet,$n=function(M){M/=100;const ee=this.opacity;this.addCommands({cmd:()=>{this.opacity=M,me(this,te,mt).call(this)},undo:()=>{this.opacity=ee,me(this,te,mt).call(this)},mustExec:!0,type:n.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},$=new WeakSet,Hn=function(){const{parentRotation:M,parentDimensions:[ee,he]}=this;switch(M){case 90:return[0,he,he,ee];case 180:return[ee,he,ee,he];case 270:return[ee,0,he,ee];default:return[0,0,ee,he]}},D=new WeakSet,dn=function(){const{ctx:M,color:ee,opacity:he,thickness:ae,parentScale:W,scaleFactor:I}=this;M.lineWidth=ae*W/I,M.lineCap="round",M.lineJoin="round",M.miterLimit=10,M.strokeStyle=`${ee}${(0,o.opacityToHex)(he)}`},G=new WeakSet,Xn=function(M,ee){this.canvas.addEventListener("contextmenu",_(this,u)),this.canvas.addEventListener("pointerleave",_(this,g)),this.canvas.addEventListener("pointermove",_(this,p)),this.canvas.addEventListener("pointerup",_(this,y)),this.canvas.removeEventListener("pointerdown",_(this,h)),this.isEditing=!0,_(this,T)||(ye(this,T,!0),me(this,Me,xt).call(this),this.thickness||(this.thickness=Ie._defaultThickness),this.color||(this.color=Ie._defaultColor||s.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=Ie._defaultOpacity)),this.currentPath.push([M,ee]),ye(this,v,!1),me(this,D,dn).call(this),ye(this,b,()=>{me(this,k,Kn).call(this),_(this,b)&&window.requestAnimationFrame(_(this,b))}),window.requestAnimationFrame(_(this,b))},Z=new WeakSet,fn=function(M,ee){const[he,ae]=this.currentPath.at(-1);if(this.currentPath.length>1&&M===he&&ee===ae)return;const W=this.currentPath;let I=_(this,d);if(W.push([M,ee]),ye(this,v,!0),W.length<=2){I.moveTo(...W[0]),I.lineTo(M,ee);return}W.length===3&&(ye(this,d,I=new Path2D),I.moveTo(...W[0])),me(this,z,Zn).call(this,I,...W.at(-3),...W.at(-2),M,ee)},ie=new WeakSet,Yn=function(){if(this.currentPath.length===0)return;const M=this.currentPath.at(-1);_(this,d).lineTo(...M)},Q=new WeakSet,jn=function(M,ee){ye(this,b,null),M=Math.min(Math.max(M,0),this.canvas.width),ee=Math.min(Math.max(ee,0),this.canvas.height),me(this,Z,fn).call(this,M,ee),me(this,ie,Yn).call(this);let he;if(this.currentPath.length!==1)he=me(this,K,Qn).call(this);else{const H=[M,ee];he=[[H,H.slice(),H.slice(),H]]}const ae=_(this,d),W=this.currentPath;this.currentPath=[],ye(this,d,new Path2D);const I=()=>{this.allRawPaths.push(W),this.paths.push(he),this.bezierPath2D.push(ae),this.rebuild()},q=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(me(this,se,Bt).call(this),me(this,Ee,Vt).call(this)),me(this,oe,wt).call(this))};this.addCommands({cmd:I,undo:q,mustExec:!0})},k=new WeakSet,Kn=function(){if(!_(this,v))return;ye(this,v,!1);const M=Math.ceil(this.thickness*this.parentScale),ee=this.currentPath.slice(-3),he=ee.map(I=>I[0]),ae=ee.map(I=>I[1]);Math.min(...he)-M,Math.max(...he)+M,Math.min(...ae)-M,Math.max(...ae)+M;const{ctx:W}=this;W.save(),W.clearRect(0,0,this.canvas.width,this.canvas.height);for(const I of this.bezierPath2D)W.stroke(I);W.stroke(_(this,d)),W.restore()},z=new WeakSet,Zn=function(M,ee,he,ae,W,I,q){const H=(ee+ae)/2,J=(he+W)/2,le=(ae+I)/2,xe=(W+q)/2;M.bezierCurveTo(H+2*(ae-H)/3,J+2*(W-J)/3,le+2*(ae-le)/3,xe+2*(W-xe)/3,le,xe)},K=new WeakSet,Qn=function(){const M=this.currentPath;if(M.length<=2)return[[M[0],M[0],M.at(-1),M.at(-1)]];const ee=[];let he,[ae,W]=M[0];for(he=1;he<M.length-2;he++){const[Pe,We]=M[he],[ke,He]=M[he+1],Fe=(Pe+ke)/2,Le=(We+He)/2,ze=[ae+2*(Pe-ae)/3,W+2*(We-W)/3],je=[Fe+2*(Pe-Fe)/3,Le+2*(We-Le)/3];ee.push([[ae,W],ze,je,[Fe,Le]]),[ae,W]=[Fe,Le]}const[I,q]=M[he],[H,J]=M[he+1],le=[ae+2*(I-ae)/3,W+2*(q-W)/3],xe=[H+2*(I-H)/3,J+2*(q-J)/3];return ee.push([[ae,W],le,xe,[H,J]]),ee},te=new WeakSet,mt=function(){if(this.isEmpty()){me(this,Ae,Wt).call(this);return}me(this,D,dn).call(this);const{canvas:M,ctx:ee}=this;ee.setTransform(1,0,0,1,0,0),ee.clearRect(0,0,M.width,M.height),me(this,Ae,Wt).call(this);for(const he of this.bezierPath2D)ee.stroke(he)},ue=new WeakSet,pn=function(M){this.canvas.removeEventListener("pointerleave",_(this,g)),this.canvas.removeEventListener("pointermove",_(this,p)),this.canvas.removeEventListener("pointerup",_(this,y)),this.canvas.addEventListener("pointerdown",_(this,h)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",_(this,u))},10),me(this,Q,jn).call(this,M.offsetX,M.offsetY),this.addToAnnotationStorage(),this.setInBackground()},se=new WeakSet,Bt=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Ie._l10nPromise.get("editor_ink_canvas_aria_label").then(M=>{var ee;return(ee=this.canvas)==null?void 0:ee.setAttribute("aria-label",M)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Ee=new WeakSet,Vt=function(){ye(this,R,new ResizeObserver(M=>{const ee=M[0].contentRect;ee.width&&ee.height&&this.setDimensions(ee.width,ee.height)})),_(this,R).observe(this.div)},Me=new WeakSet,xt=function(){if(!_(this,T))return;const[M,ee]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*M),this.canvas.height=Math.ceil(this.height*ee),me(this,Ae,Wt).call(this)},Ue=new WeakSet,mn=function(M,ee){const he=me(this,Se,Ut).call(this),ae=(M-he)/_(this,c),W=(ee-he)/_(this,l);this.scaleFactor=Math.min(ae,W)},Ae=new WeakSet,Wt=function(){const M=me(this,Se,Ut).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+M,this.translationY*this.scaleFactor+M)},Te=new WeakSet,qn=function(M){const ee=new Path2D;for(let he=0,ae=M.length;he<ae;he++){const[W,I,q,H]=M[he];he===0&&ee.moveTo(...W),ee.bezierCurveTo(I[0],I[1],q[0],q[1],H[0],H[1])}return ee},Ve=new WeakSet,gn=function(M,ee,he){const[ae,W,I,q]=ee;switch(he){case 0:for(let H=0,J=M.length;H<J;H+=2)M[H]+=ae,M[H+1]=q-M[H+1];break;case 90:for(let H=0,J=M.length;H<J;H+=2){const le=M[H];M[H]=M[H+1]+ae,M[H+1]=le+W}break;case 180:for(let H=0,J=M.length;H<J;H+=2)M[H]=I-M[H],M[H+1]+=W;break;case 270:for(let H=0,J=M.length;H<J;H+=2){const le=M[H];M[H]=I-M[H+1],M[H+1]=q-le}break;default:throw new Error("Invalid rotation")}return M},Ke=new WeakSet,Jn=function(M,ee,he){const[ae,W,I,q]=ee;switch(he){case 0:for(let H=0,J=M.length;H<J;H+=2)M[H]-=ae,M[H+1]=q-M[H+1];break;case 90:for(let H=0,J=M.length;H<J;H+=2){const le=M[H];M[H]=M[H+1]-W,M[H+1]=le-ae}break;case 180:for(let H=0,J=M.length;H<J;H+=2)M[H]=I-M[H],M[H+1]-=W;break;case 270:for(let H=0,J=M.length;H<J;H+=2){const le=M[H];M[H]=q-M[H+1],M[H+1]=I-le}break;default:throw new Error("Invalid rotation")}return M},Ze=new WeakSet,er=function(M,ee,he,ae){var J,le;const W=[],I=this.thickness/2,q=M*ee+I,H=M*he+I;for(const xe of this.paths){const Pe=[],We=[];for(let ke=0,He=xe.length;ke<He;ke++){const[Fe,Le,ze,je]=xe[ke],Je=M*Fe[0]+q,tt=M*Fe[1]+H,at=M*Le[0]+q,nt=M*Le[1]+H,ct=M*ze[0]+q,lt=M*ze[1]+H,ht=M*je[0]+q,dt=M*je[1]+H;ke===0&&(Pe.push(Je,tt),We.push(Je,tt)),Pe.push(at,nt,ct,lt,ht,dt),We.push(at,nt),ke===He-1&&We.push(ht,dt)}W.push({bezier:me(J=Ie,Ve,gn).call(J,Pe,ae,this.rotation),points:me(le=Ie,Ve,gn).call(le,We,ae,this.rotation)})}return W},qe=new WeakSet,vn=function(){let M=1/0,ee=-1/0,he=1/0,ae=-1/0;for(const W of this.paths)for(const[I,q,H,J]of W){const le=n.Util.bezierBoundingBox(...I,...q,...H,...J);M=Math.min(M,le[0]),he=Math.min(he,le[1]),ee=Math.max(ee,le[2]),ae=Math.max(ae,le[3])}return[M,he,ee,ae]},Se=new WeakSet,Ut=function(){return _(this,f)?Math.ceil(this.thickness*this.parentScale):0},oe=new WeakSet,wt=function(){let M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isEmpty())return;if(!_(this,f)){me(this,te,mt).call(this);return}const ee=me(this,qe,vn).call(this),he=me(this,Se,Ut).call(this);ye(this,c,Math.max(s.AnnotationEditor.MIN_SIZE,ee[2]-ee[0])),ye(this,l,Math.max(s.AnnotationEditor.MIN_SIZE,ee[3]-ee[1]));const ae=Math.ceil(he+_(this,c)*this.scaleFactor),W=Math.ceil(he+_(this,l)*this.scaleFactor),[I,q]=this.parentDimensions;this.width=ae/I,this.height=W/q,this.setAspectRatio(ae,W);const H=this.translationX,J=this.translationY;this.translationX=-ee[0],this.translationY=-ee[1],me(this,Me,xt).call(this),me(this,te,mt).call(this),ye(this,N,ae),ye(this,m,W),this.setDims(ae,W);const le=M?he/this.scaleFactor/2:0;this.translate(H-this.translationX-le,J-this.translationY-le)},re(Ie,Te),re(Ie,Ve),re(Ie,Ke),st(Ie,"_defaultColor",null),st(Ie,"_defaultOpacity",1),st(Ie,"_defaultThickness",1),st(Ie,"_l10nPromise"),st(Ie,"_type","ink");let a=Ie;e.InkEditor=a},(r,e,t)=>{var l,c,u,p,g,y,h,d,f,yn,T,It,N,tr,b,nr,x,An,w,Gt,V,rr;Object.defineProperty(e,"__esModule",{value:!0}),e.StampEditor=void 0,t(148),t(151);var n=t(163),s=t(1),i=t(167),o=t(197);class a extends n.AnnotationEditor{constructor(Y){super({...Y,name:"stampEditor"});re(this,f);re(this,T);re(this,N);re(this,b);re(this,x);re(this,w);re(this,V);re(this,l,null);re(this,c,null);re(this,u,null);re(this,p,null);re(this,g,null);re(this,y,null);re(this,h,null);re(this,d,!1);ye(this,p,Y.bitmapUrl)}remove(){var Y,G;_(this,c)&&(ye(this,l,null),this._uiManager.imageManager.deleteId(_(this,c)),(Y=_(this,g))==null||Y.remove(),ye(this,g,null),(G=_(this,y))==null||G.disconnect(),ye(this,y,null)),super.remove()}rebuild(){super.rebuild(),this.div!==null&&(_(this,c)&&me(this,f,yn).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this.div.draggable=!0,this.parent.addUndoableEditor(this),this.div.focus()}isEmpty(){return _(this,u)===null&&_(this,l)===null&&_(this,p)===null}get isResizable(){return!0}render(){if(this.div)return this.div;let Y,G;if(this.width&&(Y=this.x,G=this.y),super.render(),_(this,l)?me(this,T,It).call(this):(this.div.classList.add("loading"),me(this,f,yn).call(this)),this.width){const[X,Z]=this.parentDimensions;this.setAt(Y*X,G*Z,this.width*X,this.height*Z)}return this.div}static deserialize(Y,G,X){if(Y instanceof o.StampAnnotationElement)return null;const Z=super.deserialize(Y,G,X),{rect:ne,bitmapUrl:ie,bitmapId:be,isSvg:Q}=Y;be&&X.imageManager.isValidId(be)?ye(Z,c,be):ye(Z,p,ie),ye(Z,d,Q);const[O,k]=Z.pageDimensions;return Z.width=(ne[2]-ne[0])/O,Z.height=(ne[3]-ne[1])/k,Z}serialize(){let Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.isEmpty())return null;const X={annotationType:s.AnnotationEditorType.STAMP,bitmapId:_(this,c),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:_(this,d)};if(Y)return X.bitmapUrl=me(this,w,Gt).call(this,!0),X;if(G===null)return X;G.stamps||(G.stamps=new Map);const Z=_(this,d)?(X.rect[2]-X.rect[0])*(X.rect[3]-X.rect[1]):null;if(!G.stamps.has(_(this,c)))G.stamps.set(_(this,c),{area:Z,serialized:X}),X.bitmap=me(this,w,Gt).call(this,!1);else if(_(this,d)){const ne=G.stamps.get(_(this,c));Z>ne.area&&(ne.area=Z,ne.serialized.bitmap.close(),ne.serialized.bitmap=me(this,w,Gt).call(this,!1))}return X}}l=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,g=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakSet,yn=function(){if(_(this,c)){this._uiManager.imageManager.getFromId(_(this,c)).then(G=>{if(!G){this.remove();return}ye(this,l,G.bitmap),me(this,T,It).call(this)});return}if(_(this,p)){const G=_(this,p);ye(this,p,null),ye(this,u,this._uiManager.imageManager.getFromUrl(G).then(X=>{if(ye(this,u,null),!X){this.remove();return}({bitmap:pt(this,l)._,id:pt(this,c)._,isSvg:pt(this,d)._}=X),me(this,T,It).call(this)}));return}const Y=document.createElement("input");Y.type="file",Y.accept="image/*",ye(this,u,new Promise(G=>{Y.addEventListener("change",async()=>{if(ye(this,u,null),!Y.files||Y.files.length===0)this.remove();else{const X=await this._uiManager.imageManager.getFromFile(Y.files[0]);if(!X){this.remove();return}({bitmap:pt(this,l)._,id:pt(this,c)._,isSvg:pt(this,d)._}=X),me(this,T,It).call(this)}G()}),Y.addEventListener("cancel",()=>{ye(this,u,null),this.remove(),G()})})),Y.click()},T=new WeakSet,It=function(){const{div:Y}=this;let{width:G,height:X}=_(this,l);const[Z,ne]=this.pageDimensions,ie=.75;if(this.width)G=this.width*Z,X=this.height*ne;else if(G>ie*Z||X>ie*ne){const k=Math.min(ie*Z/G,ie*ne/X);G*=k,X*=k}const[be,Q]=this.parentDimensions;this.setDims(G*be/Z,X*Q/ne);const O=ye(this,g,document.createElement("canvas"));Y.append(O),me(this,x,An).call(this,G,X),me(this,V,rr).call(this),Y.classList.remove("loading")},N=new WeakSet,tr=function(Y,G){const[X,Z]=this.parentDimensions;this.width=Y/X,this.height=G/Z,this.setDims(Y,G),this.fixAndSetPosition(),_(this,h)!==null&&clearTimeout(_(this,h)),ye(this,h,setTimeout(()=>{ye(this,h,null),me(this,x,An).call(this,Y,G)},200))},b=new WeakSet,nr=function(Y,G){const{width:X,height:Z}=_(this,l);let ne=X,ie=Z,be=_(this,l);for(;ne>2*Y||ie>2*G;){const Q=ne,O=ie;ne>2*Y&&(ne=ne>=16384?Math.floor(ne/2)-1:Math.ceil(ne/2)),ie>2*G&&(ie=ie>=16384?Math.floor(ie/2)-1:Math.ceil(ie/2));const k=new OffscreenCanvas(ne,ie);k.getContext("2d").drawImage(be,0,0,Q,O,0,0,ne,ie),be=k.transferToImageBitmap()}return be},x=new WeakSet,An=function(Y,G){const X=_(this,g);if(!X||X.width===Y&&X.height===G)return;X.width=Y,X.height=G;const Z=_(this,d)?_(this,l):me(this,b,nr).call(this,Y,G),ne=X.getContext("2d");ne.filter=this._uiManager.hcmFilter,ne.drawImage(Z,0,0,Z.width,Z.height,0,0,Y,G)},w=new WeakSet,Gt=function(Y){if(Y){if(_(this,d)){const Z=this._uiManager.imageManager.getSvgUrl(_(this,c));if(Z)return Z}const G=document.createElement("canvas");return{width:G.width,height:G.height}=_(this,l),G.getContext("2d").drawImage(_(this,l),0,0),G.toDataURL()}if(_(this,d)){const[G,X]=this.pageDimensions,Z=Math.round(this.width*G*i.PixelsPerInch.PDF_TO_CSS_UNITS),ne=Math.round(this.height*X*i.PixelsPerInch.PDF_TO_CSS_UNITS),ie=new OffscreenCanvas(Z,ne);return ie.getContext("2d").drawImage(_(this,l),0,0,_(this,l).width,_(this,l).height,0,0,Z,ne),ie.transferToImageBitmap()}return structuredClone(_(this,l))},V=new WeakSet,rr=function(){ye(this,y,new ResizeObserver(Y=>{const G=Y[0].contentRect;G.width&&G.height&&me(this,N,tr).call(this,G.width,G.height)})),_(this,y).observe(this.div)},st(a,"_type","stamp"),e.StampEditor=a}],__webpack_module_cache__={};function __w_pdfjs_require__(r){var e=__webpack_module_cache__[r];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r].call(t.exports,t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var r=__webpack_exports__;Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"AbortException",{enumerable:!0,get:function(){return e.AbortException}}),Object.defineProperty(r,"AnnotationEditorLayer",{enumerable:!0,get:function(){return i.AnnotationEditorLayer}}),Object.defineProperty(r,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(r,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(r,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return o.AnnotationEditorUIManager}}),Object.defineProperty(r,"AnnotationLayer",{enumerable:!0,get:function(){return a.AnnotationLayer}}),Object.defineProperty(r,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(r,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(r,"FeatureTest",{enumerable:!0,get:function(){return e.FeatureTest}}),Object.defineProperty(r,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(r,"ImageKind",{enumerable:!0,get:function(){return e.ImageKind}}),Object.defineProperty(r,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(r,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(r,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(r,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(r,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(r,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(r,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(r,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(r,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(r,"PromiseCapability",{enumerable:!0,get:function(){return e.PromiseCapability}}),Object.defineProperty(r,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(r,"SVGGraphics",{enumerable:!0,get:function(){return t.SVGGraphics}}),Object.defineProperty(r,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(r,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(r,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(r,"XfaLayer",{enumerable:!0,get:function(){return c.XfaLayer}}),Object.defineProperty(r,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(r,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(r,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(r,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(r,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(r,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(r,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(r,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(r,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(r,"normalizeUnicode",{enumerable:!0,get:function(){return e.normalizeUnicode}}),Object.defineProperty(r,"renderTextLayer",{enumerable:!0,get:function(){return s.renderTextLayer}}),Object.defineProperty(r,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(r,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(r,"updateTextLayer",{enumerable:!0,get:function(){return s.updateTextLayer}}),Object.defineProperty(r,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(124),n=__w_pdfjs_require__(167),s=__w_pdfjs_require__(194),i=__w_pdfjs_require__(195),o=__w_pdfjs_require__(164),a=__w_pdfjs_require__(197),l=__w_pdfjs_require__(175),c=__w_pdfjs_require__(200)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const pdfjsWorkerURL="/acchymns-dev/assets/pdf.worker.min-4b291930.js",_sfc_main$2=defineComponent({__name:"PDFWrapper",props:{src:{}},emits:["error"],setup(r,{emit:e}){const t=r;pdfExports.GlobalWorkerOptions.workerSrc=pdfjsWorkerURL;let n=ref();return onMounted(async()=>{var i;let s;try{s=await pdfExports.getDocument(t.src).promise}catch{e("error");return}for(let o=1;o<=s.numPages;o++){let a=document.createElement("canvas"),l=await s.getPage(o);const c=Capacitor.getPlatform()=="web"?5:window.devicePixelRatio;let u=l.getViewport({scale:c});a.height=u.height,a.width=u.width;let p=a.getContext("2d");if(p===null){e("error");return}try{await l.render({canvasContext:p,viewport:u}).promise,a.style.width="100%";const g=a.toDataURL("image/png"),y=document.createElement("img");y.classList.add("song-img"),y.src=g,(i=n.value)==null||i.appendChild(y)}catch{e("error");return}}}),(s,i)=>(openBlock(),createElementBlock("div",{ref_key:"root",ref:n,class:"container"},null,512))}}),PDFWrapper_vue_vue_type_style_index_0_lang="",PDFWrapper_vue_vue_type_style_index_1_lang="",_withScopeId=r=>(pushScopeId("data-v-1226a89e"),r=r(),popScopeId(),r),_hoisted_1$1={key:0,class:"fallback-container"},_hoisted_2$1=_withScopeId(()=>createBaseVNode("img",{src:_imports_0,class:"wifi-fallback"},null,-1)),_hoisted_3$1=[_hoisted_2$1],_hoisted_4$1=["src"],_sfc_main$1=defineComponent({__name:"SongContainer",props:{book:{},number:{}},setup(r){const e=r;let t=ref(""),n=ref();function s(T,R,N){const m=R+"."+N[T].fileExtension;return`${N[T].srcUrl}/songs/${m}`}let i=ref(""),o=ref(!1);const a=useMediaQuery("(prefers-color-scheme: dark)"),l=useLocalStorage("ACCOptions.overrideSystemTheme",!1),c=useLocalStorage("ACCOptions.overrideDarkMode",!1);let u=useLocalStorage("ACCOptions.songInverted",!1);const p=computed(()=>l.value?c.value:a.value),g=computed(()=>p.value&&u.value);let y=readonly(useLocalStorage("ACCOptions.panzoomEnable",!0)),h;var d=Capacitor.getPlatform()!=="web";onMounted(async()=>{const T=await getAllBookMetaData();if(console.log(T[e.book]),T[e.book]==null){o.value=!0;return}const R=s(e.book,e.number,T);t.value=T[e.book].fileExtension,i.value=R,y.value&&(h=createPanZoom$1(n.value,{beforeWheel:N=>N.shiftKey,maxZoom:3,minZoom:d?1:.25,bounds:!0,boundsPadding:d?1:.5})),d&&setInterval(()=>{v.refresh()},10)});class f{constructor(R){st(this,"_observer");st(this,"_observedNodes");this._observer=R,this._observedNodes=new Set}observe(R){this._observedNodes.add(R),this._observer.observe(R)}unobserve(R){this._observedNodes.delete(R),this._observer.unobserve(R)}disconnect(){this._observedNodes.clear(),this._observer.disconnect()}refresh(){for(let R of this._observedNodes)this._observer.unobserve(R),this._observer.observe(R)}}const v=new f(new IntersectionObserver((T,R)=>{for(const N of T){let m=N.boundingClientRect;N.intersectionRect.height<m.height?h.setVerticalPan(!0):h.setVerticalPan(!1)}},{root:null,rootMargin:"0px",threshold:1}));return onUpdated(async()=>{d&&v.observe(n.value)}),(T,R)=>unref(o)?(openBlock(),createElementBlock("div",_hoisted_1$1,_hoisted_3$1)):(openBlock(),createElementBlock("div",{key:1,ref_key:"panzoom_container",ref:n,class:"panzoom-container"},[unref(t)=="pdf"?(openBlock(),createBlock(_sfc_main$2,{key:0,onError:R[0]||(R[0]=N=>isRef(o)?o.value=!0:o=!0),src:unref(i),class:normalizeClass(["song-img",{"inverted-song":g.value}])},null,8,["src","class"])):unref(t)!==""?(openBlock(),createElementBlock("img",{key:1,onError:R[1]||(R[1]=N=>isRef(o)?o.value=!0:o=!0),src:unref(i),class:normalizeClass(["song-img",{"inverted-song":g.value}])},null,42,_hoisted_4$1)):createCommentVNode("",!0)],512))}}),SongContainer_vue_vue_type_style_index_0_scoped_1226a89e_lang="",SongContainer=_export_sfc(_sfc_main$1,[["__scopeId","data-v-1226a89e"]]),version="14.7.77",createExtendedExponentialRampToValueAutomationEvent=(r,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:r}),createExtendedLinearRampToValueAutomationEvent=(r,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:r}),createSetValueAutomationEvent=(r,e)=>({startTime:e,type:"setValue",value:r}),createSetValueCurveAutomationEvent=(r,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:r}),getTargetValueAtTime=(r,e,{startTime:t,target:n,timeConstant:s})=>n+(e-n)*Math.exp((t-r)/s),isExponentialRampToValueAutomationEvent=r=>r.type==="exponentialRampToValue",isLinearRampToValueAutomationEvent=r=>r.type==="linearRampToValue",isAnyRampToValueAutomationEvent=r=>isExponentialRampToValueAutomationEvent(r)||isLinearRampToValueAutomationEvent(r),isSetValueAutomationEvent=r=>r.type==="setValue",isSetValueCurveAutomationEvent=r=>r.type==="setValueCurve",getValueOfAutomationEventAtIndexAtTime=(r,e,t,n)=>{const s=r[e];return s===void 0?n:isAnyRampToValueAutomationEvent(s)||isSetValueAutomationEvent(s)?s.value:isSetValueCurveAutomationEvent(s)?s.values[s.values.length-1]:getTargetValueAtTime(t,getValueOfAutomationEventAtIndexAtTime(r,e-1,s.startTime,n),s)},getEndTimeAndValueOfPreviousAutomationEvent=(r,e,t,n,s)=>t===void 0?[n.insertTime,s]:isAnyRampToValueAutomationEvent(t)?[t.endTime,t.value]:isSetValueAutomationEvent(t)?[t.startTime,t.value]:isSetValueCurveAutomationEvent(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,getValueOfAutomationEventAtIndexAtTime(r,e-1,t.startTime,s)],isCancelAndHoldAutomationEvent=r=>r.type==="cancelAndHold",isCancelScheduledValuesAutomationEvent=r=>r.type==="cancelScheduledValues",getEventTime=r=>isCancelAndHoldAutomationEvent(r)||isCancelScheduledValuesAutomationEvent(r)?r.cancelTime:isExponentialRampToValueAutomationEvent(r)||isLinearRampToValueAutomationEvent(r)?r.endTime:r.startTime,getExponentialRampValueAtTime=(r,e,t,{endTime:n,value:s})=>t===s?s:0<t&&0<s||t<0&&s<0?t*(s/t)**((r-e)/(n-e)):0,getLinearRampValueAtTime=(r,e,t,{endTime:n,value:s})=>t+(r-e)/(n-e)*(s-t),interpolateValue=(r,e)=>{const t=Math.floor(e),n=Math.ceil(e);return t===n?r[t]:(1-(e-t))*r[t]+(1-(n-e))*r[n]},getValueCurveValueAtTime=(r,{duration:e,startTime:t,values:n})=>{const s=(r-t)/e*(n.length-1);return interpolateValue(n,s)},isSetTargetAutomationEvent=r=>r.type==="setTarget";class AutomationEventList{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=getEventTime(e);if(isCancelAndHoldAutomationEvent(e)||isCancelScheduledValuesAutomationEvent(e)){const n=this._automationEvents.findIndex(i=>isCancelScheduledValuesAutomationEvent(e)&&isSetValueCurveAutomationEvent(i)?i.startTime+i.duration>=t:getEventTime(i)>=t),s=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),isCancelAndHoldAutomationEvent(e)){const i=this._automationEvents[this._automationEvents.length-1];if(s!==void 0&&isAnyRampToValueAutomationEvent(s)){if(i!==void 0&&isSetTargetAutomationEvent(i))throw new Error("The internal list is malformed.");const o=i===void 0?s.insertTime:isSetValueCurveAutomationEvent(i)?i.startTime+i.duration:getEventTime(i),a=i===void 0?this._defaultValue:isSetValueCurveAutomationEvent(i)?i.values[i.values.length-1]:i.value,l=isExponentialRampToValueAutomationEvent(s)?getExponentialRampValueAtTime(t,o,a,s):getLinearRampValueAtTime(t,o,a,s),c=isExponentialRampToValueAutomationEvent(s)?createExtendedExponentialRampToValueAutomationEvent(l,t,this._currenTime):createExtendedLinearRampToValueAutomationEvent(l,t,this._currenTime);this._automationEvents.push(c)}if(i!==void 0&&isSetTargetAutomationEvent(i)&&this._automationEvents.push(createSetValueAutomationEvent(this.getValue(t),t)),i!==void 0&&isSetValueCurveAutomationEvent(i)&&i.startTime+i.duration>t){const o=t-i.startTime,a=(i.values.length-1)/i.duration,l=Math.max(2,1+Math.ceil(o*a)),c=o/(l-1)*a,u=i.values.slice(0,l);if(c<1)for(let p=1;p<l;p+=1){const g=c*p%1;u[p]=i.values[p-1]*(1-g)+i.values[p]*g}this._automationEvents[this._automationEvents.length-1]=createSetValueCurveAutomationEvent(u,i.startTime,o)}}}else{const n=this._automationEvents.findIndex(o=>getEventTime(o)>t),s=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(s!==void 0&&isSetValueCurveAutomationEvent(s)&&getEventTime(s)+s.duration>t)return!1;const i=isExponentialRampToValueAutomationEvent(e)?createExtendedExponentialRampToValueAutomationEvent(e.value,e.endTime,this._currenTime):isLinearRampToValueAutomationEvent(e)?createExtendedLinearRampToValueAutomationEvent(e.value,t,this._currenTime):e;if(n===-1)this._automationEvents.push(i);else{if(isSetValueCurveAutomationEvent(e)&&t+e.duration>getEventTime(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,i)}}return!0}flush(e){const t=this._automationEvents.findIndex(n=>getEventTime(n)>e);if(t>1){const n=this._automationEvents.slice(t-1),s=n[0];isSetTargetAutomationEvent(s)&&n.unshift(createSetValueAutomationEvent(getValueOfAutomationEventAtIndexAtTime(this._automationEvents,t-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>getEventTime(o)>e),n=this._automationEvents[t],s=(t===-1?this._automationEvents.length:t)-1,i=this._automationEvents[s];if(i!==void 0&&isSetTargetAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||n.insertTime>e))return getTargetValueAtTime(e,getValueOfAutomationEventAtIndexAtTime(this._automationEvents,s-1,i.startTime,this._defaultValue),i);if(i!==void 0&&isSetValueAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return i.value;if(i!==void 0&&isSetValueCurveAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)||i.startTime+i.duration>e))return e<i.startTime+i.duration?getValueCurveValueAtTime(e,i):i.values[i.values.length-1];if(i!==void 0&&isAnyRampToValueAutomationEvent(i)&&(n===void 0||!isAnyRampToValueAutomationEvent(n)))return i.value;if(n!==void 0&&isExponentialRampToValueAutomationEvent(n)){const[o,a]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,s,i,n,this._defaultValue);return getExponentialRampValueAtTime(e,o,a,n)}if(n!==void 0&&isLinearRampToValueAutomationEvent(n)){const[o,a]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,s,i,n,this._defaultValue);return getLinearRampValueAtTime(e,o,a,n)}return this._defaultValue}}const createCancelAndHoldAutomationEvent=r=>({cancelTime:r,type:"cancelAndHold"}),createCancelScheduledValuesAutomationEvent=r=>({cancelTime:r,type:"cancelScheduledValues"}),createExponentialRampToValueAutomationEvent=(r,e)=>({endTime:e,type:"exponentialRampToValue",value:r}),createLinearRampToValueAutomationEvent=(r,e)=>({endTime:e,type:"linearRampToValue",value:r}),createSetTargetAutomationEvent=(r,e,t)=>({startTime:e,target:r,timeConstant:t,type:"setTarget"}),createAbortError=()=>new DOMException("","AbortError"),createAddActiveInputConnectionToAudioNode=r=>(e,t,[n,s,i],o)=>{r(e[s],[t,n,i],a=>a[0]===t&&a[1]===n,o)},createAddAudioNodeConnections=r=>(e,t,n)=>{const s=[];for(let i=0;i<n.numberOfInputs;i+=1)s.push(new Set);r.set(e,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},createAddAudioParamConnections=r=>(e,t)=>{r.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},ACTIVE_AUDIO_NODE_STORE=new WeakSet,AUDIO_NODE_CONNECTIONS_STORE=new WeakMap,AUDIO_NODE_STORE=new WeakMap,AUDIO_PARAM_CONNECTIONS_STORE=new WeakMap,AUDIO_PARAM_STORE=new WeakMap,CONTEXT_STORE=new WeakMap,EVENT_LISTENERS=new WeakMap,CYCLE_COUNTERS=new WeakMap,NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=new WeakMap,NODE_TO_PROCESSOR_MAPS=new WeakMap,handler={construct(){return handler}},isConstructible=r=>{try{const e=new Proxy(r,handler);new e}catch{return!1}return!0},IMPORT_STATEMENT_REGEX=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,splitImportStatements=(r,e)=>{const t=[];let n=r.replace(/^[\s]+/,""),s=n.match(IMPORT_STATEMENT_REGEX);for(;s!==null;){const i=s[1].slice(1,-1),o=s[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,e).toString());t.push(o),n=n.slice(s[0].length).replace(/^[\s]+/,""),s=n.match(IMPORT_STATEMENT_REGEX)}return[t.join(";"),n]},verifyParameterDescriptors=r=>{if(r!==void 0&&!Array.isArray(r))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},verifyProcessorCtor=r=>{if(!isConstructible(r))throw new TypeError("The given value for processorCtor should be a constructor.");if(r.prototype===null||typeof r.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},createAddAudioWorkletModule=(r,e,t,n,s,i,o,a,l,c,u,p,g)=>{let y=0;return(h,d,f={credentials:"omit"})=>{const v=u.get(h);if(v!==void 0&&v.has(d))return Promise.resolve();const T=c.get(h);if(T!==void 0){const m=T.get(d);if(m!==void 0)return m}const R=i(h),N=R.audioWorklet===void 0?s(d).then(([m,b])=>{const[P,x]=splitImportStatements(m,b),S=`${P};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${x}
})})(window,'_AWGS')`;return t(S)}).then(()=>{const m=g._AWGS.pop();if(m===void 0)throw new SyntaxError;n(R.currentTime,R.sampleRate,()=>m(class{},void 0,(b,P)=>{if(b.trim()==="")throw e();const x=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(R);if(x!==void 0){if(x.has(b))throw e();verifyProcessorCtor(P),verifyParameterDescriptors(P.parameterDescriptors),x.set(b,P)}else verifyProcessorCtor(P),verifyParameterDescriptors(P.parameterDescriptors),NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(R,new Map([[b,P]]))},R.sampleRate,void 0,void 0))}):Promise.all([s(d),Promise.resolve(r(p,p))]).then(([[m,b],P])=>{const x=y+1;y=x;const[S,w]=splitImportStatements(m,b),j=`${S};((AudioWorkletProcessor,registerProcessor)=>{${w}
})(${P?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${P?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${P?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${x}',class extends AudioWorkletProcessor{process(){return !1}})`,D=new Blob([j],{type:"application/javascript; charset=utf-8"}),Y=URL.createObjectURL(D);return R.audioWorklet.addModule(Y,f).then(()=>{if(a(R))return R;const G=o(R);return G.audioWorklet.addModule(Y,f).then(()=>G)}).then(G=>{if(l===null)throw new SyntaxError;try{new l(G,`__sac${x}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Y))});return T===void 0?c.set(h,new Map([[d,N]])):T.set(d,N),N.then(()=>{const m=u.get(h);m===void 0?u.set(h,new Set([d])):m.add(d)}).finally(()=>{const m=c.get(h);m!==void 0&&m.delete(d)}),N}},getValueForKey=(r,e)=>{const t=r.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},pickElementFromSet=(r,e)=>{const t=Array.from(r).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[n]=t;return r.delete(n),n},deletePassiveInputConnectionToAudioNode=(r,e,t,n)=>{const s=getValueForKey(r,e),i=pickElementFromSet(s,o=>o[0]===t&&o[1]===n);return s.size===0&&r.delete(e),i},getEventListenersOfAudioNode=r=>getValueForKey(EVENT_LISTENERS,r),setInternalStateToActive=r=>{if(ACTIVE_AUDIO_NODE_STORE.has(r))throw new Error("The AudioNode is already stored.");ACTIVE_AUDIO_NODE_STORE.add(r),getEventListenersOfAudioNode(r).forEach(e=>e(!0))},isAudioWorkletNode=r=>"port"in r,setInternalStateToPassive=r=>{if(!ACTIVE_AUDIO_NODE_STORE.has(r))throw new Error("The AudioNode is not stored.");ACTIVE_AUDIO_NODE_STORE.delete(r),getEventListenersOfAudioNode(r).forEach(e=>e(!1))},setInternalStateToPassiveWhenNecessary=(r,e)=>{!isAudioWorkletNode(r)&&e.every(t=>t.size===0)&&setInternalStateToPassive(r)},createAddConnectionToAudioNode=(r,e,t,n,s,i,o,a,l,c,u,p,g)=>{const y=new WeakMap;return(h,d,f,v,T)=>{const{activeInputs:R,passiveInputs:N}=i(d),{outputs:m}=i(h),b=a(h),P=x=>{const S=l(d),w=l(h);if(x){const E=deletePassiveInputConnectionToAudioNode(N,h,f,v);r(R,h,E,!1),!T&&!p(h)&&t(w,S,f,v),g(d)&&setInternalStateToActive(d)}else{const E=n(R,h,f,v);e(N,v,E,!1),!T&&!p(h)&&s(w,S,f,v);const V=o(d);if(V===0)u(d)&&setInternalStateToPassiveWhenNecessary(d,R);else{const $=y.get(d);$!==void 0&&clearTimeout($),y.set(d,setTimeout(()=>{u(d)&&setInternalStateToPassiveWhenNecessary(d,R)},V*1e3))}}};return c(m,[d,f,v],x=>x[0]===d&&x[1]===f&&x[2]===v,!0)?(b.add(P),u(h)?r(R,h,[f,v,P],!0):e(N,v,[h,f,P],!0),!0):!1}},createAddPassiveInputConnectionToAudioNode=r=>(e,t,[n,s,i],o)=>{const a=e.get(n);a===void 0?e.set(n,new Set([[s,t,i]])):r(a,[s,t,i],l=>l[0]===s&&l[1]===t,o)},createAddSilentConnection=r=>(e,t)=>{const n=r(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const s=()=>{t.removeEventListener("ended",s),t.disconnect(n),n.disconnect()};t.addEventListener("ended",s)},createAddUnrenderedAudioWorkletNode=r=>(e,t)=>{r(e).add(t)},DEFAULT_OPTIONS$j={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},createAnalyserNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(a,l){const c=s(a),u={...DEFAULT_OPTIONS$j,...l},p=n(c,u),g=i(c)?e():null;super(a,!1,p,g),this._nativeAnalyserNode=p}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const l=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=l,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const l=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=l,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},isOwnedByContext=(r,e)=>r.context===e,createAnalyserNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const c={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=r(o,c)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):s(i,o)}}},testAudioBufferCopyChannelMethodsOutOfBoundsSupport=r=>{try{r.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},createIndexSizeError=()=>new DOMException("","IndexSizeError"),wrapAudioBufferGetChannelDataMethod=r=>{r.getChannelData=(e=>t=>{try{return e.call(r,t)}catch(n){throw n.code===12?createIndexSizeError():n}})(r.getChannelData)},DEFAULT_OPTIONS$i={numberOfChannels:1},createAudioBufferConstructor=(r,e,t,n,s,i,o,a)=>{let l=null;return class sr{constructor(u){if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:p,numberOfChannels:g,sampleRate:y}={...DEFAULT_OPTIONS$i,...u};l===null&&(l=new s(1,1,44100));const h=n!==null&&e(i,i)?new n({length:p,numberOfChannels:g,sampleRate:y}):l.createBuffer(g,p,y);if(h.numberOfChannels===0)throw t();return typeof h.copyFromChannel!="function"?(o(h),wrapAudioBufferGetChannelDataMethod(h)):e(testAudioBufferCopyChannelMethodsOutOfBoundsSupport,()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport(h))||a(h),r.add(h),h}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===sr.prototype||r.has(u)}}},MOST_NEGATIVE_SINGLE_FLOAT=-34028234663852886e22,MOST_POSITIVE_SINGLE_FLOAT=-MOST_NEGATIVE_SINGLE_FLOAT,isActiveAudioNode=r=>ACTIVE_AUDIO_NODE_STORE.has(r),DEFAULT_OPTIONS$h={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},createAudioBufferSourceNodeConstructor=(r,e,t,n,s,i,o,a)=>class extends r{constructor(c,u){const p=i(c),g={...DEFAULT_OPTIONS$h,...u},y=s(p,g),h=o(p),d=h?e():null;super(c,!1,y,d),this._audioBufferSourceNodeRenderer=d,this._isBufferNullified=!1,this._isBufferSet=g.buffer!==null,this._nativeAudioBufferSourceNode=y,this._onended=null,this._playbackRate=t(this,h,y.playbackRate,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,c!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeAudioBufferSourceNode.onended=u;const p=this._nativeAudioBufferSourceNode.onended;this._onended=p!==null&&p===u?c:p}get playbackRate(){return this._playbackRate}start(c=0,u=0,p){if(this._nativeAudioBufferSourceNode.start(c,u,p),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=p===void 0?[c,u]:[c,u,p]),this.context.state!=="closed"){setInternalStateToActive(this);const g=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",g),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",g)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=c)}},createAudioBufferSourceNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap;let o=null,a=null;const l=async(c,u)=>{let p=t(c);const g=isOwnedByContext(p,u);if(!g){const y={buffer:p.buffer,channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,loop:p.loop,loopEnd:p.loopEnd,loopStart:p.loopStart,playbackRate:p.playbackRate.value};p=e(u,y),o!==null&&p.start(...o),a!==null&&p.stop(a)}return i.set(u,p),g?await r(u,c.playbackRate,p.playbackRate):await n(u,c.playbackRate,p.playbackRate),await s(c,u,p),p};return{set start(c){o=c},set stop(c){a=c},render(c,u){const p=i.get(u);return p!==void 0?Promise.resolve(p):l(c,u)}}},isAudioBufferSourceNode=r=>"playbackRate"in r,isBiquadFilterNode=r=>"frequency"in r&&"gain"in r,isConstantSourceNode=r=>"offset"in r,isGainNode=r=>!("frequency"in r)&&"gain"in r,isOscillatorNode=r=>"detune"in r&&"frequency"in r,isStereoPannerNode=r=>"pan"in r,getAudioNodeConnections=r=>getValueForKey(AUDIO_NODE_CONNECTIONS_STORE,r),getAudioParamConnections=r=>getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE,r),deactivateActiveAudioNodeInputConnections=(r,e)=>{const{activeInputs:t}=getAudioNodeConnections(r);t.forEach(s=>s.forEach(([i])=>{e.includes(r)||deactivateActiveAudioNodeInputConnections(i,[...e,r])}));const n=isAudioBufferSourceNode(r)?[r.playbackRate]:isAudioWorkletNode(r)?Array.from(r.parameters.values()):isBiquadFilterNode(r)?[r.Q,r.detune,r.frequency,r.gain]:isConstantSourceNode(r)?[r.offset]:isGainNode(r)?[r.gain]:isOscillatorNode(r)?[r.detune,r.frequency]:isStereoPannerNode(r)?[r.pan]:[];for(const s of n){const i=getAudioParamConnections(s);i!==void 0&&i.activeInputs.forEach(([o])=>deactivateActiveAudioNodeInputConnections(o,e))}isActiveAudioNode(r)&&setInternalStateToPassive(r)},deactivateAudioGraph=r=>{deactivateActiveAudioNodeInputConnections(r.destination,[])},isValidLatencyHint=r=>r===void 0||typeof r=="number"||typeof r=="string"&&(r==="balanced"||r==="interactive"||r==="playback"),createAudioContextConstructor=(r,e,t,n,s,i,o,a,l)=>class extends r{constructor(u={}){if(l===null)throw new Error("Missing the native AudioContext constructor.");let p;try{p=new l(u)}catch(h){throw h.code===12&&h.message==="sampleRate is not in range"?t():h}if(p===null)throw n();if(!isValidLatencyHint(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&p.sampleRate!==u.sampleRate)throw t();super(p,2);const{latencyHint:g}=u,{sampleRate:y}=p;if(this._baseLatency=typeof p.baseLatency=="number"?p.baseLatency:g==="balanced"?512/y:g==="interactive"||g===void 0?256/y:g==="playback"?1024/y:Math.max(2,Math.min(128,Math.round(g*y/128)))*128/y,this._nativeAudioContext=p,l.name==="webkitAudioContext"?(this._nativeGainNode=p.createGain(),this._nativeOscillatorNode=p.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(p.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,p.state==="running"){this._state="suspended";const h=()=>{this._state==="suspended"&&(this._state=null),p.removeEventListener("statechange",h)};p.addEventListener("statechange",h)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)}))}createMediaElementSource(u){return new s(this,{mediaElement:u})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,p)=>{const g=()=>{this._nativeAudioContext.removeEventListener("statechange",g),this._nativeAudioContext.state==="running"?u():this.resume().then(u,p)};this._nativeAudioContext.addEventListener("statechange",g)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},createAudioDestinationNodeConstructor=(r,e,t,n,s,i,o,a)=>class extends r{constructor(c,u){const p=i(c),g=o(p),y=s(p,u,g),h=g?e(a):null;super(c,!1,y,h),this._isNodeOfNativeOfflineAudioContext=g,this._nativeAudioDestinationNode=y}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},createAudioDestinationNodeRenderer=r=>{const e=new WeakMap,t=async(n,s)=>{const i=s.destination;return e.set(s,i),await r(n,s,i),i};return{render(n,s){const i=e.get(s);return i!==void 0?Promise.resolve(i):t(n,s)}}},createAudioListenerFactory=(r,e,t,n,s,i,o,a)=>(l,c)=>{const u=c.listener,p=()=>{const m=new Float32Array(1),b=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),P=o(c);let x=!1,S=[0,0,-1,0,1,0],w=[0,0,0];const E=()=>{if(x)return;x=!0;const D=n(c,256,9,0);D.onaudioprocess=({inputBuffer:Y})=>{const G=[i(Y,m,0),i(Y,m,1),i(Y,m,2),i(Y,m,3),i(Y,m,4),i(Y,m,5)];G.some((Z,ne)=>Z!==S[ne])&&(u.setOrientation(...G),S=G);const X=[i(Y,m,6),i(Y,m,7),i(Y,m,8)];X.some((Z,ne)=>Z!==w[ne])&&(u.setPosition(...X),w=X)},b.connect(D)},V=D=>Y=>{Y!==S[D]&&(S[D]=Y,u.setOrientation(...S))},$=D=>Y=>{Y!==w[D]&&(w[D]=Y,u.setPosition(...w))},j=(D,Y,G)=>{const X=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Y});X.connect(b,0,D),X.start(),Object.defineProperty(X.offset,"defaultValue",{get(){return Y}});const Z=r({context:l},P,X.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT);return a(Z,"value",ne=>()=>ne.call(Z),ne=>ie=>{try{ne.call(Z,ie)}catch(be){if(be.code!==9)throw be}E(),P&&G(ie)}),Z.cancelAndHoldAtTime=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.cancelAndHoldAtTime),Z.cancelScheduledValues=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.cancelScheduledValues),Z.exponentialRampToValueAtTime=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.exponentialRampToValueAtTime),Z.linearRampToValueAtTime=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.linearRampToValueAtTime),Z.setTargetAtTime=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.setTargetAtTime),Z.setValueAtTime=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.setValueAtTime),Z.setValueCurveAtTime=(ne=>P?()=>{throw s()}:(...ie)=>{const be=ne.apply(Z,ie);return E(),be})(Z.setValueCurveAtTime),Z};return{forwardX:j(0,0,V(0)),forwardY:j(1,0,V(1)),forwardZ:j(2,-1,V(2)),positionX:j(6,0,$(0)),positionY:j(7,0,$(1)),positionZ:j(8,0,$(2)),upX:j(3,0,V(3)),upY:j(4,1,V(4)),upZ:j(5,0,V(5))}},{forwardX:g,forwardY:y,forwardZ:h,positionX:d,positionY:f,positionZ:v,upX:T,upY:R,upZ:N}=u.forwardX===void 0?p():u;return{get forwardX(){return g},get forwardY(){return y},get forwardZ(){return h},get positionX(){return d},get positionY(){return f},get positionZ(){return v},get upX(){return T},get upY(){return R},get upZ(){return N}}},isAudioNode$1=r=>"context"in r,isAudioNodeOutputConnection=r=>isAudioNode$1(r[0]),insertElementInSet=(r,e,t,n)=>{for(const s of r)if(t(s)){if(n)return!1;throw Error("The set contains at least one similar element.")}return r.add(e),!0},addActiveInputConnectionToAudioParam=(r,e,[t,n],s)=>{insertElementInSet(r,[e,t,n],i=>i[0]===e&&i[1]===t,s)},addPassiveInputConnectionToAudioParam=(r,[e,t,n],s)=>{const i=r.get(e);i===void 0?r.set(e,new Set([[t,n]])):insertElementInSet(i,[t,n],o=>o[0]===t,s)},isNativeAudioNodeFaker=r=>"inputs"in r,connectNativeAudioNodeToNativeAudioNode=(r,e,t,n)=>{if(isNativeAudioNodeFaker(e)){const s=e.inputs[n];return r.connect(s,t,0),[s,t,0]}return r.connect(e,t,n),[e,t,n]},deleteActiveInputConnection=(r,e,t)=>{for(const n of r)if(n[0]===e&&n[1]===t)return r.delete(n),n;return null},deleteActiveInputConnectionToAudioParam=(r,e,t)=>pickElementFromSet(r,n=>n[0]===e&&n[1]===t),deleteEventListenerOfAudioNode=(r,e)=>{if(!getEventListenersOfAudioNode(r).delete(e))throw new Error("Missing the expected event listener.")},deletePassiveInputConnectionToAudioParam=(r,e,t)=>{const n=getValueForKey(r,e),s=pickElementFromSet(n,i=>i[0]===t);return n.size===0&&r.delete(e),s},disconnectNativeAudioNodeFromNativeAudioNode=(r,e,t,n)=>{isNativeAudioNodeFaker(e)?r.disconnect(e.inputs[n],t,0):r.disconnect(e,t,n)},getNativeAudioNode=r=>getValueForKey(AUDIO_NODE_STORE,r),getNativeAudioParam=r=>getValueForKey(AUDIO_PARAM_STORE,r),isPartOfACycle=r=>CYCLE_COUNTERS.has(r),isPassiveAudioNode=r=>!ACTIVE_AUDIO_NODE_STORE.has(r),testAudioNodeDisconnectMethodSupport=(r,e)=>new Promise(t=>{if(e!==null)t(!0);else{const n=r.createScriptProcessor(256,1,1),s=r.createGain(),i=r.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;const a=r.createBufferSource();a.buffer=i,a.loop=!0,a.connect(n).connect(r.destination),a.connect(s),a.disconnect(s),n.onaudioprocess=l=>{const c=l.inputBuffer.getChannelData(0);Array.prototype.some.call(c,u=>u===1)?t(!0):t(!1),a.stop(),n.onaudioprocess=null,a.disconnect(n),n.disconnect(r.destination)},a.start()}}),visitEachAudioNodeOnce=(r,e)=>{const t=new Map;for(const n of r)for(const s of n){const i=t.get(s);t.set(s,i===void 0?1:i+1)}t.forEach((n,s)=>e(s,n))},isNativeAudioNode$1=r=>"context"in r,wrapAudioNodeDisconnectMethod=r=>{const e=new Map;r.connect=(t=>(n,s=0,i=0)=>{const o=isNativeAudioNode$1(n)?t(n,s,i):t(n,s),a=e.get(n);return a===void 0?e.set(n,[{input:i,output:s}]):a.every(l=>l.input!==i||l.output!==s)&&a.push({input:i,output:s}),o})(r.connect.bind(r)),r.disconnect=(t=>(n,s,i)=>{if(t.apply(r),n===void 0)e.clear();else if(typeof n=="number")for(const[o,a]of e){const l=a.filter(c=>c.output!==n);l.length===0?e.delete(o):e.set(o,l)}else if(e.has(n))if(s===void 0)e.delete(n);else{const o=e.get(n);if(o!==void 0){const a=o.filter(l=>l.output!==s&&(l.input!==i||i===void 0));a.length===0?e.delete(n):e.set(n,a)}}for(const[o,a]of e)a.forEach(l=>{isNativeAudioNode$1(o)?r.connect(o,l.output,l.input):r.connect(o,l.output)})})(r.disconnect)},addConnectionToAudioParamOfAudioContext=(r,e,t,n)=>{const{activeInputs:s,passiveInputs:i}=getAudioParamConnections(e),{outputs:o}=getAudioNodeConnections(r),a=getEventListenersOfAudioNode(r),l=c=>{const u=getNativeAudioNode(r),p=getNativeAudioParam(e);if(c){const g=deletePassiveInputConnectionToAudioParam(i,r,t);addActiveInputConnectionToAudioParam(s,r,g,!1),!n&&!isPartOfACycle(r)&&u.connect(p,t)}else{const g=deleteActiveInputConnectionToAudioParam(s,r,t);addPassiveInputConnectionToAudioParam(i,g,!1),!n&&!isPartOfACycle(r)&&u.disconnect(p,t)}};return insertElementInSet(o,[e,t],c=>c[0]===e&&c[1]===t,!0)?(a.add(l),isActiveAudioNode(r)?addActiveInputConnectionToAudioParam(s,r,[t,l],!0):addPassiveInputConnectionToAudioParam(i,[r,t,l],!0),!0):!1},deleteInputConnectionOfAudioNode=(r,e,t,n)=>{const{activeInputs:s,passiveInputs:i}=getAudioNodeConnections(e),o=deleteActiveInputConnection(s[n],r,t);return o===null?[deletePassiveInputConnectionToAudioNode(i,r,t,n)[2],!1]:[o[2],!0]},deleteInputConnectionOfAudioParam=(r,e,t)=>{const{activeInputs:n,passiveInputs:s}=getAudioParamConnections(e),i=deleteActiveInputConnection(n,r,t);return i===null?[deletePassiveInputConnectionToAudioParam(s,r,t)[1],!1]:[i[2],!0]},deleteInputsOfAudioNode=(r,e,t,n,s)=>{const[i,o]=deleteInputConnectionOfAudioNode(r,t,n,s);if(i!==null&&(deleteEventListenerOfAudioNode(r,i),o&&!e&&!isPartOfACycle(r)&&disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(r),getNativeAudioNode(t),n,s)),isActiveAudioNode(t)){const{activeInputs:a}=getAudioNodeConnections(t);setInternalStateToPassiveWhenNecessary(t,a)}},deleteInputsOfAudioParam=(r,e,t,n)=>{const[s,i]=deleteInputConnectionOfAudioParam(r,t,n);s!==null&&(deleteEventListenerOfAudioNode(r,s),i&&!e&&!isPartOfACycle(r)&&getNativeAudioNode(r).disconnect(getNativeAudioParam(t),n))},deleteAnyConnection=(r,e)=>{const t=getAudioNodeConnections(r),n=[];for(const s of t.outputs)isAudioNodeOutputConnection(s)?deleteInputsOfAudioNode(r,e,...s):deleteInputsOfAudioParam(r,e,...s),n.push(s[0]);return t.outputs.clear(),n},deleteConnectionAtOutput=(r,e,t)=>{const n=getAudioNodeConnections(r),s=[];for(const i of n.outputs)i[1]===t&&(isAudioNodeOutputConnection(i)?deleteInputsOfAudioNode(r,e,...i):deleteInputsOfAudioParam(r,e,...i),s.push(i[0]),n.outputs.delete(i));return s},deleteConnectionToDestination=(r,e,t,n,s)=>{const i=getAudioNodeConnections(r);return Array.from(i.outputs).filter(o=>o[0]===t&&(n===void 0||o[1]===n)&&(s===void 0||o[2]===s)).map(o=>(isAudioNodeOutputConnection(o)?deleteInputsOfAudioNode(r,e,...o):deleteInputsOfAudioParam(r,e,...o),i.outputs.delete(o),o[0]))},createAudioNodeConstructor=(r,e,t,n,s,i,o,a,l,c,u,p,g,y,h,d)=>class extends c{constructor(v,T,R,N){super(R),this._context=v,this._nativeAudioNode=R;const m=u(v);p(m)&&t(testAudioNodeDisconnectMethodSupport,()=>testAudioNodeDisconnectMethodSupport(m,d))!==!0&&wrapAudioNodeDisconnectMethod(R),AUDIO_NODE_STORE.set(this,R),EVENT_LISTENERS.set(this,new Set),v.state!=="closed"&&T&&setInternalStateToActive(this),r(this,N,R)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,T=0,R=0){if(T<0||T>=this._nativeAudioNode.numberOfOutputs)throw s();const N=u(this._context),m=h(N);if(g(v)||y(v))throw i();if(isAudioNode$1(v)){const x=getNativeAudioNode(v);try{const w=connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode,x,T,R),E=isPassiveAudioNode(this);(m||E)&&this._nativeAudioNode.disconnect(...w),this.context.state!=="closed"&&!E&&isPassiveAudioNode(v)&&setInternalStateToActive(v)}catch(w){throw w.code===12?i():w}if(e(this,v,T,R,m)){const w=l([this],v);visitEachAudioNodeOnce(w,n(m))}return v}const b=getNativeAudioParam(v);if(b.name==="playbackRate"&&b.maxValue===1024)throw o();try{this._nativeAudioNode.connect(b,T),(m||isPassiveAudioNode(this))&&this._nativeAudioNode.disconnect(b,T)}catch(x){throw x.code===12?i():x}if(addConnectionToAudioParamOfAudioContext(this,v,T,m)){const x=l([this],v);visitEachAudioNodeOnce(x,n(m))}}disconnect(v,T,R){let N;const m=u(this._context),b=h(m);if(v===void 0)N=deleteAnyConnection(this,b);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw s();N=deleteConnectionAtOutput(this,b,v)}else{if(T!==void 0&&(T<0||T>=this.numberOfOutputs)||isAudioNode$1(v)&&R!==void 0&&(R<0||R>=v.numberOfInputs))throw s();if(N=deleteConnectionToDestination(this,b,v,T,R),N.length===0)throw i()}for(const P of N){const x=l([this],P);visitEachAudioNodeOnce(x,a)}}},createAudioParamFactory=(r,e,t,n,s,i,o,a,l,c,u,p,g)=>(y,h,d,f=null,v=null)=>{const T=d.value,R=new AutomationEventList(T),N=h?n(R):null,m={get defaultValue(){return T},get maxValue(){return f===null?d.maxValue:f},get minValue(){return v===null?d.minValue:v},get value(){return d.value},set value(b){d.value=b,m.setValueAtTime(b,y.context.currentTime)},cancelAndHoldAtTime(b){if(typeof d.cancelAndHoldAtTime=="function")N===null&&R.flush(y.context.currentTime),R.add(s(b)),d.cancelAndHoldAtTime(b);else{const P=Array.from(R).pop();N===null&&R.flush(y.context.currentTime),R.add(s(b));const x=Array.from(R).pop();d.cancelScheduledValues(b),P!==x&&x!==void 0&&(x.type==="exponentialRampToValue"?d.exponentialRampToValueAtTime(x.value,x.endTime):x.type==="linearRampToValue"?d.linearRampToValueAtTime(x.value,x.endTime):x.type==="setValue"?d.setValueAtTime(x.value,x.startTime):x.type==="setValueCurve"&&d.setValueCurveAtTime(x.values,x.startTime,x.duration))}return m},cancelScheduledValues(b){return N===null&&R.flush(y.context.currentTime),R.add(i(b)),d.cancelScheduledValues(b),m},exponentialRampToValueAtTime(b,P){if(b===0)throw new RangeError;if(!Number.isFinite(P)||P<0)throw new RangeError;const x=y.context.currentTime;return N===null&&R.flush(x),Array.from(R).length===0&&(R.add(c(T,x)),d.setValueAtTime(T,x)),R.add(o(b,P)),d.exponentialRampToValueAtTime(b,P),m},linearRampToValueAtTime(b,P){const x=y.context.currentTime;return N===null&&R.flush(x),Array.from(R).length===0&&(R.add(c(T,x)),d.setValueAtTime(T,x)),R.add(a(b,P)),d.linearRampToValueAtTime(b,P),m},setTargetAtTime(b,P,x){return N===null&&R.flush(y.context.currentTime),R.add(l(b,P,x)),d.setTargetAtTime(b,P,x),m},setValueAtTime(b,P){return N===null&&R.flush(y.context.currentTime),R.add(c(b,P)),d.setValueAtTime(b,P),m},setValueCurveAtTime(b,P,x){const S=b instanceof Float32Array?b:new Float32Array(b);if(p!==null&&p.name==="webkitAudioContext"){const w=P+x,E=y.context.sampleRate,V=Math.ceil(P*E),$=Math.floor(w*E),j=$-V,D=new Float32Array(j);for(let G=0;G<j;G+=1){const X=(S.length-1)/x*((V+G)/E-P),Z=Math.floor(X),ne=Math.ceil(X);D[G]=Z===ne?S[Z]:(1-(X-Z))*S[Z]+(1-(ne-X))*S[ne]}N===null&&R.flush(y.context.currentTime),R.add(u(D,P,x)),d.setValueCurveAtTime(D,P,x);const Y=$/E;Y<w&&g(m,D[D.length-1],Y),g(m,S[S.length-1],w)}else N===null&&R.flush(y.context.currentTime),R.add(u(S,P,x)),d.setValueCurveAtTime(S,P,x);return m}};return t.set(m,d),e.set(m,y),r(m,N),m},createAudioParamRenderer=r=>({replay(e){for(const t of r)if(t.type==="exponentialRampToValue"){const{endTime:n,value:s}=t;e.exponentialRampToValueAtTime(s,n)}else if(t.type==="linearRampToValue"){const{endTime:n,value:s}=t;e.linearRampToValueAtTime(s,n)}else if(t.type==="setTarget"){const{startTime:n,target:s,timeConstant:i}=t;e.setTargetAtTime(s,n,i)}else if(t.type==="setValue"){const{startTime:n,value:s}=t;e.setValueAtTime(s,n)}else if(t.type==="setValueCurve"){const{duration:n,startTime:s,values:i}=t;e.setValueCurveAtTime(i,s,n)}else throw new Error("Can't apply an unknown automation.")}});class ReadOnlyMap{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,s)=>e.call(t,n,s,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const DEFAULT_OPTIONS$g={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},createAudioWorkletNodeConstructor=(r,e,t,n,s,i,o,a,l,c,u,p,g,y)=>class extends e{constructor(d,f,v){var T;const R=a(d),N=l(R),m=u({...DEFAULT_OPTIONS$g,...v});g(m);const b=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(R),P=b==null?void 0:b.get(f),x=N||R.state!=="closed"?R:(T=o(R))!==null&&T!==void 0?T:R,S=s(x,N?null:d.baseLatency,c,f,P,m),w=N?n(f,m,P):null;super(d,!0,S,w);const E=[];S.parameters.forEach(($,j)=>{const D=t(this,N,$);E.push([j,D])}),this._nativeAudioWorkletNode=S,this._onprocessorerror=null,this._parameters=new ReadOnlyMap(E),N&&r(R,this);const{activeInputs:V}=i(this);p(S,V)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(d){const f=typeof d=="function"?y(this,d):null;this._nativeAudioWorkletNode.onprocessorerror=f;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===f?d:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function copyFromChannel(r,e,t,n,s){if(typeof r.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),r.copyFromChannel(e[t],n,s);else{const i=r.getChannelData(n);if(e[t].byteLength===0)e[t]=i.slice(s,s+128);else{const o=new Float32Array(i.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const copyToChannel=(r,e,t,n,s)=>{typeof r.copyToChannel=="function"?e[t].byteLength!==0&&r.copyToChannel(e[t],n,s):e[t].byteLength!==0&&r.getChannelData(n).set(e[t],s)},createNestedArrays=(r,e)=>{const t=[];for(let n=0;n<r;n+=1){const s=[],i=typeof e=="number"?e:e[n];for(let o=0;o<i;o+=1)s.push(new Float32Array(128));t.push(s)}return t},getAudioWorkletProcessor=(r,e)=>{const t=getValueForKey(NODE_TO_PROCESSOR_MAPS,r),n=getNativeAudioNode(e);return getValueForKey(t,n)},processBuffer=async(r,e,t,n,s,i,o)=>{const a=e===null?Math.ceil(r.context.length/128)*128:e.length,l=n.channelCount*n.numberOfInputs,c=s.reduce((f,v)=>f+v,0),u=c===0?null:t.createBuffer(c,a,t.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const p=getAudioNodeConnections(r),g=await getAudioWorkletProcessor(t,r),y=createNestedArrays(n.numberOfInputs,n.channelCount),h=createNestedArrays(n.numberOfOutputs,s),d=Array.from(r.parameters.keys()).reduce((f,v)=>({...f,[v]:new Float32Array(128)}),{});for(let f=0;f<a;f+=128){if(n.numberOfInputs>0&&e!==null)for(let v=0;v<n.numberOfInputs;v+=1)for(let T=0;T<n.channelCount;T+=1)copyFromChannel(e,y[v],T,T,f);i.parameterDescriptors!==void 0&&e!==null&&i.parameterDescriptors.forEach(({name:v},T)=>{copyFromChannel(e,d,v,l+T,f)});for(let v=0;v<n.numberOfInputs;v+=1)for(let T=0;T<s[v];T+=1)h[v][T].byteLength===0&&(h[v][T]=new Float32Array(128));try{const v=y.map((R,N)=>p.activeInputs[N].size===0?[]:R),T=o(f/t.sampleRate,t.sampleRate,()=>g.process(v,h,d));if(u!==null)for(let R=0,N=0;R<n.numberOfOutputs;R+=1){for(let m=0;m<s[R];m+=1)copyToChannel(u,h[R],m,N+m,f);N+=s[R]}if(!T)break}catch(v){r.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},createAudioWorkletNodeRendererFactory=(r,e,t,n,s,i,o,a,l,c,u,p,g,y,h,d)=>(f,v,T)=>{const R=new WeakMap;let N=null;const m=async(b,P)=>{let x=u(b),S=null;const w=isOwnedByContext(x,P),E=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(p===null){const V=E.reduce((Y,G)=>Y+G,0),$=s(P,{channelCount:Math.max(1,V),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,V)}),j=[];for(let Y=0;Y<b.numberOfOutputs;Y+=1)j.push(n(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[Y]}));const D=o(P,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});D.connect=e.bind(null,j),D.disconnect=l.bind(null,j),S=[$,j,D]}else w||(x=new p(P,f));if(R.set(P,S===null?x:S[2]),S!==null){if(N===null){if(T===void 0)throw new Error("Missing the processor constructor.");if(g===null)throw new Error("Missing the native OfflineAudioContext constructor.");const G=b.channelCount*b.numberOfInputs,X=T.parameterDescriptors===void 0?0:T.parameterDescriptors.length,Z=G+X;N=processBuffer(b,Z===0?null:await(async()=>{const ie=new g(Z,Math.ceil(b.context.length/128)*128,P.sampleRate),be=[],Q=[];for(let F=0;F<v.numberOfInputs;F+=1)be.push(o(ie,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),Q.push(s(ie,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const O=await Promise.all(Array.from(b.parameters.values()).map(async F=>{const z=i(ie,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:F.value});return await y(ie,F,z.offset),z})),k=n(ie,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,G+X)});for(let F=0;F<v.numberOfInputs;F+=1){be[F].connect(Q[F]);for(let z=0;z<v.channelCount;z+=1)Q[F].connect(k,z,F*v.channelCount+z)}for(const[F,z]of O.entries())z.connect(k,0,G+F),z.start(0);return k.connect(ie.destination),await Promise.all(be.map(F=>h(b,ie,F))),d(ie)})(),P,v,E,T,c)}const V=await N,$=t(P,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[j,D,Y]=S;V!==null&&($.buffer=V,$.start(0)),$.connect(j);for(let G=0,X=0;G<b.numberOfOutputs;G+=1){const Z=D[G];for(let ne=0;ne<E[G];ne+=1)j.connect(Z,X+ne,ne);X+=E[G]}return Y}if(w)for(const[V,$]of b.parameters.entries())await r(P,$,x.parameters.get(V));else for(const[V,$]of b.parameters.entries())await y(P,$,x.parameters.get(V));return await h(b,P,x),x};return{render(b,P){a(P,b);const x=R.get(P);return x!==void 0?Promise.resolve(x):m(b,P)}}},createBaseAudioContextConstructor=(r,e,t,n,s,i,o,a,l,c,u,p,g,y,h,d,f,v,T,R)=>class extends h{constructor(m,b){super(m,b),this._nativeContext=m,this._audioWorklet=r===void 0?void 0:{addModule:(P,x)=>r(this,P,x)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new s(this)}createBuffer(m,b,P){return new t({length:b,numberOfChannels:m,sampleRate:P})}createBufferSource(){return new n(this)}createChannelMerger(m=6){return new i(this,{numberOfInputs:m})}createChannelSplitter(m=6){return new o(this,{numberOfOutputs:m})}createConstantSource(){return new a(this)}createConvolver(){return new l(this)}createDelay(m=1){return new u(this,{maxDelayTime:m})}createDynamicsCompressor(){return new p(this)}createGain(){return new g(this)}createIIRFilter(m,b){return new y(this,{feedback:b,feedforward:m})}createOscillator(){return new d(this)}createPanner(){return new f(this)}createPeriodicWave(m,b,P={disableNormalization:!1}){return new v(this,{...P,imag:b,real:m})}createStereoPanner(){return new T(this)}createWaveShaper(){return new R(this)}decodeAudioData(m,b,P){return c(this._nativeContext,m).then(x=>(typeof b=="function"&&b(x),x),x=>{throw typeof P=="function"&&P(x),x})}},DEFAULT_OPTIONS$f={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},createBiquadFilterNodeConstructor=(r,e,t,n,s,i,o,a)=>class extends r{constructor(c,u){const p=i(c),g={...DEFAULT_OPTIONS$f,...u},y=s(p,g),h=o(p),d=h?t():null;super(c,!1,y,d),this._Q=e(this,h,y.Q,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._detune=e(this,h,y.detune,1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT),-1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT)),this._frequency=e(this,h,y.frequency,c.sampleRate/2,0),this._gain=e(this,h,y.gain,40*Math.log10(MOST_POSITIVE_SINGLE_FLOAT),MOST_NEGATIVE_SINGLE_FLOAT),this._nativeBiquadFilterNode=y,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(c){this._nativeBiquadFilterNode.type=c}getFrequencyResponse(c,u,p){try{this._nativeBiquadFilterNode.getFrequencyResponse(c,u,p)}catch(g){throw g.code===11?n():g}if(c.length!==u.length||u.length!==p.length)throw n()}},createBiquadFilterNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(a,l)=>{let c=t(a);const u=isOwnedByContext(c,l);if(!u){const p={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(l,p)}return i.set(l,c),u?(await r(l,a.Q,c.Q),await r(l,a.detune,c.detune),await r(l,a.frequency,c.frequency),await r(l,a.gain,c.gain)):(await n(l,a.Q,c.Q),await n(l,a.detune,c.detune),await n(l,a.frequency,c.frequency),await n(l,a.gain,c.gain)),await s(a,l,c),c};return{render(a,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):o(a,l)}}},createCacheTestResult=(r,e)=>(t,n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r.get(t);if(i!==void 0)return i;try{const o=n();return o instanceof Promise?(r.set(t,o),o.catch(()=>!1).then(a=>(r.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},DEFAULT_OPTIONS$e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},createChannelMergerNodeConstructor=(r,e,t,n,s)=>class extends r{constructor(o,a){const l=n(o),c={...DEFAULT_OPTIONS$e,...a},u=t(l,c),p=s(l)?e():null;super(o,!1,u,p)}},createChannelMergerNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const c={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=r(o,c)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):s(i,o)}}},DEFAULT_OPTIONS$d={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},createChannelSplitterNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(a,l){const c=n(a),u=i({...DEFAULT_OPTIONS$d,...l}),p=t(c,u),g=s(c)?e():null;super(a,!1,p,g)}},createChannelSplitterNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const c={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=r(o,c)}return n.set(o,a),await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):s(i,o)}}},createConnectAudioParam=r=>(e,t,n)=>r(t,e,n),createConnectMultipleOutputs=r=>(e,t,n=0,s=0)=>{const i=e[n];if(i===void 0)throw r();return isNativeAudioNode$1(t)?i.connect(t,0,s):i.connect(t,0)},createConnectedNativeAudioBufferSourceNodeFactory=r=>(e,t)=>{const n=r(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=e.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}},DEFAULT_OPTIONS$c={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},createConstantSourceNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(l,c){const u=s(l),p={...DEFAULT_OPTIONS$c,...c},g=n(u,p),y=i(u),h=y?t():null;super(l,!1,g,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=g,this._offset=e(this,y,g.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(l){const c=typeof l=="function"?o(this,l):null;this._nativeConstantSourceNode.onended=c;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===c?l:u}start(l=0){if(this._nativeConstantSourceNode.start(l),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=l),this.context.state!=="closed"){setInternalStateToActive(this);const c=()=>{this._nativeConstantSourceNode.removeEventListener("ended",c),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeConstantSourceNode.addEventListener("ended",c)}}stop(l=0){this._nativeConstantSourceNode.stop(l),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=l)}},createConstantSourceNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap;let o=null,a=null;const l=async(c,u)=>{let p=t(c);const g=isOwnedByContext(p,u);if(!g){const y={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,offset:p.offset.value};p=e(u,y),o!==null&&p.start(o),a!==null&&p.stop(a)}return i.set(u,p),g?await r(u,c.offset,p.offset):await n(u,c.offset,p.offset),await s(c,u,p),p};return{set start(c){o=c},set stop(c){a=c},render(c,u){const p=i.get(u);return p!==void 0?Promise.resolve(p):l(c,u)}}},createConvertNumberToUnsignedLong=r=>e=>(r[0]=e,r[0]),DEFAULT_OPTIONS$b={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},createConvolverNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(a,l){const c=n(a),u={...DEFAULT_OPTIONS$b,...l},p=t(c,u),y=s(c)?e():null;super(a,!1,p,y),this._isBufferNullified=!1,this._nativeConvolverNode=p,u.buffer!==null&&i(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const l=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=l.createBuffer(1,1,l.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},createConvolverNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const c={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=r(o,c)}return n.set(o,a),isNativeAudioNodeFaker(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):s(i,o)}}},createCreateNativeOfflineAudioContext=(r,e)=>(t,n,s)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,s)}catch(i){throw i.name==="SyntaxError"?r():i}},createDataCloneError=()=>new DOMException("","DataCloneError"),detachArrayBuffer=r=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const s=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>s();try{e.postMessage(r,[r])}catch{}finally{s()}})},createDecodeAudioData=(r,e,t,n,s,i,o,a,l,c,u)=>(p,g)=>{const y=o(p)?p:i(p);if(s.has(g)){const h=t();return Promise.reject(h)}try{s.add(g)}catch{}return e(l,()=>l(y))?y.decodeAudioData(g).then(h=>(detachArrayBuffer(g).catch(()=>{}),e(a,()=>a(h))||u(h),r.add(h),h)):new Promise((h,d)=>{const f=async()=>{try{await detachArrayBuffer(g)}catch{}},v=T=>{d(T),f()};try{y.decodeAudioData(g,T=>{typeof T.copyFromChannel!="function"&&(c(T),wrapAudioBufferGetChannelDataMethod(T)),r.add(T),f().then(()=>h(T))},T=>{v(T===null?n():T)})}catch(T){v(T)}})},createDecrementCycleCounter=(r,e,t,n,s,i,o,a)=>(l,c)=>{const u=e.get(l);if(u===void 0)throw new Error("Missing the expected cycle count.");const p=i(l.context),g=a(p);if(u===c){if(e.delete(l),!g&&o(l)){const y=n(l),{outputs:h}=t(l);for(const d of h)if(isAudioNodeOutputConnection(d)){const f=n(d[0]);r(y,f,d[1],d[2])}else{const f=s(d[0]);y.connect(f,d[1])}}}else e.set(l,u-c)},DEFAULT_OPTIONS$a={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},createDelayNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(l,c){const u=s(l),p={...DEFAULT_OPTIONS$a,...c},g=n(u,p),y=i(u),h=y?t(p.maxDelayTime):null;super(l,!1,g,h),this._delayTime=e(this,y,g.delayTime),o(this,p.maxDelayTime)}get delayTime(){return this._delayTime}},createDelayNodeRendererFactory=(r,e,t,n,s)=>i=>{const o=new WeakMap,a=async(l,c)=>{let u=t(l);const p=isOwnedByContext(u,c);if(!p){const g={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:i};u=e(c,g)}return o.set(c,u),p?await r(c,l.delayTime,u.delayTime):await n(c,l.delayTime,u.delayTime),await s(l,c,u),u};return{render(l,c){const u=o.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},createDeleteActiveInputConnectionToAudioNode=r=>(e,t,n,s)=>r(e[s],i=>i[0]===t&&i[1]===n),createDeleteUnrenderedAudioWorkletNode=r=>(e,t)=>{r(e).delete(t)},isDelayNode=r=>"delayTime"in r,createDetectCycles=(r,e,t)=>function n(s,i){const o=isAudioNode$1(i)?i:t(r,i);if(isDelayNode(o))return[];if(s[0]===o)return[s];if(s.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(l=>n([...s,o],l[0])).reduce((l,c)=>l.concat(c),[])},getOutputAudioNodeAtIndex=(r,e,t)=>{const n=e[t];if(n===void 0)throw r();return n},createDisconnectMultipleOutputs=r=>(e,t=void 0,n=void 0,s=0)=>t===void 0?e.forEach(i=>i.disconnect()):typeof t=="number"?getOutputAudioNodeAtIndex(r,e,t).disconnect():isNativeAudioNode$1(t)?n===void 0?e.forEach(i=>i.disconnect(t)):s===void 0?getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0):getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0,s):n===void 0?e.forEach(i=>i.disconnect(t)):getOutputAudioNodeAtIndex(r,e,n).disconnect(t,0),DEFAULT_OPTIONS$9={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},createDynamicsCompressorNodeConstructor=(r,e,t,n,s,i,o,a)=>class extends r{constructor(c,u){const p=i(c),g={...DEFAULT_OPTIONS$9,...u},y=n(p,g),h=o(p),d=h?t():null;super(c,!1,y,d),this._attack=e(this,h,y.attack),this._knee=e(this,h,y.knee),this._nativeDynamicsCompressorNode=y,this._ratio=e(this,h,y.ratio),this._release=e(this,h,y.release),this._threshold=e(this,h,y.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(c){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=c,c>2)throw this._nativeDynamicsCompressorNode.channelCount=u,s()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(c){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=c,c==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,s()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},createDynamicsCompressorNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(a,l)=>{let c=t(a);const u=isOwnedByContext(c,l);if(!u){const p={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(l,p)}return i.set(l,c),u?(await r(l,a.attack,c.attack),await r(l,a.knee,c.knee),await r(l,a.ratio,c.ratio),await r(l,a.release,c.release),await r(l,a.threshold,c.threshold)):(await n(l,a.attack,c.attack),await n(l,a.knee,c.knee),await n(l,a.ratio,c.ratio),await n(l,a.release,c.release),await n(l,a.threshold,c.threshold)),await s(a,l,c),c};return{render(a,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):o(a,l)}}},createEncodingError=()=>new DOMException("","EncodingError"),createEvaluateSource=r=>e=>new Promise((t,n)=>{if(r===null){n(new SyntaxError);return}const s=r.document.head;if(s===null)n(new SyntaxError);else{const i=r.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=r.onerror,c=()=>{r.onerror=l,URL.revokeObjectURL(a)};r.onerror=(u,p,g,y,h)=>{if(p===a||p===r.location.href&&g===1&&y===1)return c(),n(h),!1;if(l!==null)return l(u,p,g,y,h)},i.onerror=()=>{c(),n(new SyntaxError)},i.onload=()=>{c(),t()},i.src=a,i.type="module",s.appendChild(i)}}),createEventTargetConstructor=r=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,s){if(n!==null){let i=this._listeners.get(n);i===void 0&&(i=r(this,n),typeof n=="function"&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,s){const i=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,s)}},createExposeCurrentFrameAndCurrentTime=r=>(e,t,n)=>{Object.defineProperties(r,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{r!==null&&(delete r.currentFrame,delete r.currentTime)}},createFetchSource=r=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw r()},DEFAULT_OPTIONS$8={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},createGainNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(a,l){const c=s(a),u={...DEFAULT_OPTIONS$8,...l},p=n(c,u),g=i(c),y=g?t():null;super(a,!1,p,y),this._gain=e(this,g,p.gain,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get gain(){return this._gain}},createGainNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(a,l)=>{let c=t(a);const u=isOwnedByContext(c,l);if(!u){const p={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(l,p)}return i.set(l,c),u?await r(l,a.gain,c.gain):await n(l,a.gain,c.gain),await s(a,l,c),c};return{render(a,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):o(a,l)}}},createGetActiveAudioWorkletNodeInputs=(r,e)=>t=>e(r,t),createGetAudioNodeRenderer=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},createGetAudioNodeTailTime=r=>e=>{var t;return(t=r.get(e))!==null&&t!==void 0?t:0},createGetAudioParamRenderer=r=>e=>{const t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},createGetBackupOfflineAudioContext=r=>e=>r.get(e),createInvalidStateError=()=>new DOMException("","InvalidStateError"),createGetNativeContext=r=>e=>{const t=r.get(e);if(t===void 0)throw createInvalidStateError();return t},createGetOrCreateBackupOfflineAudioContext=(r,e)=>t=>{let n=r.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),r.set(t,n),n},createGetUnrenderedAudioWorkletNodes=r=>e=>{const t=r.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},createInvalidAccessError=()=>new DOMException("","InvalidAccessError"),wrapIIRFilterNodeGetFrequencyResponseMethod=r=>{r.getFrequencyResponse=(e=>(t,n,s)=>{if(t.length!==n.length||n.length!==s.length)throw createInvalidAccessError();return e.call(r,t,n,s)})(r.getFrequencyResponse)},DEFAULT_OPTIONS$7={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},createIIRFilterNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(a,l){const c=n(a),u=s(c),p={...DEFAULT_OPTIONS$7,...l},g=e(c,u?null:a.baseLatency,p),y=u?t(p.feedback,p.feedforward):null;super(a,!1,g,y),wrapIIRFilterNodeGetFrequencyResponseMethod(g),this._nativeIIRFilterNode=g,i(this,1)}getFrequencyResponse(a,l,c){return this._nativeIIRFilterNode.getFrequencyResponse(a,l,c)}},filterBuffer=(r,e,t,n,s,i,o,a,l,c,u)=>{const p=c.length;let g=a;for(let y=0;y<p;y+=1){let h=t[0]*c[y];for(let d=1;d<s;d+=1){const f=g-d&l-1;h+=t[d]*i[f],h-=r[d]*o[f]}for(let d=s;d<n;d+=1)h+=t[d]*i[g-d&l-1];for(let d=s;d<e;d+=1)h-=r[d]*o[g-d&l-1];i[g]=c[y],o[g]=h,g=g+1&l-1,u[y]=h}return g},filterFullBuffer=(r,e,t,n)=>{const s=t instanceof Float64Array?t:new Float64Array(t),i=n instanceof Float64Array?n:new Float64Array(n),o=s.length,a=i.length,l=Math.min(o,a);if(s[0]!==1){for(let h=0;h<o;h+=1)i[h]/=s[0];for(let h=1;h<a;h+=1)s[h]/=s[0]}const c=32,u=new Float32Array(c),p=new Float32Array(c),g=e.createBuffer(r.numberOfChannels,r.length,r.sampleRate),y=r.numberOfChannels;for(let h=0;h<y;h+=1){const d=r.getChannelData(h),f=g.getChannelData(h);u.fill(0),p.fill(0),filterBuffer(s,o,i,a,l,u,p,0,c,d,f)}return g},createIIRFilterNodeRendererFactory=(r,e,t,n,s)=>(i,o)=>{const a=new WeakMap;let l=null;const c=async(u,p)=>{let g=null,y=e(u);const h=isOwnedByContext(y,p);if(p.createIIRFilter===void 0?g=r(p,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):h||(y=p.createIIRFilter(o,i)),a.set(p,g===null?y:g),g!==null){if(l===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const f=new t(u.context.destination.channelCount,u.context.length,p.sampleRate);l=(async()=>{await n(u,f,f.destination);const v=await s(f);return filterFullBuffer(v,p,i,o)})()}const d=await l;return g.buffer=d,g.start(0),g}return await n(u,p,y),y};return{render(u,p){const g=a.get(p);return g!==void 0?Promise.resolve(g):c(u,p)}}},createIncrementCycleCounterFactory=(r,e,t,n,s,i)=>o=>(a,l)=>{const c=r.get(a);if(c===void 0){if(!o&&i(a)){const u=n(a),{outputs:p}=t(a);for(const g of p)if(isAudioNodeOutputConnection(g)){const y=n(g[0]);e(u,y,g[1],g[2])}else{const y=s(g[0]);u.disconnect(y,g[1])}}r.set(a,l)}else r.set(a,c+l)},createIsAnyAudioContext=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},createIsAnyAudioNode=(r,e)=>t=>r.has(t)||e(t),createIsAnyAudioParam=(r,e)=>t=>r.has(t)||e(t),createIsAnyOfflineAudioContext=(r,e)=>t=>{const n=r.get(t);return e(n)||e(t)},createIsNativeAudioContext=r=>e=>r!==null&&e instanceof r,createIsNativeAudioNode=r=>e=>r!==null&&typeof r.AudioNode=="function"&&e instanceof r.AudioNode,createIsNativeAudioParam=r=>e=>r!==null&&typeof r.AudioParam=="function"&&e instanceof r.AudioParam,createIsNativeContext=(r,e)=>t=>r(t)||e(t),createIsNativeOfflineAudioContext=r=>e=>r!==null&&e instanceof r,createIsSecureContext=r=>r!==null&&r.isSecureContext,createMediaElementAudioSourceNodeConstructor=(r,e,t,n)=>class extends r{constructor(i,o){const a=t(i),l=e(a,o);if(n(a))throw TypeError();super(i,!0,l,null),this._nativeMediaElementAudioSourceNode=l}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},DEFAULT_OPTIONS$6={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},createMediaStreamAudioDestinationNodeConstructor=(r,e,t,n)=>class extends r{constructor(i,o){const a=t(i);if(n(a))throw new TypeError;const l={...DEFAULT_OPTIONS$6,...o},c=e(a,l);super(i,!1,c,null),this._nativeMediaStreamAudioDestinationNode=c}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},createMediaStreamAudioSourceNodeConstructor=(r,e,t,n)=>class extends r{constructor(i,o){const a=t(i),l=e(a,o);if(n(a))throw new TypeError;super(i,!0,l,null),this._nativeMediaStreamAudioSourceNode=l}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},createMediaStreamTrackAudioSourceNodeConstructor=(r,e,t)=>class extends r{constructor(s,i){const o=t(s),a=e(o,i);super(s,!0,a,null)}},createMinimalBaseAudioContextConstructor=(r,e,t,n,s,i)=>class extends t{constructor(a,l){super(a),this._nativeContext=a,CONTEXT_STORE.set(this,a),n(a)&&s.set(a,new Set),this._destination=new r(this,l),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const l=typeof a=="function"?i(this,a):null;this._nativeContext.onstatechange=l;const c=this._nativeContext.onstatechange;this._onstatechange=c!==null&&c===l?a:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},testPromiseSupport=r=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=r.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},createMonitorConnections=(r,e)=>(t,n,s)=>{const i=new Set;return t.connect=(o=>(a,l=0,c=0)=>{const u=i.size===0;if(e(a))return o.call(t,a,l,c),r(i,[a,l,c],p=>p[0]===a&&p[1]===l&&p[2]===c,!0),u&&n(),a;o.call(t,a,l),r(i,[a,l],p=>p[0]===a&&p[1]===l,!0),u&&n()})(t.connect),t.disconnect=(o=>(a,l,c)=>{const u=i.size>0;if(a===void 0)o.apply(t),i.clear();else if(typeof a=="number"){o.call(t,a);for(const g of i)g[1]===a&&i.delete(g)}else{e(a)?o.call(t,a,l,c):o.call(t,a,l);for(const g of i)g[0]===a&&(l===void 0||g[1]===l)&&(c===void 0||g[2]===c)&&i.delete(g)}const p=i.size===0;u&&p&&s()})(t.disconnect),t},assignNativeAudioNodeOption=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t]&&(r[t]=n)},assignNativeAudioNodeOptions=(r,e)=>{assignNativeAudioNodeOption(r,e,"channelCount"),assignNativeAudioNodeOption(r,e,"channelCountMode"),assignNativeAudioNodeOption(r,e,"channelInterpretation")},testAnalyserNodeGetFloatTimeDomainDataMethodSupport=r=>typeof r.getFloatTimeDomainData=="function",wrapAnalyserNodeGetFloatTimeDomainDataMethod=r=>{r.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);r.getByteTimeDomainData(t);const n=Math.max(t.length,r.fftSize);for(let s=0;s<n;s+=1)e[s]=(t[s]-128)*.0078125;return e}},createNativeAnalyserNodeFactory=(r,e)=>(t,n)=>{const s=t.createAnalyser();if(assignNativeAudioNodeOptions(s,n),!(n.maxDecibels>n.minDecibels))throw e();return assignNativeAudioNodeOption(s,n,"fftSize"),assignNativeAudioNodeOption(s,n,"maxDecibels"),assignNativeAudioNodeOption(s,n,"minDecibels"),assignNativeAudioNodeOption(s,n,"smoothingTimeConstant"),r(testAnalyserNodeGetFloatTimeDomainDataMethodSupport,()=>testAnalyserNodeGetFloatTimeDomainDataMethodSupport(s))||wrapAnalyserNodeGetFloatTimeDomainDataMethod(s),s},createNativeAudioBufferConstructor=r=>r===null?null:r.hasOwnProperty("AudioBuffer")?r.AudioBuffer:null,assignNativeAudioNodeAudioParamValue=(r,e,t)=>{const n=e[t];n!==void 0&&n!==r[t].value&&(r[t].value=n)},wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=r=>{r.start=(e=>{let t=!1;return(n=0,s=0,i)=>{if(t)throw createInvalidStateError();e.call(r,n,s,i),t=!0}})(r.start)},wrapAudioScheduledSourceNodeStartMethodNegativeParameters=r=>{r.start=(e=>(t=0,n=0,s)=>{if(typeof s=="number"&&s<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(r,t,n,s)})(r.start)},wrapAudioScheduledSourceNodeStopMethodNegativeParameters=r=>{r.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(r,t)})(r.stop)},createNativeAudioBufferSourceNodeFactory=(r,e,t,n,s,i,o,a,l,c,u)=>(p,g)=>{const y=p.createBufferSource();return assignNativeAudioNodeOptions(y,g),assignNativeAudioNodeAudioParamValue(y,g,"playbackRate"),assignNativeAudioNodeOption(y,g,"buffer"),assignNativeAudioNodeOption(y,g,"loop"),assignNativeAudioNodeOption(y,g,"loopEnd"),assignNativeAudioNodeOption(y,g,"loopStart"),e(t,()=>t(p))||wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(y),e(n,()=>n(p))||l(y),e(s,()=>s(p))||c(y,p),e(i,()=>i(p))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(y),e(o,()=>o(p))||u(y,p),e(a,()=>a(p))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(y),r(p,y),y},createNativeAudioContextConstructor=r=>r===null?null:r.hasOwnProperty("AudioContext")?r.AudioContext:r.hasOwnProperty("webkitAudioContext")?r.webkitAudioContext:null,createNativeAudioDestinationNodeFactory=(r,e)=>(t,n,s)=>{const i=t.destination;if(i.channelCount!==n)try{i.channelCount=n}catch{}s&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:n});const o=r(t,{channelCount:n,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>l=>{a.call(o,l);try{i.channelCount=l}catch(c){if(l>i.maxChannelCount)throw c}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>l=>{a.call(o,l),i.channelCountMode=l}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>l=>{a.call(o,l),i.channelInterpretation=l}),Object.defineProperty(o,"maxChannelCount",{get:()=>i.maxChannelCount}),o.connect(i),o},createNativeAudioWorkletNodeConstructor=r=>r===null?null:r.hasOwnProperty("AudioWorkletNode")?r.AudioWorkletNode:null,testClonabilityOfAudioWorkletNodeOptions=r=>{const{port1:e}=new MessageChannel;try{e.postMessage(r)}finally{e.close()}},createNativeAudioWorkletNodeFactory=(r,e,t,n,s)=>(i,o,a,l,c,u)=>{if(a!==null)try{const p=new a(i,l,u),g=new Map;let y=null;if(Object.defineProperties(p,{channelCount:{get:()=>u.channelCount,set:()=>{throw r()}},channelCountMode:{get:()=>"explicit",set:()=>{throw r()}},onprocessorerror:{get:()=>y,set:h=>{typeof y=="function"&&p.removeEventListener("processorerror",y),y=typeof h=="function"?h:null,typeof y=="function"&&p.addEventListener("processorerror",y)}}}),p.addEventListener=(h=>(...d)=>{if(d[0]==="processorerror"){const f=typeof d[1]=="function"?d[1]:typeof d[1]=="object"&&d[1]!==null&&typeof d[1].handleEvent=="function"?d[1].handleEvent:null;if(f!==null){const v=g.get(d[1]);v!==void 0?d[1]=v:(d[1]=T=>{T.type==="error"?(Object.defineProperties(T,{type:{value:"processorerror"}}),f(T)):f(new ErrorEvent(d[0],{...T}))},g.set(f,d[1]))}}return h.call(p,"error",d[1],d[2]),h.call(p,...d)})(p.addEventListener),p.removeEventListener=(h=>(...d)=>{if(d[0]==="processorerror"){const f=g.get(d[1]);f!==void 0&&(g.delete(d[1]),d[1]=f)}return h.call(p,"error",d[1],d[2]),h.call(p,d[0],d[1],d[2])})(p.removeEventListener),u.numberOfOutputs!==0){const h=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return p.connect(h).connect(i.destination),s(p,()=>h.disconnect(),()=>h.connect(i.destination))}return p}catch(p){throw p.code===11?n():p}if(c===void 0)throw n();return testClonabilityOfAudioWorkletNodeOptions(u),e(i,o,c,u)},computeBufferSize=(r,e)=>r===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(r*e))))),cloneAudioWorkletNodeOptions=r=>new Promise((e,t)=>{const{port1:n,port2:s}=new MessageChannel;n.onmessage=({data:i})=>{n.close(),s.close(),e(i)},n.onmessageerror=({data:i})=>{n.close(),s.close(),t(i)},s.postMessage(r)}),createAudioWorkletProcessorPromise=async(r,e)=>{const t=await cloneAudioWorkletNodeOptions(e);return new r(t)},createAudioWorkletProcessor=(r,e,t,n)=>{let s=NODE_TO_PROCESSOR_MAPS.get(r);s===void 0&&(s=new WeakMap,NODE_TO_PROCESSOR_MAPS.set(r,s));const i=createAudioWorkletProcessorPromise(t,n);return s.set(e,i),i},createNativeAudioWorkletNodeFakerFactory=(r,e,t,n,s,i,o,a,l,c,u,p,g)=>(y,h,d,f)=>{if(f.numberOfInputs===0&&f.numberOfOutputs===0)throw l();const v=Array.isArray(f.outputChannelCount)?f.outputChannelCount:Array.from(f.outputChannelCount);if(v.some(se=>se<1))throw l();if(v.length!==f.numberOfOutputs)throw e();if(f.channelCountMode!=="explicit")throw l();const T=f.channelCount*f.numberOfInputs,R=v.reduce((se,ge)=>se+ge,0),N=d.parameterDescriptors===void 0?0:d.parameterDescriptors.length;if(T+N>6||R>6)throw l();const m=new MessageChannel,b=[],P=[];for(let se=0;se<f.numberOfInputs;se+=1)b.push(o(y,{channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,gain:1})),P.push(s(y,{channelCount:f.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:f.channelCount}));const x=[];if(d.parameterDescriptors!==void 0)for(const{defaultValue:se,maxValue:ge,minValue:Ee,name:Oe}of d.parameterDescriptors){const Me=i(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:f.parameterData[Oe]!==void 0?f.parameterData[Oe]:se===void 0?0:se});Object.defineProperties(Me.offset,{defaultValue:{get:()=>se===void 0?0:se},maxValue:{get:()=>ge===void 0?MOST_POSITIVE_SINGLE_FLOAT:ge},minValue:{get:()=>Ee===void 0?MOST_NEGATIVE_SINGLE_FLOAT:Ee}}),x.push(Me)}const S=n(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,T+N)}),w=computeBufferSize(h,y.sampleRate),E=a(y,w,T+N,Math.max(1,R)),V=s(y,{channelCount:Math.max(1,R),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,R)}),$=[];for(let se=0;se<f.numberOfOutputs;se+=1)$.push(n(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[se]}));for(let se=0;se<f.numberOfInputs;se+=1){b[se].connect(P[se]);for(let ge=0;ge<f.channelCount;ge+=1)P[se].connect(S,ge,se*f.channelCount+ge)}const j=new ReadOnlyMap(d.parameterDescriptors===void 0?[]:d.parameterDescriptors.map(({name:se},ge)=>{const Ee=x[ge];return Ee.connect(S,0,T+ge),Ee.start(0),[se,Ee.offset]}));S.connect(E);let D=f.channelInterpretation,Y=null;const G=f.numberOfOutputs===0?[E]:$,X={get bufferSize(){return w},get channelCount(){return f.channelCount},set channelCount(se){throw t()},get channelCountMode(){return f.channelCountMode},set channelCountMode(se){throw t()},get channelInterpretation(){return D},set channelInterpretation(se){for(const ge of b)ge.channelInterpretation=se;D=se},get context(){return E.context},get inputs(){return b},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get onprocessorerror(){return Y},set onprocessorerror(se){typeof Y=="function"&&X.removeEventListener("processorerror",Y),Y=typeof se=="function"?se:null,typeof Y=="function"&&X.addEventListener("processorerror",Y)},get parameters(){return j},get port(){return m.port2},addEventListener(...se){return E.addEventListener(se[0],se[1],se[2])},connect:r.bind(null,G),disconnect:c.bind(null,G),dispatchEvent(...se){return E.dispatchEvent(se[0])},removeEventListener(...se){return E.removeEventListener(se[0],se[1],se[2])}},Z=new Map;m.port1.addEventListener=(se=>(...ge)=>{if(ge[0]==="message"){const Ee=typeof ge[1]=="function"?ge[1]:typeof ge[1]=="object"&&ge[1]!==null&&typeof ge[1].handleEvent=="function"?ge[1].handleEvent:null;if(Ee!==null){const Oe=Z.get(ge[1]);Oe!==void 0?ge[1]=Oe:(ge[1]=Me=>{u(y.currentTime,y.sampleRate,()=>Ee(Me))},Z.set(Ee,ge[1]))}}return se.call(m.port1,ge[0],ge[1],ge[2])})(m.port1.addEventListener),m.port1.removeEventListener=(se=>(...ge)=>{if(ge[0]==="message"){const Ee=Z.get(ge[1]);Ee!==void 0&&(Z.delete(ge[1]),ge[1]=Ee)}return se.call(m.port1,ge[0],ge[1],ge[2])})(m.port1.removeEventListener);let ne=null;Object.defineProperty(m.port1,"onmessage",{get:()=>ne,set:se=>{typeof ne=="function"&&m.port1.removeEventListener("message",ne),ne=typeof se=="function"?se:null,typeof ne=="function"&&(m.port1.addEventListener("message",ne),m.port1.start())}}),d.prototype.port=m.port1;let ie=null;createAudioWorkletProcessor(y,X,d,f).then(se=>ie=se);const Q=createNestedArrays(f.numberOfInputs,f.channelCount),O=createNestedArrays(f.numberOfOutputs,v),k=d.parameterDescriptors===void 0?[]:d.parameterDescriptors.reduce((se,{name:ge})=>({...se,[ge]:new Float32Array(128)}),{});let F=!0;const z=()=>{f.numberOfOutputs>0&&E.disconnect(V);for(let se=0,ge=0;se<f.numberOfOutputs;se+=1){const Ee=$[se];for(let Oe=0;Oe<v[se];Oe+=1)V.disconnect(Ee,ge+Oe,Oe);ge+=v[se]}},L=new Map;E.onaudioprocess=({inputBuffer:se,outputBuffer:ge})=>{if(ie!==null){const Ee=p(X);for(let Oe=0;Oe<w;Oe+=128){for(let Me=0;Me<f.numberOfInputs;Me+=1)for(let we=0;we<f.channelCount;we+=1)copyFromChannel(se,Q[Me],we,we,Oe);d.parameterDescriptors!==void 0&&d.parameterDescriptors.forEach(({name:Me},we)=>{copyFromChannel(se,k,Me,T+we,Oe)});for(let Me=0;Me<f.numberOfInputs;Me+=1)for(let we=0;we<v[Me];we+=1)O[Me][we].byteLength===0&&(O[Me][we]=new Float32Array(128));try{const Me=Q.map((Ue,Ne)=>{if(Ee[Ne].size>0)return L.set(Ne,w/128),Ue;const de=L.get(Ne);return de===void 0?[]:(Ue.every(Te=>Te.every(_e=>_e===0))&&(de===1?L.delete(Ne):L.set(Ne,de-1)),Ue)});F=u(y.currentTime+Oe/y.sampleRate,y.sampleRate,()=>ie.process(Me,O,k));for(let Ue=0,Ne=0;Ue<f.numberOfOutputs;Ue+=1){for(let Ae=0;Ae<v[Ue];Ae+=1)copyToChannel(ge,O[Ue],Ae,Ne+Ae,Oe);Ne+=v[Ue]}}catch(Me){F=!1,X.dispatchEvent(new ErrorEvent("processorerror",{colno:Me.colno,filename:Me.filename,lineno:Me.lineno,message:Me.message}))}if(!F){for(let Me=0;Me<f.numberOfInputs;Me+=1){b[Me].disconnect(P[Me]);for(let we=0;we<f.channelCount;we+=1)P[Oe].disconnect(S,we,Me*f.channelCount+we)}if(d.parameterDescriptors!==void 0){const Me=d.parameterDescriptors.length;for(let we=0;we<Me;we+=1){const Ue=x[we];Ue.disconnect(S,0,T+we),Ue.stop()}}S.disconnect(E),E.onaudioprocess=null,K?z():pe();break}}}};let K=!1;const U=o(y,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),te=()=>E.connect(U).connect(y.destination),pe=()=>{E.disconnect(U),U.disconnect()},ue=()=>{if(F){pe(),f.numberOfOutputs>0&&E.connect(V);for(let se=0,ge=0;se<f.numberOfOutputs;se+=1){const Ee=$[se];for(let Oe=0;Oe<v[se];Oe+=1)V.connect(Ee,ge+Oe,Oe);ge+=v[se]}}K=!0},ve=()=>{F&&(te(),z()),K=!1};return te(),g(X,ue,ve)},createNativeBiquadFilterNode=(r,e)=>{const t=r.createBiquadFilter();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"Q"),assignNativeAudioNodeAudioParamValue(t,e,"detune"),assignNativeAudioNodeAudioParamValue(t,e,"frequency"),assignNativeAudioNodeAudioParamValue(t,e,"gain"),assignNativeAudioNodeOption(t,e,"type"),t},createNativeChannelMergerNodeFactory=(r,e)=>(t,n)=>{const s=t.createChannelMerger(n.numberOfInputs);return r!==null&&r.name==="webkitAudioContext"&&e(t,s),assignNativeAudioNodeOptions(s,n),s},wrapChannelSplitterNode=r=>{const e=r.numberOfOutputs;Object.defineProperty(r,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw createInvalidStateError()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw createInvalidStateError()}}),Object.defineProperty(r,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw createInvalidStateError()}})},createNativeChannelSplitterNode=(r,e)=>{const t=r.createChannelSplitter(e.numberOfOutputs);return assignNativeAudioNodeOptions(t,e),wrapChannelSplitterNode(t),t},createNativeConstantSourceNodeFactory=(r,e,t,n,s)=>(i,o)=>{if(i.createConstantSource===void 0)return t(i,o);const a=i.createConstantSource();return assignNativeAudioNodeOptions(a,o),assignNativeAudioNodeAudioParamValue(a,o,"offset"),e(n,()=>n(i))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(a),e(s,()=>s(i))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(a),r(i,a),a},interceptConnections=(r,e)=>(r.connect=e.connect.bind(e),r.disconnect=e.disconnect.bind(e),r),createNativeConstantSourceNodeFakerFactory=(r,e,t,n)=>(s,{offset:i,...o})=>{const a=s.createBuffer(1,2,44100),l=e(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=t(s,{...o,gain:i}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const p={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(h){c.channelCount=h},get channelCountMode(){return c.channelCountMode},set channelCountMode(h){c.channelCountMode=h},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(h){c.channelInterpretation=h},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(h){l.onended=h},addEventListener(...h){return l.addEventListener(h[0],h[1],h[2])},dispatchEvent(...h){return l.dispatchEvent(h[0])},removeEventListener(...h){return l.removeEventListener(h[0],h[1],h[2])},start(h=0){l.start.call(l,h)},stop(h=0){l.stop.call(l,h)}},g=()=>l.connect(c),y=()=>l.disconnect(c);return r(s,l),n(interceptConnections(p,c),g,y)},createNativeConvolverNodeFactory=(r,e)=>(t,n)=>{const s=t.createConvolver();if(assignNativeAudioNodeOptions(s,n),n.disableNormalization===s.normalize&&(s.normalize=!n.disableNormalization),assignNativeAudioNodeOption(s,n,"buffer"),n.channelCount>2||(e(s,"channelCount",i=>()=>i.call(s),i=>o=>{if(o>2)throw r();return i.call(s,o)}),n.channelCountMode==="max"))throw r();return e(s,"channelCountMode",i=>()=>i.call(s),i=>o=>{if(o==="max")throw r();return i.call(s,o)}),s},createNativeDelayNode=(r,e)=>{const t=r.createDelay(e.maxDelayTime);return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"delayTime"),t},createNativeDynamicsCompressorNodeFactory=r=>(e,t)=>{const n=e.createDynamicsCompressor();if(assignNativeAudioNodeOptions(n,t),t.channelCount>2||t.channelCountMode==="max")throw r();return assignNativeAudioNodeAudioParamValue(n,t,"attack"),assignNativeAudioNodeAudioParamValue(n,t,"knee"),assignNativeAudioNodeAudioParamValue(n,t,"ratio"),assignNativeAudioNodeAudioParamValue(n,t,"release"),assignNativeAudioNodeAudioParamValue(n,t,"threshold"),n},createNativeGainNode=(r,e)=>{const t=r.createGain();return assignNativeAudioNodeOptions(t,e),assignNativeAudioNodeAudioParamValue(t,e,"gain"),t},createNativeIIRFilterNodeFactory=r=>(e,t,n)=>{if(e.createIIRFilter===void 0)return r(e,t,n);const s=e.createIIRFilter(n.feedforward,n.feedback);return assignNativeAudioNodeOptions(s,n),s};function divide(r,e){const t=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/t,(r[1]*e[0]-r[0]*e[1])/t]}function multiply(r,e){return[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]}function evaluatePolynomial(r,e){let t=[0,0];for(let n=r.length-1;n>=0;n-=1)t=multiply(t,e),t[0]+=r[n];return t}const createNativeIIRFilterNodeFakerFactory=(r,e,t,n)=>(s,i,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:u})=>{const p=computeBufferSize(i,s.sampleRate),g=c instanceof Float64Array?c:new Float64Array(c),y=u instanceof Float64Array?u:new Float64Array(u),h=g.length,d=y.length,f=Math.min(h,d);if(h===0||h>20)throw n();if(g[0]===0)throw e();if(d===0||d>20)throw n();if(y[0]===0)throw e();if(g[0]!==1){for(let x=0;x<d;x+=1)y[x]/=g[0];for(let x=1;x<h;x+=1)g[x]/=g[0]}const v=t(s,p,o,o);v.channelCount=o,v.channelCountMode=a,v.channelInterpretation=l;const T=32,R=[],N=[],m=[];for(let x=0;x<o;x+=1){R.push(0);const S=new Float32Array(T),w=new Float32Array(T);S.fill(0),w.fill(0),N.push(S),m.push(w)}v.onaudioprocess=x=>{const S=x.inputBuffer,w=x.outputBuffer,E=S.numberOfChannels;for(let V=0;V<E;V+=1){const $=S.getChannelData(V),j=w.getChannelData(V);R[V]=filterBuffer(g,h,y,d,f,N[V],m[V],R[V],T,$,j)}};const b=s.sampleRate/2;return interceptConnections({get bufferSize(){return p},get channelCount(){return v.channelCount},set channelCount(x){v.channelCount=x},get channelCountMode(){return v.channelCountMode},set channelCountMode(x){v.channelCountMode=x},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(x){v.channelInterpretation=x},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...x){return v.addEventListener(x[0],x[1],x[2])},dispatchEvent(...x){return v.dispatchEvent(x[0])},getFrequencyResponse(x,S,w){if(x.length!==S.length||S.length!==w.length)throw r();const E=x.length;for(let V=0;V<E;V+=1){const $=-Math.PI*(x[V]/b),j=[Math.cos($),Math.sin($)],D=evaluatePolynomial(y,j),Y=evaluatePolynomial(g,j),G=divide(D,Y);S[V]=Math.sqrt(G[0]*G[0]+G[1]*G[1]),w[V]=Math.atan2(G[1],G[0])}},removeEventListener(...x){return v.removeEventListener(x[0],x[1],x[2])}},v)},createNativeMediaElementAudioSourceNode=(r,e)=>r.createMediaElementSource(e.mediaElement),createNativeMediaStreamAudioDestinationNode=(r,e)=>{const t=r.createMediaStreamDestination();return assignNativeAudioNodeOptions(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},createNativeMediaStreamAudioSourceNode=(r,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((i,o)=>i.id<o.id?-1:i.id>o.id?1:0);const n=t.slice(0,1),s=r.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(s,"mediaStream",{value:e}),s},createNativeMediaStreamTrackAudioSourceNodeFactory=(r,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);const s=new MediaStream([n]),i=t.createMediaStreamSource(s);if(n.kind!=="audio")throw r();if(e(t))throw new TypeError;return i},createNativeOfflineAudioContextConstructor=r=>r===null?null:r.hasOwnProperty("OfflineAudioContext")?r.OfflineAudioContext:r.hasOwnProperty("webkitOfflineAudioContext")?r.webkitOfflineAudioContext:null,createNativeOscillatorNodeFactory=(r,e,t,n,s,i)=>(o,a)=>{const l=o.createOscillator();return assignNativeAudioNodeOptions(l,a),assignNativeAudioNodeAudioParamValue(l,a,"detune"),assignNativeAudioNodeAudioParamValue(l,a,"frequency"),a.periodicWave!==void 0?l.setPeriodicWave(a.periodicWave):assignNativeAudioNodeOption(l,a,"type"),e(t,()=>t(o))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(l),e(n,()=>n(o))||i(l,o),e(s,()=>s(o))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(l),r(o,l),l},createNativePannerNodeFactory=r=>(e,t)=>{const n=e.createPanner();return n.orientationX===void 0?r(e,t):(assignNativeAudioNodeOptions(n,t),assignNativeAudioNodeAudioParamValue(n,t,"orientationX"),assignNativeAudioNodeAudioParamValue(n,t,"orientationY"),assignNativeAudioNodeAudioParamValue(n,t,"orientationZ"),assignNativeAudioNodeAudioParamValue(n,t,"positionX"),assignNativeAudioNodeAudioParamValue(n,t,"positionY"),assignNativeAudioNodeAudioParamValue(n,t,"positionZ"),assignNativeAudioNodeOption(n,t,"coneInnerAngle"),assignNativeAudioNodeOption(n,t,"coneOuterAngle"),assignNativeAudioNodeOption(n,t,"coneOuterGain"),assignNativeAudioNodeOption(n,t,"distanceModel"),assignNativeAudioNodeOption(n,t,"maxDistance"),assignNativeAudioNodeOption(n,t,"panningModel"),assignNativeAudioNodeOption(n,t,"refDistance"),assignNativeAudioNodeOption(n,t,"rolloffFactor"),n)},createNativePannerNodeFakerFactory=(r,e,t,n,s,i,o,a,l,c)=>(u,{coneInnerAngle:p,coneOuterAngle:g,coneOuterGain:y,distanceModel:h,maxDistance:d,orientationX:f,orientationY:v,orientationZ:T,panningModel:R,positionX:N,positionY:m,positionZ:b,refDistance:P,rolloffFactor:x,...S})=>{const w=u.createPanner();if(S.channelCount>2||S.channelCountMode==="max")throw o();assignNativeAudioNodeOptions(w,S);const E={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},V=t(u,{...E,channelInterpretation:"speakers",numberOfInputs:6}),$=n(u,{...S,gain:1}),j=n(u,{...E,gain:1}),D=n(u,{...E,gain:0}),Y=n(u,{...E,gain:0}),G=n(u,{...E,gain:0}),X=n(u,{...E,gain:0}),Z=n(u,{...E,gain:0}),ne=s(u,256,6,1),ie=i(u,{...E,curve:new Float32Array([1,1]),oversample:"none"});let be=[f,v,T],Q=[N,m,b];const O=new Float32Array(1);ne.onaudioprocess=({inputBuffer:L})=>{const K=[l(L,O,0),l(L,O,1),l(L,O,2)];K.some((te,pe)=>te!==be[pe])&&(w.setOrientation(...K),be=K);const U=[l(L,O,3),l(L,O,4),l(L,O,5)];U.some((te,pe)=>te!==Q[pe])&&(w.setPosition(...U),Q=U)},Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(X.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Z.gain,"defaultValue",{get:()=>0});const k={get bufferSize(){},get channelCount(){return w.channelCount},set channelCount(L){if(L>2)throw o();$.channelCount=L,w.channelCount=L},get channelCountMode(){return w.channelCountMode},set channelCountMode(L){if(L==="max")throw o();$.channelCountMode=L,w.channelCountMode=L},get channelInterpretation(){return w.channelInterpretation},set channelInterpretation(L){$.channelInterpretation=L,w.channelInterpretation=L},get coneInnerAngle(){return w.coneInnerAngle},set coneInnerAngle(L){w.coneInnerAngle=L},get coneOuterAngle(){return w.coneOuterAngle},set coneOuterAngle(L){w.coneOuterAngle=L},get coneOuterGain(){return w.coneOuterGain},set coneOuterGain(L){if(L<0||L>1)throw e();w.coneOuterGain=L},get context(){return w.context},get distanceModel(){return w.distanceModel},set distanceModel(L){w.distanceModel=L},get inputs(){return[$]},get maxDistance(){return w.maxDistance},set maxDistance(L){if(L<0)throw new RangeError;w.maxDistance=L},get numberOfInputs(){return w.numberOfInputs},get numberOfOutputs(){return w.numberOfOutputs},get orientationX(){return j.gain},get orientationY(){return D.gain},get orientationZ(){return Y.gain},get panningModel(){return w.panningModel},set panningModel(L){w.panningModel=L},get positionX(){return G.gain},get positionY(){return X.gain},get positionZ(){return Z.gain},get refDistance(){return w.refDistance},set refDistance(L){if(L<0)throw new RangeError;w.refDistance=L},get rolloffFactor(){return w.rolloffFactor},set rolloffFactor(L){if(L<0)throw new RangeError;w.rolloffFactor=L},addEventListener(...L){return $.addEventListener(L[0],L[1],L[2])},dispatchEvent(...L){return $.dispatchEvent(L[0])},removeEventListener(...L){return $.removeEventListener(L[0],L[1],L[2])}};p!==k.coneInnerAngle&&(k.coneInnerAngle=p),g!==k.coneOuterAngle&&(k.coneOuterAngle=g),y!==k.coneOuterGain&&(k.coneOuterGain=y),h!==k.distanceModel&&(k.distanceModel=h),d!==k.maxDistance&&(k.maxDistance=d),f!==k.orientationX.value&&(k.orientationX.value=f),v!==k.orientationY.value&&(k.orientationY.value=v),T!==k.orientationZ.value&&(k.orientationZ.value=T),R!==k.panningModel&&(k.panningModel=R),N!==k.positionX.value&&(k.positionX.value=N),m!==k.positionY.value&&(k.positionY.value=m),b!==k.positionZ.value&&(k.positionZ.value=b),P!==k.refDistance&&(k.refDistance=P),x!==k.rolloffFactor&&(k.rolloffFactor=x),(be[0]!==1||be[1]!==0||be[2]!==0)&&w.setOrientation(...be),(Q[0]!==0||Q[1]!==0||Q[2]!==0)&&w.setPosition(...Q);const F=()=>{$.connect(w),r($,ie,0,0),ie.connect(j).connect(V,0,0),ie.connect(D).connect(V,0,1),ie.connect(Y).connect(V,0,2),ie.connect(G).connect(V,0,3),ie.connect(X).connect(V,0,4),ie.connect(Z).connect(V,0,5),V.connect(ne).connect(u.destination)},z=()=>{$.disconnect(w),a($,ie,0,0),ie.disconnect(j),j.disconnect(V),ie.disconnect(D),D.disconnect(V),ie.disconnect(Y),Y.disconnect(V),ie.disconnect(G),G.disconnect(V),ie.disconnect(X),X.disconnect(V),ie.disconnect(Z),Z.disconnect(V),V.disconnect(ne),ne.disconnect(u.destination)};return c(interceptConnections(k,w),F,z)},createNativePeriodicWaveFactory=r=>(e,{disableNormalization:t,imag:n,real:s})=>{const i=n instanceof Float32Array?n:new Float32Array(n),o=s instanceof Float32Array?s:new Float32Array(s),a=e.createPeriodicWave(o,i,{disableNormalization:t});if(Array.from(n).length<2)throw r();return a},createNativeScriptProcessorNode=(r,e,t,n)=>r.createScriptProcessor(e,t,n),createNativeStereoPannerNodeFactory=(r,e)=>(t,n)=>{const s=n.channelCountMode;if(s==="clamped-max")throw e();if(t.createStereoPanner===void 0)return r(t,n);const i=t.createStereoPanner();return assignNativeAudioNodeOptions(i,n),assignNativeAudioNodeAudioParamValue(i,n,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>s,set:o=>{if(o!==s)throw e()}}),i},createNativeStereoPannerNodeFakerFactory=(r,e,t,n,s,i)=>{const a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},p=(h,d,f,v)=>{const T=new Float32Array(16385),R=new Float32Array(16385);for(let S=0;S<16385;S+=1){const w=S/16384*l;T[S]=Math.cos(w),R[S]=Math.sin(w)}const N=t(h,{...c,gain:0}),m=n(h,{...u,curve:T}),b=n(h,{...u,curve:a}),P=t(h,{...c,gain:0}),x=n(h,{...u,curve:R});return{connectGraph(){d.connect(N),d.connect(b.inputs===void 0?b:b.inputs[0]),d.connect(P),b.connect(f),f.connect(m.inputs===void 0?m:m.inputs[0]),f.connect(x.inputs===void 0?x:x.inputs[0]),m.connect(N.gain),x.connect(P.gain),N.connect(v,0,0),P.connect(v,0,1)},disconnectGraph(){d.disconnect(N),d.disconnect(b.inputs===void 0?b:b.inputs[0]),d.disconnect(P),b.disconnect(f),f.disconnect(m.inputs===void 0?m:m.inputs[0]),f.disconnect(x.inputs===void 0?x:x.inputs[0]),m.disconnect(N.gain),x.disconnect(P.gain),N.disconnect(v,0,0),P.disconnect(v,0,1)}}},g=(h,d,f,v)=>{const T=new Float32Array(16385),R=new Float32Array(16385),N=new Float32Array(16385),m=new Float32Array(16385),b=Math.floor(16385/2);for(let G=0;G<16385;G+=1)if(G>b){const X=(G-b)/(16384-b)*l;T[G]=Math.cos(X),R[G]=Math.sin(X),N[G]=0,m[G]=1}else{const X=G/(16384-b)*l;T[G]=1,R[G]=0,N[G]=Math.cos(X),m[G]=Math.sin(X)}const P=e(h,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),x=t(h,{...c,gain:0}),S=n(h,{...u,curve:T}),w=t(h,{...c,gain:0}),E=n(h,{...u,curve:R}),V=n(h,{...u,curve:a}),$=t(h,{...c,gain:0}),j=n(h,{...u,curve:N}),D=t(h,{...c,gain:0}),Y=n(h,{...u,curve:m});return{connectGraph(){d.connect(P),d.connect(V.inputs===void 0?V:V.inputs[0]),P.connect(x,0),P.connect(w,0),P.connect($,1),P.connect(D,1),V.connect(f),f.connect(S.inputs===void 0?S:S.inputs[0]),f.connect(E.inputs===void 0?E:E.inputs[0]),f.connect(j.inputs===void 0?j:j.inputs[0]),f.connect(Y.inputs===void 0?Y:Y.inputs[0]),S.connect(x.gain),E.connect(w.gain),j.connect($.gain),Y.connect(D.gain),x.connect(v,0,0),$.connect(v,0,0),w.connect(v,0,1),D.connect(v,0,1)},disconnectGraph(){d.disconnect(P),d.disconnect(V.inputs===void 0?V:V.inputs[0]),P.disconnect(x,0),P.disconnect(w,0),P.disconnect($,1),P.disconnect(D,1),V.disconnect(f),f.disconnect(S.inputs===void 0?S:S.inputs[0]),f.disconnect(E.inputs===void 0?E:E.inputs[0]),f.disconnect(j.inputs===void 0?j:j.inputs[0]),f.disconnect(Y.inputs===void 0?Y:Y.inputs[0]),S.disconnect(x.gain),E.disconnect(w.gain),j.disconnect($.gain),Y.disconnect(D.gain),x.disconnect(v,0,0),$.disconnect(v,0,0),w.disconnect(v,0,1),D.disconnect(v,0,1)}}},y=(h,d,f,v,T)=>{if(d===1)return p(h,f,v,T);if(d===2)return g(h,f,v,T);throw s()};return(h,{channelCount:d,channelCountMode:f,pan:v,...T})=>{if(f==="max")throw s();const R=r(h,{...T,channelCount:1,channelCountMode:f,numberOfInputs:2}),N=t(h,{...T,channelCount:d,channelCountMode:f,gain:1}),m=t(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:b,disconnectGraph:P}=y(h,d,N,m,R);Object.defineProperty(m.gain,"defaultValue",{get:()=>0}),Object.defineProperty(m.gain,"maxValue",{get:()=>1}),Object.defineProperty(m.gain,"minValue",{get:()=>-1});const x={get bufferSize(){},get channelCount(){return N.channelCount},set channelCount(V){N.channelCount!==V&&(S&&P(),{connectGraph:b,disconnectGraph:P}=y(h,V,N,m,R),S&&b()),N.channelCount=V},get channelCountMode(){return N.channelCountMode},set channelCountMode(V){if(V==="clamped-max"||V==="max")throw s();N.channelCountMode=V},get channelInterpretation(){return N.channelInterpretation},set channelInterpretation(V){N.channelInterpretation=V},get context(){return N.context},get inputs(){return[N]},get numberOfInputs(){return N.numberOfInputs},get numberOfOutputs(){return N.numberOfOutputs},get pan(){return m.gain},addEventListener(...V){return N.addEventListener(V[0],V[1],V[2])},dispatchEvent(...V){return N.dispatchEvent(V[0])},removeEventListener(...V){return N.removeEventListener(V[0],V[1],V[2])}};let S=!1;const w=()=>{b(),S=!0},E=()=>{P(),S=!1};return i(interceptConnections(x,R),w,E)}},createNativeWaveShaperNodeFactory=(r,e,t,n,s,i,o)=>(a,l)=>{const c=a.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,l);assignNativeAudioNodeOptions(c,l);const u=l.curve===null||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(u!==null&&u.length<2)throw e();assignNativeAudioNodeOption(c,{curve:u},"curve"),assignNativeAudioNodeOption(c,l,"oversample");let p=null,g=!1;return o(c,"curve",d=>()=>d.call(c),d=>f=>(d.call(c,f),g&&(n(f)&&p===null?p=r(a,c):!n(f)&&p!==null&&(p(),p=null)),f)),s(c,()=>{g=!0,n(c.curve)&&(p=r(a,c))},()=>{g=!1,p!==null&&(p(),p=null)})},createNativeWaveShaperNodeFakerFactory=(r,e,t,n,s)=>(i,{curve:o,oversample:a,...l})=>{const c=i.createWaveShaper(),u=i.createWaveShaper();assignNativeAudioNodeOptions(c,l),assignNativeAudioNodeOptions(u,l);const p=t(i,{...l,gain:1}),g=t(i,{...l,gain:-1}),y=t(i,{...l,gain:1}),h=t(i,{...l,gain:-1});let d=null,f=!1,v=null;const T={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(m){p.channelCount=m,g.channelCount=m,c.channelCount=m,y.channelCount=m,u.channelCount=m,h.channelCount=m},get channelCountMode(){return c.channelCountMode},set channelCountMode(m){p.channelCountMode=m,g.channelCountMode=m,c.channelCountMode=m,y.channelCountMode=m,u.channelCountMode=m,h.channelCountMode=m},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(m){p.channelInterpretation=m,g.channelInterpretation=m,c.channelInterpretation=m,y.channelInterpretation=m,u.channelInterpretation=m,h.channelInterpretation=m},get context(){return c.context},get curve(){return v},set curve(m){if(m!==null&&m.length<2)throw e();if(m===null)c.curve=m,u.curve=m;else{const b=m.length,P=new Float32Array(b+2-b%2),x=new Float32Array(b+2-b%2);P[0]=m[0],x[0]=-m[b-1];const S=Math.ceil((b+1)/2),w=(b+1)/2-1;for(let E=1;E<S;E+=1){const V=E/S*w,$=Math.floor(V),j=Math.ceil(V);P[E]=$===j?m[$]:(1-(V-$))*m[$]+(1-(j-V))*m[j],x[E]=$===j?-m[b-1-$]:-((1-(V-$))*m[b-1-$])-(1-(j-V))*m[b-1-j]}P[S]=b%2===1?m[S-1]:(m[S-2]+m[S-1])/2,c.curve=P,u.curve=x}v=m,f&&(n(v)&&d===null?d=r(i,p):d!==null&&(d(),d=null))},get inputs(){return[p]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(m){c.oversample=m,u.oversample=m},addEventListener(...m){return p.addEventListener(m[0],m[1],m[2])},dispatchEvent(...m){return p.dispatchEvent(m[0])},removeEventListener(...m){return p.removeEventListener(m[0],m[1],m[2])}};o!==null&&(T.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==T.oversample&&(T.oversample=a);const R=()=>{p.connect(c).connect(y),p.connect(g).connect(u).connect(h).connect(y),f=!0,n(v)&&(d=r(i,p))},N=()=>{p.disconnect(c),c.disconnect(y),p.disconnect(g),g.disconnect(u),u.disconnect(h),h.disconnect(y),f=!1,d!==null&&(d(),d=null)};return s(interceptConnections(T,y),R,N)},createNotSupportedError=()=>new DOMException("","NotSupportedError"),DEFAULT_OPTIONS$5={numberOfChannels:1},createOfflineAudioContextConstructor=(r,e,t,n,s)=>class extends r{constructor(o,a,l){let c;if(typeof o=="number"&&a!==void 0&&l!==void 0)c={length:a,numberOfChannels:o,sampleRate:l};else if(typeof o=="object")c=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:p,sampleRate:g}={...DEFAULT_OPTIONS$5,...c},y=n(p,u,g);e(testPromiseSupport,()=>testPromiseSupport(y))||y.addEventListener("statechange",(()=>{let h=0;const d=f=>{this._state==="running"&&(h>0?(y.removeEventListener("statechange",d),f.stopImmediatePropagation(),this._waitForThePromiseToSettle(f)):h+=1)};return d})()),super(y,p),this._length=u,this._nativeOfflineAudioContext=y,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",s(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,deactivateAudioGraph(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},DEFAULT_OPTIONS$4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},createOscillatorNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(l,c){const u=s(l),p={...DEFAULT_OPTIONS$4,...c},g=t(u,p),y=i(u),h=y?n():null,d=l.sampleRate/2;super(l,!1,g,h),this._detune=e(this,y,g.detune,153600,-153600),this._frequency=e(this,y,g.frequency,d,-d),this._nativeOscillatorNode=g,this._onended=null,this._oscillatorNodeRenderer=h,this._oscillatorNodeRenderer!==null&&p.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=p.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(l){const c=typeof l=="function"?o(this,l):null;this._nativeOscillatorNode.onended=c;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===c?l:u}get type(){return this._nativeOscillatorNode.type}set type(l){this._nativeOscillatorNode.type=l,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(l){this._nativeOscillatorNode.setPeriodicWave(l),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=l)}start(l=0){if(this._nativeOscillatorNode.start(l),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=l),this.context.state!=="closed"){setInternalStateToActive(this);const c=()=>{this._nativeOscillatorNode.removeEventListener("ended",c),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeOscillatorNode.addEventListener("ended",c)}}stop(l=0){this._nativeOscillatorNode.stop(l),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=l)}},createOscillatorNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap;let o=null,a=null,l=null;const c=async(u,p)=>{let g=t(u);const y=isOwnedByContext(g,p);if(!y){const h={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,detune:g.detune.value,frequency:g.frequency.value,periodicWave:o===null?void 0:o,type:g.type};g=e(p,h),a!==null&&g.start(a),l!==null&&g.stop(l)}return i.set(p,g),y?(await r(p,u.detune,g.detune),await r(p,u.frequency,g.frequency)):(await n(p,u.detune,g.detune),await n(p,u.frequency,g.frequency)),await s(u,p,g),g};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){l=u},render(u,p){const g=i.get(p);return g!==void 0?Promise.resolve(g):c(u,p)}}},DEFAULT_OPTIONS$3={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},createPannerNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(l,c){const u=s(l),p={...DEFAULT_OPTIONS$3,...c},g=t(u,p),y=i(u),h=y?n():null;super(l,!1,g,h),this._nativePannerNode=g,this._orientationX=e(this,y,g.orientationX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationY=e(this,y,g.orientationY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationZ=e(this,y,g.orientationZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionX=e(this,y,g.positionX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionY=e(this,y,g.positionY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionZ=e(this,y,g.positionZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(l){this._nativePannerNode.coneInnerAngle=l}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(l){this._nativePannerNode.coneOuterAngle=l}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(l){this._nativePannerNode.coneOuterGain=l}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(l){this._nativePannerNode.distanceModel=l}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(l){this._nativePannerNode.maxDistance=l}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(l){this._nativePannerNode.panningModel=l}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(l){this._nativePannerNode.refDistance=l}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(l){this._nativePannerNode.rolloffFactor=l}},createPannerNodeRendererFactory=(r,e,t,n,s,i,o,a,l,c)=>()=>{const u=new WeakMap;let p=null;const g=async(y,h)=>{let d=null,f=i(y);const v={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation},T={...v,coneInnerAngle:f.coneInnerAngle,coneOuterAngle:f.coneOuterAngle,coneOuterGain:f.coneOuterGain,distanceModel:f.distanceModel,maxDistance:f.maxDistance,panningModel:f.panningModel,refDistance:f.refDistance,rolloffFactor:f.rolloffFactor},R=isOwnedByContext(f,h);if("bufferSize"in f)d=n(h,{...v,gain:1});else if(!R){const N={...T,orientationX:f.orientationX.value,orientationY:f.orientationY.value,orientationZ:f.orientationZ.value,positionX:f.positionX.value,positionY:f.positionY.value,positionZ:f.positionZ.value};f=s(h,N)}if(u.set(h,d===null?f:d),d!==null){if(p===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const E=new o(6,y.context.length,h.sampleRate),V=e(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});V.connect(E.destination),p=(async()=>{const $=await Promise.all([y.orientationX,y.orientationY,y.orientationZ,y.positionX,y.positionY,y.positionZ].map(async(j,D)=>{const Y=t(E,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:D===0?1:0});return await a(E,j,Y.offset),Y}));for(let j=0;j<6;j+=1)$[j].connect(V,0,j),$[j].start(0);return c(E)})()}const N=await p,m=n(h,{...v,gain:1});await l(y,h,m);const b=[];for(let E=0;E<N.numberOfChannels;E+=1)b.push(N.getChannelData(E));let P=[b[0][0],b[1][0],b[2][0]],x=[b[3][0],b[4][0],b[5][0]],S=n(h,{...v,gain:1}),w=s(h,{...T,orientationX:P[0],orientationY:P[1],orientationZ:P[2],positionX:x[0],positionY:x[1],positionZ:x[2]});m.connect(S).connect(w.inputs[0]),w.connect(d);for(let E=128;E<N.length;E+=128){const V=[b[0][E],b[1][E],b[2][E]],$=[b[3][E],b[4][E],b[5][E]];if(V.some((j,D)=>j!==P[D])||$.some((j,D)=>j!==x[D])){P=V,x=$;const j=E/h.sampleRate;S.gain.setValueAtTime(0,j),S=n(h,{...v,gain:0}),w=s(h,{...T,orientationX:P[0],orientationY:P[1],orientationZ:P[2],positionX:x[0],positionY:x[1],positionZ:x[2]}),S.gain.setValueAtTime(1,j),m.connect(S).connect(w.inputs[0]),w.connect(d)}}return d}return R?(await r(h,y.orientationX,f.orientationX),await r(h,y.orientationY,f.orientationY),await r(h,y.orientationZ,f.orientationZ),await r(h,y.positionX,f.positionX),await r(h,y.positionY,f.positionY),await r(h,y.positionZ,f.positionZ)):(await a(h,y.orientationX,f.orientationX),await a(h,y.orientationY,f.orientationY),await a(h,y.orientationZ,f.orientationZ),await a(h,y.positionX,f.positionX),await a(h,y.positionY,f.positionY),await a(h,y.positionZ,f.positionZ)),isNativeAudioNodeFaker(f)?await l(y,h,f.inputs[0]):await l(y,h,f),f};return{render(y,h){const d=u.get(h);return d!==void 0?Promise.resolve(d):g(y,h)}}},DEFAULT_OPTIONS$2={disableNormalization:!1},createPeriodicWaveConstructor=(r,e,t,n)=>class ir{constructor(i,o){const a=e(i),l=n({...DEFAULT_OPTIONS$2,...o}),c=r(a,l);return t.add(c),c}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===ir.prototype||t.has(i)}},createRenderAutomation=(r,e)=>(t,n,s)=>(r(n).replay(s),e(n,t,s)),createRenderInputsOfAudioNode=(r,e,t)=>async(n,s,i)=>{const o=r(n);await Promise.all(o.activeInputs.map((a,l)=>Array.from(a).map(async([c,u])=>{const g=await e(c).render(c,s),y=n.context.destination;!t(c)&&(n!==y||!t(n))&&g.connect(i,u,l)})).reduce((a,l)=>[...a,...l],[]))},createRenderInputsOfAudioParam=(r,e,t)=>async(n,s,i)=>{const o=e(n);await Promise.all(Array.from(o.activeInputs).map(async([a,l])=>{const u=await r(a).render(a,s);t(a)||u.connect(i,l)}))},createRenderNativeOfflineAudioContext=(r,e,t,n)=>s=>r(testPromiseSupport,()=>testPromiseSupport(s))?Promise.resolve(r(n,n)).then(i=>{if(!i){const o=t(s,512,0,1);s.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>s.currentTime,o.connect(s.destination)}return s.startRendering()}):new Promise(i=>{const o=e(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.oncomplete=a=>{o.disconnect(),i(a.renderedBuffer)},o.connect(s.destination),s.startRendering()}),createSetActiveAudioWorkletNodeInputs=r=>(e,t)=>{r.set(e,t)},createSetAudioNodeTailTime=r=>(e,t)=>r.set(e,t),createStartRendering=(r,e,t,n,s,i,o,a)=>(l,c)=>t(l).render(l,c).then(()=>Promise.all(Array.from(n(c)).map(u=>t(u).render(u,c)))).then(()=>s(c)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),wrapAudioBufferGetChannelDataMethod(u)):e(i,()=>i(u))||a(u),r.add(u),u)),DEFAULT_OPTIONS$1={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},createStereoPannerNodeConstructor=(r,e,t,n,s,i)=>class extends r{constructor(a,l){const c=s(a),u={...DEFAULT_OPTIONS$1,...l},p=t(c,u),g=i(c),y=g?n():null;super(a,!1,p,y),this._pan=e(this,g,p.pan)}get pan(){return this._pan}},createStereoPannerNodeRendererFactory=(r,e,t,n,s)=>()=>{const i=new WeakMap,o=async(a,l)=>{let c=t(a);const u=isOwnedByContext(c,l);if(!u){const p={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(l,p)}return i.set(l,c),u?await r(l,a.pan,c.pan):await n(l,a.pan,c.pan),isNativeAudioNodeFaker(c)?await s(a,l,c.inputs[0]):await s(a,l,c),c};return{render(a,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):o(a,l)}}},createTestAudioBufferConstructorSupport=r=>()=>{if(r===null)return!1;try{new r({length:1,sampleRate:44100})}catch{return!1}return!0},createTestAudioWorkletProcessorPostMessageSupport=(r,e)=>async()=>{if(r===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),s=URL.createObjectURL(t);let i=!1,o=!1;try{await n.audioWorklet.addModule(s);const a=new r(n,"a",{numberOfOutputs:0}),l=n.createOscillator();a.port.onmessage=()=>i=!0,a.onprocessorerror=()=>o=!0,l.connect(a),l.start(0),await n.startRendering()}catch{}finally{URL.revokeObjectURL(s)}return i&&!o},createTestOfflineAudioContextCurrentTimeSupport=(r,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),n=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(s=>{t.oncomplete=()=>{n.disconnect(),s(t.currentTime!==0)},t.startRendering()})},createUnknownError=()=>new DOMException("","UnknownError"),DEFAULT_OPTIONS={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},createWaveShaperNodeConstructor=(r,e,t,n,s,i,o)=>class extends r{constructor(l,c){const u=s(l),p={...DEFAULT_OPTIONS,...c},g=t(u,p),h=i(u)?n():null;super(l,!0,g,h),this._isCurveNullified=!1,this._nativeWaveShaperNode=g,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(l){if(l===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(l.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=l}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(l){this._nativeWaveShaperNode.oversample=l}},createWaveShaperNodeRendererFactory=(r,e,t)=>()=>{const n=new WeakMap,s=async(i,o)=>{let a=e(i);if(!isOwnedByContext(a,o)){const c={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=r(o,c)}return n.set(o,a),isNativeAudioNodeFaker(a)?await t(i,o,a.inputs[0]):await t(i,o,a),a};return{render(i,o){const a=n.get(o);return a!==void 0?Promise.resolve(a):s(i,o)}}},createWindow=()=>typeof window>"u"?null:window,createWrapAudioBufferCopyChannelMethods=(r,e)=>t=>{t.copyFromChannel=(n,s,i=0)=>{const o=r(i),a=r(s);if(a>=t.numberOfChannels)throw e();const l=t.length,c=t.getChannelData(a),u=n.length;for(let p=o<0?-o:0;p+o<l&&p<u;p+=1)n[p]=c[p+o]},t.copyToChannel=(n,s,i=0)=>{const o=r(i),a=r(s);if(a>=t.numberOfChannels)throw e();const l=t.length,c=t.getChannelData(a),u=n.length;for(let p=o<0?-o:0;p+o<l&&p<u;p+=1)c[p+o]=n[p]}},createWrapAudioBufferCopyChannelMethodsOutOfBounds=r=>e=>{e.copyFromChannel=(t=>(n,s,i=0)=>{const o=r(i),a=r(s);if(o<e.length)return t.call(e,n,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(n,s,i=0)=>{const o=r(i),a=r(s);if(o<e.length)return t.call(e,n,a,o)})(e.copyToChannel)},createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=r=>(e,t)=>{const n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),r(e,"buffer",s=>()=>{const i=s.call(e);return i===n?null:i},s=>i=>s.call(e,i===null?n:i))},createWrapChannelMergerNode=(r,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw r()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw r()}});const s=t.createBufferSource();e(n,()=>{const a=n.numberOfInputs;for(let l=0;l<a;l+=1)s.connect(n,0,l)},()=>s.disconnect(n))},getFirstSample=(r,e,t)=>r.copyFromChannel===void 0?r.getChannelData(t)[0]:(r.copyFromChannel(e,t),e[0]),isDCCurve=r=>{if(r===null)return!1;const e=r.length;return e%2!==0?r[Math.floor(e/2)]!==0:r[e/2-1]+r[e/2]!==0},overwriteAccessors=(r,e,t,n)=>{let s=r;for(;!s.hasOwnProperty(e);)s=Object.getPrototypeOf(s);const{get:i,set:o}=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(r,e,{get:t(i),set:n(o)})},sanitizeAudioWorkletNodeOptions=r=>({...r,outputChannelCount:r.outputChannelCount!==void 0?r.outputChannelCount:r.numberOfInputs===1&&r.numberOfOutputs===1?[r.channelCount]:Array.from({length:r.numberOfOutputs},()=>1)}),sanitizeChannelSplitterOptions=r=>({...r,channelCount:r.numberOfOutputs}),sanitizePeriodicWaveOptions=r=>{const{imag:e,real:t}=r;return e===void 0?t===void 0?{...r,imag:[0,0],real:[0,0]}:{...r,imag:Array.from(t,()=>0),real:t}:t===void 0?{...r,imag:e,real:Array.from(e,()=>0)}:{...r,imag:e,real:t}},setValueAtTimeUntilPossible=(r,e,t)=>{try{r.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;setValueAtTimeUntilPossible(r,e,t+1e-7)}},testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=r=>{const e=r.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},testAudioBufferSourceNodeStartMethodOffsetClampingSupport=r=>{const e=r.createBufferSource(),t=r.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},testAudioBufferSourceNodeStopMethodNullifiedBufferSupport=r=>{const e=r.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},testAudioScheduledSourceNodeStartMethodNegativeParametersSupport=r=>{const e=r.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=r=>{const e=r.createBuffer(1,1,44100),t=r.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},testAudioScheduledSourceNodeStopMethodNegativeParametersSupport=r=>{const e=r.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},testAudioWorkletNodeOptionsClonability=r=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(r)}finally{e.close(),t.close()}},wrapAudioBufferSourceNodeStartMethodOffsetClamping=r=>{r.start=(e=>(t=0,n=0,s)=>{const i=r.buffer,o=i===null?n:Math.min(i.duration,n);i!==null&&o>i.duration-.5/r.context.sampleRate?e.call(r,t,0,0):e.call(r,t,o,s)})(r.start)},wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=(r,e)=>{const t=e.createGain();r.connect(t);const n=(s=>()=>{s.call(r,t),r.removeEventListener("ended",n)})(r.disconnect);r.addEventListener("ended",n),interceptConnections(r,t),r.stop=(s=>{let i=!1;return(o=0)=>{if(i)try{s.call(r,o)}catch{t.gain.setValueAtTime(0,o)}else s.call(r,o),i=!0}})(r.stop)},wrapEventListener=(r,e)=>t=>{const n={value:r};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(r,t):e.handleEvent.call(r,t)},addActiveInputConnectionToAudioNode=createAddActiveInputConnectionToAudioNode(insertElementInSet),addPassiveInputConnectionToAudioNode=createAddPassiveInputConnectionToAudioNode(insertElementInSet),deleteActiveInputConnectionToAudioNode=createDeleteActiveInputConnectionToAudioNode(pickElementFromSet),audioNodeTailTimeStore=new WeakMap,getAudioNodeTailTime=createGetAudioNodeTailTime(audioNodeTailTimeStore),cacheTestResult=createCacheTestResult(new Map,new WeakMap),window$1=createWindow(),createNativeAnalyserNode=createNativeAnalyserNodeFactory(cacheTestResult,createIndexSizeError),getAudioNodeRenderer=createGetAudioNodeRenderer(getAudioNodeConnections),renderInputsOfAudioNode=createRenderInputsOfAudioNode(getAudioNodeConnections,getAudioNodeRenderer,isPartOfACycle),createAnalyserNodeRenderer=createAnalyserNodeRendererFactory(createNativeAnalyserNode,getNativeAudioNode,renderInputsOfAudioNode),getNativeContext=createGetNativeContext(CONTEXT_STORE),nativeOfflineAudioContextConstructor=createNativeOfflineAudioContextConstructor(window$1),isNativeOfflineAudioContext=createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor),audioParamAudioNodeStore=new WeakMap,eventTargetConstructor=createEventTargetConstructor(wrapEventListener),nativeAudioContextConstructor=createNativeAudioContextConstructor(window$1),isNativeAudioContext=createIsNativeAudioContext(nativeAudioContextConstructor),isNativeAudioNode=createIsNativeAudioNode(window$1),isNativeAudioParam=createIsNativeAudioParam(window$1),nativeAudioWorkletNodeConstructor=createNativeAudioWorkletNodeConstructor(window$1),audioNodeConstructor=createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE),createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode,addPassiveInputConnectionToAudioNode,connectNativeAudioNodeToNativeAudioNode,deleteActiveInputConnectionToAudioNode,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getAudioNodeTailTime,getEventListenersOfAudioNode,getNativeAudioNode,insertElementInSet,isActiveAudioNode,isPartOfACycle,isPassiveAudioNode),cacheTestResult,createIncrementCycleCounterFactory(CYCLE_COUNTERS,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,isActiveAudioNode),createIndexSizeError,createInvalidAccessError,createNotSupportedError,createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode,CYCLE_COUNTERS,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,getNativeContext,isActiveAudioNode,isNativeOfflineAudioContext),createDetectCycles(audioParamAudioNodeStore,getAudioNodeConnections,getValueForKey),eventTargetConstructor,getNativeContext,isNativeAudioContext,isNativeAudioNode,isNativeAudioParam,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor),analyserNodeConstructor=createAnalyserNodeConstructor(audioNodeConstructor,createAnalyserNodeRenderer,createIndexSizeError,createNativeAnalyserNode,getNativeContext,isNativeOfflineAudioContext),audioBufferStore=new WeakSet,nativeAudioBufferConstructor=createNativeAudioBufferConstructor(window$1),convertNumberToUnsignedLong=createConvertNumberToUnsignedLong(new Uint32Array(1)),wrapAudioBufferCopyChannelMethods=createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong,createIndexSizeError),wrapAudioBufferCopyChannelMethodsOutOfBounds=createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong),audioBufferConstructor=createAudioBufferConstructor(audioBufferStore,cacheTestResult,createNotSupportedError,nativeAudioBufferConstructor,nativeOfflineAudioContextConstructor,createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor),wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),addSilentConnection=createAddSilentConnection(createNativeGainNode),renderInputsOfAudioParam=createRenderInputsOfAudioParam(getAudioNodeRenderer,getAudioParamConnections,isPartOfACycle),connectAudioParam=createConnectAudioParam(renderInputsOfAudioParam),createNativeAudioBufferSourceNode=createNativeAudioBufferSourceNodeFactory(addSilentConnection,cacheTestResult,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport,testAudioBufferSourceNodeStartMethodOffsetClampingSupport,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioBufferSourceNodeStartMethodOffsetClamping,createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors),wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),renderAutomation=createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections),renderInputsOfAudioParam),createAudioBufferSourceNodeRenderer=createAudioBufferSourceNodeRendererFactory(connectAudioParam,createNativeAudioBufferSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),createAudioParam=createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE),audioParamAudioNodeStore,AUDIO_PARAM_STORE,createAudioParamRenderer,createCancelAndHoldAutomationEvent,createCancelScheduledValuesAutomationEvent,createExponentialRampToValueAutomationEvent,createLinearRampToValueAutomationEvent,createSetTargetAutomationEvent,createSetValueAutomationEvent,createSetValueCurveAutomationEvent,nativeAudioContextConstructor,setValueAtTimeUntilPossible),audioBufferSourceNodeConstructor=createAudioBufferSourceNodeConstructor(audioNodeConstructor,createAudioBufferSourceNodeRenderer,createAudioParam,createInvalidStateError,createNativeAudioBufferSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),audioDestinationNodeConstructor=createAudioDestinationNodeConstructor(audioNodeConstructor,createAudioDestinationNodeRenderer,createIndexSizeError,createInvalidStateError,createNativeAudioDestinationNodeFactory(createNativeGainNode,overwriteAccessors),getNativeContext,isNativeOfflineAudioContext,renderInputsOfAudioNode),createBiquadFilterNodeRenderer=createBiquadFilterNodeRendererFactory(connectAudioParam,createNativeBiquadFilterNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),setAudioNodeTailTime=createSetAudioNodeTailTime(audioNodeTailTimeStore),biquadFilterNodeConstructor=createBiquadFilterNodeConstructor(audioNodeConstructor,createAudioParam,createBiquadFilterNodeRenderer,createInvalidAccessError,createNativeBiquadFilterNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),monitorConnections=createMonitorConnections(insertElementInSet,isNativeAudioNode),wrapChannelMergerNode=createWrapChannelMergerNode(createInvalidStateError,monitorConnections),createNativeChannelMergerNode=createNativeChannelMergerNodeFactory(nativeAudioContextConstructor,wrapChannelMergerNode),createChannelMergerNodeRenderer=createChannelMergerNodeRendererFactory(createNativeChannelMergerNode,getNativeAudioNode,renderInputsOfAudioNode),channelMergerNodeConstructor=createChannelMergerNodeConstructor(audioNodeConstructor,createChannelMergerNodeRenderer,createNativeChannelMergerNode,getNativeContext,isNativeOfflineAudioContext),createChannelSplitterNodeRenderer=createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode,getNativeAudioNode,renderInputsOfAudioNode),channelSplitterNodeConstructor=createChannelSplitterNodeConstructor(audioNodeConstructor,createChannelSplitterNodeRenderer,createNativeChannelSplitterNode,getNativeContext,isNativeOfflineAudioContext,sanitizeChannelSplitterOptions),createNativeConstantSourceNodeFaker=createNativeConstantSourceNodeFakerFactory(addSilentConnection,createNativeAudioBufferSourceNode,createNativeGainNode,monitorConnections),createNativeConstantSourceNode=createNativeConstantSourceNodeFactory(addSilentConnection,cacheTestResult,createNativeConstantSourceNodeFaker,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport),createConstantSourceNodeRenderer=createConstantSourceNodeRendererFactory(connectAudioParam,createNativeConstantSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),constantSourceNodeConstructor=createConstantSourceNodeConstructor(audioNodeConstructor,createAudioParam,createConstantSourceNodeRenderer,createNativeConstantSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createNativeConvolverNode=createNativeConvolverNodeFactory(createNotSupportedError,overwriteAccessors),createConvolverNodeRenderer=createConvolverNodeRendererFactory(createNativeConvolverNode,getNativeAudioNode,renderInputsOfAudioNode),convolverNodeConstructor=createConvolverNodeConstructor(audioNodeConstructor,createConvolverNodeRenderer,createNativeConvolverNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createDelayNodeRenderer=createDelayNodeRendererFactory(connectAudioParam,createNativeDelayNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),delayNodeConstructor=createDelayNodeConstructor(audioNodeConstructor,createAudioParam,createDelayNodeRenderer,createNativeDelayNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativeDynamicsCompressorNode=createNativeDynamicsCompressorNodeFactory(createNotSupportedError),createDynamicsCompressorNodeRenderer=createDynamicsCompressorNodeRendererFactory(connectAudioParam,createNativeDynamicsCompressorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),dynamicsCompressorNodeConstructor=createDynamicsCompressorNodeConstructor(audioNodeConstructor,createAudioParam,createDynamicsCompressorNodeRenderer,createNativeDynamicsCompressorNode,createNotSupportedError,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createGainNodeRenderer=createGainNodeRendererFactory(connectAudioParam,createNativeGainNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),gainNodeConstructor=createGainNodeConstructor(audioNodeConstructor,createAudioParam,createGainNodeRenderer,createNativeGainNode,getNativeContext,isNativeOfflineAudioContext),createNativeIIRFilterNodeFaker=createNativeIIRFilterNodeFakerFactory(createInvalidAccessError,createInvalidStateError,createNativeScriptProcessorNode,createNotSupportedError),renderNativeOfflineAudioContext=createRenderNativeOfflineAudioContext(cacheTestResult,createNativeGainNode,createNativeScriptProcessorNode,createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode,nativeOfflineAudioContextConstructor)),createIIRFilterNodeRenderer=createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderInputsOfAudioNode,renderNativeOfflineAudioContext),createNativeIIRFilterNode=createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker),iIRFilterNodeConstructor=createIIRFilterNodeConstructor(audioNodeConstructor,createNativeIIRFilterNode,createIIRFilterNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createAudioListener=createAudioListenerFactory(createAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeScriptProcessorNode,createNotSupportedError,getFirstSample,isNativeOfflineAudioContext,overwriteAccessors),unrenderedAudioWorkletNodeStore=new WeakMap,minimalBaseAudioContextConstructor=createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor,createAudioListener,eventTargetConstructor,isNativeOfflineAudioContext,unrenderedAudioWorkletNodeStore,wrapEventListener),createNativeOscillatorNode=createNativeOscillatorNodeFactory(addSilentConnection,cacheTestResult,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),createOscillatorNodeRenderer=createOscillatorNodeRendererFactory(connectAudioParam,createNativeOscillatorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),oscillatorNodeConstructor=createOscillatorNodeConstructor(audioNodeConstructor,createAudioParam,createNativeOscillatorNode,createOscillatorNodeRenderer,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createConnectedNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode),createNativeWaveShaperNodeFaker=createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeGainNode,isDCCurve,monitorConnections),createNativeWaveShaperNode=createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeWaveShaperNodeFaker,isDCCurve,monitorConnections,nativeAudioContextConstructor,overwriteAccessors),createNativePannerNodeFaker=createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode,createInvalidStateError,createNativeChannelMergerNode,createNativeGainNode,createNativeScriptProcessorNode,createNativeWaveShaperNode,createNotSupportedError,disconnectNativeAudioNodeFromNativeAudioNode,getFirstSample,monitorConnections),createNativePannerNode=createNativePannerNodeFactory(createNativePannerNodeFaker),createPannerNodeRenderer=createPannerNodeRendererFactory(connectAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeGainNode,createNativePannerNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),pannerNodeConstructor=createPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativePannerNode,createPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativePeriodicWave=createNativePeriodicWaveFactory(createIndexSizeError),periodicWaveConstructor=createPeriodicWaveConstructor(createNativePeriodicWave,getNativeContext,new WeakSet,sanitizePeriodicWaveOptions),nativeStereoPannerNodeFakerFactory=createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeGainNode,createNativeWaveShaperNode,createNotSupportedError,monitorConnections),createNativeStereoPannerNode=createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory,createNotSupportedError),createStereoPannerNodeRenderer=createStereoPannerNodeRendererFactory(connectAudioParam,createNativeStereoPannerNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),stereoPannerNodeConstructor=createStereoPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativeStereoPannerNode,createStereoPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext),createWaveShaperNodeRenderer=createWaveShaperNodeRendererFactory(createNativeWaveShaperNode,getNativeAudioNode,renderInputsOfAudioNode),waveShaperNodeConstructor=createWaveShaperNodeConstructor(audioNodeConstructor,createInvalidStateError,createNativeWaveShaperNode,createWaveShaperNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),isSecureContext=createIsSecureContext(window$1),exposeCurrentFrameAndCurrentTime=createExposeCurrentFrameAndCurrentTime(window$1),backupOfflineAudioContextStore=new WeakMap,getOrCreateBackupOfflineAudioContext=createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore,nativeOfflineAudioContextConstructor),addAudioWorkletModule=isSecureContext?createAddAudioWorkletModule(cacheTestResult,createNotSupportedError,createEvaluateSource(window$1),exposeCurrentFrameAndCurrentTime,createFetchSource(createAbortError),getNativeContext,getOrCreateBackupOfflineAudioContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,new WeakMap,new WeakMap,createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),window$1):void 0,isNativeContext=createIsNativeContext(isNativeAudioContext,isNativeOfflineAudioContext),decodeAudioData=createDecodeAudioData(audioBufferStore,cacheTestResult,createDataCloneError,createEncodingError,new WeakSet,getNativeContext,isNativeContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,testPromiseSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),baseAudioContextConstructor=createBaseAudioContextConstructor(addAudioWorkletModule,analyserNodeConstructor,audioBufferConstructor,audioBufferSourceNodeConstructor,biquadFilterNodeConstructor,channelMergerNodeConstructor,channelSplitterNodeConstructor,constantSourceNodeConstructor,convolverNodeConstructor,decodeAudioData,delayNodeConstructor,dynamicsCompressorNodeConstructor,gainNodeConstructor,iIRFilterNodeConstructor,minimalBaseAudioContextConstructor,oscillatorNodeConstructor,pannerNodeConstructor,periodicWaveConstructor,stereoPannerNodeConstructor,waveShaperNodeConstructor),mediaElementAudioSourceNodeConstructor=createMediaElementAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaElementAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioDestinationNodeConstructor=createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioDestinationNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioSourceNodeConstructor=createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),createNativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError,isNativeOfflineAudioContext),mediaStreamTrackAudioSourceNodeConstructor=createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamTrackAudioSourceNode,getNativeContext),audioContextConstructor=createAudioContextConstructor(baseAudioContextConstructor,createInvalidStateError,createNotSupportedError,createUnknownError,mediaElementAudioSourceNodeConstructor,mediaStreamAudioDestinationNodeConstructor,mediaStreamAudioSourceNodeConstructor,mediaStreamTrackAudioSourceNodeConstructor,nativeAudioContextConstructor),getUnrenderedAudioWorkletNodes=createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore),addUnrenderedAudioWorkletNode=createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),connectMultipleOutputs=createConnectMultipleOutputs(createIndexSizeError),deleteUnrenderedAudioWorkletNode=createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),disconnectMultipleOutputs=createDisconnectMultipleOutputs(createIndexSizeError),activeAudioWorkletNodeInputsStore=new WeakMap,getActiveAudioWorkletNodeInputs=createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore,getValueForKey),createNativeAudioWorkletNodeFaker=createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs,createIndexSizeError,createInvalidStateError,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,createNativeScriptProcessorNode,createNotSupportedError,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getActiveAudioWorkletNodeInputs,monitorConnections),createNativeAudioWorkletNode=createNativeAudioWorkletNodeFactory(createInvalidStateError,createNativeAudioWorkletNodeFaker,createNativeGainNode,createNotSupportedError,monitorConnections),createAudioWorkletNodeRenderer=createAudioWorkletNodeRendererFactory(connectAudioParam,connectMultipleOutputs,createNativeAudioBufferSourceNode,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,deleteUnrenderedAudioWorkletNode,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getNativeAudioNode,nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),getBackupOfflineAudioContext=createGetBackupOfflineAudioContext(backupOfflineAudioContextStore),setActiveAudioWorkletNodeInputs=createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore),audioWorkletNodeConstructor=isSecureContext?createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode,audioNodeConstructor,createAudioParam,createAudioWorkletNodeRenderer,createNativeAudioWorkletNode,getAudioNodeConnections,getBackupOfflineAudioContext,getNativeContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,sanitizeAudioWorkletNodeOptions,setActiveAudioWorkletNodeInputs,testAudioWorkletNodeOptionsClonability,wrapEventListener):void 0,createNativeOfflineAudioContext=createCreateNativeOfflineAudioContext(createNotSupportedError,nativeOfflineAudioContextConstructor),startRendering=createStartRendering(audioBufferStore,cacheTestResult,getAudioNodeRenderer,getUnrenderedAudioWorkletNodes,renderNativeOfflineAudioContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),offlineAudioContextConstructor=createOfflineAudioContextConstructor(baseAudioContextConstructor,cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,startRendering),isAnyAudioContext=createIsAnyAudioContext(CONTEXT_STORE,isNativeAudioContext),isAnyAudioNode=createIsAnyAudioNode(AUDIO_NODE_STORE,isNativeAudioNode),isAnyAudioParam=createIsAnyAudioParam(AUDIO_PARAM_STORE,isNativeAudioParam),isAnyOfflineAudioContext=createIsAnyOfflineAudioContext(CONTEXT_STORE,isNativeOfflineAudioContext);function assert(r,e){if(!r)throw new Error(e)}function assertRange(r,e,t=1/0){if(!(e<=r&&r<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${r}`)}function assertContextRunning(r){!r.isOffline&&r.state!=="running"&&warn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let defaultLogger=console;function log(...r){defaultLogger.log(...r)}function warn(...r){defaultLogger.warn(...r)}function isUndef(r){return typeof r>"u"}function isDefined(r){return!isUndef(r)}function isFunction(r){return typeof r=="function"}function isNumber(r){return typeof r=="number"}function isObject(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object}function isBoolean(r){return typeof r=="boolean"}function isArray(r){return Array.isArray(r)}function isString(r){return typeof r=="string"}function isNote(r){return isString(r)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(r)}function createAudioContext(r){return new audioContextConstructor(r)}function createOfflineAudioContext(r,e,t){return new offlineAudioContextConstructor(r,e,t)}const theWindow=typeof self=="object"?self:null,hasAudioContext=theWindow&&(theWindow.hasOwnProperty("AudioContext")||theWindow.hasOwnProperty("webkitAudioContext"));function createAudioWorkletNode(r,e,t){return assert(isDefined(audioWorkletNodeConstructor),"This node only works in a secure context (https or localhost)"),new audioWorkletNodeConstructor(r,e,t)}function __decorate(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function __awaiter(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(p){o(p)}}function l(u){try{c(n.throw(u))}catch(p){o(p)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})}class Ticker{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(e*1e3,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function isAudioParam(r){return isAnyAudioParam(r)}function isAudioNode(r){return isAnyAudioNode(r)}function isOfflineAudioContext(r){return isAnyOfflineAudioContext(r)}function isAudioContext(r){return isAnyAudioContext(r)}function isAudioBuffer(r){return r instanceof AudioBuffer}function noCopy(r,e){return r==="value"||isAudioParam(e)||isAudioNode(e)||isAudioBuffer(e)}function deepMerge(r,...e){if(!e.length)return r;const t=e.shift();if(isObject(r)&&isObject(t))for(const n in t)noCopy(n,t[n])?r[n]=t[n]:isObject(t[n])?(r[n]||Object.assign(r,{[n]:{}}),deepMerge(r[n],t[n])):Object.assign(r,{[n]:t[n]});return deepMerge(r,...e)}function deepEquals(r,e){return r.length===e.length&&r.every((t,n)=>e[n]===t)}function optionsFromArguments(r,e,t=[],n){const s={},i=Array.from(e);if(isObject(i[0])&&n&&!Reflect.has(i[0],n)&&(Object.keys(i[0]).some(a=>Reflect.has(r,a))||(deepMerge(s,{[n]:i[0]}),t.splice(t.indexOf(n),1),i.shift())),i.length===1&&isObject(i[0]))deepMerge(s,i[0]);else for(let o=0;o<t.length;o++)isDefined(i[o])&&(s[t[o]]=i[o]);return deepMerge(r,s)}function getDefaultsFromInstance(r){return r.constructor.getDefaults()}function defaultArg(r,e){return isUndef(r)?e:r}function omitFromObject(r,e){return e.forEach(t=>{Reflect.has(r,t)&&delete r[t]}),r}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Tone{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||theWindow&&this.toString()===theWindow.TONE_DEBUG_CLASS)&&log(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Tone.version=version;const EPSILON=1e-6;function GT(r,e){return r>e+EPSILON}function GTE(r,e){return GT(r,e)||EQ(r,e)}function LT(r,e){return r+EPSILON<e}function EQ(r,e){return Math.abs(r-e)<EPSILON}function clamp(r,e,t){return Math.max(Math.min(r,t),e)}class Timeline extends Tone{constructor(){super(),this.name="Timeline",this._timeline=[];const e=optionsFromArguments(Timeline.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(assert(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];assert(GTE(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(EQ(this._timeline[t].time,e)){for(let n=t;n>=0&&EQ(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&GTE(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][t]<=e)return s-1;for(;n<i;){let o=Math.floor(n+(i-n)/2);const a=this._timeline[o],l=this._timeline[o+1];if(EQ(a[t],e)){for(let c=o;c<this._timeline.length;c++){const u=this._timeline[c];if(EQ(u[t],e))o=c;else break}return o}else{if(LT(a[t],e)&&GT(l[t],e))return o;GT(a[t],e)?i=o:n=o+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let s=this._search(e),i=this._search(t);return s!==-1&&i!==-1?(this._timeline[s].time!==e&&(s+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,s,i)):s===-1&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(n!==-1&&EQ(this._timeline[n].time,e)){let s=n;for(let i=n;i>=0&&EQ(this._timeline[i].time,e);i--)s=i;this._iterate(i=>{t(i)},s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const notifyNewContext=[];function onContextInit(r){notifyNewContext.push(r)}function initializeContext(r){notifyNewContext.forEach(e=>e(r))}const notifyCloseContext=[];function onContextClose(r){notifyCloseContext.push(r)}function closeContext(r){notifyCloseContext.forEach(e=>e(r))}class Emitter extends Tone{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(s=>{isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(s)||(this._events[s]=[]),this._events[s].push(t)}),this}once(e,t){const n=(...s)=>{t(...s),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(s=>{if(isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(isUndef(t))this._events[e]=[];else{const i=this._events[e];for(let o=i.length-1;o>=0;o--)i[o]===t&&i.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let s=0,i=n.length;s<i;s++)n[s].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(Emitter.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class BaseContext extends Emitter{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Context extends BaseContext{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Timeline,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=optionsFromArguments(Context.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=createAudioContext({latencyHint:e.latencyHint}),this._ticker=new Ticker(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(initializeContext(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return assert(isAudioContext(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){assert(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){assert(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){assert(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){assert(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return createAudioWorkletNode(this.rawContext,e,t)}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){assert(isDefined(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)})}workletsAreReady(){return __awaiter(this,void 0,void 0,function*(){const e=[];this._workletModules.forEach(t=>e.push(t)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,isString(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25;break}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return isAudioContext(this._context)?this._context.resume():Promise.resolve()}close(){return __awaiter(this,void 0,void 0,function*(){isAudioContext(this._context)&&(yield this._context.close()),this._initialized&&closeContext(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=e;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=t,s.loop=!0,s.start(0),this._constants.set(e,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),s()},id:n,time:i+t})};return s(),n}}class DummyContext extends BaseContext{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return __awaiter(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function readOnly(r,e){isArray(e)?e.forEach(t=>readOnly(r,t)):Object.defineProperty(r,e,{enumerable:!0,writable:!1})}function writable(r,e){isArray(e)?e.forEach(t=>writable(r,t)):Object.defineProperty(r,e,{writable:!0})}const noOp=()=>{};class ToneAudioBuffer extends Tone{constructor(){super(),this.name="ToneAudioBuffer",this.onload=noOp;const e=optionsFromArguments(ToneAudioBuffer.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&isAudioBuffer(e.url)||e.url instanceof ToneAudioBuffer?this.set(e.url):isString(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:noOp,onload:noOp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:getContext().sampleRate}set(e){return e instanceof ToneAudioBuffer?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return __awaiter(this,void 0,void 0,function*(){const t=ToneAudioBuffer.load(e).then(n=>{this.set(n),this.onload(this)});ToneAudioBuffer.downloads.push(t);try{yield t}finally{const n=ToneAudioBuffer.downloads.indexOf(t);ToneAudioBuffer.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=isArray(e)&&e[0].length>0,n=t?e.length:1,s=t?e[0].length:e.length,i=getContext(),o=i.createBuffer(n,s,i.sampleRate),a=!t&&n===1?[e]:e;for(let l=0;l<n;l++)o.copyToChannel(a[l],l);return this._buffer=o,this}toMono(e){if(isNumber(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const n=this.numberOfChannels;for(let s=0;s<n;s++){const i=this.toArray(s);for(let o=0;o<i.length;o++)t[o]+=i[o]}t=t.map(s=>s/n),this.fromArray(t)}return this}toArray(e){if(isNumber(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),s=Math.floor(t*this.sampleRate);assert(n<s,"The start time must be less than the end time");const i=s-n,o=getContext().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(n,s),a);return new ToneAudioBuffer(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new ToneAudioBuffer().fromArray(e)}static fromUrl(e){return __awaiter(this,void 0,void 0,function*(){return yield new ToneAudioBuffer().load(e)})}static load(e){return __awaiter(this,void 0,void 0,function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const a=t[1].split("|");let l=a[0];for(const c of a)if(ToneAudioBuffer.supportsType(c)){l=c;break}e=e.replace(t[0],l)}const n=ToneAudioBuffer.baseUrl===""||ToneAudioBuffer.baseUrl.endsWith("/")?ToneAudioBuffer.baseUrl:ToneAudioBuffer.baseUrl+"/",s=yield fetch(n+e);if(!s.ok)throw new Error(`could not load url: ${e}`);const i=yield s.arrayBuffer();return yield getContext().decodeAudioData(i)})}static supportsType(e){const t=e.split("."),n=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return __awaiter(this,void 0,void 0,function*(){for(yield Promise.resolve();ToneAudioBuffer.downloads.length;)yield ToneAudioBuffer.downloads[0]})}}ToneAudioBuffer.baseUrl="";ToneAudioBuffer.downloads=[];class OfflineContext extends Context{constructor(){super({clockSource:"offline",context:isOfflineAudioContext(arguments[0])?arguments[0]:createOfflineAudioContext(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:isOfflineAudioContext(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=isOfflineAudioContext(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return __awaiter(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(s=>setTimeout(s,1)))}})}render(e=!0){return __awaiter(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ToneAudioBuffer(t)})}close(){return Promise.resolve()}}const dummyContext=new DummyContext;let globalContext=dummyContext;function getContext(){return globalContext===dummyContext&&hasAudioContext&&setContext(new Context),globalContext}function setContext(r){isAudioContext(r)?globalContext=new Context(r):isOfflineAudioContext(r)?globalContext=new OfflineContext(r):globalContext=r}function start(){return globalContext.resume()}if(theWindow&&!theWindow.TONE_SILENCE_LOGGING){const e=` * Tone.js v${version} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function dbToGain(r){return Math.pow(10,r/20)}function gainToDb(r){return 20*(Math.log(r)/Math.LN10)}function intervalToFrequencyRatio(r){return Math.pow(2,r/12)}let A4=440;function getA4(){return A4}function setA4(r){A4=r}function ftom(r){return Math.round(ftomf(r))}function ftomf(r){return 69+12*Math.log2(r/A4)}function mtof(r){return A4*Math.pow(2,(r-69)/12)}class TimeBaseClass extends Tone{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),s=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let s=0;return e&&e!=="0"&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(s+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof TimeBaseClass&&this.fromType(this._val),isUndef(this._val))return this._noArg();if(isString(this._val)&&isUndef(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(isObject(this._val)){let e=0;for(const t in this._val)if(isDefined(this._val[t])){const n=this._val[t],s=new this.constructor(this.context,t).valueOf()*n;e+=s}return e}if(isDefined(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return isString(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class TimeClass extends TimeBaseClass{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new TimeClass(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),s=this.valueOf(),a=Math.round(s/n)*n-s;return s+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const o=Math.pow(2,i);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let n=t[0],s=new TimeClass(this.context,t[0]).toSeconds();return t.forEach(i=>{const o=new TimeClass(this.context,i).toSeconds();Math.abs(o-e)<Math.abs(s-e)&&(n=i,s=o)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let s=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=s.toString();return i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3))),[n,t,s].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ftom(this.toFrequency())}_now(){return this.context.now()}}class FrequencyClass extends TimeClass{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return getA4()}static set A4(e){setA4(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:FrequencyClass.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const s=noteToScaleIndex[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?s:FrequencyClass.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let s=1;return e&&e!=="0"&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(s*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(e){return new FrequencyClass(this.context,this.valueOf()*intervalToFrequencyRatio(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return ftom(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/FrequencyClass.A4);let n=Math.round(12*t)+57;const s=Math.floor(n/12);return s<0&&(n+=-12*s),scaleIndexToNote[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return mtof(e)}static ftom(e){return ftom(e)}}const noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class TransportTimeClass extends TimeClass{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ToneWithContext extends Tone{constructor(){super();const e=optionsFromArguments(ToneWithContext.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:getContext()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new TimeClass(this.context,e).toSeconds()}toFrequency(e){return new FrequencyClass(this.context,e).toFrequency()}toTicks(e){return new TransportTimeClass(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{isUndef(e[n])&&delete t[n]}),t}get(){const e=getDefaultsFromInstance(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];isDefined(n)&&isDefined(n.value)&&isDefined(n.setValueAtTime)?e[t]=n.value:n instanceof ToneWithContext?e[t]=n._getPartialProperties(e[t]):isArray(n)||isNumber(n)||isString(n)||isBoolean(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&isDefined(this[t])&&(this[t]&&isDefined(this[t].value)&&isDefined(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ToneWithContext?this[t].set(e[t]):this[t]=e[t])}),this}}class StateTimeline extends Timeline{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return assertRange(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){const n=this._search(t);for(let s=n;s>=0;s--){const i=this._timeline[s];if(i.state===e)return i}}getNextState(e,t){const n=this._search(t);if(n!==-1)for(let s=n;s<this._timeline.length;s++){const i=this._timeline[s];if(i.state===e)return i}}}class Param extends ToneWithContext{constructor(){super(optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]);for(assert(isDefined(e.param)&&(isAudioParam(e.param)||e.param instanceof Param),"param must be an AudioParam");!isAudioParam(e.param);)e.param=e.param._param;this._swappable=isDefined(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Timeline(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,isDefined(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return isDefined(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return isDefined(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return isDefined(this.maxValue)&&isDefined(this.minValue)&&assertRange(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?dbToGain(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?gainToDb(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),s=this._fromType(e);return assert(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),s=this._events.get(t);let i=this._initialValue;if(s===null)i=this._initialValue;else if(s.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const o=this._events.getBefore(s.time);let a;o===null?a=this._initialValue:a=o.value,s.type==="setTargetAtTime"&&(i=this._exponentialApproach(s.time,a,s.value,s.constant,t))}else if(n===null)i=s.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let o=s.value;if(s.type==="setTargetAtTime"){const a=this._events.getBefore(s.time);a===null?o=this._initialValue:o=a.value}n.type==="linearRampToValueAtTime"?i=this._linearInterpolate(s.time,o,n.time,n.value,t):i=this._exponentialInterpolate(s.time,o,n.time,n.value,t)}else i=s.value;return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),s=this.toSeconds(t);return assert(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=EQ(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(t);return assert(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,s),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const s=this._fromType(e);assert(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(s),assert(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(e,t,n,s=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*s;this.setValueAtTime(this._toType(i),t);const o=n/(e.length-1);for(let a=1;a<e.length;a++){const l=this._fromType(e[a])*s;this.linearRampToValueAtTime(this._toType(l),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return assert(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));assert(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const s=this._events.get(t),i=this._events.getAfter(t);return s&&EQ(s.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){const s=this._events.getAfter(n.time),i=s?s.time:t+2,o=(i-t)/10;for(let a=t;a<i;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,s=>{s.type==="cancelScheduledValues"?e.cancelScheduledValues(s.time):s.type==="setTargetAtTime"?e.setTargetAtTime(s.value,s.time,s.constant):e[s.type](s.value,s.time)}),this}setParam(e){assert(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,s,i){return n+(t-n)*Math.exp(-(i-e)/s)}_linearInterpolate(e,t,n,s,i){return t+(s-t)*((i-e)/(n-e))}_exponentialInterpolate(e,t,n,s,i){return t*Math.pow(s/t,(i-e)/(n-e))}}class ToneAudioNode extends ToneWithContext{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return isDefined(this.input)?isAudioParam(this.input)||this.input instanceof Param?1:this.input.numberOfInputs:0}get numberOfOutputs(){return isDefined(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return isDefined(e)&&(e instanceof ToneAudioNode||isAudioNode(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();assert(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return connect(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return warn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return disconnect(this,e,t,n),this}chain(...e){return connectSeries(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),isDefined(this.input)&&(this.input instanceof ToneAudioNode?this.input.dispose():isAudioNode(this.input)&&this.input.disconnect()),isDefined(this.output)&&(this.output instanceof ToneAudioNode?this.output.dispose():isAudioNode(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function connectSeries(...r){const e=r.shift();r.reduce((t,n)=>(t instanceof ToneAudioNode?t.connect(n):isAudioNode(t)&&connect(t,n),n),e)}function connect(r,e,t=0,n=0){for(assert(isDefined(r),"Cannot connect from undefined node"),assert(isDefined(e),"Cannot connect to undefined node"),(e instanceof ToneAudioNode||isAudioNode(e))&&assert(e.numberOfInputs>0,"Cannot connect to node with no inputs"),assert(r.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof ToneAudioNode||e instanceof Param;)isDefined(e.input)&&(e=e.input);for(;r instanceof ToneAudioNode;)isDefined(r.output)&&(r=r.output);isAudioParam(e)?r.connect(e,t):r.connect(e,t,n)}function disconnect(r,e,t=0,n=0){if(isDefined(e))for(;e instanceof ToneAudioNode;)e=e.input;for(;!isAudioNode(r);)isDefined(r.output)&&(r=r.output);isAudioParam(e)?r.disconnect(e,t):isAudioNode(e)?r.disconnect(e,t,n):r.disconnect()}class Gain extends ToneAudioNode{constructor(){super(optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]);this.gain=new Param({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),readOnly(this,"gain")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class OneShotSource extends ToneAudioNode{constructor(e){super(e),this.onended=noOp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Gain({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:noOp})}_startGain(e,t=1){assert(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){assert(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==noOp&&(this.onended(this),this.onended=noOp,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),assert(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ToneConstantSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]);connect(this._source,this._gainNode),this.offset=new Param({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Signal extends ToneAudioNode{constructor(){super(optionsFromArguments(Signal.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=optionsFromArguments(Signal.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ToneConstantSource({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,s){return this._param.setValueCurveAtTime(e,t,n,s),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function connectSignal(r,e,t,n){(e instanceof Param||isAudioParam(e)||e instanceof Signal&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Signal&&(e.overridden=!0)),connect(r,e,t,n)}class TickParam extends Param{constructor(){super(optionsFromArguments(TickParam.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Timeline(1/0),this._multiplier=1;const e=optionsFromArguments(TickParam.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Param.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const s=this._fromType(e),i=this._events.get(t),o=Math.round(Math.max(1/n,1));for(let a=0;a<=o;a++){const l=n*a+t,c=this._exponentialApproach(i.time,i.value,s,n,l);this.linearRampToValueAtTime(this._toType(c),l)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),o=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),o=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),s=this._events.get(t),i=Math.round(Math.max((t-s.time)*10,1)),o=(t-s.time)/i;for(let a=0;a<=i;a++){const l=o*a+s.time,c=this._exponentialInterpolate(s.time,s.value,t,n,l);this.linearRampToValueAtTime(this._toType(c),l)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(isUndef(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let s=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&i.type==="setValueAtTime"&&(s=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+s)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(t);return this.getTimeOfTick(s+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){const s=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-t.time),a=Math.sqrt(Math.pow(s,2)-2*o*(t.ticks-e)),l=(-s+a)/o,c=(-s-a)/o;return(l>0?l:c)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),s=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class TickSignal extends Signal{constructor(){super(optionsFromArguments(TickSignal.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]);this.input=this._param=new TickParam({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Signal.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class TickSource extends ToneWithContext{constructor(){super(optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new StateTimeline,this._tickOffset=new Timeline;const e=optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]);this.frequency=new TickSignal({context:this.context,units:e.units,value:e.frequency}),readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ToneWithContext.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),isDefined(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let i=n,o=0;return this._state.forEachBetween(n.time,t+this.sampleTime,a=>{let l=i.time;const c=this._tickOffset.get(a.time);c&&c.time>=i.time&&(o=c.ticks,l=c.time),i.state==="started"&&a.state!=="started"&&(o+=this.frequency.getTicksAtTime(a.time)-this.frequency.getTicksAtTime(l)),i=a}),this._state.remove(s),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let s=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,o=>{let a=s.time;const l=this._tickOffset.get(o.time);l&&l.time>=s.time&&(i=l.seconds,a=l.time),s.state==="started"&&o.state!=="started"&&(i+=o.time-a),s=o}),this._state.remove(n),i}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),s=this._state.get(t),i=Math.max(n.time,s.time),o=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,n){let s=this._state.get(e);this._state.forEachBetween(e,t,o=>{s&&s.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(s.time,e),o.time-this.sampleTime,n),s=o});let i=null;if(s&&s.state==="started"){const o=Math.max(s.time,e),a=this.frequency.getTicksAtTime(o),l=this.frequency.getTicksAtTime(s.time),c=a-l;let u=Math.ceil(c)-c;u=EQ(u,1)?0:u;let p=this.frequency.getTimeOfTick(a+u);for(;p<t;){try{n(p,Math.round(this.getTicksAtTime(p)))}catch(g){i=g;break}p+=this.frequency.getDurationOfTicks(1,p)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Clock extends ToneWithContext{constructor(){super(optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=noOp,this._lastUpdate=0,this._state=new StateTimeline("stopped"),this._boundLoop=this._loop.bind(this);const e=optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new TickSource({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){assertContextRunning(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const s=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,s);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,s)=>{this.callback(n,s)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Emitter.mixin(Clock);class ToneAudioBuffers extends Tone{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=optionsFromArguments(ToneAudioBuffers.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:noOp,onload:noOp,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return assert(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=noOp,s=noOp){return isString(t)?this._buffers.set(e.toString(),new ToneAudioBuffer(this.baseUrl+t,n,s)):this._buffers.set(e.toString(),new ToneAudioBuffer(t,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class TicksClass extends TransportTimeClass{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Draw extends ToneWithContext{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Timeline,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}onContextInit(r=>{r.draw=new Draw({context:r})});onContextClose(r=>{r.draw.dispose()});class IntervalTimeline extends Tone{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){assert(isDefined(e.time),"Events must have a time property"),assert(isDefined(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new IntervalNode(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let n,s=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,s=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,s=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,s=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,s=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),s&&this._rebalance(s)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),s=e.right;s&&(e.right=s.left,s.left=e),t!==null?n?t.left=s:t.right=s:this._setRoot(s)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),s=e.left;s&&(e.left=s.right,s.right=e),t!==null?n?t.left=s:t.right=s:this._setRoot(s)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let s=1;s<t.length;s++)t[s].low>n.low&&(n=t[s]);return n.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(s=>{s.event&&t(s.event)})}return this}forEachFrom(e,t){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(s=>{s.event&&t(s.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class IntervalNode{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Volume extends ToneAudioNode{constructor(){super(optionsFromArguments(Volume.getDefaults(),arguments,["volume"])),this.name="Volume";const e=optionsFromArguments(Volume.getDefaults(),arguments,["volume"]);this.input=this.output=new Gain({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,readOnly(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Destination extends ToneAudioNode{constructor(){super(optionsFromArguments(Destination.getDefaults(),arguments)),this.name="Destination",this.input=new Volume({context:this.context}),this.output=new Gain({context:this.context}),this.volume=this.input.volume;const e=optionsFromArguments(Destination.getDefaults(),arguments);connectSeries(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),connectSeries(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}onContextInit(r=>{r.destination=new Destination({context:r})});onContextClose(r=>{r.destination.dispose()});class TimelineValue extends Tone{constructor(e){super(),this.name="TimelineValue",this._timeline=new Timeline({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class TransportEvent{constructor(e,t){this.id=TransportEvent._eventId++;const n=Object.assign(TransportEvent.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:noOp,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}TransportEvent._eventId=0;class TransportRepeatEvent extends TransportEvent{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(TransportRepeatEvent.getDefaults(),t);this.duration=new TicksClass(e.context,n.duration).valueOf(),this._interval=new TicksClass(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},TransportEvent.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Transport extends ToneWithContext{constructor(){super(optionsFromArguments(Transport.getDefaults(),arguments)),this.name="Transport",this._loop=new TimelineValue(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Timeline,this._repeatedEvents=new IntervalTimeline,this._syncedSignals=[],this._swingAmount=0;const e=optionsFromArguments(Transport.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Clock({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),readOnly(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const n=t%(this._swingTicks*2)/(this._swingTicks*2),s=Math.sin(n*Math.PI)*this._swingAmount;e+=new TicksClass(this.context,this._swingTicks*2/3).toSeconds()*s}this._timeline.forEachAtTime(t,n=>n.invoke(e))}schedule(e,t){const n=new TransportEvent(this,{callback:e,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,s=1/0){const i=new TransportRepeatEvent(this,{callback:e,duration:new TimeClass(this.context,s).toTicks(),interval:new TimeClass(this.context,t).toTicks(),time:new TransportTimeClass(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new TransportEvent(this,{callback:e,once:!0,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new TicksClass(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return isDefined(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new TimeClass(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new TimeClass(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new TicksClass(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new TicksClass(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(t),s=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),i=t+s;this.emit("stop",i),this._clock.setTicksAtTime(e,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),n=this.getTicksAtTime(t),s=e-n%e;return this._clock.nextTickTime(s,t)}}syncSignal(e,t){if(!t){const s=this.now();if(e.getValueAtTime(s)!==0){const o=1/(60/this.bpm.getValueAtTime(s)/this.PPQ);t=e.getValueAtTime(s)/o}else t=0}const n=new Gain(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),writable(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Emitter.mixin(Transport);onContextInit(r=>{r.transport=new Transport({context:r})});onContextClose(r=>{r.transport.dispose()});class Source extends ToneAudioNode{constructor(e){super(e),this.input=void 0,this._state=new StateTimeline("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=noOp,this._syncedStop=noOp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Volume({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,onstop:noOp,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let s=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),!this._synced&&this._state.getValueAtTime(s)==="started")assert(GT(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,t,n);else if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const i=this._state.get(s);i&&(i.offset=this.toSeconds(defaultArg(t,0)),i.duration=n?this.toSeconds(n):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,n)},s);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else assertContextRunning(this.context),this._start(s,t,n);return this}stop(e){let t=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||isDefined(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){const s=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(e,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=noOp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ToneBufferSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]);connect(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Param({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ToneAudioBuffer(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{url:new ToneAudioBuffer,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,s=1){assert(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,s),this.loop?t=defaultArg(t,this.loopStart):t=defaultArg(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,l=this.toSeconds(this.loopStart),c=a-l;GTE(o,a)&&(o=(o-l)%c+l),EQ(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LT(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,o)),isDefined(n)){let a=this.toSeconds(n);a=Math.max(a,0),this.stop(i+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function generateWaveform(r,e){return __awaiter(this,void 0,void 0,function*(){const t=e/r.context.sampleRate,n=new OfflineContext(1,t,r.context.sampleRate);return new r.constructor(Object.assign(r.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class ToneOscillatorNode extends OneShotSource{constructor(){super(optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]);connect(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Param({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Param({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Oscillator extends Source{constructor(){super(optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),readOnly(this,"frequency"),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new ToneOscillatorNode({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Oscillator._periodicWaveCache.find(t=>t.phase===this._phase&&deepEquals(t.partials,this._partials));{const e=Oscillator._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(isDefined(n)){const{partials:s,wave:i}=n;this._wave=i,this._partials=s,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[s,i]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(s,i);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Oscillator._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),Oscillator._periodicWaveCache.length>100&&Oscillator._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){assertRange(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const s=new Float32Array(e);this._partials.forEach((i,o)=>s[o]=i),this._partials=Array.from(s),this.type=this._type}}_getRealImaginary(e,t){let s=2048;const i=new Float32Array(s),o=new Float32Array(s);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,s=a,this._partials.length===0)return[i,o]}else{const l=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);l?(a=parseInt(l[2],10)+1,this._partialCount=parseInt(l[2],10),e=l[1],a=Math.max(a,2),s=a):this._partialCount=0,this._partials=[]}for(let l=1;l<s;++l){const c=2/(l*Math.PI);let u;switch(e){case"sine":u=l<=a?1:0,this._partials[l-1]=u;break;case"square":u=l&1?2*c:0,this._partials[l-1]=u;break;case"sawtooth":u=c*(l&1?1:-1),this._partials[l-1]=u;break;case"triangle":l&1?u=2*(c*c)*(l-1>>1&1?-1:1):u=0,this._partials[l-1]=u;break;case"custom":u=this._partials[l-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(i[l]=-u*Math.sin(t*l),o[l]=u*Math.cos(t*l)):(i[l]=0,o[l]=0)}return[i,o]}_inverseFFT(e,t,n){let s=0;const i=e.length;for(let o=0;o<i;o++)s+=e[o]*Math.cos(o*n)+t[o]*Math.sin(o*n);return s}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const s=Math.PI*2,i=32;for(let o=0;o<i;o++)n=Math.max(this._inverseFFT(e,t,o/i*s),n);return clamp(-this._inverseFFT(e,t,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Oscillator._periodicWaveCache=[];class SignalOperator extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(SignalOperator.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}}class WaveShaper extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]);isArray(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):isFunction(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Signal.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let s=0,i=t;s<i;s++){const o=s/(i-1)*2-1;n[s]=e(o,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(n=>n.includes(e));assert(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class AudioToGain extends SignalOperator{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new WaveShaper({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Multiply extends Signal{constructor(){super(Object.assign(optionsFromArguments(Multiply.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=optionsFromArguments(Multiply.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Gain({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Signal.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class AMOscillator extends Source{constructor(){super(optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new AudioToGain({context:this.context}),this._modulationNode=new Gain({context:this.context});const e=optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),readOnly(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class FMOscillator extends Source{constructor(){super(optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Gain({context:this.context,gain:0});const e=optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Multiply({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),readOnly(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class PulseOscillator extends Source{constructor(){super(optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Gain({context:this.context,gain:0}),this._thresh=new WaveShaper({context:this.context,mapping:t=>t<=0?-1:1});const e=optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]);this.width=new Signal({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),readOnly(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class FatOscillator extends Source{constructor(){super(optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((s,i)=>s.detune.value=t+n*i)}}get count(){return this._oscillators.length}set count(e){if(assertRange(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new Oscillator({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):noOp});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class PWMOscillator extends Source{constructor(){super(optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Multiply({context:this.context,value:2});const e=optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new PulseOscillator({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),readOnly(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const OmniOscillatorSourceMap={am:AMOscillator,fat:FatOscillator,fm:FMOscillator,oscillator:Oscillator,pulse:PulseOscillator,pwm:PWMOscillator};class OmniOscillator extends Source{constructor(){super(optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Oscillator.getDefaults(),FMOscillator.getDefaults(),AMOscillator.getDefaults(),FatOscillator.getDefaults(),PulseOscillator.getDefaults(),PWMOscillator.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=OmniOscillatorSourceMap[e],n=this.now();if(this._oscillator){const s=this._oscillator;s.stop(n),this.context.setTimeout(()=>s.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof OmniOscillatorSourceMap[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&isString(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){return generateWaveform(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function range(r,e=1/0){const t=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){assertRange(i,r,e),t.set(this,i)}})}}function timeRange(r,e=1/0){const t=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(i){assertRange(this.toSeconds(i),r,e),t.set(this,i)}})}}class Player extends Source{constructor(){super(optionsFromArguments(Player.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1,reverse:!1})}load(e){return __awaiter(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=noOp){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=defaultArg(t,this._loopStart):t=defaultArg(t,0);const s=this.toSeconds(t),i=n;n=defaultArg(n,Math.max(this._buffer.duration-s,0));let o=this.toSeconds(n);o=o/this._playbackRate,e=this.toSeconds(e);const a=new ToneBufferSource({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&isUndef(i)?a.start(e,s):a.start(e,s,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){const s=this.toSeconds(e);this._stop(n),this._start(n,s)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(s=>s.cancelStop())),this._activeSources.forEach(s=>{s.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}__decorate([timeRange(0)],Player.prototype,"fadeIn",void 0);__decorate([timeRange(0)],Player.prototype,"fadeOut",void 0);class Envelope extends ToneAudioNode{constructor(){super(optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Signal({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(isString(e))return e;{let n;for(n in EnvelopeCurves)if(EnvelopeCurves[n][t]===e)return n;return e}}_setCurve(e,t,n){if(isString(n)&&Reflect.has(EnvelopeCurves,n)){const s=EnvelopeCurves[n];isObject(s)?e!=="_decayCurve"&&(this[e]=s[t]):this[e]=s}else if(isArray(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){assert(["linear","exponential"].some(t=>t===e),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let s=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/s;s=(1-o)/a}if(s<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,s,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,s,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let l=1;l<a.length;l++)if(a[l-1]<=o&&o<=a[l]){a=this._attackCurve.slice(l),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,s,t)}if(i&&this.sustain<1){const a=t*this.sustain,l=e+s;this.log("decay",l),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,i+l):this._sig.exponentialApproachValueAtTime(a,l,i)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(assert(isArray(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return connectSignal(this,e,t,n),this}asArray(e=1024){return __awaiter(this,void 0,void 0,function*(){const t=e/this.context.sampleRate,n=new OfflineContext(1,t,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),o=i*.1,a=i+o,l=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:n}));return l._sig.toDestination(),l.triggerAttackRelease(t*(s+o)/a,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}__decorate([timeRange(0)],Envelope.prototype,"attack",void 0);__decorate([timeRange(0)],Envelope.prototype,"decay",void 0);__decorate([range(0,1)],Envelope.prototype,"sustain",void 0);__decorate([timeRange(0)],Envelope.prototype,"release",void 0);const EnvelopeCurves=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/(128-1)*(Math.PI/2));const s=[],i=6.4;for(e=0;e<128-1;e++){t=e/(128-1);const g=Math.sin(t*(Math.PI*2)*i-Math.PI/2)+1;s[e]=g/10+t*.83}s[128-1]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/(128-1)*a)/a;const l=[];for(e=0;e<128;e++)t=e/(128-1),l[e]=.5*(1-Math.cos(Math.PI*t));const c=[];for(e=0;e<128;e++){t=e/(128-1);const g=Math.pow(t,3)*4+.2,y=Math.cos(g*Math.PI*2*t);c[e]=Math.abs(y*(1-t))}function u(g){const y=new Array(g.length);for(let h=0;h<g.length;h++)y[h]=1-g[h];return y}function p(g){return g.slice(0).reverse()}return{bounce:{In:u(c),Out:c},cosine:{In:n,Out:p(n)},exponential:"exponential",linear:"linear",ripple:{In:s,Out:u(s)},sine:{In:l,Out:u(l)},step:{In:o,Out:u(o)}}})();class Instrument extends ToneAudioNode{constructor(){super(optionsFromArguments(Instrument.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=optionsFromArguments(Instrument.getDefaults(),arguments);this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...s)=>{const i=s[t],o=this.context.transport.schedule(a=>{s[t]=a,n.apply(this,s)},i);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,s){const i=this.toSeconds(n),o=this.toSeconds(t);return this.triggerAttack(e,i,s),this.triggerRelease(i+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Monophonic extends Instrument{constructor(){super(optionsFromArguments(Monophonic.getDefaults(),arguments));const e=optionsFromArguments(Monophonic.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Instrument.getDefaults(),{detune:0,onsilence:noOp,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const s=this.toSeconds(t);return this._triggerEnvelopeAttack(s,n),this.setNote(e,s),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),s=e instanceof FrequencyClass?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,i,n)}else this.frequency.setValueAtTime(s,n);return this}}__decorate([timeRange(0)],Monophonic.prototype,"portamento",void 0);class AmplitudeEnvelope extends Envelope{constructor(){super(optionsFromArguments(AmplitudeEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Gain({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Synth extends Monophonic{constructor(){super(optionsFromArguments(Synth.getDefaults(),arguments)),this.name="Synth";const e=optionsFromArguments(Synth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),readOnly(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),s=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+s)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class MembraneSynth extends Synth{constructor(){super(optionsFromArguments(MembraneSynth.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=optionsFromArguments(MembraneSynth.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,readOnly(this,["oscillator","envelope"])}static getDefaults(){return deepMerge(Monophonic.getDefaults(),Synth.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),s=this.toFrequency(e instanceof FrequencyClass?e.toFrequency():e),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}__decorate([range(0)],MembraneSynth.prototype,"octaves",void 0);__decorate([timeRange(0)],MembraneSynth.prototype,"pitchDecay",void 0);const workletContext=new Set;function addToWorklet(r){workletContext.add(r)}function registerProcessor(r,e){const t=`registerProcessor("${r}", ${e})`;workletContext.add(t)}const toneAudioWorkletProcessor=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;addToWorklet(toneAudioWorkletProcessor);const singleIOProcess=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;addToWorklet(singleIOProcess);const delayLine=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;addToWorklet(delayLine);const workletName$1="feedback-comb-filter",feedbackCombFilter=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;registerProcessor(workletName$1,feedbackCombFilter);class Sampler extends Instrument{constructor(){super(optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach(n=>{const s=parseInt(n,10);if(assert(isNote(n)||isNumber(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),isNote(n)){const i=new FrequencyClass(this.context,n).toMidi();t[i]=e.urls[n]}else isNumber(s)&&isFinite(s)&&(t[s]=e.urls[s])}),this._buffers=new ToneAudioBuffers({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:noOp,onerror:noOp,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(s=>{const i=ftomf(new FrequencyClass(this.context,s).toFrequency()),o=Math.round(i),a=i-o,l=this._findClosest(o),c=o-l,u=this._buffers.get(c),p=intervalToFrequencyRatio(l+a),g=new ToneBufferSource({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:p}).connect(this.output);g.start(t,0,u.duration/p,n),isArray(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(g),g.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const y=this._activeSources.get(o),h=y.indexOf(g);h!==-1&&y.splice(h,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const s=new FrequencyClass(this.context,n).toMidi();if(this._activeSources.has(s)&&this._activeSources.get(s).length){const i=this._activeSources.get(s);t=this.toSeconds(t),i.forEach(o=>{o.stop(t)}),this._activeSources.set(s,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,s),isArray(t)?(assert(isArray(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const l=t[Math.min(a,t.length-1)];this.triggerRelease(o,i+this.toSeconds(l))})):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(assert(isNote(e)||isFinite(e),`note must be a pitch or midi: ${e}`),isNote(e)){const s=new FrequencyClass(this.context,e).toMidi();this._buffers.add(s,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}__decorate([timeRange(0)],Sampler.prototype,"attack",void 0);__decorate([timeRange(0)],Sampler.prototype,"release",void 0);class Panner extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Panner.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=optionsFromArguments(Panner.getDefaults(),arguments,["pan"]);this.pan=new Param({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",readOnly(this,"pan")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const workletName="bit-crusher",bitCrusherWorklet=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;registerProcessor(workletName,bitCrusherWorklet);class Solo extends ToneAudioNode{constructor(){super(optionsFromArguments(Solo.getDefaults(),arguments,["solo"])),this.name="Solo";const e=optionsFromArguments(Solo.getDefaults(),arguments,["solo"]);this.input=this.output=new Gain({context:this.context}),Solo._allSolos.has(this.context)||Solo._allSolos.set(this.context,new Set),Solo._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Solo._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Solo._soloed.has(this.context)||Solo._soloed.set(this.context,new Set),Solo._soloed.get(this.context).add(this)}_removeSolo(){Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).delete(this)}_isSoloed(){return Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).has(this)}_noSolos(){return!Solo._soloed.has(this.context)||Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Solo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Solo._allSolos=new Map;Solo._soloed=new Map;class PanVol extends ToneAudioNode{constructor(){super(optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Panner({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Channel extends ToneAudioNode{constructor(){super(optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Solo({solo:e.solo,context:this.context}),this._panVol=this.output=new PanVol({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Channel.buses.has(e)||Channel.buses.set(e,new Gain({context:this.context})),Channel.buses.get(e)}send(e,t=0){const n=this._getBus(e),s=new Gain({context:this.context,units:"decibels",gain:t});return this.connect(s),s.connect(n),s}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Channel.buses=new Map;class Listener extends ToneAudioNode{constructor(){super(...arguments),this.name="Listener",this.positionX=new Param({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Param({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Param({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Param({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Param({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Param({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Param({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Param({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Param({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}onContextInit(r=>{r.listener=new Listener({context:r})});onContextClose(r=>{r.listener.dispose()});getContext().transport;getContext().destination;getContext().destination;getContext().listener;getContext().draw;const context=getContext();function loaded(){return ToneAudioBuffer.loaded()}const notes_to_load=["A2","C3","A3","C4","A4","C5"],notes_loaded=Object.fromEntries(notes_to_load.map(r=>[r,!1])),sampler=new Sampler().toDestination();context.lookAhead=.05;for(const r of notes_to_load)fetch(`/acchymns-dev/assets/notes/${r}.mp3`).then(async e=>{const t=URL.createObjectURL(await e.blob());sampler.add(r,t),notes_loaded[r]=!0});const interval=useLocalStorage("ACCOptions.playbackInterval",.25),duration=useLocalStorage("ACCOptions.playbackDuration",2.5),staggered=useLocalStorage("ACCOptions.staggered",!0),isPlaying=ref(!1);let cancel_interval_id;const scheduled_notes_interval_id=[],player={async play(r){if(isPlaying.value)return;if(isPlaying.value=!0,await start(),!Object.values(notes_loaded).every(t=>t)){console.log("Not all notes have been loaded!");return}if(!sampler.loaded){console.log("Sampler hasn't loaded!");return}console.log("attempting to start notes"),console.log(...unref(r)),await loaded();let e;if(staggered.value){for(const[t,n]of unref(r).entries())scheduled_notes_interval_id.push(setTimeout(()=>{sampler.triggerAttack(n)},interval.value*t*1e3));e=duration.value+interval.value*unref(r).length}else sampler.triggerAttack(unref(r)),e=duration.value;cancel_interval_id=setTimeout(()=>{sampler.releaseAll(),isPlaying.value=!1},e*1e3)},stop(){for(const r of scheduled_notes_interval_id)clearTimeout(r);clearTimeout(cancel_interval_id),sampler.releaseAll(),isPlaying.value=!1}};function useNotes(){return{player,isPlaying}}const _hoisted_1={class:"menu"},_hoisted_2={class:"title"},_hoisted_3={class:"title--left"},_hoisted_4={class:"title--center"},_hoisted_5={class:"title--right"},_hoisted_6={key:1,class:"ionicon",src:_imports_2$1},_hoisted_7=createBaseVNode("p",{class:"tooltiptext"},"New! Starting Notes",-1),_hoisted_8=[_hoisted_7],_hoisted_9={class:"w-100",style:{height:"100vh"}},_sfc_main=defineComponent({__name:"SongDisplayView",props:{book:{},number:{}},setup(r){const e=r,t=useRouter(),{player:n,isPlaying:s}=useNotes(),i=ref([]),o=useCapacitorPreferences("bookmarks",[]),a=computed(()=>o.value.findIndex(y=>y.book==e.book&&y.number==e.number)!=-1);async function l(){if(!a.value)o.value.push(e),await Toast.show({text:`#${e.number} added to Bookmarks`});else{const y=o.value.findIndex(h=>h.book==e.book&&h.number==e.number);o.value.splice(y,1),await Toast.show({text:`#${e.number} removed from Bookmarks`})}}onMounted(async()=>{var h;const y=await getSongMetaData(e.book);y!=null&&(i.value=(((h=y[e.number])==null?void 0:h.notes)??[]).reverse())}),onUnmounted(()=>{n.stop()});let c=useLocalStorage("starting_notes_tooltip_complete",!1),u=ref();function p(){n.play(i),g()}function g(){var y,h;(y=u.value)==null||y.classList.add("tooltiphidden"),(h=u.value)==null||h.classList.add("tooltip"),setTimeout(()=>{c.value=!0},1e3)}return(y,h)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("img",{onClick:h[0]||(h[0]=d=>unref(t).back()),class:"ionicon",src:_imports_0$1})]),createBaseVNode("div",_hoisted_4,[createBaseVNode("h1",null,"#"+toDisplayString(e.number),1)]),createBaseVNode("div",_hoisted_5,[i.value.length!=0?(openBlock(),createElementBlock(Fragment,{key:0},[unref(s)?(openBlock(),createElementBlock("img",_hoisted_6)):(openBlock(),createElementBlock("img",{key:0,onClick:p,class:"ionicon",src:_imports_1})),unref(c)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",{key:2,class:"tooltip",ref_key:"tooltip",ref:u,onClick:h[1]||(h[1]=d=>g())},_hoisted_8,512))],64)):createCommentVNode("",!0),a.value?(openBlock(),createElementBlock("img",{key:1,onClick:h[2]||(h[2]=d=>l()),class:"ionicon",src:_imports_3})):(openBlock(),createElementBlock("img",{key:2,onClick:h[3]||(h[3]=d=>l()),class:"ionicon",src:_imports_2}))])])]),createBaseVNode("div",_hoisted_9,[createVNode(SongContainer,{book:e.book,number:e.number},null,8,["book","number"])])],64))}}),SongDisplayView_vue_vue_type_style_index_0_lang="";export{_sfc_main as default};
