import{d as q,r as C,aj as j,Y as G,b as J,M as E,ak as l,U as Y,k as c,l as e,a5 as Z,a6 as z,q as m,F as k,s as $,v as x,w as f,m as r,a3 as H,x as o,p as D,ag as T,S as I,aa as K,R as b,G as Q,H as X,al as R,I as tt,J as et,Z as N,am as st,an as nt,ao as at,ap as ot,aq as it,ar as lt,af as ct,as as rt,L as dt}from"./index-684b626a.js";import{_ as ut}from"./chevron-back-outline-3b18af6c.js";import{_ as _t}from"./close-d0f2b920.js";import{_ as mt}from"./home-outline-fa9c027b.js";import{_ as ft}from"./settings-5944a888.js";import{T as i}from"./index-1d38a5d6.js";import{u as ht}from"./navigator-13b14813.js";const pt="/acchymns-dev/assets/enter-outline.svg",vt="/acchymns-dev/assets/arrow-down-circle-outline.svg",wt="/acchymns-dev/assets/trash-outline.svg",a=v=>(Q("data-v-3fcf9af1"),v=v(),X(),v),yt={class:"menu"},gt={class:"title"},kt=a(()=>e("h1",{class:"title--center"},"Import Hymnals",-1)),xt={class:"main-content"},Dt={class:"input-option reference-option"},It=["disabled"],bt=a(()=>e("img",{class:"ionicon enter-button-icon",src:pt},null,-1)),St=[bt],Ct={key:0},Et={key:1,class:"warning-label-container"},$t=a(()=>e("img",{class:"ionicon warning-icon",src:R},null,-1)),Tt=a(()=>e("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Pt=[$t,Tt],Bt=["onClick"],Ot=a(()=>e("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:rt},null,-1)),Ht=[Ot],Nt={key:2},Rt={key:3,class:"warning-label-container"},Vt=a(()=>e("img",{class:"ionicon warning-icon",src:R},null,-1)),Lt=a(()=>e("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Mt=[Vt,Lt],Ut={class:"button-array"},At=["onClick"],Ft=a(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:vt},null,-1)),Wt=[Ft],qt=["onClick"],jt=a(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:_t},null,-1)),Gt=[jt],Jt={key:4},Yt={class:"button-array"},Zt=["onClick"],zt=a(()=>e("img",{class:"ionicon ionicon-custom add-button-icon",src:wt},null,-1)),Kt=[zt],Qt=a(()=>e("div",{style:{"padding-bottom":"200px"}},null,-1)),Xt={class:"nav"},te=a(()=>e("img",{class:"ionicon nav__icon",src:mt},null,-1)),ee=a(()=>e("span",{class:"nav__text"},"Home",-1)),se=a(()=>e("img",{class:"ionicon nav__icon",src:tt},null,-1)),ne=a(()=>e("span",{class:"nav__text"},"Search",-1)),ae=a(()=>e("img",{class:"ionicon nav__icon",src:et},null,-1)),oe=a(()=>e("span",{class:"nav__text"},"Bookmarks",-1)),ie=a(()=>e("img",{class:"ionicon nav__icon--active",src:ft},null,-1)),le=a(()=>e("span",{class:"nav__text"},"Settings",-1)),ce=q({__name:"SettingsImportView",setup(v){ht();let d=C(new Map),h=C(new Map);j(async()=>{h.value.forEach(async(t,n)=>{await t.cancel(),d.value.delete(n)})});const p=G("bookSources",[]);let P=J("import_books_tooltip_complete",!1);const w=E(()=>p.value.filter(n=>n.status==l.PREVIEW)),S=E(()=>p.value.filter(t=>t.status==l.IMPORTED)),B=E(()=>p.value.filter(t=>t.status==l.DOWNLOADED)),y=C("");async function O(t,n=!0){let s=p.value.find(_=>_.id==t.id);if(s==null)return!1;if((await N.getStatus()).connected)I.getPlatform()!=="web"&&await st(s);else return await i.show({text:"No internet connection."}),!1;let g=null;try{const _=new AbortController,W=setTimeout(()=>_.abort(),2e3);g=await fetch(s.src+"/summary.json",{method:"HEAD",signal:_.signal}),clearTimeout(W)}catch(_){if(_.name=="TypeError")return await i.show({text:"Failed to load hymnal!"}),!1;if(_.name!="AbortError")throw _}return g==null||!g.ok||g.status!=200?(await i.show({text:"Failed to load hymnal!"}),!1):s.status!=l.IMPORTED?(s.status=l.IMPORTED,n&&await i.show({text:"Successfully imported hymnal!"}),!0):(await i.show({text:"Hymnal already imported!"}),!1)}async function V(t){if(t=t.toUpperCase(),t in H){const n=p.value.find(s=>s.id==t);if(n==null)return;n.status==l.IMPORTED||n.status==l.DOWNLOADED?await i.show({text:`Hymnal (${t}) already imported!`}):await O(n,!1)&&await i.show({text:`Successfully imported hymnal (${t})!`})}else await i.show({text:`Unknown hymnal reference (${t})!`})}async function L(t){if((await N.getStatus()).connected){let n=nt(t,(s,u)=>M(s,u),(s,u)=>U(s,u));h.value.set(t.id,n)}else await i.show({text:"No internet connection."});console.log("Downloads:",h.value)}async function M(t,n){d.value.set(t.id,n)}async function U(t,n){t.src=n,t.status=l.DOWNLOADED,await i.show({text:"Successfully downloaded hymnal!"})}Y(()=>{P.value||(P.value=!0)});async function A(t){var n;t.status=Object.keys(at).includes(t.id)?l.PREVIEW:l.HIDDEN,h.value.has(t.id)&&((n=h.value.get(t.id))==null||n.cancel(),d.value.delete(t.id)),I.getPlatform()!=="web"&&await ot(t),await i.show({text:"Successfully removed hymnal!"})}async function F(t){t.status=l.IMPORTED,t.src=H[t.id],await it.rmdir({directory:lt.Documents,path:`Hymnals/${t.id}`,recursive:!0}),d.value.delete(t.id),ct(),await i.show({text:"Successfully deleted hymnal!"})}return(t,n)=>(o(),c(k,null,[e("div",yt,[e("div",gt,[e("img",{onClick:n[0]||(n[0]=s=>t.$router.back()),class:"ionicon title--left",src:ut}),kt])]),e("div",xt,[e("div",Dt,[Z(e("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>y.value=s),type:"text",class:"search-bar",placeholder:"Book Code"},null,512),[[z,y.value,void 0,{trim:!0}]]),e("a",{disabled:y.value.length===0,onClick:n[2]||(n[2]=s=>V(y.value)),class:"reference-button"},St,8,It)]),w.value.length!=0?(o(),c("h2",Ct,"Available Hymnals")):m("",!0),w.value.length!=0?(o(),c("div",Et,Pt)):m("",!0),e("div",null,[(o(!0),c(k,null,$(w.value,s=>(o(),D(T,{key:s.id,src:s.src,"with-link":!1},{default:f(()=>[e("button",{onClick:u=>O(s)},Ht,8,Bt)]),_:2},1032,["src"]))),128))]),S.value.length!=0?(o(),c("h2",Nt,"Imported Hymnals")):m("",!0),S.value.length!=0&&w.value.length==0?(o(),c("div",Rt,Mt)):m("",!0),e("div",null,[(o(!0),c(k,null,$(S.value,s=>(o(),D(T,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:f(()=>[e("div",Ut,[(r(d).get(s.id)||0)<1&&r(I).getPlatform()!=="web"?(o(),c("button",{key:0,onClick:u=>L(s)},Wt,8,At)):m("",!0),(r(d).get(s.id||"")||0)>=1&&(r(d).get(s.id||"")||0)<100&&r(I).getPlatform()!=="web"?(o(),D(K,{key:1,radius:15,progress:r(d).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress","transform"])):m("",!0),e("button",{onClick:u=>A(s)},Gt,8,qt)])]),_:2},1032,["src"]))),128))]),B.value.length!=0?(o(),c("h2",Jt,"Downloaded Hymnals")):m("",!0),e("div",null,[(o(!0),c(k,null,$(B.value,s=>(o(),D(T,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:f(()=>[e("div",Yt,[e("button",{onClick:u=>F(s)},Kt,8,Zt)])]),_:2},1032,["src"]))),128))]),Qt]),e("nav",Xt,[x(r(b),{to:"/",class:"nav__link"},{default:f(()=>[te,ee]),_:1}),x(r(b),{to:"/search",class:"nav__link"},{default:f(()=>[se,ne]),_:1}),x(r(b),{to:"/bookmarks",class:"nav__link"},{default:f(()=>[ae,oe]),_:1}),x(r(b),{to:"/settings",class:"nav__link nav__link--active"},{default:f(()=>[ie,le]),_:1})])],64))}});const pe=dt(ce,[["__scopeId","data-v-3fcf9af1"]]);export{pe as default};
