import{d as L,r as x,as as U,V as F,p as W,c as D,at as i,S as q,b as l,e as n,w as j,$ as z,k as d,au as P,F as v,C,i as G,a6 as T,o as a,g,h as b,av as J,aq as E,f as m,P as _,ah as K,_ as Q,aw as O,ax as X,ay as Y,az as Z,aA as tt,an as et,ao as st,am as nt,l as at}from"./index-229ae8ba.js";import{_ as ot}from"./chevron-back-outline-3b18af6c.js";import{_ as it}from"./close-d0f2b920.js";import{T as o}from"./index-075bba4c.js";const lt="/acchymns-dev/assets/enter-outline.svg",rt="/acchymns-dev/assets/arrow-down-circle-outline.svg",ct="/acchymns-dev/assets/trash-outline.svg",ut={class:"menu"},dt={class:"title"},mt={class:"main-content"},ft={class:"input-option reference-option"},pt={key:0},wt={key:1,class:"warning-label-container"},yt=["onClick"],vt={key:2},gt={key:3,class:"warning-label-container"},_t={class:"button-array"},ht=["onClick"],kt=["onClick"],xt={key:4},Dt={class:"button-array"},Ct=["onClick"],bt=L({__name:"SettingsImportView",setup(Et){let r=x(new Map),f=x(new Map);U(async()=>{f.value.forEach(async(e,t)=>{await e.cancel(),r.value.delete(t)})});const p=F("bookSources",[]);let I=W("import_books_tooltip_complete",!1);const w=D(()=>p.value.filter(t=>t.status==i.PREVIEW)),h=D(()=>p.value.filter(e=>e.status==i.IMPORTED)),S=D(()=>p.value.filter(e=>e.status==i.DOWNLOADED)),k=x("");async function $(e,t=!0){let s=p.value.find(u=>u.id==e.id);if(s==null)return!1;if((await O.getStatus()).connected)_.getPlatform()!=="web"&&await X(s);else return await o.show({text:"No internet connection."}),!1;let y=null;try{const u=new AbortController,M=setTimeout(()=>u.abort(),2e3);y=await fetch(s.src+"/summary.json",{method:"HEAD",signal:u.signal}),clearTimeout(M)}catch(u){if(u.name=="TypeError")return await o.show({text:"Failed to load hymnal!"}),!1;if(u.name!="AbortError")throw u}return y==null||!y.ok||y.status!=200?(await o.show({text:"Failed to load hymnal!"}),!1):s.status!=i.IMPORTED?(s.status=i.IMPORTED,t&&await o.show({text:"Successfully imported hymnal!"}),!0):(await o.show({text:"Hymnal already imported!"}),!1)}async function B(e){if(e=e.toUpperCase(),e in T){const t=p.value.find(s=>s.id==e);if(t==null)return;t.status==i.IMPORTED||t.status==i.DOWNLOADED?await o.show({text:`Hymnal (${e}) already imported!`}):await $(t,!1)&&await o.show({text:`Successfully imported hymnal (${e})!`})}else await o.show({text:`Unknown hymnal reference (${e})!`})}async function V(e){if((await O.getStatus()).connected){let t=Y(e,(s,c)=>N(s,c),(s,c)=>H(s,c));f.value.set(e.id,t)}else await o.show({text:"No internet connection."});console.log("Downloads:",f.value)}async function N(e,t){r.value.set(e.id,t)}async function H(e,t){e.src=t,e.status=i.DOWNLOADED,await o.show({text:"Successfully downloaded hymnal!"})}q(()=>{I.value||(I.value=!0)});async function R(e){var t;e.status=Object.keys(Z).includes(e.id)?i.PREVIEW:i.HIDDEN,f.value.has(e.id)&&((t=f.value.get(e.id))==null||t.cancel(),r.value.delete(e.id)),_.getPlatform()!=="web"&&await tt(e),await o.show({text:"Successfully removed hymnal!"})}async function A(e){e.status=i.IMPORTED,e.src=T[e.id],await et.rmdir({directory:st.Documents,path:`Hymnals/${e.id}`,recursive:!0}),r.value.delete(e.id),nt(),await o.show({text:"Successfully deleted hymnal!"})}return(e,t)=>(a(),l(v,null,[n("div",ut,[n("div",dt,[n("img",{onClick:t[0]||(t[0]=s=>e.$router.back()),class:"ionicon title--left",src:ot}),t[3]||(t[3]=n("div",{class:"title--center"},[n("h1",null,"Import Hymnals")],-1))])]),n("div",mt,[n("div",ft,[j(n("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),type:"text",class:"search-bar",placeholder:"Book Code"},null,512),[[z,k.value,void 0,{trim:!0}]]),n("button",{onClick:t[2]||(t[2]=s=>B(k.value)),class:"reference-button"},t[4]||(t[4]=[n("img",{class:"ionicon enter-button-icon",src:lt},null,-1)]))]),w.value.length!=0?(a(),l("h2",pt,"Available Hymnals")):d("",!0),w.value.length!=0?(a(),l("div",wt,t[5]||(t[5]=[n("img",{class:"ionicon warning-icon",src:P},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(v,null,C(w.value,s=>(a(),g(E,{key:s.id,src:s.src,"with-link":!1},{default:b(()=>[n("button",{onClick:c=>$(s)},t[6]||(t[6]=[n("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:J},null,-1)]),8,yt)]),_:2},1032,["src"]))),128))]),h.value.length!=0?(a(),l("h2",vt,"Imported Hymnals")):d("",!0),h.value.length!=0&&w.value.length==0?(a(),l("div",gt,t[7]||(t[7]=[n("img",{class:"ionicon warning-icon",src:P},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(v,null,C(h.value,s=>(a(),g(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:b(()=>[n("div",_t,[(m(r).get(s.id)||0)<1&&m(_).getPlatform()!=="web"?(a(),l("button",{key:0,onClick:c=>V(s)},t[8]||(t[8]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:rt},null,-1)]),8,ht)):d("",!0),(m(r).get(s.id||"")||0)>=1&&(m(r).get(s.id||"")||0)<100&&m(_).getPlatform()!=="web"?(a(),g(K,{key:1,radius:15,progress:m(r).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress"])):d("",!0),n("button",{onClick:c=>R(s)},t[9]||(t[9]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:it},null,-1)]),8,kt)])]),_:2},1032,["src"]))),128))]),S.value.length!=0?(a(),l("h2",xt,"Downloaded Hymnals")):d("",!0),n("div",null,[(a(!0),l(v,null,C(S.value,s=>(a(),g(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:b(()=>[n("div",Dt,[n("button",{onClick:c=>A(s)},t[10]||(t[10]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ct},null,-1)]),8,Ct)])]),_:2},1032,["src"]))),128))]),t[11]||(t[11]=n("div",{style:{"padding-bottom":"200px"}},null,-1))]),G(Q,{current_page:"settings"})],64))}});const Tt=at(bt,[["__scopeId","data-v-ca9104e6"]]);export{Tt as default};
