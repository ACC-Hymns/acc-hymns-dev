var P=Object.defineProperty;var V=(p,t,s)=>t in p?P(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s;var M=(p,t,s)=>(V(p,typeof t!="symbol"?t+"":t,s),s);import{d as z,o as E,a as q,f as G,r as S,J as x,N as W,c as J,g as K,a0 as U,a1 as Z,a2 as Q,a3 as X,n as Y,j as tt,a4 as st,k as $,l as a,Z as N,a5 as et,A as ot,m as D,F as L,s as O,t as C,q as T,v as it,x as y,z as H,p as rt,w as nt,R as at,_ as lt,B as ct}from"./index-83306a13.js";import{s as R}from"./search-ac5b21e0.js";const ht="/acchymns-dev/assets/filter-outline.svg";class j{constructor(t,s,e){M(this,"r",0);M(this,"g",0);M(this,"b",0);this.set(t,s,e)}toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`}set(t,s,e){this.r=this.clamp(t),this.g=this.clamp(s),this.b=this.clamp(e)}hueRotate(t=0){t=t/180*Math.PI;const s=Math.sin(t),e=Math.cos(t);this.multiply([.213+e*.787-s*.213,.715-e*.715-s*.715,.072-e*.072+s*.928,.213-e*.213+s*.143,.715+e*.285+s*.14,.072-e*.072-s*.283,.213-e*.213-s*.787,.715-e*.715+s*.715,.072+e*.928+s*.072])}grayscale(t=1){this.multiply([.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)])}sepia(t=1){this.multiply([.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)])}saturate(t=1){this.multiply([.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t])}multiply(t){const s=this.clamp(this.r*t[0]+this.g*t[1]+this.b*t[2]),e=this.clamp(this.r*t[3]+this.g*t[4]+this.b*t[5]),o=this.clamp(this.r*t[6]+this.g*t[7]+this.b*t[8]);this.r=s,this.g=e,this.b=o}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-(.5*t)+.5)}linear(t=1,s=0){this.r=this.clamp(this.r*t+s*255),this.g=this.clamp(this.g*t+s*255),this.b=this.clamp(this.b*t+s*255)}invert(t=1){this.r=this.clamp((t+this.r/255*(1-2*t))*255),this.g=this.clamp((t+this.g/255*(1-2*t))*255),this.b=this.clamp((t+this.b/255*(1-2*t))*255)}hsl(){const t=this.r/255,s=this.g/255,e=this.b/255,o=Math.max(t,s,e),l=Math.min(t,s,e);let d=0,g=0;const m=(o+l)/2;if(o===l)d=g=0;else{const _=o-l;switch(g=m>.5?_/(2-o-l):_/(o+l),o){case t:d=(s-e)/_+(s<e?6:0);break;case s:d=(e-t)/_+2;break;case e:d=(t-s)/_+4;break}d/=6}return{h:d*100,s:g*100,l:m*100}}clamp(t){return t>255?t=255:t<0&&(t=0),t}}class ut{constructor(t){M(this,"target");M(this,"targetHSL");M(this,"reusedColor");this.target=t,this.targetHSL=t.hsl(),this.reusedColor=new j(0,0,0)}solve(){const t=this.solveNarrow(this.solveWide());return{values:t.values,loss:t.loss,filter:this.css(t.values??[])}}solveWide(){const e=[60,180,18e3,600,1.2,1.2];let o={loss:1/0};for(let l=0;o.loss>25&&l<3;l++){const d=[50,20,3750,50,100,100],g=this.spsa(5,e,15,d,1e3);g.loss<o.loss&&(o=g)}return o}solveNarrow(t){const s=t.loss,e=2,o=s+1,l=[.25*o,.25*o,o,.25*o,.2*o,.2*o];return this.spsa(s,l,e,t.values,500)}spsa(t,s,e,o,l){const g=.16666666666666666;let m=null,_=1/0;const w=new Array(6),v=new Array(6),F=new Array(6);for(let h=0;h<l;h++){const k=e/Math.pow(h+1,g);for(let c=0;c<6;c++)w[c]=Math.random()>.5?1:-1,v[c]=o[c]+k*w[c],F[c]=o[c]-k*w[c];const f=this.loss(v)-this.loss(F);for(let c=0;c<6;c++){const i=f/(2*k)*w[c],r=s[c]/Math.pow(t+h+1,1);o[c]=B(o[c]-r*i,c)}const A=this.loss(o);A<_&&(m=o.slice(0),_=A)}return{values:m,loss:_};function B(h,k){let f=100;return k===2?f=7500:(k===4||k===5)&&(f=200),k===3?h>f?h%=f:h<0&&(h=f+h%f):h<0?h=0:h>f&&(h=f),h}}loss(t){const s=this.reusedColor;s.set(0,0,0),s.invert(t[0]/100),s.sepia(t[1]/100),s.saturate(t[2]/100),s.hueRotate(t[3]*3.6),s.brightness(t[4]/100),s.contrast(t[5]/100);const e=s.hsl();return Math.abs(s.r-this.target.r)+Math.abs(s.g-this.target.g)+Math.abs(s.b-this.target.b)+Math.abs(e.h-this.targetHSL.h)+Math.abs(e.s-this.targetHSL.s)+Math.abs(e.l-this.targetHSL.l)}css(t){function s(e,o=1){return Math.round(t[e]*o)}return`filter: invert(${s(0)}%) sepia(${s(1)}%) saturate(${s(2)}%) hue-rotate(${s(3,3.6)}deg) brightness(${s(4)}%) contrast(${s(5)}%);`}}function dt(p){const t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;p=p.replace(t,(e,o,l,d)=>o+o+l+l+d+d);const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]:null}const _t=a("h1",{class:"pagetitle"},"Search",-1),pt={class:"search-bar"},mt=a("button",{disabled:""},[a("svg",{viewBox:"0 0 1024 1024"},[a("path",{class:"path1",d:"M848.471 928l-263.059-263.059c-48.941 36.706-110.118 55.059-177.412 55.059-171.294 0-312-140.706-312-312s140.706-312 312-312c171.294 0 312 140.706 312 312 0 67.294-24.471 128.471-55.059 177.412l263.059 263.059-79.529 79.529zM189.623 408.078c0 121.364 97.091 218.455 218.455 218.455s218.455-97.091 218.455-218.455c0-121.364-103.159-218.455-218.455-218.455-121.364 0-218.455 97.091-218.455 218.455z"})])],-1),ft={class:"filters"},bt=a("p",{class:"dropdown-text"},"Filters",-1),gt=a("img",{class:"ionicon filter-icon",src:ht},null,-1),kt=[bt,gt],vt=["src"],yt=a("div",{class:"dropdown-content-text"},"All Hymnals",-1),wt=["onClick"],Mt={class:"dropdown-content-item"},St=["src"],$t={class:"dropdown-content-text"},At={key:0,style:{"margin-top":"10px","margin-bottom":"10px"}},Ct={class:"songlist"},Ft={class:"song__title"},Bt={class:"book__title"},xt={class:"booktext--right"},Dt={class:"song__number"},Lt=a("div",{class:"song__title"},"Show more",-1),Rt=[Lt],I=50,Tt=z({__name:"SearchView",setup(p){E((i,r)=>{ct(r.fullPath)});const t=q(),s=G("searchParams",{search:"",bookFilters:[]}),e=S(s.value.search),o=x(()=>R(e.value));W(e,i=>{s.value.search=i});const l=S([]),d=S([]),g=S(new Map),m=x(()=>s.value.bookFilters.length>0?l.value.filter(i=>{var r,u;return(((r=i.stripped_title)==null?void 0:r.includes(o.value))||((u=i==null?void 0:i.stripped_first_line)==null?void 0:u.includes(o.value))||(i==null?void 0:i.number)==o.value)&&s.value.bookFilters.find(n=>n==i.book.name.short)}).sort((i,r)=>i.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").localeCompare(r.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,""))):e.value===""?[]:l.value.filter(i=>{var r,u;return((r=i.stripped_title)==null?void 0:r.includes(o.value))||((u=i==null?void 0:i.stripped_first_line)==null?void 0:u.includes(o.value))||(i==null?void 0:i.number)==o.value}).sort((i,r)=>i.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").localeCompare(r.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"")))),_=S(I),w=x(()=>m.value.length-_.value<I?m.value:m.value.slice(0,_.value));J(async()=>{const i=await K(),r=await U();d.value.push(...Object.values(i));for(const u of Object.keys(r))for(const n of Object.keys(r[u])){let b=r[u][n];b.title==null&&(b.title=""),l.value.push({title:(b==null?void 0:b.title)??"",number:n,book:i[u],stripped_title:R((b==null?void 0:b.title)??""),stripped_first_line:R((b==null?void 0:b.first_line)??"")})}Z.concat(Object.keys(Q)).forEach(async u=>{let n=await X(u);n!=null&&g.value.set(u,n)}),await Y(),tt(t.fullPath)});const v=S(!1);function F(){v.value=!1}function B(){v.value=!v.value}let h=S([]);function k(i){if(v.value=!0,s.value.bookFilters.includes(i)){let r=s.value.bookFilters.findIndex(u=>u==i);s.value.bookFilters.splice(r,1)}else s.value.bookFilters.push(i)}function f(){s.value.bookFilters=[]}function A(i){return i?"./assets/checkmark-circle.svg":"./assets/ellipse-outline.svg"}function c(i){const r=dt(i??"#000000");return(r==null?void 0:r.length)!==3?"":new ut(new j(r[0],r[1],r[2])).solve().filter}return(i,r)=>{const u=st("click-away");return y(),$(L,null,[_t,a("div",pt,[N(a("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>e.value=n),placeholder:"Search for a song title or number...","aria-label":"Search through site content"},null,512),[[et,e.value]]),mt]),a("div",ft,[N((y(),$("a",{onClick:r[1]||(r[1]=n=>B()),class:"dropdown"},kt)),[[u,F]]),a("div",{class:ot(["dropdown-content",v.value?"dropdown-content-active":""])},[a("a",null,[a("div",{class:"dropdown-content-top-item",onClick:f},[a("img",{class:"ionicon checkmark-icon",src:A(D(s).bookFilters.length==0)},null,8,vt),yt])]),(y(!0),$(L,null,O(d.value,n=>(y(),$("a",{key:n.name.medium,onClick:b=>k(n.name.short),ref_for:!0,ref_key:"book_filters",ref:h},[a("div",Mt,[a("img",{class:"ionicon",src:A(D(s).bookFilters.includes(n.name.short)),style:H(c(n.primaryColor))},null,12,St),a("div",$t,C(n.name.medium),1)])],8,wt))),128))],2)]),m.value.length>0?(y(),$("h2",At,"Search Results ("+C(m.value.length)+")",1)):T("",!0),a("div",Ct,[(y(!0),$(L,null,O(w.value,n=>(y(),rt(D(at),{key:n.title+n.number+n.book.name.short,to:`/display/${n.book.name.short}/${n.number}`,class:"song",style:H(`background: linear-gradient(135deg, ${n.book.primaryColor}, ${n.book.secondaryColor})`)},{default:nt(()=>[a("div",null,[a("div",Ft,C(n.title),1),a("div",Bt,C(n.book.name.medium),1)]),a("div",xt,[a("div",Dt,"#"+C(n.number),1)])]),_:2},1032,["to","style"]))),128)),w.value.length<m.value.length?(y(),$("div",{key:0,onClick:r[2]||(r[2]=n=>_.value+=I),class:"song",style:{background:"var(--blue)","justify-content":"center"}},Rt)):T("",!0)]),it(lt,{current_page:"search"})],64)}}});export{Tt as default};
