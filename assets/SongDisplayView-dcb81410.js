var kS=Object.defineProperty;var DS=(r,t,e)=>t in r?kS(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var at=(r,t,e)=>(DS(r,typeof t!="symbol"?t+"":t,e),e),fm=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var h=(r,t,e)=>(fm(r,t,"read from private field"),e?e.call(r):t.get(r)),b=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},_=(r,t,e,s)=>(fm(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);var qe=(r,t,e,s)=>({set _(n){_(r,t,n,e)},get _(){return h(r,t,s)}}),w=(r,t,e)=>(fm(r,t,"access private method"),e);import{_ as O0}from"./chevron-back-outline-3b18af6c.js";import{a as NS,_ as LS,D as FS}from"./DropdownMenu-b48b0b80.js";import{S as M0,_ as BS}from"./index-8e84c4b6.js";import{_ as VS}from"./chevron-forward-outline-4fe420c1.js";import{_ as k0}from"./close-d0f2b920.js";import{r as Mt,K as Pf,L as $S,M as qb,d as ny,N as Zb,c as se,O as iy,l as Gt,P as jS,s as Oo,o as Qb,g as Jb,Q as US,e as Z,b as it,f as t_,S as ji,D as Hs,m as Ps,n as WS,T as HS,u as zS,U as GS,a as D0,V as N0,h as XS,W as YS,t as Kn,F as Bd,w as L0,i as KS,A as F0,C as Fi,j as qS}from"./index-d8b98756.js";import{C as ZS,c as QS,g as JS,a as tT,s as eT,d as sT,r as e_,_ as ve,b as mn,e as nT}from"./broadcast-a28a3022.js";import{T as pm}from"./index-d17b9749.js";import{u as iT}from"./broadcast-e221efca.js";import{v as B0}from"./index-f1fc4d9b.js";class rT extends ZS.classBuilder().ep({...QS}).m(function(t,e,s,n){return[JS(s,this.serialize,this.deserialize),tT(s,t.getEndpointParameterInstructions())]}).s("DynamoDB_20120810","PutItem",{}).n("DynamoDBClient","PutItemCommand").f(void 0,void 0).ser(eT).de(sT).build(){}function aT(){const r=Mt(null),t=Pf(()=>r.value!=null);async function e(){r.value=e_()}e();async function s(n){if(r.value!=null){const i={TableName:"ACC_HYMNS_SONG_ISSUES",Item:{SONG_BOOK:{S:n.book},SONG_NUMBER:{S:n.number}}},a=new rT(i);return await r.value.send(a)}return null}return{client:r,is_ready:t,report:s}}const oT="/acchymns-dev/assets/musical-notes-outline.svg",V0="/acchymns-dev/assets/musical-notes.svg",lT="/acchymns-dev/assets/flag-outline.svg",cT="/acchymns-dev/assets/radio-outline.svg";var Fg={exports:{}};Fg.exports=s_;Fg.exports.addWheelListener=s_;Fg.exports.removeWheelListener=hT;function s_(r,t,e){r.addEventListener("wheel",t,e)}function hT(r,t,e){r.removeEventListener("wheel",t,e)}var uT=Fg.exports,Bg={exports:{}},dT=4,fT=.001,pT=1e-7,gT=10,Pc=11,Vd=1/(Pc-1),mT=typeof Float32Array=="function";function n_(r,t){return 1-3*t+3*r}function i_(r,t){return 3*t-6*r}function r_(r){return 3*r}function Of(r,t,e){return((n_(t,e)*r+i_(t,e))*r+r_(t))*r}function a_(r,t,e){return 3*n_(t,e)*r*r+2*i_(t,e)*r+r_(t)}function vT(r,t,e,s,n){var i,a,o=0;do a=t+(e-t)/2,i=Of(a,s,n)-r,i>0?e=a:t=a;while(Math.abs(i)>pT&&++o<gT);return a}function yT(r,t,e,s){for(var n=0;n<dT;++n){var i=a_(t,e,s);if(i===0)return t;var a=Of(t,e,s)-r;t-=a/i}return t}function bT(r){return r}var _T=function(t,e,s,n){if(!(0<=t&&t<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&s===n)return bT;for(var i=mT?new Float32Array(Pc):new Array(Pc),a=0;a<Pc;++a)i[a]=Of(a*Vd,t,s);function o(l){for(var c=0,u=1,d=Pc-1;u!==d&&i[u]<=l;++u)c+=Vd;--u;var f=(l-i[u])/(i[u+1]-i[u]),p=c+f*Vd,g=a_(p,t,s);return g>=fT?yT(l,p,t,s):g===0?p:vT(l,c,c+Vd,t,s)}return function(c){return c===0?0:c===1?1:Of(o(c),e,n)}},Ec=_T,$0={ease:Ec(.25,.1,.25,1),easeIn:Ec(.42,0,1,1),easeOut:Ec(0,0,.58,1),easeInOut:Ec(.42,0,.58,1),linear:Ec(0,0,1,1)};Bg.exports=AT;Bg.exports.makeAggregateRaf=o_;Bg.exports.sharedScheduler=o_();function AT(r,t,e){var s=Object.create(null),n=Object.create(null);e=e||{};var i=typeof e.easing=="function"?e.easing:$0[e.easing];i||(e.easing&&console.warn("Unknown easing function in amator: "+e.easing),i=$0.ease);var a=typeof e.step=="function"?e.step:j0,o=typeof e.done=="function"?e.done:j0,l=wT(e.scheduler),c=Object.keys(t);c.forEach(function(y){s[y]=r[y],n[y]=t[y]-r[y]});var u=typeof e.duration=="number"?e.duration:400,d=Math.max(1,u*.06),f,p=0;return f=l.next(m),{cancel:g};function g(){l.cancel(f),f=0}function m(){var y=i(p/d);p+=1,v(y),p<=d?(f=l.next(m),a(r)):(f=0,setTimeout(function(){o(r)},0))}function v(y){c.forEach(function(S){r[S]=n[S]*y+s[S]})}}function j0(){}function wT(r){if(!r){var t=typeof window<"u"&&window.requestAnimationFrame;return t?ST():TT()}if(typeof r.next!="function")throw new Error("Scheduler is supposed to have next(cb) function");if(typeof r.cancel!="function")throw new Error("Scheduler is supposed to have cancel(handle) function");return r}function ST(){return{next:window.requestAnimationFrame.bind(window),cancel:window.cancelAnimationFrame.bind(window)}}function TT(){return{next:function(r){return setTimeout(r,1e3/60)},cancel:function(r){return clearTimeout(r)}}}function o_(){var r=new Set,t=new Set,e=0;return{next:n,cancel:n,clearAll:s};function s(){r.clear(),t.clear(),cancelAnimationFrame(e),e=0}function n(o){t.add(o),i()}function i(){e||(e=requestAnimationFrame(a))}function a(){e=0;var o=t;t=r,r=o,r.forEach(function(l){l()}),r.clear()}}var CT=Bg.exports,ET=function(t){IT(t);var e=xT(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t};function xT(r){var t=Object.create(null);return{on:function(e,s,n){if(typeof s!="function")throw new Error("callback is expected to be a function");var i=t[e];return i||(i=t[e]=[]),i.push({callback:s,ctx:n}),r},off:function(e,s){var n=typeof e>"u";if(n)return t=Object.create(null),r;if(t[e]){var i=typeof s!="function";if(i)delete t[e];else for(var a=t[e],o=0;o<a.length;++o)a[o].callback===s&&a.splice(o,1)}return r},fire:function(e){var s=t[e];if(!s)return r;var n;arguments.length>1&&(n=Array.prototype.splice.call(arguments,1));for(var i=0;i<s.length;++i){var a=s[i];a.callback.apply(a.ctx,n)}return r}}}function IT(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var t=["on","fire","off"],e=0;e<t.length;++e)if(r.hasOwnProperty(t[e]))throw new Error("Subject cannot be eventified, since it already has property '"+t[e]+"'")}var RT=PT;function PT(r,t,e){typeof e!="object"&&(e={});var s=typeof e.minVelocity=="number"?e.minVelocity:5,n=typeof e.amplitude=="number"?e.amplitude:.25,i=typeof e.cancelAnimationFrame=="function"?e.cancelAnimationFrame:OT(),a=typeof e.requestAnimationFrame=="function"?e.requestAnimationFrame:MT(),o,l,c=342,u,d,f,p,g,m,v,y;return{start:T,stop:A,cancel:S};function S(){i(u),i(y)}function T(){o=r(),p=v=d=g=0,l=new Date,i(u),i(y),u=a(E)}function E(){var x=Date.now(),I=x-l;l=x;var R=r(),O=R.x-o.x,P=R.y-o.y;o=R;var M=1e3/(1+I);d=.8*O*M+.2*d,g=.8*P*M+.2*g,u=a(E)}function A(){i(u),i(y);var x=r();f=x.x,m=x.y,l=Date.now(),(d<-s||d>s)&&(p=n*d,f+=p),(g<-s||g>s)&&(v=n*g,m+=v),y=a(C)}function C(){var x=Date.now()-l,I=!1,R=0,O=0;p&&(R=-p*Math.exp(-x/c),R>.5||R<-.5?I=!0:R=p=0),v&&(O=-v*Math.exp(-x/c),O>.5||O<-.5?I=!0:O=v=0),I&&(t(f+R,m+O),y=a(C))}}function OT(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function MT(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(r){return setTimeout(r,16)}}var kT=DT;function DT(r){if(r)return{capture:W0,release:W0};var t,e,s,n=!1;return{capture:i,release:a};function i(o){n=!0,e=window.document.onselectstart,s=window.document.ondragstart,window.document.onselectstart=U0,t=o,t.ondragstart=U0}function a(){n&&(n=!1,window.document.onselectstart=e,t&&(t.ondragstart=s))}}function U0(r){return r.stopPropagation(),!1}function W0(){}var gm,H0;function NT(){if(H0)return gm;H0=1,gm=r;function r(){this.x=0,this.y=0,this.scale=1}return gm}var $d={exports:{}},z0;function LT(){if(z0)return $d.exports;z0=1,$d.exports=r,$d.exports.canAttach=t;function r(e,s){if(!t(e))throw new Error("svg element is required for svg.panzoom to work");var n=e.ownerSVGElement;if(!n)throw new Error("Do not apply panzoom to the root <svg> element. Use its child instead (e.g. <g></g>). As of March 2016 only FireFox supported transform on the root element");s.disableKeyboardInteraction||n.setAttribute("tabindex",0);var i={getBBox:o,getScreenCTM:l,getOwner:a,applyTransform:u,initTransform:c};return i;function a(){return n}function o(){var d=e.getBBox();return{left:d.x,top:d.y,width:d.width,height:d.height}}function l(){var d=n.getCTM();return d||n.getScreenCTM()}function c(d){var f=e.getCTM();f===null&&(f=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),d.x=f.e,d.y=f.f,d.scale=f.a,n.removeAttributeNS(null,"viewBox")}function u(d){e.setAttribute("transform","matrix("+d.scale+" 0 0 "+d.scale+" "+d.x+" "+d.y+")")}}function t(e){return e&&e.ownerSVGElement&&e.getCTM}return $d.exports}var jd={exports:{}},G0;function FT(){if(G0)return jd.exports;G0=1,jd.exports=r,jd.exports.canAttach=t;function r(e,s){var n=t(e);if(!n)throw new Error("panzoom requires DOM element to be attached to the DOM tree");var i=e.parentElement;e.scrollTop=0,s.disableKeyboardInteraction||i.setAttribute("tabindex",0);var a={getBBox:l,getOwner:o,applyTransform:c};return a;function o(){return i}function l(){return{left:0,top:0,width:e.clientWidth,height:e.clientHeight}}function c(u){e.style.transformOrigin="0 0 0",e.style.transform="matrix("+u.scale+", 0, 0, "+u.scale+", "+u.x+", "+u.y+")"}}function t(e){return e&&e.parentElement&&e.style}return jd.exports}var X0=uT,mm=CT,BT=ET,VT=RT,l_=kT,$T=l_(),jT=l_(!0),UT=NT(),Y0=LT(),K0=FT(),WT=1,HT=1.75,q0=300,Z0=200,zT=c_,Q0=0,J0=0;function c_(r,t){Q0=r.offsetWidth,J0=r.offsetHeight,t=t||{};var e=t.controller;if(e||(Y0.canAttach(r)?e=Y0(r,t):K0.canAttach(r)&&(e=K0(r,t))),!e)throw new Error("Cannot create panzoom for the current type of dom element");var s=e.getOwner(),n={x:0,y:0},i=!1,a=new UT;e.initTransform&&e.initTransform(a);var o=typeof t.filterKey=="function"?t.filterKey:Mo,l=typeof t.pinchSpeed=="number"?t.pinchSpeed:1,c=t.bounds,u=typeof t.maxZoom=="number"?t.maxZoom:Number.POSITIVE_INFINITY,d=typeof t.minZoom=="number"?t.minZoom:0,f=typeof t.boundsPadding=="number"?t.boundsPadding:.05,p=typeof t.zoomDoubleClickSpeed=="number"?t.zoomDoubleClickSpeed:HT,g=t.beforeWheel||Mo,m=t.beforeMouseDown||Mo,v=typeof t.zoomSpeed=="number"?t.zoomSpeed:WT,y=tb(t.transformOrigin),S=t.enableTextSelection?jT:$T;GT(c),t.autocenter&&Pt();var T,E=0,A=0,C=0,x=null,I=new Date,R,O=!1,P=!0,M=!0,B=!1,F,W,j,D,$,H;"smoothScroll"in t&&!t.smoothScroll?H=XT():H=VT(uo,SS,t.smoothScroll);var Y,K,nt,ut=!1;d0();var Rt={dispose:TS,moveBy:fo,moveTo:cm,smoothMoveTo:wS,centerOn:AS,zoomTo:Ld,zoomAbs:kd,smoothZoom:Nd,smoothZoomAbs:OS,showRectangle:G,pause:pt,resume:rt,isPaused:ye,getTransform:Ot,getMinZoom:mt,setMinZoom:Ht,getMaxZoom:Oe,setMaxZoom:tt,setVerticalPan:Dt,setHorizontalPan:Ct,getInitWidth:ct,getInitHeight:N,getTransformOrigin:L,setTransformOrigin:yt,getZoomSpeed:Q,setZoomSpeed:Ws};BT(Rt);var ht=typeof t.initialX=="number"?t.initialX:a.x,U=typeof t.initialY=="number"?t.initialY:a.y,V=typeof t.initialZoom=="number"?t.initialZoom:a.scale;return(ht!=a.x||U!=a.y||V!=a.scale)&&kd(ht,U,V),Rt;function N(){return J0}function ct(){return Q0}function pt(){f0(),ut=!0}function rt(){ut&&(d0(),ut=!1)}function Ct(k){P=k}function Dt(k){M=k}function ye(){return ut}function G(k){var z=s.getBoundingClientRect(),X=q(z.width,z.height),et=k.right-k.left,Et=k.bottom-k.top;if(!Number.isFinite(et)||!Number.isFinite(Et))throw new Error("Invalid rectangle");var Vt=X.x/et,$t=X.y/Et,Me=Math.min(Vt,$t);a.x=-(k.left+et/2)*Me+X.x/2,a.y=-(k.top+Et/2)*Me+X.y/2,a.scale=Me}function q(k,z){if(e.getScreenCTM){var X=e.getScreenCTM(),et=X.a,Et=X.d,Vt=X.e,$t=X.f;n.x=k*et-Vt,n.y=z*Et-$t}else n.x=k,n.y=z;return n}function Pt(){var k,z,X=0,et=0,Et=h0();if(Et)X=Et.left,et=Et.top,k=Et.right-Et.left,z=Et.bottom-Et.top;else{var Vt=s.getBoundingClientRect();k=Vt.width,z=Vt.height}var $t=e.getBBox();if(!($t.width===0||$t.height===0)){var Me=z/$t.height,go=k/$t.width,Or=Math.min(go,Me);a.x=-($t.left+$t.width/2)*Or+k/2+X,a.y=-($t.top+$t.height/2)*Or+z/2+et,a.scale=Or}}function Ot(){return a}function mt(){return d}function Ht(k){d=k}function Oe(){return u}function tt(k){u=k}function L(){return y}function yt(k){y=tb(k)}function Q(){return v}function Ws(k){if(!Number.isFinite(k))throw new Error("Zoom speed should be a number");v=k}function uo(){return{x:a.x,y:a.y}}function cm(k,z){a.x=k,a.y=z,hm(),po("pan"),um()}function c0(k,z){cm(P?a.x+k:a.x,M?a.y+z:a.y)}function hm(){var k=h0();if(k){var z=!1,X=bS(),et=k.left-X.right;return et>0&&(a.x+=et,z=!0),et=k.right-X.left,et<0&&(a.x+=et,z=!0),M&&(et=k.top-X.bottom,et>0&&(a.y+=et,z=!0),et=k.bottom-X.top,et<0&&(a.y+=et,z=!0)),z}}function h0(){if(c){if(typeof c=="boolean"){var k=s.getBoundingClientRect(),z=k.width,X=k.height;return{left:z*f,top:X*f,right:z*(1-f),bottom:X*(1-f)}}return c}}function bS(){var k=e.getBBox(),z=_S(k.left,k.top);return{left:z.x,top:z.y,right:k.width*a.scale+z.x,bottom:k.height*a.scale+z.y}}function _S(k,z){return{x:k*a.scale+a.x,y:z*a.scale+a.y}}function um(){i=!0,T=window.requestAnimationFrame(CS)}function u0(k,z,X){if(vm(k)||vm(z)||vm(X))throw new Error("zoom requires valid numbers");var et=a.scale*X;if(et<d){if(a.scale===d)return;X=d/a.scale}if(et>u){if(a.scale===u)return;X=u/a.scale}var Et=q(k,z);if(a.x=Et.x-X*(Et.x-a.x),a.y=Et.y-X*(Et.y-a.y),c&&f===1&&d===1)a.scale*=X,hm();else{var Vt=hm();Vt||(a.scale*=X)}po("zoom"),um()}function kd(k,z,X){var et=X/a.scale;u0(k,z,et)}function AS(k){var z=k.ownerSVGElement;if(!z)throw new Error("ui element is required to be within the scene");var X=k.getBoundingClientRect(),et=X.left+X.width/2,Et=X.top+X.height/2,Vt=z.getBoundingClientRect(),$t=Vt.width/2-et,Me=Vt.height/2-Et;fo($t,Me,!0)}function wS(k,z){fo(k-a.x,z-a.y,!0)}function fo(k,z,X){if(!X)return c0(k,z);Y&&Y.cancel();var et={x:0,y:0},Et={x:k,y:z},Vt=0,$t=0;Y=mm(et,Et,{step:function(Me){c0(Me.x-Vt,Me.y-$t),Vt=Me.x,$t=Me.y}})}function SS(k,z){Fd(),cm(k,z)}function TS(){f0()}function d0(){s.addEventListener("mousedown",A0,{passive:!1}),s.addEventListener("dblclick",_0,{passive:!1}),s.addEventListener("touchstart",g0,{passive:!1}),s.addEventListener("keydown",p0,{passive:!1}),X0.addWheelListener(s,E0,{passive:!1}),um()}function f0(){X0.removeWheelListener(s,E0),s.removeEventListener("mousedown",A0),s.removeEventListener("keydown",p0),s.removeEventListener("dblclick",_0),s.removeEventListener("touchstart",g0),T&&(window.cancelAnimationFrame(T),T=0),H.cancel(),T0(),C0(),S.release(),dm()}function CS(){i&&ES()}function ES(){i=!1,e.applyTransform(a),po("transform"),T=0}function p0(k){var z=0,X=0,et=0;if(k.keyCode===38?X=1:k.keyCode===40?X=-1:k.keyCode===37?z=1:k.keyCode===39?z=-1:k.keyCode===189||k.keyCode===109?et=1:(k.keyCode===187||k.keyCode===107)&&(et=-1),!o(k,z,X,et)){if(z||X){k.preventDefault(),k.stopPropagation();var Et=s.getBoundingClientRect(),Vt=Math.min(Et.width,Et.height),$t=.05,Me=Vt*$t*z,go=Vt*$t*X;fo(Me,go)}if(et){var Or=x0(et*100),Vt=y?Cc():xS();Ld(Vt.x,Vt.y,Or)}}}function xS(){var k=s.getBoundingClientRect();return{x:k.width/2,y:k.height/2}}function g0(k){if(IS(k),Tc(),k.touches.length===1)return PS(k,k.touches[0]);k.touches.length===2&&($=b0(k.touches[0],k.touches[1]),nt=!0,m0())}function IS(k){t.onTouch&&!t.onTouch(k)||(k.stopPropagation(),k.preventDefault())}function RS(k){Tc(),!(t.onDoubleClick&&!t.onDoubleClick(k))&&(k.preventDefault(),k.stopPropagation())}function PS(k){A=new Date;var z=k.touches[0],X=Yn(z);R=X;var et=q(X.x,X.y);F=et.x,W=et.y,j=F,D=W,H.cancel(),m0()}function m0(){O||(O=!0,document.addEventListener("touchmove",v0),document.addEventListener("touchend",Dd),document.addEventListener("touchcancel",Dd))}function v0(k){if(k.touches.length===1){k.stopPropagation();var z=k.touches[0],X=Yn(z),et=q(X.x,X.y),Et=et.x-F,Vt=et.y-W;Et!==0&&Vt!==0&&I0(),F=et.x,W=et.y,fo(Et,Vt)}else if(k.touches.length===2){nt=!0;var $t=k.touches[0],Me=k.touches[1],go=b0($t,Me),Or=1+(go/$-1)*l,R0=Yn($t),P0=Yn(Me);if(F=(R0.x+P0.x)/2,W=(R0.y+P0.y)/2,y){var X=Cc();F=X.x,W=X.y}Ld(F,W,Or),$=go,k.stopPropagation(),k.preventDefault()}}function Tc(){C&&(clearTimeout(C),C=0)}function y0(k){if(t.onClick){Tc();var z=F-j,X=W-D,et=Math.sqrt(z*z+X*X);et>5||(C=setTimeout(function(){C=0,t.onClick(k)},q0))}}function Dd(k){if(Tc(),k.touches.length>0){var z=Yn(k.touches[0]),X=q(z.x,z.y);F=X.x,W=X.y}else{var et=new Date;if(et-E<q0)if(y){var z=Cc();Nd(z.x,z.y,p)}else Nd(R.x,R.y,p);else et-A<Z0&&y0(k);E=et,dm(),C0()}}function b0(k,z){var X=k.clientX-z.clientX,et=k.clientY-z.clientY;return Math.sqrt(X*X+et*et)}function _0(k){RS(k);var z=Yn(k);y&&(z=Cc()),Nd(z.x,z.y,p)}function A0(k){if(Tc(),!m(k)){if(x=k,I=new Date,O)return k.stopPropagation(),!1;var z=k.button===1&&window.event!==null||k.button===0;if(z){H.cancel();var X=Yn(k),et=q(X.x,X.y);return j=F=et.x,D=W=et.y,document.addEventListener("mousemove",w0),document.addEventListener("mouseup",S0),S.capture(k.target||k.srcElement),!1}}}function w0(k){if(!O){I0();var z=Yn(k),X=q(z.x,z.y),et=X.x-F,Et=X.y-W;F=X.x,W=X.y,fo(et,Et)}}function S0(){var k=new Date;k-I<Z0&&y0(x),S.release(),dm(),T0()}function T0(){document.removeEventListener("mousemove",w0),document.removeEventListener("mouseup",S0),B=!1}function C0(){document.removeEventListener("touchmove",v0),document.removeEventListener("touchend",Dd),document.removeEventListener("touchcancel",Dd),B=!1,nt=!1,O=!1}function E0(k){if(!g(k)){H.cancel();var z=k.deltaY;k.deltaMode>0&&(z*=100);var X=x0(z);if(X!==1){var et=y?Cc():Yn(k);Ld(et.x,et.y,X),k.preventDefault()}}}function Yn(k){var z,X,et=s.getBoundingClientRect();return z=k.clientX-et.left,X=k.clientY-et.top,{x:z,y:X}}function Nd(k,z,X){var et=a.scale,Et={scale:et},Vt={scale:X*et};H.cancel(),Fd(),K=mm(Et,Vt,{step:function($t){kd(k,z,$t.scale)},done:MS})}function OS(k,z,X){var et=a.scale,Et={scale:et},Vt={scale:X};H.cancel(),Fd(),K=mm(Et,Vt,{step:function($t){kd(k,z,$t.scale)}})}function Cc(){var k=s.getBoundingClientRect();return{x:k.width*y.x,y:k.height*y.y}}function Ld(k,z,X){return H.cancel(),Fd(),u0(k,z,X)}function Fd(){K&&(K.cancel(),K=null)}function x0(k){var z=Math.sign(k),X=Math.min(.25,Math.abs(v*k/128));return 1-z*X}function I0(){B||(po("panstart"),B=!0,H.start())}function dm(){B&&(nt||H.stop(),po("panend"))}function MS(){po("zoomend")}function po(k){Rt.fire(k,Rt)}}function tb(r){if(r){if(typeof r=="object")return(!Eo(r.x)||!Eo(r.y))&&eb(r),r;eb()}}function eb(r){throw console.error(r),new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function Mo(){}function GT(r){var t=typeof r;if(!(t==="undefined"||t==="boolean")){var e=Eo(r.left)&&Eo(r.top)&&Eo(r.bottom)&&Eo(r.right);if(!e)throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}}function Eo(r){return Number.isFinite(r)}function vm(r){return Number.isNaN?Number.isNaN(r):r!==r}function XT(){return{start:Mo,stop:Mo,cancel:Mo}}function YT(){if(typeof document>"u")return;var r=document.getElementsByTagName("script");if(!r)return;for(var t,e=0;e<r.length;++e){var s=r[e];if(s.src&&s.src.match(/\bpanzoom(\.min)?\.js/)){t=s;break}}if(!t)return;var n=t.getAttribute("query");if(!n)return;var i=t.getAttribute("name")||"pz",a=Date.now();o();function o(){var u=document.querySelector(n);if(!u){var d=Date.now(),f=d-a;if(f<2e3){setTimeout(o,100);return}console.error("Cannot find the panzoom element",i);return}var p=l(t);console.log(p),window[i]=c_(u,p)}function l(u){for(var d=u.attributes,f={},p=0;p<d.length;++p){var g=d[p],m=c(g);m&&(f[m.name]=m.value)}return f}function c(u){if(u.name){var d=u.name[0]==="p"&&u.name[1]==="z"&&u.name[2]==="-";if(d){var f=u.name.substr(3),p=JSON.parse(u.value);return{name:f,value:p}}}}}YT();const KT=$S(zT);var qT={9306:(r,t,e)=>{var s=e(4901),n=e(6823),i=TypeError;r.exports=function(a){if(s(a))return a;throw new i(n(a)+" is not a function")}},3506:(r,t,e)=>{var s=e(3925),n=String,i=TypeError;r.exports=function(a){if(s(a))return a;throw new i("Can't set "+n(a)+" as a prototype")}},7080:(r,t,e)=>{var s=e(4402).has;r.exports=function(n){return s(n),n}},679:(r,t,e)=>{var s=e(1625),n=TypeError;r.exports=function(i,a){if(s(a,i))return i;throw new n("Incorrect invocation")}},8551:(r,t,e)=>{var s=e(34),n=String,i=TypeError;r.exports=function(a){if(s(a))return a;throw new i(n(a)+" is not an object")}},7811:r=>{r.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7394:(r,t,e)=>{var s=e(4576),n=e(6706),i=e(2195),a=s.ArrayBuffer,o=s.TypeError;r.exports=a&&n(a.prototype,"byteLength","get")||function(l){if(i(l)!=="ArrayBuffer")throw new o("ArrayBuffer expected");return l.byteLength}},3238:(r,t,e)=>{var s=e(4576),n=e(7476),i=e(7394),a=s.ArrayBuffer,o=a&&a.prototype,l=o&&n(o.slice);r.exports=function(c){if(i(c)!==0||!l)return!1;try{return l(c,0,0),!1}catch{return!0}}},5169:(r,t,e)=>{var s=e(3238),n=TypeError;r.exports=function(i){if(s(i))throw new n("ArrayBuffer is detached");return i}},5636:(r,t,e)=>{var s=e(4576),n=e(9504),i=e(6706),a=e(7696),o=e(5169),l=e(7394),c=e(4483),u=e(1548),d=s.structuredClone,f=s.ArrayBuffer,p=s.DataView,g=Math.min,m=f.prototype,v=p.prototype,y=n(m.slice),S=i(m,"resizable","get"),T=i(m,"maxByteLength","get"),E=n(v.getInt8),A=n(v.setInt8);r.exports=(u||c)&&function(C,x,I){var R=l(C),O=x===void 0?R:a(x),P=!S||!S(C),M;if(o(C),u&&(C=d(C,{transfer:[C]}),R===O&&(I||P)))return C;if(R>=O&&(!I||P))M=y(C,0,O);else{var B=I&&!P&&T?{maxByteLength:T(C)}:void 0;M=new f(O,B);for(var F=new p(C),W=new p(M),j=g(O,R),D=0;D<j;D++)A(W,D,E(F,D))}return u||c(C),M}},4644:(r,t,e)=>{var s=e(7811),n=e(3724),i=e(4576),a=e(4901),o=e(34),l=e(9297),c=e(6955),u=e(6823),d=e(6699),f=e(6840),p=e(2106),g=e(1625),m=e(2787),v=e(2967),y=e(8227),S=e(3392),T=e(1181),E=T.enforce,A=T.get,C=i.Int8Array,x=C&&C.prototype,I=i.Uint8ClampedArray,R=I&&I.prototype,O=C&&m(C),P=x&&m(x),M=Object.prototype,B=i.TypeError,F=y("toStringTag"),W=S("TYPED_ARRAY_TAG"),j="TypedArrayConstructor",D=s&&!!v&&c(i.opera)!=="Opera",$=!1,H,Y,K,nt={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ut={BigInt64Array:8,BigUint64Array:8},Rt=function(Ct){if(!o(Ct))return!1;var Dt=c(Ct);return Dt==="DataView"||l(nt,Dt)||l(ut,Dt)},ht=function(rt){var Ct=m(rt);if(o(Ct)){var Dt=A(Ct);return Dt&&l(Dt,j)?Dt[j]:ht(Ct)}},U=function(rt){if(!o(rt))return!1;var Ct=c(rt);return l(nt,Ct)||l(ut,Ct)},V=function(rt){if(U(rt))return rt;throw new B("Target is not a typed array")},N=function(rt){if(a(rt)&&(!v||g(O,rt)))return rt;throw new B(u(rt)+" is not a typed array constructor")},ct=function(rt,Ct,Dt,ye){if(n){if(Dt)for(var G in nt){var q=i[G];if(q&&l(q.prototype,rt))try{delete q.prototype[rt]}catch{try{q.prototype[rt]=Ct}catch{}}}(!P[rt]||Dt)&&f(P,rt,Dt?Ct:D&&x[rt]||Ct,ye)}},pt=function(rt,Ct,Dt){var ye,G;if(n){if(v){if(Dt){for(ye in nt)if(G=i[ye],G&&l(G,rt))try{delete G[rt]}catch{}}if(!O[rt]||Dt)try{return f(O,rt,Dt?Ct:D&&O[rt]||Ct)}catch{}else return}for(ye in nt)G=i[ye],G&&(!G[rt]||Dt)&&f(G,rt,Ct)}};for(H in nt)Y=i[H],K=Y&&Y.prototype,K?E(K)[j]=Y:D=!1;for(H in ut)Y=i[H],K=Y&&Y.prototype,K&&(E(K)[j]=Y);if((!D||!a(O)||O===Function.prototype)&&(O=function(){throw new B("Incorrect invocation")},D))for(H in nt)i[H]&&v(i[H],O);if((!D||!P||P===M)&&(P=O.prototype,D))for(H in nt)i[H]&&v(i[H].prototype,P);if(D&&m(R)!==P&&v(R,P),n&&!l(P,F)){$=!0,p(P,F,{configurable:!0,get:function(){return o(this)?this[W]:void 0}});for(H in nt)i[H]&&d(i[H],W,H)}r.exports={NATIVE_ARRAY_BUFFER_VIEWS:D,TYPED_ARRAY_TAG:$&&W,aTypedArray:V,aTypedArrayConstructor:N,exportTypedArrayMethod:ct,exportTypedArrayStaticMethod:pt,getTypedArrayConstructor:ht,isView:Rt,isTypedArray:U,TypedArray:O,TypedArrayPrototype:P}},5370:(r,t,e)=>{var s=e(6198);r.exports=function(n,i,a){for(var o=0,l=arguments.length>2?a:s(i),c=new n(l);l>o;)c[o]=i[o++];return c}},9617:(r,t,e)=>{var s=e(5397),n=e(5610),i=e(6198),a=function(o){return function(l,c,u){var d=s(l),f=i(d);if(f===0)return!o&&-1;var p=n(u,f),g;if(o&&c!==c){for(;f>p;)if(g=d[p++],g!==g)return!0}else for(;f>p;p++)if((o||p in d)&&d[p]===c)return o||p||0;return!o&&-1}};r.exports={includes:a(!0),indexOf:a(!1)}},4527:(r,t,e)=>{var s=e(3724),n=e(4376),i=TypeError,a=Object.getOwnPropertyDescriptor,o=s&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(l){return l instanceof TypeError}}();r.exports=o?function(l,c){if(n(l)&&!a(l,"length").writable)throw new i("Cannot set read only .length");return l.length=c}:function(l,c){return l.length=c}},7680:(r,t,e)=>{var s=e(9504);r.exports=s([].slice)},7628:(r,t,e)=>{var s=e(6198);r.exports=function(n,i){for(var a=s(n),o=new i(a),l=0;l<a;l++)o[l]=n[a-l-1];return o}},9928:(r,t,e)=>{var s=e(6198),n=e(1291),i=RangeError;r.exports=function(a,o,l,c){var u=s(a),d=n(l),f=d<0?u+d:d;if(f>=u||f<0)throw new i("Incorrect index");for(var p=new o(u),g=0;g<u;g++)p[g]=g===f?c:a[g];return p}},6319:(r,t,e)=>{var s=e(8551),n=e(9539);r.exports=function(i,a,o,l){try{return l?a(s(o)[0],o[1]):a(o)}catch(c){n(i,"throw",c)}}},2195:(r,t,e)=>{var s=e(9504),n=s({}.toString),i=s("".slice);r.exports=function(a){return i(n(a),8,-1)}},6955:(r,t,e)=>{var s=e(2140),n=e(4901),i=e(2195),a=e(8227),o=a("toStringTag"),l=Object,c=i(function(){return arguments}())==="Arguments",u=function(d,f){try{return d[f]}catch{}};r.exports=s?i:function(d){var f,p,g;return d===void 0?"Undefined":d===null?"Null":typeof(p=u(f=l(d),o))=="string"?p:c?i(f):(g=i(f))==="Object"&&n(f.callee)?"Arguments":g}},7740:(r,t,e)=>{var s=e(9297),n=e(5031),i=e(7347),a=e(4913);r.exports=function(o,l,c){for(var u=n(l),d=a.f,f=i.f,p=0;p<u.length;p++){var g=u[p];!s(o,g)&&!(c&&s(c,g))&&d(o,g,f(l,g))}}},2211:(r,t,e)=>{var s=e(9039);r.exports=!s(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype})},2529:r=>{r.exports=function(t,e){return{value:t,done:e}}},6699:(r,t,e)=>{var s=e(3724),n=e(4913),i=e(6980);r.exports=s?function(a,o,l){return n.f(a,o,i(1,l))}:function(a,o,l){return a[o]=l,a}},6980:r=>{r.exports=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}}},4659:(r,t,e)=>{var s=e(3724),n=e(4913),i=e(6980);r.exports=function(a,o,l){s?n.f(a,o,i(0,l)):a[o]=l}},2106:(r,t,e)=>{var s=e(283),n=e(4913);r.exports=function(i,a,o){return o.get&&s(o.get,a,{getter:!0}),o.set&&s(o.set,a,{setter:!0}),n.f(i,a,o)}},6840:(r,t,e)=>{var s=e(4901),n=e(4913),i=e(283),a=e(9433);r.exports=function(o,l,c,u){u||(u={});var d=u.enumerable,f=u.name!==void 0?u.name:l;if(s(c)&&i(c,f,u),u.global)d?o[l]=c:a(l,c);else{try{u.unsafe?o[l]&&(d=!0):delete o[l]}catch{}d?o[l]=c:n.f(o,l,{value:c,enumerable:!1,configurable:!u.nonConfigurable,writable:!u.nonWritable})}return o}},6279:(r,t,e)=>{var s=e(6840);r.exports=function(n,i,a){for(var o in i)s(n,o,i[o],a);return n}},9433:(r,t,e)=>{var s=e(4576),n=Object.defineProperty;r.exports=function(i,a){try{n(s,i,{value:a,configurable:!0,writable:!0})}catch{s[i]=a}return a}},3724:(r,t,e)=>{var s=e(9039);r.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},4483:(r,t,e)=>{var s=e(4576),n=e(9429),i=e(1548),a=s.structuredClone,o=s.ArrayBuffer,l=s.MessageChannel,c=!1,u,d,f,p;if(i)c=function(g){a(g,{transfer:[g]})};else if(o)try{l||(u=n("worker_threads"),u&&(l=u.MessageChannel)),l&&(d=new l,f=new o(2),p=function(g){d.port1.postMessage(null,[g])},f.byteLength===2&&(p(f),f.byteLength===0&&(c=p)))}catch{}r.exports=c},4055:(r,t,e)=>{var s=e(4576),n=e(34),i=s.document,a=n(i)&&n(i.createElement);r.exports=function(o){return a?i.createElement(o):{}}},6837:r=>{var t=TypeError,e=9007199254740991;r.exports=function(s){if(s>e)throw t("Maximum allowed index exceeded");return s}},5002:r=>{r.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8727:r=>{r.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6193:(r,t,e)=>{var s=e(4215);r.exports=s==="NODE"},2839:(r,t,e)=>{var s=e(4576),n=s.navigator,i=n&&n.userAgent;r.exports=i?String(i):""},9519:(r,t,e)=>{var s=e(4576),n=e(2839),i=s.process,a=s.Deno,o=i&&i.versions||a&&a.version,l=o&&o.v8,c,u;l&&(c=l.split("."),u=c[0]>0&&c[0]<4?1:+(c[0]+c[1])),!u&&n&&(c=n.match(/Edge\/(\d+)/),(!c||c[1]>=74)&&(c=n.match(/Chrome\/(\d+)/),c&&(u=+c[1]))),r.exports=u},4215:(r,t,e)=>{var s=e(4576),n=e(2839),i=e(2195),a=function(o){return n.slice(0,o.length)===o};r.exports=function(){return a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":s.Bun&&typeof Bun.version=="string"?"BUN":s.Deno&&typeof Deno.version=="object"?"DENO":i(s.process)==="process"?"NODE":s.window&&s.document?"BROWSER":"REST"}()},8574:(r,t,e)=>{var s=e(9504),n=Error,i=s("".replace),a=function(c){return String(new n(c).stack)}("zxcasd"),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(a);r.exports=function(c,u){if(l&&typeof c=="string"&&!n.prepareStackTrace)for(;u--;)c=i(c,o,"");return c}},6518:(r,t,e)=>{var s=e(4576),n=e(7347).f,i=e(6699),a=e(6840),o=e(9433),l=e(7740),c=e(2796);r.exports=function(u,d){var f=u.target,p=u.global,g=u.stat,m,v,y,S,T,E;if(p?v=s:g?v=s[f]||o(f,{}):v=s[f]&&s[f].prototype,v)for(y in d){if(T=d[y],u.dontCallGetSet?(E=n(v,y),S=E&&E.value):S=v[y],m=c(p?y:f+(g?".":"#")+y,u.forced),!m&&S!==void 0){if(typeof T==typeof S)continue;l(T,S)}(u.sham||S&&S.sham)&&i(T,"sham",!0),a(v,y,T,u)}}},9039:r=>{r.exports=function(t){try{return!!t()}catch{return!0}}},8745:(r,t,e)=>{var s=e(616),n=Function.prototype,i=n.apply,a=n.call;r.exports=typeof Reflect=="object"&&Reflect.apply||(s?a.bind(i):function(){return a.apply(i,arguments)})},6080:(r,t,e)=>{var s=e(7476),n=e(9306),i=e(616),a=s(s.bind);r.exports=function(o,l){return n(o),l===void 0?o:i?a(o,l):function(){return o.apply(l,arguments)}}},616:(r,t,e)=>{var s=e(9039);r.exports=!s(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")})},9565:(r,t,e)=>{var s=e(616),n=Function.prototype.call;r.exports=s?n.bind(n):function(){return n.apply(n,arguments)}},350:(r,t,e)=>{var s=e(3724),n=e(9297),i=Function.prototype,a=s&&Object.getOwnPropertyDescriptor,o=n(i,"name"),l=o&&(function(){}).name==="something",c=o&&(!s||s&&a(i,"name").configurable);r.exports={EXISTS:o,PROPER:l,CONFIGURABLE:c}},6706:(r,t,e)=>{var s=e(9504),n=e(9306);r.exports=function(i,a,o){try{return s(n(Object.getOwnPropertyDescriptor(i,a)[o]))}catch{}}},7476:(r,t,e)=>{var s=e(2195),n=e(9504);r.exports=function(i){if(s(i)==="Function")return n(i)}},9504:(r,t,e)=>{var s=e(616),n=Function.prototype,i=n.call,a=s&&n.bind.bind(i,i);r.exports=s?a:function(o){return function(){return i.apply(o,arguments)}}},9429:(r,t,e)=>{var s=e(4576),n=e(6193);r.exports=function(i){if(n){try{return s.process.getBuiltinModule(i)}catch{}try{return Function('return require("'+i+'")')()}catch{}}}},7751:(r,t,e)=>{var s=e(4576),n=e(4901),i=function(a){return n(a)?a:void 0};r.exports=function(a,o){return arguments.length<2?i(s[a]):s[a]&&s[a][o]}},1767:r=>{r.exports=function(t){return{iterator:t,next:t.next,done:!1}}},8646:(r,t,e)=>{var s=e(9565),n=e(8551),i=e(1767),a=e(851);r.exports=function(o,l){(!l||typeof o!="string")&&n(o);var c=a(o);return i(n(c!==void 0?s(c,o):o))}},851:(r,t,e)=>{var s=e(6955),n=e(5966),i=e(4117),a=e(6269),o=e(8227),l=o("iterator");r.exports=function(c){if(!i(c))return n(c,l)||n(c,"@@iterator")||a[s(c)]}},81:(r,t,e)=>{var s=e(9565),n=e(9306),i=e(8551),a=e(6823),o=e(851),l=TypeError;r.exports=function(c,u){var d=arguments.length<2?o(c):u;if(n(d))return i(s(d,c));throw new l(a(c)+" is not iterable")}},5966:(r,t,e)=>{var s=e(9306),n=e(4117);r.exports=function(i,a){var o=i[a];return n(o)?void 0:s(o)}},3789:(r,t,e)=>{var s=e(9306),n=e(8551),i=e(9565),a=e(1291),o=e(1767),l="Invalid size",c=RangeError,u=TypeError,d=Math.max,f=function(p,g){this.set=p,this.size=d(g,0),this.has=s(p.has),this.keys=s(p.keys)};f.prototype={getIterator:function(){return o(n(i(this.keys,this.set)))},includes:function(p){return i(this.has,this.set,p)}},r.exports=function(p){n(p);var g=+p.size;if(g!==g)throw new u(l);var m=a(g);if(m<0)throw new c(l);return new f(p,m)}},4576:function(r){var t=function(e){return e&&e.Math===Math&&e};r.exports=t(typeof globalThis=="object"&&globalThis)||t(typeof window=="object"&&window)||t(typeof self=="object"&&self)||t(typeof global=="object"&&global)||t(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},9297:(r,t,e)=>{var s=e(9504),n=e(8981),i=s({}.hasOwnProperty);r.exports=Object.hasOwn||function(o,l){return i(n(o),l)}},421:r=>{r.exports={}},397:(r,t,e)=>{var s=e(7751);r.exports=s("document","documentElement")},5917:(r,t,e)=>{var s=e(3724),n=e(9039),i=e(4055);r.exports=!s&&!n(function(){return Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a!==7})},7055:(r,t,e)=>{var s=e(9504),n=e(9039),i=e(2195),a=Object,o=s("".split);r.exports=n(function(){return!a("z").propertyIsEnumerable(0)})?function(l){return i(l)==="String"?o(l,""):a(l)}:a},3167:(r,t,e)=>{var s=e(4901),n=e(34),i=e(2967);r.exports=function(a,o,l){var c,u;return i&&s(c=o.constructor)&&c!==l&&n(u=c.prototype)&&u!==l.prototype&&i(a,u),a}},3706:(r,t,e)=>{var s=e(9504),n=e(4901),i=e(7629),a=s(Function.toString);n(i.inspectSource)||(i.inspectSource=function(o){return a(o)}),r.exports=i.inspectSource},1181:(r,t,e)=>{var s=e(8622),n=e(4576),i=e(34),a=e(6699),o=e(9297),l=e(7629),c=e(6119),u=e(421),d="Object already initialized",f=n.TypeError,p=n.WeakMap,g,m,v,y=function(A){return v(A)?m(A):g(A,{})},S=function(A){return function(C){var x;if(!i(C)||(x=m(C)).type!==A)throw new f("Incompatible receiver, "+A+" required");return x}};if(s||l.state){var T=l.state||(l.state=new p);T.get=T.get,T.has=T.has,T.set=T.set,g=function(A,C){if(T.has(A))throw new f(d);return C.facade=A,T.set(A,C),C},m=function(A){return T.get(A)||{}},v=function(A){return T.has(A)}}else{var E=c("state");u[E]=!0,g=function(A,C){if(o(A,E))throw new f(d);return C.facade=A,a(A,E,C),C},m=function(A){return o(A,E)?A[E]:{}},v=function(A){return o(A,E)}}r.exports={set:g,get:m,has:v,enforce:y,getterFor:S}},4209:(r,t,e)=>{var s=e(8227),n=e(6269),i=s("iterator"),a=Array.prototype;r.exports=function(o){return o!==void 0&&(n.Array===o||a[i]===o)}},4376:(r,t,e)=>{var s=e(2195);r.exports=Array.isArray||function(i){return s(i)==="Array"}},1108:(r,t,e)=>{var s=e(6955);r.exports=function(n){var i=s(n);return i==="BigInt64Array"||i==="BigUint64Array"}},4901:r=>{var t=typeof document=="object"&&document.all;r.exports=typeof t>"u"&&t!==void 0?function(e){return typeof e=="function"||e===t}:function(e){return typeof e=="function"}},2796:(r,t,e)=>{var s=e(9039),n=e(4901),i=/#|\.prototype\./,a=function(d,f){var p=l[o(d)];return p===u?!0:p===c?!1:n(f)?s(f):!!f},o=a.normalize=function(d){return String(d).replace(i,".").toLowerCase()},l=a.data={},c=a.NATIVE="N",u=a.POLYFILL="P";r.exports=a},4117:r=>{r.exports=function(t){return t==null}},34:(r,t,e)=>{var s=e(4901);r.exports=function(n){return typeof n=="object"?n!==null:s(n)}},3925:(r,t,e)=>{var s=e(34);r.exports=function(n){return s(n)||n===null}},6395:r=>{r.exports=!1},757:(r,t,e)=>{var s=e(7751),n=e(4901),i=e(1625),a=e(7040),o=Object;r.exports=a?function(l){return typeof l=="symbol"}:function(l){var c=s("Symbol");return n(c)&&i(c.prototype,o(l))}},507:(r,t,e)=>{var s=e(9565);r.exports=function(n,i,a){for(var o=a?n:n.iterator,l=n.next,c,u;!(c=s(l,o)).done;)if(u=i(c.value),u!==void 0)return u}},2652:(r,t,e)=>{var s=e(6080),n=e(9565),i=e(8551),a=e(6823),o=e(4209),l=e(6198),c=e(1625),u=e(81),d=e(851),f=e(9539),p=TypeError,g=function(v,y){this.stopped=v,this.result=y},m=g.prototype;r.exports=function(v,y,S){var T=S&&S.that,E=!!(S&&S.AS_ENTRIES),A=!!(S&&S.IS_RECORD),C=!!(S&&S.IS_ITERATOR),x=!!(S&&S.INTERRUPTED),I=s(y,T),R,O,P,M,B,F,W,j=function($){return R&&f(R,"normal",$),new g(!0,$)},D=function($){return E?(i($),x?I($[0],$[1],j):I($[0],$[1])):x?I($,j):I($)};if(A)R=v.iterator;else if(C)R=v;else{if(O=d(v),!O)throw new p(a(v)+" is not iterable");if(o(O)){for(P=0,M=l(v);M>P;P++)if(B=D(v[P]),B&&c(m,B))return B;return new g(!1)}R=u(v,O)}for(F=A?v.next:R.next;!(W=n(F,R)).done;){try{B=D(W.value)}catch($){f(R,"throw",$)}if(typeof B=="object"&&B&&c(m,B))return B}return new g(!1)}},9539:(r,t,e)=>{var s=e(9565),n=e(8551),i=e(5966);r.exports=function(a,o,l){var c,u;n(a);try{if(c=i(a,"return"),!c){if(o==="throw")throw l;return l}c=s(c,a)}catch(d){u=!0,c=d}if(o==="throw")throw l;if(u)throw c;return n(c),l}},9462:(r,t,e)=>{var s=e(9565),n=e(2360),i=e(6699),a=e(6279),o=e(8227),l=e(1181),c=e(5966),u=e(7657).IteratorPrototype,d=e(2529),f=e(9539),p=o("toStringTag"),g="IteratorHelper",m="WrapForValidIterator",v=l.set,y=function(E){var A=l.getterFor(E?m:g);return a(n(u),{next:function(){var x=A(this);if(E)return x.nextHandler();try{var I=x.done?void 0:x.nextHandler();return d(I,x.done)}catch(R){throw x.done=!0,R}},return:function(){var C=A(this),x=C.iterator;if(C.done=!0,E){var I=c(x,"return");return I?s(I,x):d(void 0,!0)}if(C.inner)try{f(C.inner.iterator,"normal")}catch(R){return f(x,"throw",R)}return x&&f(x,"normal"),d(void 0,!0)}})},S=y(!0),T=y(!1);i(T,p,"Iterator Helper"),r.exports=function(E,A){var C=function(I,R){R?(R.iterator=I.iterator,R.next=I.next):R=I,R.type=A?m:g,R.nextHandler=E,R.counter=0,R.done=!1,v(this,R)};return C.prototype=A?S:T,C}},713:(r,t,e)=>{var s=e(9565),n=e(9306),i=e(8551),a=e(1767),o=e(9462),l=e(6319),c=o(function(){var u=this.iterator,d=i(s(this.next,u)),f=this.done=!!d.done;if(!f)return l(u,this.mapper,[d.value,this.counter++],!0)});r.exports=function(d){return i(this),n(d),new c(a(this),{mapper:d})}},7657:(r,t,e)=>{var s=e(9039),n=e(4901),i=e(34),a=e(2360),o=e(2787),l=e(6840),c=e(8227),u=e(6395),d=c("iterator"),f=!1,p,g,m;[].keys&&(m=[].keys(),"next"in m?(g=o(o(m)),g!==Object.prototype&&(p=g)):f=!0);var v=!i(p)||s(function(){var y={};return p[d].call(y)!==y});v?p={}:u&&(p=a(p)),n(p[d])||l(p,d,function(){return this}),r.exports={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:f}},6269:r=>{r.exports={}},6198:(r,t,e)=>{var s=e(8014);r.exports=function(n){return s(n.length)}},283:(r,t,e)=>{var s=e(9504),n=e(9039),i=e(4901),a=e(9297),o=e(3724),l=e(350).CONFIGURABLE,c=e(3706),u=e(1181),d=u.enforce,f=u.get,p=String,g=Object.defineProperty,m=s("".slice),v=s("".replace),y=s([].join),S=o&&!n(function(){return g(function(){},"length",{value:8}).length!==8}),T=String(String).split("String"),E=r.exports=function(A,C,x){m(p(C),0,7)==="Symbol("&&(C="["+v(p(C),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),x&&x.getter&&(C="get "+C),x&&x.setter&&(C="set "+C),(!a(A,"name")||l&&A.name!==C)&&(o?g(A,"name",{value:C,configurable:!0}):A.name=C),S&&x&&a(x,"arity")&&A.length!==x.arity&&g(A,"length",{value:x.arity});try{x&&a(x,"constructor")&&x.constructor?o&&g(A,"prototype",{writable:!1}):A.prototype&&(A.prototype=void 0)}catch{}var I=d(A);return a(I,"source")||(I.source=y(T,typeof C=="string"?C:"")),A};Function.prototype.toString=E(function(){return i(this)&&f(this).source||c(this)},"toString")},741:r=>{var t=Math.ceil,e=Math.floor;r.exports=Math.trunc||function(n){var i=+n;return(i>0?e:t)(i)}},6043:(r,t,e)=>{var s=e(9306),n=TypeError,i=function(a){var o,l;this.promise=new a(function(c,u){if(o!==void 0||l!==void 0)throw new n("Bad Promise constructor");o=c,l=u}),this.resolve=s(o),this.reject=s(l)};r.exports.f=function(a){return new i(a)}},2603:(r,t,e)=>{var s=e(655);r.exports=function(n,i){return n===void 0?arguments.length<2?"":i:s(n)}},4149:r=>{var t=RangeError;r.exports=function(e){if(e===e)return e;throw new t("NaN is not allowed")}},2360:(r,t,e)=>{var s=e(8551),n=e(6801),i=e(8727),a=e(421),o=e(397),l=e(4055),c=e(6119),u=">",d="<",f="prototype",p="script",g=c("IE_PROTO"),m=function(){},v=function(A){return d+p+u+A+d+"/"+p+u},y=function(A){A.write(v("")),A.close();var C=A.parentWindow.Object;return A=null,C},S=function(){var A=l("iframe"),C="java"+p+":",x;return A.style.display="none",o.appendChild(A),A.src=String(C),x=A.contentWindow.document,x.open(),x.write(v("document.F=Object")),x.close(),x.F},T,E=function(){try{T=new ActiveXObject("htmlfile")}catch{}E=typeof document<"u"?document.domain&&T?y(T):S():y(T);for(var A=i.length;A--;)delete E[f][i[A]];return E()};a[g]=!0,r.exports=Object.create||function(C,x){var I;return C!==null?(m[f]=s(C),I=new m,m[f]=null,I[g]=C):I=E(),x===void 0?I:n.f(I,x)}},6801:(r,t,e)=>{var s=e(3724),n=e(8686),i=e(4913),a=e(8551),o=e(5397),l=e(1072);t.f=s&&!n?Object.defineProperties:function(u,d){a(u);for(var f=o(d),p=l(d),g=p.length,m=0,v;g>m;)i.f(u,v=p[m++],f[v]);return u}},4913:(r,t,e)=>{var s=e(3724),n=e(5917),i=e(8686),a=e(8551),o=e(6969),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",f="configurable",p="writable";t.f=s?i?function(m,v,y){if(a(m),v=o(v),a(y),typeof m=="function"&&v==="prototype"&&"value"in y&&p in y&&!y[p]){var S=u(m,v);S&&S[p]&&(m[v]=y.value,y={configurable:f in y?y[f]:S[f],enumerable:d in y?y[d]:S[d],writable:!1})}return c(m,v,y)}:c:function(m,v,y){if(a(m),v=o(v),a(y),n)try{return c(m,v,y)}catch{}if("get"in y||"set"in y)throw new l("Accessors not supported");return"value"in y&&(m[v]=y.value),m}},7347:(r,t,e)=>{var s=e(3724),n=e(9565),i=e(8773),a=e(6980),o=e(5397),l=e(6969),c=e(9297),u=e(5917),d=Object.getOwnPropertyDescriptor;t.f=s?d:function(p,g){if(p=o(p),g=l(g),u)try{return d(p,g)}catch{}if(c(p,g))return a(!n(i.f,p,g),p[g])}},8480:(r,t,e)=>{var s=e(1828),n=e(8727),i=n.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(o){return s(o,i)}},3717:(r,t)=>{t.f=Object.getOwnPropertySymbols},2787:(r,t,e)=>{var s=e(9297),n=e(4901),i=e(8981),a=e(6119),o=e(2211),l=a("IE_PROTO"),c=Object,u=c.prototype;r.exports=o?c.getPrototypeOf:function(d){var f=i(d);if(s(f,l))return f[l];var p=f.constructor;return n(p)&&f instanceof p?p.prototype:f instanceof c?u:null}},1625:(r,t,e)=>{var s=e(9504);r.exports=s({}.isPrototypeOf)},1828:(r,t,e)=>{var s=e(9504),n=e(9297),i=e(5397),a=e(9617).indexOf,o=e(421),l=s([].push);r.exports=function(c,u){var d=i(c),f=0,p=[],g;for(g in d)!n(o,g)&&n(d,g)&&l(p,g);for(;u.length>f;)n(d,g=u[f++])&&(~a(p,g)||l(p,g));return p}},1072:(r,t,e)=>{var s=e(1828),n=e(8727);r.exports=Object.keys||function(a){return s(a,n)}},8773:(r,t)=>{var e={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,n=s&&!e.call({1:2},1);t.f=n?function(a){var o=s(this,a);return!!o&&o.enumerable}:e},2967:(r,t,e)=>{var s=e(6706),n=e(34),i=e(7750),a=e(3506);r.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,l={},c;try{c=s(Object.prototype,"__proto__","set"),c(l,[]),o=l instanceof Array}catch{}return function(d,f){return i(d),a(f),n(d)&&(o?c(d,f):d.__proto__=f),d}}():void 0)},4270:(r,t,e)=>{var s=e(9565),n=e(4901),i=e(34),a=TypeError;r.exports=function(o,l){var c,u;if(l==="string"&&n(c=o.toString)&&!i(u=s(c,o))||n(c=o.valueOf)&&!i(u=s(c,o))||l!=="string"&&n(c=o.toString)&&!i(u=s(c,o)))return u;throw new a("Can't convert object to primitive value")}},5031:(r,t,e)=>{var s=e(7751),n=e(9504),i=e(8480),a=e(3717),o=e(8551),l=n([].concat);r.exports=s("Reflect","ownKeys")||function(u){var d=i.f(o(u)),f=a.f;return f?l(d,f(u)):d}},8235:(r,t,e)=>{var s=e(9504),n=e(9297),i=SyntaxError,a=parseInt,o=String.fromCharCode,l=s("".charAt),c=s("".slice),u=s(/./.exec),d={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},f=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;r.exports=function(g,m){for(var v=!0,y="";m<g.length;){var S=l(g,m);if(S==="\\"){var T=c(g,m,m+2);if(n(d,T))y+=d[T],m+=2;else if(T==="\\u"){m+=2;var E=c(g,m,m+4);if(!u(f,E))throw new i("Bad Unicode escape at: "+m);y+=o(a(E,16)),m+=4}else throw new i('Unknown escape sequence: "'+T+'"')}else if(S==='"'){v=!1,m++;break}else{if(u(p,S))throw new i("Bad control character in string literal at: "+m);y+=S,m++}}if(v)throw new i("Unterminated string at: "+m);return{value:y,end:m}}},1103:r=>{r.exports=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}}},7750:(r,t,e)=>{var s=e(4117),n=TypeError;r.exports=function(i){if(s(i))throw new n("Can't call method on "+i);return i}},9286:(r,t,e)=>{var s=e(4402),n=e(8469),i=s.Set,a=s.add;r.exports=function(o){var l=new i;return n(o,function(c){a(l,c)}),l}},3440:(r,t,e)=>{var s=e(7080),n=e(4402),i=e(9286),a=e(5170),o=e(3789),l=e(8469),c=e(507),u=n.has,d=n.remove;r.exports=function(p){var g=s(this),m=o(p),v=i(g);return a(g)<=m.size?l(g,function(y){m.includes(y)&&d(v,y)}):c(m.getIterator(),function(y){u(g,y)&&d(v,y)}),v}},4402:(r,t,e)=>{var s=e(9504),n=Set.prototype;r.exports={Set,add:s(n.add),has:s(n.has),remove:s(n.delete),proto:n}},8750:(r,t,e)=>{var s=e(7080),n=e(4402),i=e(5170),a=e(3789),o=e(8469),l=e(507),c=n.Set,u=n.add,d=n.has;r.exports=function(p){var g=s(this),m=a(p),v=new c;return i(g)>m.size?l(m.getIterator(),function(y){d(g,y)&&u(v,y)}):o(g,function(y){m.includes(y)&&u(v,y)}),v}},4449:(r,t,e)=>{var s=e(7080),n=e(4402).has,i=e(5170),a=e(3789),o=e(8469),l=e(507),c=e(9539);r.exports=function(d){var f=s(this),p=a(d);if(i(f)<=p.size)return o(f,function(m){if(p.includes(m))return!1},!0)!==!1;var g=p.getIterator();return l(g,function(m){if(n(f,m))return c(g,"normal",!1)})!==!1}},3838:(r,t,e)=>{var s=e(7080),n=e(5170),i=e(8469),a=e(3789);r.exports=function(l){var c=s(this),u=a(l);return n(c)>u.size?!1:i(c,function(d){if(!u.includes(d))return!1},!0)!==!1}},8527:(r,t,e)=>{var s=e(7080),n=e(4402).has,i=e(5170),a=e(3789),o=e(507),l=e(9539);r.exports=function(u){var d=s(this),f=a(u);if(i(d)<f.size)return!1;var p=f.getIterator();return o(p,function(g){if(!n(d,g))return l(p,"normal",!1)})!==!1}},8469:(r,t,e)=>{var s=e(9504),n=e(507),i=e(4402),a=i.Set,o=i.proto,l=s(o.forEach),c=s(o.keys),u=c(new a).next;r.exports=function(d,f,p){return p?n({iterator:c(d),next:u},f):l(d,f)}},4916:(r,t,e)=>{var s=e(7751),n=function(i){return{size:i,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};r.exports=function(i){var a=s("Set");try{new a()[i](n(0));try{return new a()[i](n(-1)),!1}catch{return!0}}catch{return!1}}},5170:(r,t,e)=>{var s=e(6706),n=e(4402);r.exports=s(n.proto,"size","get")||function(i){return i.size}},3650:(r,t,e)=>{var s=e(7080),n=e(4402),i=e(9286),a=e(3789),o=e(507),l=n.add,c=n.has,u=n.remove;r.exports=function(f){var p=s(this),g=a(f).getIterator(),m=i(p);return o(g,function(v){c(p,v)?u(m,v):l(m,v)}),m}},4204:(r,t,e)=>{var s=e(7080),n=e(4402).add,i=e(9286),a=e(3789),o=e(507);r.exports=function(c){var u=s(this),d=a(c).getIterator(),f=i(u);return o(d,function(p){n(f,p)}),f}},6119:(r,t,e)=>{var s=e(5745),n=e(3392),i=s("keys");r.exports=function(a){return i[a]||(i[a]=n(a))}},7629:(r,t,e)=>{var s=e(6395),n=e(4576),i=e(9433),a="__core-js_shared__",o=r.exports=n[a]||i(a,{});(o.versions||(o.versions=[])).push({version:"3.39.0",mode:s?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:(r,t,e)=>{var s=e(7629);r.exports=function(n,i){return s[n]||(s[n]=i||{})}},1548:(r,t,e)=>{var s=e(4576),n=e(9039),i=e(9519),a=e(4215),o=s.structuredClone;r.exports=!!o&&!n(function(){if(a==="DENO"&&i>92||a==="NODE"&&i>94||a==="BROWSER"&&i>97)return!1;var l=new ArrayBuffer(8),c=o(l,{transfer:[l]});return l.byteLength!==0||c.byteLength!==8})},4495:(r,t,e)=>{var s=e(9519),n=e(9039),i=e(4576),a=i.String;r.exports=!!Object.getOwnPropertySymbols&&!n(function(){var o=Symbol("symbol detection");return!a(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&s&&s<41})},5610:(r,t,e)=>{var s=e(1291),n=Math.max,i=Math.min;r.exports=function(a,o){var l=s(a);return l<0?n(l+o,0):i(l,o)}},5854:(r,t,e)=>{var s=e(2777),n=TypeError;r.exports=function(i){var a=s(i,"number");if(typeof a=="number")throw new n("Can't convert number to bigint");return BigInt(a)}},7696:(r,t,e)=>{var s=e(1291),n=e(8014),i=RangeError;r.exports=function(a){if(a===void 0)return 0;var o=s(a),l=n(o);if(o!==l)throw new i("Wrong length or index");return l}},5397:(r,t,e)=>{var s=e(7055),n=e(7750);r.exports=function(i){return s(n(i))}},1291:(r,t,e)=>{var s=e(741);r.exports=function(n){var i=+n;return i!==i||i===0?0:s(i)}},8014:(r,t,e)=>{var s=e(1291),n=Math.min;r.exports=function(i){var a=s(i);return a>0?n(a,9007199254740991):0}},8981:(r,t,e)=>{var s=e(7750),n=Object;r.exports=function(i){return n(s(i))}},9590:(r,t,e)=>{var s=e(1291),n=RangeError;r.exports=function(i){var a=s(i);if(a<0)throw new n("The argument can't be less than 0");return a}},2777:(r,t,e)=>{var s=e(9565),n=e(34),i=e(757),a=e(5966),o=e(4270),l=e(8227),c=TypeError,u=l("toPrimitive");r.exports=function(d,f){if(!n(d)||i(d))return d;var p=a(d,u),g;if(p){if(f===void 0&&(f="default"),g=s(p,d,f),!n(g)||i(g))return g;throw new c("Can't convert object to primitive value")}return f===void 0&&(f="number"),o(d,f)}},6969:(r,t,e)=>{var s=e(2777),n=e(757);r.exports=function(i){var a=s(i,"string");return n(a)?a:a+""}},2140:(r,t,e)=>{var s=e(8227),n=s("toStringTag"),i={};i[n]="z",r.exports=String(i)==="[object z]"},655:(r,t,e)=>{var s=e(6955),n=String;r.exports=function(i){if(s(i)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return n(i)}},6823:r=>{var t=String;r.exports=function(e){try{return t(e)}catch{return"Object"}}},3392:(r,t,e)=>{var s=e(9504),n=0,i=Math.random(),a=s(1 .toString);r.exports=function(o){return"Symbol("+(o===void 0?"":o)+")_"+a(++n+i,36)}},7040:(r,t,e)=>{var s=e(4495);r.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},8686:(r,t,e)=>{var s=e(3724),n=e(9039);r.exports=s&&n(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},2812:r=>{var t=TypeError;r.exports=function(e,s){if(e<s)throw new t("Not enough arguments");return e}},8622:(r,t,e)=>{var s=e(4576),n=e(4901),i=s.WeakMap;r.exports=n(i)&&/native code/.test(String(i))},8227:(r,t,e)=>{var s=e(4576),n=e(5745),i=e(9297),a=e(3392),o=e(4495),l=e(7040),c=s.Symbol,u=n("wks"),d=l?c.for||c:c&&c.withoutSetter||a;r.exports=function(f){return i(u,f)||(u[f]=o&&i(c,f)?c[f]:d("Symbol."+f)),u[f]}},6573:(r,t,e)=>{var s=e(3724),n=e(2106),i=e(3238),a=ArrayBuffer.prototype;s&&!("detached"in a)&&n(a,"detached",{configurable:!0,get:function(){return i(this)}})},7936:(r,t,e)=>{var s=e(6518),n=e(5636);n&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return n(this,arguments.length?arguments[0]:void 0,!1)}})},8100:(r,t,e)=>{var s=e(6518),n=e(5636);n&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return n(this,arguments.length?arguments[0]:void 0,!0)}})},4114:(r,t,e)=>{var s=e(6518),n=e(8981),i=e(6198),a=e(4527),o=e(6837),l=e(9039),c=l(function(){return[].push.call({length:4294967296},1)!==4294967297}),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(f){return f instanceof TypeError}},d=c||!u();s({target:"Array",proto:!0,arity:1,forced:d},{push:function(p){var g=n(this),m=i(g),v=arguments.length;o(m+v);for(var y=0;y<v;y++)g[m]=arguments[y],m++;return a(g,m),m}})},8111:(r,t,e)=>{var s=e(6518),n=e(4576),i=e(679),a=e(8551),o=e(4901),l=e(2787),c=e(2106),u=e(4659),d=e(9039),f=e(9297),p=e(8227),g=e(7657).IteratorPrototype,m=e(3724),v=e(6395),y="constructor",S="Iterator",T=p("toStringTag"),E=TypeError,A=n[S],C=v||!o(A)||A.prototype!==g||!d(function(){A({})}),x=function(){if(i(this,g),l(this)===g)throw new E("Abstract class Iterator not directly constructable")},I=function(R,O){m?c(g,R,{configurable:!0,get:function(){return O},set:function(P){if(a(this),this===g)throw new E("You can't redefine this property");f(this,R)?this[R]=P:u(this,R,P)}}):g[R]=O};f(g,T)||I(T,S),(C||!f(g,y)||g[y]===Object)&&I(y,x),x.prototype=g,s({global:!0,constructor:!0,forced:C},{Iterator:x})},9314:(r,t,e)=>{var s=e(6518),n=e(9565),i=e(8551),a=e(1767),o=e(4149),l=e(9590),c=e(9462),u=e(6395),d=c(function(){for(var f=this.iterator,p=this.next,g,m;this.remaining;)if(this.remaining--,g=i(n(p,f)),m=this.done=!!g.done,m)return;if(g=i(n(p,f)),m=this.done=!!g.done,!m)return g.value});s({target:"Iterator",proto:!0,real:!0,forced:u},{drop:function(p){i(this);var g=l(o(+p));return new d(a(this),{remaining:g})}})},1148:(r,t,e)=>{var s=e(6518),n=e(2652),i=e(9306),a=e(8551),o=e(1767);s({target:"Iterator",proto:!0,real:!0},{every:function(c){a(this),i(c);var u=o(this),d=0;return!n(u,function(f,p){if(!c(f,d++))return p()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},2489:(r,t,e)=>{var s=e(6518),n=e(9565),i=e(9306),a=e(8551),o=e(1767),l=e(9462),c=e(6319),u=e(6395),d=l(function(){for(var f=this.iterator,p=this.predicate,g=this.next,m,v,y;;){if(m=a(n(g,f)),v=this.done=!!m.done,v)return;if(y=m.value,c(f,p,[y,this.counter++],!0))return y}});s({target:"Iterator",proto:!0,real:!0,forced:u},{filter:function(p){return a(this),i(p),new d(o(this),{predicate:p})}})},531:(r,t,e)=>{var s=e(6518),n=e(9565),i=e(9306),a=e(8551),o=e(1767),l=e(8646),c=e(9462),u=e(9539),d=e(6395),f=c(function(){for(var p=this.iterator,g=this.mapper,m,v;;){if(v=this.inner)try{if(m=a(n(v.next,v.iterator)),!m.done)return m.value;this.inner=null}catch(y){u(p,"throw",y)}if(m=a(n(this.next,p)),this.done=!!m.done)return;try{this.inner=l(g(m.value,this.counter++),!1)}catch(y){u(p,"throw",y)}}});s({target:"Iterator",proto:!0,real:!0,forced:d},{flatMap:function(g){return a(this),i(g),new f(o(this),{mapper:g,inner:null})}})},1701:(r,t,e)=>{var s=e(6518),n=e(713),i=e(6395);s({target:"Iterator",proto:!0,real:!0,forced:i},{map:n})},3579:(r,t,e)=>{var s=e(6518),n=e(2652),i=e(9306),a=e(8551),o=e(1767);s({target:"Iterator",proto:!0,real:!0},{some:function(c){a(this),i(c);var u=o(this),d=0;return n(u,function(f,p){if(c(f,d++))return p()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1689:(r,t,e)=>{var s=e(6518),n=e(4576),i=e(8745),a=e(7680),o=e(6043),l=e(9306),c=e(1103),u=n.Promise,d=!1,f=!u||!u.try||c(function(){u.try(function(p){d=p===8},8)}).error||!d;s({target:"Promise",stat:!0,forced:f},{try:function(p){var g=arguments.length>1?a(arguments,1):[],m=o.f(this),v=c(function(){return i(l(p),void 0,g)});return(v.error?m.reject:m.resolve)(v.value),m.promise}})},4628:(r,t,e)=>{var s=e(6518),n=e(6043);s({target:"Promise",stat:!0},{withResolvers:function(){var a=n.f(this);return{promise:a.promise,resolve:a.resolve,reject:a.reject}}})},7642:(r,t,e)=>{var s=e(6518),n=e(3440),i=e(4916);s({target:"Set",proto:!0,real:!0,forced:!i("difference")},{difference:n})},8004:(r,t,e)=>{var s=e(6518),n=e(9039),i=e(8750),a=e(4916),o=!a("intersection")||n(function(){return String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:o},{intersection:i})},3853:(r,t,e)=>{var s=e(6518),n=e(4449),i=e(4916);s({target:"Set",proto:!0,real:!0,forced:!i("isDisjointFrom")},{isDisjointFrom:n})},5876:(r,t,e)=>{var s=e(6518),n=e(3838),i=e(4916);s({target:"Set",proto:!0,real:!0,forced:!i("isSubsetOf")},{isSubsetOf:n})},2475:(r,t,e)=>{var s=e(6518),n=e(8527),i=e(4916);s({target:"Set",proto:!0,real:!0,forced:!i("isSupersetOf")},{isSupersetOf:n})},5024:(r,t,e)=>{var s=e(6518),n=e(3650),i=e(4916);s({target:"Set",proto:!0,real:!0,forced:!i("symmetricDifference")},{symmetricDifference:n})},1698:(r,t,e)=>{var s=e(6518),n=e(4204),i=e(4916);s({target:"Set",proto:!0,real:!0,forced:!i("union")},{union:n})},7467:(r,t,e)=>{var s=e(7628),n=e(4644),i=n.aTypedArray,a=n.exportTypedArrayMethod,o=n.getTypedArrayConstructor;a("toReversed",function(){return s(i(this),o(this))})},4732:(r,t,e)=>{var s=e(4644),n=e(9504),i=e(9306),a=e(5370),o=s.aTypedArray,l=s.getTypedArrayConstructor,c=s.exportTypedArrayMethod,u=n(s.TypedArrayPrototype.sort);c("toSorted",function(f){f!==void 0&&i(f);var p=o(this),g=a(l(p),p);return u(g,f)})},9577:(r,t,e)=>{var s=e(9928),n=e(4644),i=e(1108),a=e(1291),o=e(5854),l=n.aTypedArray,c=n.getTypedArrayConstructor,u=n.exportTypedArrayMethod,d=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(f){return f===8}}();u("with",function(f,p){var g=l(this),m=a(f),v=i(g)?o(p):+p;return s(g,c(g),m,v)},!d)},8992:(r,t,e)=>{e(8111)},4743:(r,t,e)=>{e(9314)},3215:(r,t,e)=>{e(1148)},4520:(r,t,e)=>{e(2489)},670:(r,t,e)=>{e(531)},1454:(r,t,e)=>{e(1701)},7550:(r,t,e)=>{e(3579)},8335:(r,t,e)=>{var s=e(6518),n=e(3724),i=e(4576),a=e(7751),o=e(9504),l=e(9565),c=e(4901),u=e(34),d=e(4376),f=e(9297),p=e(655),g=e(6198),m=e(4659),v=e(9039),y=e(8235),S=e(4495),T=i.JSON,E=i.Number,A=i.SyntaxError,C=T&&T.parse,x=a("Object","keys"),I=Object.getOwnPropertyDescriptor,R=o("".charAt),O=o("".slice),P=o(/./.exec),M=o([].push),B=/^\d$/,F=/^[1-9]$/,W=/^[\d-]$/,j=/^[\t\n\r ]$/,D=0,$=1,H=function(U,V){U=p(U);var N=new ut(U,0),ct=N.parse(),pt=ct.value,rt=N.skip(j,ct.end);if(rt<U.length)throw new A('Unexpected extra character: "'+R(U,rt)+'" after the parsed data at: '+rt);return c(V)?Y({"":pt},"",V,ct):pt},Y=function(U,V,N,ct){var pt=U[V],rt=ct&&pt===ct.value,Ct=rt&&typeof ct.source=="string"?{source:ct.source}:{},Dt,ye,G,q,Pt;if(u(pt)){var Ot=d(pt),mt=rt?ct.nodes:Ot?[]:{};if(Ot)for(Dt=mt.length,G=g(pt),q=0;q<G;q++)K(pt,q,Y(pt,""+q,N,q<Dt?mt[q]:void 0));else for(ye=x(pt),G=g(ye),q=0;q<G;q++)Pt=ye[q],K(pt,Pt,Y(pt,Pt,N,f(mt,Pt)?mt[Pt]:void 0))}return l(N,U,V,pt,Ct)},K=function(U,V,N){if(n){var ct=I(U,V);if(ct&&!ct.configurable)return}N===void 0?delete U[V]:m(U,V,N)},nt=function(U,V,N,ct){this.value=U,this.end=V,this.source=N,this.nodes=ct},ut=function(U,V){this.source=U,this.index=V};ut.prototype={fork:function(U){return new ut(this.source,U)},parse:function(){var U=this.source,V=this.skip(j,this.index),N=this.fork(V),ct=R(U,V);if(P(W,ct))return N.number();switch(ct){case"{":return N.object();case"[":return N.array();case'"':return N.string();case"t":return N.keyword(!0);case"f":return N.keyword(!1);case"n":return N.keyword(null)}throw new A('Unexpected character: "'+ct+'" at: '+V)},node:function(U,V,N,ct,pt){return new nt(V,ct,U?null:O(this.source,N,ct),pt)},object:function(){for(var U=this.source,V=this.index+1,N=!1,ct={},pt={};V<U.length;){if(V=this.until(['"',"}"],V),R(U,V)==="}"&&!N){V++;break}var rt=this.fork(V).string(),Ct=rt.value;V=rt.end,V=this.until([":"],V)+1,V=this.skip(j,V),rt=this.fork(V).parse(),m(pt,Ct,rt),m(ct,Ct,rt.value),V=this.until([",","}"],rt.end);var Dt=R(U,V);if(Dt===",")N=!0,V++;else if(Dt==="}"){V++;break}}return this.node($,ct,this.index,V,pt)},array:function(){for(var U=this.source,V=this.index+1,N=!1,ct=[],pt=[];V<U.length;){if(V=this.skip(j,V),R(U,V)==="]"&&!N){V++;break}var rt=this.fork(V).parse();if(M(pt,rt),M(ct,rt.value),V=this.until([",","]"],rt.end),R(U,V)===",")N=!0,V++;else if(R(U,V)==="]"){V++;break}}return this.node($,ct,this.index,V,pt)},string:function(){var U=this.index,V=y(this.source,this.index+1);return this.node(D,V.value,U,V.end)},number:function(){var U=this.source,V=this.index,N=V;if(R(U,N)==="-"&&N++,R(U,N)==="0")N++;else if(P(F,R(U,N)))N=this.skip(B,N+1);else throw new A("Failed to parse number at: "+N);if(R(U,N)==="."&&(N=this.skip(B,N+1)),R(U,N)==="e"||R(U,N)==="E"){N++,(R(U,N)==="+"||R(U,N)==="-")&&N++;var ct=N;if(N=this.skip(B,N),ct===N)throw new A("Failed to parse number's exponent value at: "+N)}return this.node(D,E(O(U,V,N)),V,N)},keyword:function(U){var V=""+U,N=this.index,ct=N+V.length;if(O(this.source,N,ct)!==V)throw new A("Failed to parse value at: "+N);return this.node(D,U,N,ct)},skip:function(U,V){for(var N=this.source;V<N.length&&P(U,R(N,V));V++);return V},until:function(U,V){V=this.skip(j,V);for(var N=R(this.source,V),ct=0;ct<U.length;ct++)if(U[ct]===N)return V;throw new A('Unexpected character: "'+N+'" at: '+V)}};var Rt=v(function(){var U="9007199254740993",V;return C(U,function(N,ct,pt){V=pt.source}),V!==U}),ht=S&&!v(function(){return 1/C("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:Rt},{parse:function(V,N){return ht&&!c(N)?C(V):H(V,N)}})},5247:(r,t,e)=>{e(1689)},4979:(r,t,e)=>{var s=e(6518),n=e(4576),i=e(7751),a=e(6980),o=e(4913).f,l=e(9297),c=e(679),u=e(3167),d=e(2603),f=e(5002),p=e(8574),g=e(3724),m=e(6395),v="DOMException",y=i("Error"),S=i(v),T=function(){c(this,E);var j=arguments.length,D=d(j<1?void 0:arguments[0]),$=d(j<2?void 0:arguments[1],"Error"),H=new S(D,$),Y=new y(D);return Y.name=v,o(H,"stack",a(1,p(Y.stack,1))),u(H,this,T),H},E=T.prototype=S.prototype,A="stack"in new y(v),C="stack"in new S(1,2),x=S&&g&&Object.getOwnPropertyDescriptor(n,v),I=!!x&&!(x.writable&&x.configurable),R=A&&!I&&!C;s({global:!0,constructor:!0,forced:m||R},{DOMException:R?T:S});var O=i(v),P=O.prototype;if(P.constructor!==O){m||o(P,"constructor",a(1,O));for(var M in f)if(l(f,M)){var B=f[M],F=B.s;l(O,F)||o(O,F,a(6,B.c))}}},4603:(r,t,e)=>{var s=e(6840),n=e(9504),i=e(655),a=e(2812),o=URLSearchParams,l=o.prototype,c=n(l.append),u=n(l.delete),d=n(l.forEach),f=n([].push),p=new o("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&s(l,"delete",function(g){var m=arguments.length,v=m<2?void 0:arguments[1];if(m&&v===void 0)return u(this,g);var y=[];d(this,function(R,O){f(y,{key:O,value:R})}),a(m,1);for(var S=i(g),T=i(v),E=0,A=0,C=!1,x=y.length,I;E<x;)I=y[E++],C||I.key===S?(C=!0,u(this,I.key)):A++;for(;A<x;)I=y[A++],I.key===S&&I.value===T||c(this,I.key,I.value)},{enumerable:!0,unsafe:!0})},7566:(r,t,e)=>{var s=e(6840),n=e(9504),i=e(655),a=e(2812),o=URLSearchParams,l=o.prototype,c=n(l.getAll),u=n(l.has),d=new o("a=1");(d.has("a",2)||!d.has("a",void 0))&&s(l,"has",function(p){var g=arguments.length,m=g<2?void 0:arguments[1];if(g&&m===void 0)return u(this,p);var v=c(this,p);a(g,1);for(var y=i(m),S=0;S<v.length;)if(v[S++]===y)return!0;return!1},{enumerable:!0,unsafe:!0})},8721:(r,t,e)=>{var s=e(3724),n=e(9504),i=e(2106),a=URLSearchParams.prototype,o=n(a.forEach);s&&!("size"in a)&&i(a,"size",{get:function(){var c=0;return o(this,function(){c++}),c},configurable:!0,enumerable:!0})}},sb={};function xt(r){var t=sb[r];if(t!==void 0)return t.exports;var e=sb[r]={exports:{}};return qT[r].call(e.exports,e,e.exports,xt),e.exports}xt.d=(r,t)=>{for(var e in t)xt.o(t,e)&&!xt.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:t[e]})};xt.o=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);var dt=globalThis.pdfjsLib={};xt.d(dt,{AbortException:()=>ao,AnnotationEditorLayer:()=>Vv,AnnotationEditorParamsType:()=>Tt,AnnotationEditorType:()=>gt,AnnotationEditorUIManager:()=>Za,AnnotationLayer:()=>zC,AnnotationMode:()=>Wi,ColorPicker:()=>Nf,DOMSVGFactory:()=>fy,DrawLayer:()=>Uv,FeatureTest:()=>ns,GlobalWorkerOptions:()=>Pi,ImageKind:()=>Jd,InvalidPDFException:()=>u_,MissingPDFException:()=>bd,OPS:()=>Gs,OutputScale:()=>Dm,PDFDataRangeTransport:()=>oA,PDFDateString:()=>cy,PDFWorker:()=>Do,PasswordResponses:()=>t1,PermissionFlag:()=>JT,PixelsPerInch:()=>Cr,RenderingCancelledException:()=>oy,TextLayer:()=>qc,UnexpectedResponseException:()=>Ug,Util:()=>lt,VerbosityLevel:()=>Vg,XfaLayer:()=>cA,build:()=>CC,createValidAbsoluteUrl:()=>i1,fetchData:()=>Hg,getDocument:()=>mC,getFilenameFromUrl:()=>f1,getPdfFilenameFromUrl:()=>p1,getXfaPageViewport:()=>g1,isDataScheme:()=>zg,isPdfFile:()=>ly,noContextMenu:()=>pn,normalizeUnicode:()=>h1,setLayerDimensions:()=>qa,shadow:()=>At,stopEvent:()=>hn,version:()=>TC});xt(4114);xt(6573);xt(8100);xt(7936);xt(7467);xt(4732);xt(9577);xt(5247);xt(4979);xt(4603);xt(7566);xt(8721);const Ye=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),h_=[1,0,0,1,0,0],Pm=[.001,0,0,.001,0,0],ZT=1e7,ym=1.35,Es={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Wi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},QT="pdfjs_internal_editor_",gt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Tt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},JT={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},$e={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Jd={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},be={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},xc={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Vg={ERRORS:0,WARNINGS:1,INFOS:5},Gs={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},t1={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let $g=Vg.WARNINGS;function e1(r){Number.isInteger(r)&&($g=r)}function s1(){return $g}function jg(r){$g>=Vg.INFOS&&console.log(`Info: ${r}`)}function ft(r){$g>=Vg.WARNINGS&&console.log(`Warning: ${r}`)}function Ft(r){throw new Error(r)}function me(r,t){r||Ft(t)}function n1(r){switch(r==null?void 0:r.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function i1(r,t=null,e=null){if(!r)return null;try{if(e&&typeof r=="string"){if(e.addDefaultProtocol&&r.startsWith("www.")){const n=r.match(/\./g);(n==null?void 0:n.length)>=2&&(r=`http://${r}`)}if(e.tryConvertEncoding)try{r=c1(r)}catch{}}const s=t?new URL(r,t):new URL(r);if(n1(s))return s}catch{}return null}function At(r,t,e,s=!1){return Object.defineProperty(r,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Ir=function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t}();class Om extends Ir{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Mm extends Ir{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class u_ extends Ir{constructor(t){super(t,"InvalidPDFException")}}class bd extends Ir{constructor(t){super(t,"MissingPDFException")}}class Ug extends Ir{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class r1 extends Ir{constructor(t){super(t,"FormatError")}}class ao extends Ir{constructor(t){super(t,"AbortException")}}function d_(r){(typeof r!="object"||(r==null?void 0:r.length)===void 0)&&Ft("Invalid argument for bytesToString");const t=r.length,e=8192;if(t<e)return String.fromCharCode.apply(null,r);const s=[];for(let n=0;n<t;n+=e){const i=Math.min(n+e,t),a=r.subarray(n,i);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function Wg(r){typeof r!="string"&&Ft("Invalid argument for stringToBytes");const t=r.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=r.charCodeAt(s)&255;return e}function a1(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function ry(r){const t=Object.create(null);for(const[e,s]of r)t[e]=s;return t}function o1(){const r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function l1(){try{return new Function(""),!0}catch{return!1}}class ns{static get isLittleEndian(){return At(this,"isLittleEndian",o1())}static get isEvalSupported(){return At(this,"isEvalSupported",l1())}static get isOffscreenCanvasSupported(){return At(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return At(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?At(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):At(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var t,e;return At(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const bm=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0"));var Bo,tf,fh,km;class lt{static makeHexColor(t,e,s){return`#${bm[t]}${bm[e]}${bm[s]}`}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){const s=t[0]*e[0]+t[1]*e[2]+e[4],n=t[0]*e[1]+t[1]*e[3]+e[5];return[s,n]}static applyInverseTransform(t,e){const s=e[0]*e[3]-e[1]*e[2],n=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s,i=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s;return[n,i]}static getAxialAlignedBoundingBox(t,e){const s=this.applyTransform(t,e),n=this.applyTransform(t.slice(2,4),e),i=this.applyTransform([t[0],t[3]],e),a=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],n[0],i[0],a[0]),Math.min(s[1],n[1],i[1],a[1]),Math.max(s[0],n[0],i[0],a[0]),Math.max(s[1],n[1],i[1],a[1])]}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){const e=[t[0],t[2],t[1],t[3]],s=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],i=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],o=(s+a)/2,l=Math.sqrt((s+a)**2-4*(s*a-i*n))/2,c=o+l||1,u=o-l||1;return[Math.sqrt(c),Math.sqrt(u)]}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),n=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>n)return null;const i=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return i>a?null:[s,i,n,a]}static bezierBoundingBox(t,e,s,n,i,a,o,l,c){return c?(c[0]=Math.min(c[0],t,o),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,o),c[3]=Math.max(c[3],e,l)):c=[Math.min(t,o),Math.min(e,l),Math.max(t,o),Math.max(e,l)],w(this,fh,km).call(this,t,s,i,o,e,n,a,l,3*(-t+3*(s-i)+o),6*(t-2*s+i),3*(s-t),c),w(this,fh,km).call(this,t,s,i,o,e,n,a,l,3*(-e+3*(n-a)+l),6*(e-2*n+a),3*(n-e),c),c}}Bo=new WeakSet,tf=function(t,e,s,n,i,a,o,l,c,u){if(c<=0||c>=1)return;const d=1-c,f=c*c,p=f*c,g=d*(d*(d*t+3*c*e)+3*f*s)+p*n,m=d*(d*(d*i+3*c*a)+3*f*o)+p*l;u[0]=Math.min(u[0],g),u[1]=Math.min(u[1],m),u[2]=Math.max(u[2],g),u[3]=Math.max(u[3],m)},fh=new WeakSet,km=function(t,e,s,n,i,a,o,l,c,u,d,f){if(Math.abs(c)<1e-12){Math.abs(u)>=1e-12&&w(this,Bo,tf).call(this,t,e,s,n,i,a,o,l,-d/u,f);return}const p=u**2-4*d*c;if(p<0)return;const g=Math.sqrt(p),m=2*c;w(this,Bo,tf).call(this,t,e,s,n,i,a,o,l,(-u+g)/m,f),w(this,Bo,tf).call(this,t,e,s,n,i,a,o,l,(-u-g)/m,f)},b(lt,Bo),b(lt,fh);function c1(r){return decodeURIComponent(escape(r))}let _m=null,nb=null;function h1(r){return _m||(_m=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,nb=new Map([["ﬅ","ſt"]])),r.replaceAll(_m,(t,e,s)=>e?e.normalize("NFKC"):nb.get(s))}function u1(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Uint8Array(32);return crypto.getRandomValues(r),d_(r)}const ay="pdfjs_internal_id_",qn={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};function d1(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(d_(r))}xt(4628);xt(7642);xt(8004);xt(3853);xt(5876);xt(2475);xt(5024);xt(1698);xt(1454);xt(8992);xt(4743);xt(3215);xt(7550);xt(8335);const Jn="http://www.w3.org/2000/svg",Lr=class Lr{};at(Lr,"CSS",96),at(Lr,"PDF",72),at(Lr,"PDF_TO_CSS_UNITS",Lr.CSS/Lr.PDF);let Cr=Lr;async function Hg(r,t="text"){if(Oc(r,document.baseURI)){const e=await fetch(r);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const n=new XMLHttpRequest;n.open("GET",r,!0),n.responseType=t,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(n.status===200||n.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(n.response);return}e(n.responseText);return}s(new Error(n.statusText))}},n.send(null)})}class _d{constructor({viewBox:t,scale:e,rotation:s,offsetX:n=0,offsetY:i=0,dontFlip:a=!1}){this.viewBox=t,this.scale=e,this.rotation=s,this.offsetX=n,this.offsetY=i;const o=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let c,u,d,f;switch(s%=360,s<0&&(s+=360),s){case 180:c=-1,u=0,d=0,f=1;break;case 90:c=0,u=1,d=1,f=0;break;case 270:c=0,u=-1,d=-1,f=0;break;case 0:c=1,u=0,d=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(d=-d,f=-f);let p,g,m,v;c===0?(p=Math.abs(l-t[1])*e+n,g=Math.abs(o-t[0])*e+i,m=(t[3]-t[1])*e,v=(t[2]-t[0])*e):(p=Math.abs(o-t[0])*e+n,g=Math.abs(l-t[1])*e+i,m=(t[2]-t[0])*e,v=(t[3]-t[1])*e),this.transform=[c*e,u*e,d*e,f*e,p-c*e*o-d*e*l,g-u*e*o-f*e*l],this.width=m,this.height=v}get rawDims(){const{viewBox:t}=this;return At(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:n=this.offsetY,dontFlip:i=!1}={}){return new _d({viewBox:this.viewBox.slice(),scale:t,rotation:e,offsetX:s,offsetY:n,dontFlip:i})}convertToViewportPoint(t,e){return lt.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){const e=lt.applyTransform([t[0],t[1]],this.transform),s=lt.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){return lt.applyInverseTransform([t,e],this.transform)}}class oy extends Ir{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function zg(r){const t=r.length;let e=0;for(;e<t&&r[e].trim()==="";)e++;return r.substring(e,e+5).toLowerCase()==="data:"}function ly(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function f1(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function p1(r,t="document.pdf"){if(typeof r!="string")return t;if(zg(r))return ft('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,n=e.exec(r);let i=s.exec(n[1])||s.exec(n[2])||s.exec(n[3]);if(i&&(i=i[0],i.includes("%")))try{i=s.exec(decodeURIComponent(i))[0]}catch{}return i||t}class ib{constructor(){at(this,"started",Object.create(null));at(this,"times",[])}time(t){t in this.started&&ft(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||ft(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:n,end:i}of this.times)t.push(`${s.padEnd(e)} ${i-n}ms
`);return t.join("")}}function Oc(r,t){try{const{protocol:e}=t?new URL(r,t):new URL(r);return e==="http:"||e==="https:"}catch{return!1}}function pn(r){r.preventDefault()}function hn(r){r.preventDefault(),r.stopPropagation()}function rb(r){console.log("Deprecated API usage: "+r)}var ph;class cy{static toDateObject(t){if(!t||typeof t!="string")return null;h(this,ph)||_(this,ph,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=h(this,ph).exec(t);if(!e)return null;const s=parseInt(e[1],10);let n=parseInt(e[2],10);n=n>=1&&n<=12?n-1:0;let i=parseInt(e[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const c=e[7]||"Z";let u=parseInt(e[8],10);u=u>=0&&u<=23?u:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,c==="-"?(a+=u,o+=d):c==="+"&&(a-=u,o-=d),new Date(Date.UTC(s,n,i,a,o,l))}}ph=new WeakMap,b(cy,ph,void 0);function g1(r,{scale:t=1,rotation:e=0}){const{width:s,height:n}=r.attributes.style,i=[0,0,parseInt(s),parseInt(n)];return new _d({viewBox:i,scale:t,rotation:e})}function hy(r){if(r.startsWith("#")){const t=parseInt(r.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(t=>parseInt(t)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(ft(`Not a valid color format: "${r}"`),[0,0,0])}function m1(r){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const e of r.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;r.set(e,hy(s))}t.remove()}function Kt(r){const{a:t,b:e,c:s,d:n,e:i,f:a}=r.getTransform();return[t,e,s,n,i,a]}function bn(r){const{a:t,b:e,c:s,d:n,e:i,f:a}=r.getTransform().invertSelf();return[t,e,s,n,i,a]}function qa(r,t,e=!1,s=!0){if(t instanceof _d){const{pageWidth:n,pageHeight:i}=t.rawDims,{style:a}=r,o=ns.isCSSRoundSupported,l=`var(--scale-factor) * ${n}px`,c=`var(--scale-factor) * ${i}px`,u=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,d=o?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!e||t.rotation%180===0?(a.width=u,a.height=d):(a.width=d,a.height=u)}s&&r.setAttribute("data-main-rotation",t.rotation)}class Dm{constructor(){const t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var Hi,Br,Xs,Vr,gh,mh,sp,f_,np,p_,ip,g_,Vo,ef,rp,m_,vh,Lm;const ni=class ni{constructor(t){b(this,np);b(this,ip);b(this,Vo);b(this,rp);b(this,vh);b(this,Hi,null);b(this,Br,null);b(this,Xs,void 0);b(this,Vr,null);b(this,gh,null);_(this,Xs,t),h(ni,mh)||_(ni,mh,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const t=_(this,Hi,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=h(this,Xs)._uiManager._signal;t.addEventListener("contextmenu",pn,{signal:e}),t.addEventListener("pointerdown",w(ni,sp,f_),{signal:e});const s=_(this,Vr,document.createElement("div"));s.className="buttons",t.append(s);const n=h(this,Xs).toolbarPosition;if(n){const{style:i}=t,a=h(this,Xs)._uiManager.direction==="ltr"?1-n[0]:n[0];i.insetInlineEnd=`${100*a}%`,i.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return w(this,rp,m_).call(this),t}get div(){return h(this,Hi)}hide(){var t;h(this,Hi).classList.add("hidden"),(t=h(this,Br))==null||t.hideDropdown()}show(){var t;h(this,Hi).classList.remove("hidden"),(t=h(this,gh))==null||t.shown()}async addAltText(t){const e=await t.render();w(this,Vo,ef).call(this,e),h(this,Vr).prepend(e,h(this,vh,Lm)),_(this,gh,t)}addColorPicker(t){_(this,Br,t);const e=t.renderButton();w(this,Vo,ef).call(this,e),h(this,Vr).prepend(e,h(this,vh,Lm))}remove(){var t;h(this,Hi).remove(),(t=h(this,Br))==null||t.destroy(),_(this,Br,null)}};Hi=new WeakMap,Br=new WeakMap,Xs=new WeakMap,Vr=new WeakMap,gh=new WeakMap,mh=new WeakMap,sp=new WeakSet,f_=function(t){t.stopPropagation()},np=new WeakSet,p_=function(t){h(this,Xs)._focusEventsAllowed=!1,hn(t)},ip=new WeakSet,g_=function(t){h(this,Xs)._focusEventsAllowed=!0,hn(t)},Vo=new WeakSet,ef=function(t){const e=h(this,Xs)._uiManager._signal;t.addEventListener("focusin",w(this,np,p_).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",w(this,ip,g_).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",pn,{signal:e})},rp=new WeakSet,m_=function(){const{editorType:t,_uiManager:e}=h(this,Xs),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",h(ni,mh)[t]),w(this,Vo,ef).call(this,s),s.addEventListener("click",n=>{e.delete()},{signal:e._signal}),h(this,Vr).append(s)},vh=new WeakSet,Lm=function(){const t=document.createElement("div");return t.className="divider",t},b(ni,sp),b(ni,mh,null);let Nm=ni;var yh,$r,jr,ap,v_,op,y_,lp,b_;class v1{constructor(t){b(this,ap);b(this,op);b(this,lp);b(this,yh,null);b(this,$r,null);b(this,jr,void 0);_(this,jr,t)}show(t,e,s){const[n,i]=w(this,op,y_).call(this,e,s),{style:a}=h(this,$r)||_(this,$r,w(this,ap,v_).call(this));t.append(h(this,$r)),a.insetInlineEnd=`${100*n}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){h(this,$r).remove()}}yh=new WeakMap,$r=new WeakMap,jr=new WeakMap,ap=new WeakSet,v_=function(){const t=_(this,$r,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",pn,{signal:h(this,jr)._signal});const e=_(this,yh,document.createElement("div"));return e.className="buttons",t.append(e),w(this,lp,b_).call(this),t},op=new WeakSet,y_=function(t,e){let s=0,n=0;for(const i of t){const a=i.y+i.height;if(a<s)continue;const o=i.x+(e?i.width:0);if(a>s){n=o,s=a;continue}e?o>n&&(n=o):o<n&&(n=o)}return[e?1-n:n,s]},lp=new WeakSet,b_=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=h(this,jr)._signal;t.addEventListener("contextmenu",pn,{signal:s}),t.addEventListener("click",()=>{h(this,jr).highlightSelection("floating_button")},{signal:s}),h(this,yh).append(t)};function Mf(r,t,e){for(const s of e)t.addEventListener(s,r[s].bind(r))}var cp;class y1{constructor(){b(this,cp,0)}get id(){return`${QT}${qe(this,cp)._++}`}}cp=new WeakMap;var $o,bh,We,jo,sf;const i0=class i0{constructor(){b(this,jo);b(this,$o,u1());b(this,bh,0);b(this,We,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;n.src=t;const i=n.decode().then(()=>(s.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return At(this,"_isSVGFittingCanvas",i)}async getFromFile(t){const{lastModified:e,name:s,size:n,type:i}=t;return w(this,jo,sf).call(this,`${e}_${s}_${n}_${i}`,t)}async getFromUrl(t){return w(this,jo,sf).call(this,t,t)}async getFromBlob(t,e){const s=await e;return w(this,jo,sf).call(this,t,s)}async getFromId(t){h(this,We)||_(this,We,new Map);const e=h(this,We).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){h(this,We)||_(this,We,new Map);let s=h(this,We).get(t);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const n=new OffscreenCanvas(e.width,e.height);return n.getContext("2d").drawImage(e,0,0),s={bitmap:n.transferToImageBitmap(),id:`image_${h(this,$o)}_${qe(this,bh)._++}`,refCounter:1,isSvg:!1},h(this,We).set(t,s),h(this,We).set(s.id,s),s}getSvgUrl(t){const e=h(this,We).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var n;h(this,We)||_(this,We,new Map);const e=h(this,We).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}(n=s.close)==null||n.call(s),e.bitmap=null}isValidId(t){return t.startsWith(`image_${h(this,$o)}_`)}};$o=new WeakMap,bh=new WeakMap,We=new WeakMap,jo=new WeakSet,sf=async function(t,e){h(this,We)||_(this,We,new Map);let s=h(this,We).get(t);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${h(this,$o)}_${qe(this,bh)._++}`,refCounter:0,isSvg:!1});let n;if(typeof e=="string"?(s.url=e,n=await Hg(e,"blob")):e instanceof File?n=s.file=e:e instanceof Blob&&(n=e),n.type==="image/svg+xml"){const i=i0._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((c,u)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,c()},a.onload=async()=>{const d=s.svgUrl=a.result;o.src=await i?`${d}#svgView(preserveAspectRatio(none))`:d},o.onerror=a.onerror=u});a.readAsDataURL(n),await l}else s.bitmap=await createImageBitmap(n);s.refCounter=1}catch(n){ft(n),s=null}return h(this,We).set(t,s),s&&h(this,We).set(s.id,s),s};let Fm=i0;var le,zi,_h,Jt;class b1{constructor(t=128){b(this,le,[]);b(this,zi,!1);b(this,_h,void 0);b(this,Jt,-1);_(this,_h,t)}add({cmd:t,undo:e,post:s,mustExec:n,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(n&&t(),h(this,zi))return;const l={cmd:t,undo:e,post:s,type:i};if(h(this,Jt)===-1){h(this,le).length>0&&(h(this,le).length=0),_(this,Jt,0),h(this,le).push(l);return}if(a&&h(this,le)[h(this,Jt)].type===i){o&&(l.undo=h(this,le)[h(this,Jt)].undo),h(this,le)[h(this,Jt)]=l;return}const c=h(this,Jt)+1;c===h(this,_h)?h(this,le).splice(0,1):(_(this,Jt,c),c<h(this,le).length&&h(this,le).splice(c)),h(this,le).push(l)}undo(){if(h(this,Jt)===-1)return;_(this,zi,!0);const{undo:t,post:e}=h(this,le)[h(this,Jt)];t(),e==null||e(),_(this,zi,!1),_(this,Jt,h(this,Jt)-1)}redo(){if(h(this,Jt)<h(this,le).length-1){_(this,Jt,h(this,Jt)+1),_(this,zi,!0);const{cmd:t,post:e}=h(this,le)[h(this,Jt)];t(),e==null||e(),_(this,zi,!1)}}hasSomethingToUndo(){return h(this,Jt)!==-1}hasSomethingToRedo(){return h(this,Jt)<h(this,le).length-1}cleanType(t){if(h(this,Jt)!==-1){for(let e=h(this,Jt);e>=0;e--)if(h(this,le)[e].type!==t){h(this,le).splice(e+1,h(this,Jt)-e),_(this,Jt,e);return}h(this,le).length=0,_(this,Jt,-1)}}destroy(){_(this,le,null)}}le=new WeakMap,zi=new WeakMap,_h=new WeakMap,Jt=new WeakMap;var hp,__;class Ad{constructor(t){b(this,hp);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ns.platform;for(const[s,n,i={}]of t)for(const a of s){const o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:n,options:i}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:n,options:i}),this.allKeys.add(a.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(w(this,hp,__).call(this,e));if(!s)return;const{callback:n,options:{bubbles:i=!1,args:a=[],checker:o=null}}=s;o&&!o(t,e)||(n.bind(t,...a,e)(),i||hn(e))}}hp=new WeakSet,__=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const up=class up{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return m1(t),At(this,"_colors",t)}convert(t){const e=hy(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,n]of this._colors)if(n.every((i,a)=>i===e[a]))return up._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?lt.makeHexColor(...e):t}};at(up,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Bm=up;var Uo,ms,_e,ke,Wo,ri,Ho,Ms,Gi,Ur,zo,Wr,wn,Ys,Hr,Ah,wh,Go,Sh,Sn,Xi,Xo,Yi,Tn,dp,Ki,Th,qi,zr,Ch,Eh,Te,Nt,ai,Gr,xh,Ih,Zi,Cn,oi,Rh,ks,Yo,nf,Ph,Vm,fp,A_,pp,w_,Ko,rf,gp,S_,mp,T_,vp,C_,Oh,$m,yp,E_,Mh,jm,kh,Um,bp,x_,De,Ze,Ks,ti,_p,I_,Ap,R_,Dh,Wm,wp,P_,Xr,Mc,Nh,Hm;const Ro=class Ro{constructor(t,e,s,n,i,a,o,l,c,u,d,f){b(this,Yo);b(this,Ph);b(this,fp);b(this,pp);b(this,Ko);b(this,gp);b(this,mp);b(this,vp);b(this,Oh);b(this,yp);b(this,Mh);b(this,kh);b(this,bp);b(this,De);b(this,Ks);b(this,_p);b(this,Ap);b(this,Dh);b(this,wp);b(this,Xr);b(this,Nh);b(this,Uo,new AbortController);b(this,ms,null);b(this,_e,new Map);b(this,ke,new Map);b(this,Wo,null);b(this,ri,null);b(this,Ho,null);b(this,Ms,new b1);b(this,Gi,null);b(this,Ur,null);b(this,zo,0);b(this,Wr,new Set);b(this,wn,null);b(this,Ys,null);b(this,Hr,new Set);at(this,"_editorUndoBar",null);b(this,Ah,!1);b(this,wh,!1);b(this,Go,!1);b(this,Sh,null);b(this,Sn,null);b(this,Xi,null);b(this,Xo,null);b(this,Yi,!1);b(this,Tn,null);b(this,dp,new y1);b(this,Ki,!1);b(this,Th,!1);b(this,qi,null);b(this,zr,null);b(this,Ch,null);b(this,Eh,null);b(this,Te,gt.NONE);b(this,Nt,new Set);b(this,ai,null);b(this,Gr,null);b(this,xh,null);b(this,Ih,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});b(this,Zi,[0,0]);b(this,Cn,null);b(this,oi,null);b(this,Rh,null);b(this,ks,null);const p=this._signal=h(this,Uo).signal;_(this,oi,t),_(this,Rh,e),_(this,Wo,s),this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:p}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:p}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:p}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:p}),n._on("setpreference",this.onSetPreference.bind(this),{signal:p}),n._on("switchannotationeditorparams",g=>this.updateParams(g.type,g.value),{signal:p}),w(this,gp,S_).call(this),w(this,bp,x_).call(this),w(this,Oh,$m).call(this),_(this,ri,i.annotationStorage),_(this,Sh,i.filterFactory),_(this,Gr,a),_(this,Xo,o||null),_(this,Ah,l),_(this,wh,c),_(this,Go,u),_(this,Eh,d||null),this.viewParameters={realScale:Cr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null}static get _keyboardManager(){const t=Ro.prototype,e=a=>h(a,oi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},n=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return At(this,"_keyboardManager",new Ad([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&h(a,oi).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&h(a,oi).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}]]))}destroy(){var t,e,s,n,i;(t=h(this,ks))==null||t.resolve(),_(this,ks,null),(e=h(this,Uo))==null||e.abort(),_(this,Uo,null),this._signal=null;for(const a of h(this,ke).values())a.destroy();h(this,ke).clear(),h(this,_e).clear(),h(this,Hr).clear(),_(this,ms,null),h(this,Nt).clear(),h(this,Ms).destroy(),(s=h(this,Wo))==null||s.destroy(),(n=h(this,Tn))==null||n.hide(),_(this,Tn,null),h(this,Sn)&&(clearTimeout(h(this,Sn)),_(this,Sn,null)),h(this,Cn)&&(clearTimeout(h(this,Cn)),_(this,Cn,null)),(i=this._editorUndoBar)==null||i.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return h(this,Eh)}get useNewAltTextFlow(){return h(this,wh)}get useNewAltTextWhenAddingImage(){return h(this,Go)}get hcmFilter(){return At(this,"hcmFilter",h(this,Gr)?h(this,Sh).addHCMFilter(h(this,Gr).foreground,h(this,Gr).background):"none")}get direction(){return At(this,"direction",getComputedStyle(h(this,oi)).direction)}get highlightColors(){return At(this,"highlightColors",h(this,Xo)?new Map(h(this,Xo).split(",").map(t=>t.split("=").map(e=>e.trim()))):null)}get highlightColorNames(){return At(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),_(this,Ur,t)}setMainHighlightColorPicker(t){_(this,Ch,t)}editAltText(t,e=!1){var s;(s=h(this,Wo))==null||s.editAltText(this,t,e)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":_(this,Go,e);break}}onPageChanging({pageNumber:t}){_(this,zo,t-1)}focusMainContainer(){h(this,oi).focus()}findParent(t,e){for(const s of h(this,ke).values()){const{x:n,y:i,width:a,height:o}=s.div.getBoundingClientRect();if(t>=n&&t<=n+a&&e>=i&&e<=i+o)return s}return null}disableUserSelect(t=!1){h(this,Rh).classList.toggle("noUserSelect",t)}addShouldRescale(t){h(this,Hr).add(t)}removeShouldRescale(t){h(this,Hr).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*Cr.PDF_TO_CSS_UNITS;for(const s of h(this,Hr))s.onScaleChanging();(e=h(this,Ur))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:s,anchorOffset:n,focusNode:i,focusOffset:a}=e,o=e.toString(),c=w(this,Yo,nf).call(this,e).closest(".textLayer"),u=this.getSelectionBoxes(c);if(!u)return;e.empty();const d=w(this,Ph,Vm).call(this,c),f=h(this,Te)===gt.NONE,p=()=>{d==null||d.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:u,anchorNode:s,anchorOffset:n,focusNode:i,focusOffset:a,text:o}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(gt.HIGHLIGHT,p);return}p()}addToAnnotationStorage(t){!t.isEmpty()&&h(this,ri)&&!h(this,ri).has(t.id)&&h(this,ri).setValue(t.id,t)}blur(){if(this.isShiftKeyDown=!1,h(this,Yi)&&(_(this,Yi,!1),w(this,Ko,rf).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of h(this,Nt))if(e.div.contains(t)){_(this,zr,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!h(this,zr))return;const[t,e]=h(this,zr);_(this,zr,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){w(this,Oh,$m).call(this),w(this,Mh,jm).call(this)}removeEditListeners(){w(this,yp,E_).call(this),w(this,kh,Um).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of h(this,Ys))if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of h(this,Ys))if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var s;if(t.preventDefault(),(s=h(this,ms))==null||s.commitOrRemove(),!this.hasSelection)return;const e=[];for(const n of h(this,Nt)){const i=n.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const i of e.items)for(const a of h(this,Ys))if(a.isHandlingMimeForPasting(i.type)){a.paste(i,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(i){ft(`paste: "${i.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const n=this.currentLayer;try{const i=[];for(const l of s){const c=await n.deserialize(l);if(!c)return;i.push(c)}const a=()=>{for(const l of i)w(this,Dh,Wm).call(this,l);w(this,Nh,Hm).call(this,i)},o=()=>{for(const l of i)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(i){ft(`paste: "${i.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),h(this,Te)!==gt.NONE&&!this.isEditorHandlingKeyboard&&Ro._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,h(this,Yi)&&(_(this,Yi,!1),w(this,Ko,rf).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(w(this,mp,T_).call(this),w(this,Mh,jm).call(this),w(this,De,Ze).call(this,{isEditing:h(this,Te)!==gt.NONE,isEmpty:w(this,Xr,Mc).call(this),hasSomethingToUndo:h(this,Ms).hasSomethingToUndo(),hasSomethingToRedo:h(this,Ms).hasSomethingToRedo(),hasSelectedEditor:!1})):(w(this,vp,C_).call(this),w(this,kh,Um).call(this),w(this,De,Ze).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!h(this,Ys)){_(this,Ys,t);for(const e of h(this,Ys))w(this,Ks,ti).call(this,e.defaultPropertiesToUpdate)}}getId(){return h(this,dp).id}get currentLayer(){return h(this,ke).get(h(this,zo))}getLayer(t){return h(this,ke).get(t)}get currentPageIndex(){return h(this,zo)}addLayer(t){h(this,ke).set(t.pageIndex,t),h(this,Ki)?t.enable():t.disable()}removeLayer(t){h(this,ke).delete(t.pageIndex)}async updateMode(t,e=null,s=!1){var n;if(h(this,Te)!==t&&!(h(this,ks)&&(await h(this,ks).promise,!h(this,ks)))){if(_(this,ks,Promise.withResolvers()),_(this,Te,t),t===gt.NONE){this.setEditingState(!1),w(this,Ap,R_).call(this),(n=this._editorUndoBar)==null||n.hide(),h(this,ks).resolve();return}this.setEditingState(!0),await w(this,_p,I_).call(this),this.unselectAll();for(const i of h(this,ke).values())i.updateMode(t);if(!e){s&&this.addNewEditorFromKeyboard(),h(this,ks).resolve();return}for(const i of h(this,_e).values())i.annotationElementId===e?(this.setSelected(i),i.enterInEditMode()):i.unselect();h(this,ks).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==h(this,Te)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){var s;if(h(this,Ys)){switch(t){case Tt.CREATE:this.currentLayer.addNewEditor();return;case Tt.HIGHLIGHT_DEFAULT_COLOR:(s=h(this,Ch))==null||s.updateColor(e);break;case Tt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(h(this,xh)||_(this,xh,new Map)).set(t,e),this.showAllEditors("highlight",e);break}for(const n of h(this,Nt))n.updateParams(t,e);for(const n of h(this,Ys))n.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){var i;for(const a of h(this,_e).values())a.editorType===t&&a.show(e);(((i=h(this,xh))==null?void 0:i.get(Tt.HIGHLIGHT_SHOW_ALL))??!0)!==e&&w(this,Ks,ti).call(this,[[Tt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(h(this,Th)!==t){_(this,Th,t);for(const e of h(this,ke).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const s of h(this,_e).values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return h(this,_e).get(t)}addEditor(t){h(this,_e).set(t.id,t)}removeEditor(t){var e;t.div.contains(document.activeElement)&&(h(this,Sn)&&clearTimeout(h(this,Sn)),_(this,Sn,setTimeout(()=>{this.focusMainContainer(),_(this,Sn,null)},0))),h(this,_e).delete(t.id),this.unselect(t),(!t.annotationElementId||!h(this,Wr).has(t.annotationElementId))&&((e=h(this,ri))==null||e.remove(t.id))}addDeletedAnnotationElement(t){h(this,Wr).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return h(this,Wr).has(t)}removeDeletedAnnotationElement(t){h(this,Wr).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){h(this,ms)!==t&&(_(this,ms,t),t&&w(this,Ks,ti).call(this,t.propertiesToUpdate))}updateUI(t){h(this,wp,P_)===t&&w(this,Ks,ti).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){w(this,Ks,ti).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(h(this,Nt).has(t)){h(this,Nt).delete(t),t.unselect(),w(this,De,Ze).call(this,{hasSelectedEditor:this.hasSelection});return}h(this,Nt).add(t),t.select(),w(this,Ks,ti).call(this,t.propertiesToUpdate),w(this,De,Ze).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;(e=h(this,Ur))==null||e.commitOrRemove();for(const s of h(this,Nt))s!==t&&s.unselect();h(this,Nt).clear(),h(this,Nt).add(t),t.select(),w(this,Ks,ti).call(this,t.propertiesToUpdate),w(this,De,Ze).call(this,{hasSelectedEditor:!0})}isSelected(t){return h(this,Nt).has(t)}get firstSelectedEditor(){return h(this,Nt).values().next().value}unselect(t){t.unselect(),h(this,Nt).delete(t),w(this,De,Ze).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return h(this,Nt).size!==0}get isEnterHandled(){return h(this,Nt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;h(this,Ms).undo(),w(this,De,Ze).call(this,{hasSomethingToUndo:h(this,Ms).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:w(this,Xr,Mc).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){h(this,Ms).redo(),w(this,De,Ze).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:h(this,Ms).hasSomethingToRedo(),isEmpty:w(this,Xr,Mc).call(this)})}addCommands(t){h(this,Ms).add(t),w(this,De,Ze).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:w(this,Xr,Mc).call(this)})}cleanUndoStack(t){h(this,Ms).cleanType(t)}delete(){var i;this.commitOrRemove();const t=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...h(this,Nt)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(n,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},n=()=>{for(const a of e)w(this,Dh,Wm).call(this,a)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){var t;(t=h(this,ms))==null||t.commitOrRemove()}hasSomethingToControl(){return h(this,ms)||this.hasSelection}selectAll(){for(const t of h(this,Nt))t.commit();w(this,Nh,Hm).call(this,h(this,_e).values())}unselectAll(){var t;if(!(h(this,ms)&&(h(this,ms).commitOrRemove(),h(this,Te)!==gt.NONE))&&!((t=h(this,Ur))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of h(this,Nt))e.unselect();h(this,Nt).clear(),w(this,De,Ze).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;h(this,Zi)[0]+=t,h(this,Zi)[1]+=e;const[n,i]=h(this,Zi),a=[...h(this,Nt)],o=1e3;h(this,Cn)&&clearTimeout(h(this,Cn)),_(this,Cn,setTimeout(()=>{_(this,Cn,null),h(this,Zi)[0]=h(this,Zi)[1]=0,this.addCommands({cmd:()=>{for(const l of a)h(this,_e).has(l.id)&&l.translateInPage(n,i)},undo:()=>{for(const l of a)h(this,_e).has(l.id)&&l.translateInPage(-n,-i)},mustExec:!1})},o));for(const l of a)l.translateInPage(t,e)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),_(this,wn,new Map);for(const t of h(this,Nt))h(this,wn).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!h(this,wn))return!1;this.disableUserSelect(!1);const t=h(this,wn);_(this,wn,null);let e=!1;for(const[{x:n,y:i,pageIndex:a},o]of t)o.newX=n,o.newY=i,o.newPageIndex=a,e||(e=n!==o.savedX||i!==o.savedY||a!==o.savedPageIndex);if(!e)return!1;const s=(n,i,a,o)=>{if(h(this,_e).has(n.id)){const l=h(this,ke).get(o);l?n._setParentAndPosition(l,i,a):(n.pageIndex=o,n.x=i,n.y=a)}};return this.addCommands({cmd:()=>{for(const[n,{newX:i,newY:a,newPageIndex:o}]of t)s(n,i,a,o)},undo:()=>{for(const[n,{savedX:i,savedY:a,savedPageIndex:o}]of t)s(n,i,a,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(h(this,wn))for(const s of h(this,wn).keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||h(this,Nt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return h(this,ms)===t}getActive(){return h(this,ms)}getMode(){return h(this,Te)}get imageManager(){return At(this,"imageManager",new Fm)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,u=e.rangeCount;c<u;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:n,width:i,height:a}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(c,u,d,f)=>({x:(u-n)/a,y:1-(c+d-s)/i,width:f/a,height:d/i});break;case"180":o=(c,u,d,f)=>({x:1-(c+d-s)/i,y:1-(u+f-n)/a,width:d/i,height:f/a});break;case"270":o=(c,u,d,f)=>({x:1-(u+f-n)/a,y:(c-s)/i,width:f/a,height:d/i});break;default:o=(c,u,d,f)=>({x:(c-s)/i,y:(u-n)/a,width:d/i,height:f/a});break}const l=[];for(let c=0,u=e.rangeCount;c<u;c++){const d=e.getRangeAt(c);if(!d.collapsed)for(const{x:f,y:p,width:g,height:m}of d.getClientRects())g===0||m===0||l.push(o(f,p,g,m))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(h(this,Ho)||_(this,Ho,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=h(this,Ho))==null||e.delete(t)}renderAnnotationElement(t){var n;const e=(n=h(this,Ho))==null?void 0:n.get(t.data.id);if(!e)return;const s=h(this,ri).getRawValue(e);s&&(h(this,Te)===gt.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}};Uo=new WeakMap,ms=new WeakMap,_e=new WeakMap,ke=new WeakMap,Wo=new WeakMap,ri=new WeakMap,Ho=new WeakMap,Ms=new WeakMap,Gi=new WeakMap,Ur=new WeakMap,zo=new WeakMap,Wr=new WeakMap,wn=new WeakMap,Ys=new WeakMap,Hr=new WeakMap,Ah=new WeakMap,wh=new WeakMap,Go=new WeakMap,Sh=new WeakMap,Sn=new WeakMap,Xi=new WeakMap,Xo=new WeakMap,Yi=new WeakMap,Tn=new WeakMap,dp=new WeakMap,Ki=new WeakMap,Th=new WeakMap,qi=new WeakMap,zr=new WeakMap,Ch=new WeakMap,Eh=new WeakMap,Te=new WeakMap,Nt=new WeakMap,ai=new WeakMap,Gr=new WeakMap,xh=new WeakMap,Ih=new WeakMap,Zi=new WeakMap,Cn=new WeakMap,oi=new WeakMap,Rh=new WeakMap,ks=new WeakMap,Yo=new WeakSet,nf=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},Ph=new WeakSet,Vm=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of h(this,ke).values())if(s.hasTextLayer(t))return s;return null},fp=new WeakSet,A_=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=w(this,Yo,nf).call(this,t).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(h(this,Tn)||_(this,Tn,new v1(this)),h(this,Tn).show(s,n,this.direction==="ltr"))},pp=new WeakSet,w_=function(){var i,a,o;const t=document.getSelection();if(!t||t.isCollapsed){h(this,ai)&&((i=h(this,Tn))==null||i.hide(),_(this,ai,null),w(this,De,Ze).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===h(this,ai))return;const n=w(this,Yo,nf).call(this,t).closest(".textLayer");if(!n){h(this,ai)&&((a=h(this,Tn))==null||a.hide(),_(this,ai,null),w(this,De,Ze).call(this,{hasSelectedText:!1}));return}if((o=h(this,Tn))==null||o.hide(),_(this,ai,e),w(this,De,Ze).call(this,{hasSelectedText:!0}),!(h(this,Te)!==gt.HIGHLIGHT&&h(this,Te)!==gt.NONE)&&(h(this,Te)===gt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(this,Yi,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=h(this,Te)===gt.HIGHLIGHT?w(this,Ph,Vm).call(this,n):null;l==null||l.toggleDrawing();const c=new AbortController,u=this.combinedSignal(c),d=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&w(this,Ko,rf).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("blur",d,{signal:u})}},Ko=new WeakSet,rf=function(t=""){h(this,Te)===gt.HIGHLIGHT?this.highlightSelection(t):h(this,Ah)&&w(this,fp,A_).call(this)},gp=new WeakSet,S_=function(){document.addEventListener("selectionchange",w(this,pp,w_).bind(this),{signal:this._signal})},mp=new WeakSet,T_=function(){if(h(this,Xi))return;_(this,Xi,new AbortController);const t=this.combinedSignal(h(this,Xi));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},vp=new WeakSet,C_=function(){var t;(t=h(this,Xi))==null||t.abort(),_(this,Xi,null)},Oh=new WeakSet,$m=function(){if(h(this,qi))return;_(this,qi,new AbortController);const t=this.combinedSignal(h(this,qi));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},yp=new WeakSet,E_=function(){var t;(t=h(this,qi))==null||t.abort(),_(this,qi,null)},Mh=new WeakSet,jm=function(){if(h(this,Gi))return;_(this,Gi,new AbortController);const t=this.combinedSignal(h(this,Gi));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},kh=new WeakSet,Um=function(){var t;(t=h(this,Gi))==null||t.abort(),_(this,Gi,null)},bp=new WeakSet,x_=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},De=new WeakSet,Ze=function(t){Object.entries(t).some(([s,n])=>h(this,Ih)[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(h(this,Ih),t)}),h(this,Te)===gt.HIGHLIGHT&&t.hasSelectedEditor===!1&&w(this,Ks,ti).call(this,[[Tt.HIGHLIGHT_FREE,!0]]))},Ks=new WeakSet,ti=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},_p=new WeakSet,I_=async function(){if(!h(this,Ki)){_(this,Ki,!0);const t=[];for(const e of h(this,ke).values())t.push(e.enable());await Promise.all(t);for(const e of h(this,_e).values())e.enable()}},Ap=new WeakSet,R_=function(){if(this.unselectAll(),h(this,Ki)){_(this,Ki,!1);for(const t of h(this,ke).values())t.disable();for(const t of h(this,_e).values())t.disable()}},Dh=new WeakSet,Wm=function(t){const e=h(this,ke).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},wp=new WeakSet,P_=function(){let t=null;for(t of h(this,Nt));return t},Xr=new WeakSet,Mc=function(){if(h(this,_e).size===0)return!0;if(h(this,_e).size===1)for(const t of h(this,_e).values())return t.isEmpty();return!1},Nh=new WeakSet,Hm=function(t){for(const e of h(this,Nt))e.unselect();h(this,Nt).clear();for(const e of t)e.isEmpty()||(h(this,Nt).add(e),e.select());w(this,De,Ze).call(this,{hasSelectedEditor:this.hasSelection})},at(Ro,"TRANSLATE_SMALL",1),at(Ro,"TRANSLATE_BIG",10);let Za=Ro;var Ce,En,qs,qo,xn,vs,Zo,In,ls,li,Yr,Rn,Qi,Kr,kc,Qo,af;const Qe=class Qe{constructor(t){b(this,Kr);b(this,Qo);b(this,Ce,null);b(this,En,!1);b(this,qs,null);b(this,qo,null);b(this,xn,null);b(this,vs,null);b(this,Zo,!1);b(this,In,null);b(this,ls,null);b(this,li,null);b(this,Yr,null);b(this,Rn,!1);_(this,ls,t),_(this,Rn,t._uiManager.useNewAltTextFlow),h(Qe,Qi)||_(Qe,Qi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){Qe._l10n??(Qe._l10n=t)}async render(){const t=_(this,qs,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=_(this,qo,document.createElement("span"));t.append(e),h(this,Rn)?(t.classList.add("new"),t.setAttribute("data-l10n-id",h(Qe,Qi).missing),e.setAttribute("data-l10n-id",h(Qe,Qi)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=h(this,ls)._uiManager._signal;t.addEventListener("contextmenu",pn,{signal:s}),t.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:s});const n=i=>{i.preventDefault(),h(this,ls)._uiManager.editAltText(h(this,ls)),h(this,Rn)&&h(this,ls)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:h(this,Kr,kc)}})};return t.addEventListener("click",n,{capture:!0,signal:s}),t.addEventListener("keydown",i=>{i.target===t&&i.key==="Enter"&&(_(this,Zo,!0),n(i))},{signal:s}),await w(this,Qo,af).call(this),t}finish(){h(this,qs)&&(h(this,qs).focus({focusVisible:h(this,Zo)}),_(this,Zo,!1))}isEmpty(){return h(this,Rn)?h(this,Ce)===null:!h(this,Ce)&&!h(this,En)}hasData(){return h(this,Rn)?h(this,Ce)!==null||!!h(this,li):this.isEmpty()}get guessedText(){return h(this,li)}async setGuessedText(t){h(this,Ce)===null&&(_(this,li,t),_(this,Yr,await Qe._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),w(this,Qo,af).call(this))}toggleAltTextBadge(t=!1){var e;if(!h(this,Rn)||h(this,Ce)){(e=h(this,In))==null||e.remove(),_(this,In,null);return}if(!h(this,In)){const s=_(this,In,document.createElement("div"));s.className="noAltTextBadge",h(this,ls).div.append(s)}h(this,In).classList.toggle("hidden",!t)}serialize(t){let e=h(this,Ce);return!t&&h(this,li)===e&&(e=h(this,Yr)),{altText:e,decorative:h(this,En),guessedText:h(this,li),textWithDisclaimer:h(this,Yr)}}get data(){return{altText:h(this,Ce),decorative:h(this,En)}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:n,cancel:i=!1}){s&&(_(this,li,s),_(this,Yr,n)),!(h(this,Ce)===t&&h(this,En)===e)&&(i||(_(this,Ce,t),_(this,En,e)),w(this,Qo,af).call(this))}toggle(t=!1){h(this,qs)&&(!t&&h(this,vs)&&(clearTimeout(h(this,vs)),_(this,vs,null)),h(this,qs).disabled=!t)}shown(){h(this,ls)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:h(this,Kr,kc)}})}destroy(){var t,e;(t=h(this,qs))==null||t.remove(),_(this,qs,null),_(this,qo,null),_(this,xn,null),(e=h(this,In))==null||e.remove(),_(this,In,null)}};Ce=new WeakMap,En=new WeakMap,qs=new WeakMap,qo=new WeakMap,xn=new WeakMap,vs=new WeakMap,Zo=new WeakMap,In=new WeakMap,ls=new WeakMap,li=new WeakMap,Yr=new WeakMap,Rn=new WeakMap,Qi=new WeakMap,Kr=new WeakSet,kc=function(){return h(this,Ce)&&"added"||h(this,Ce)===null&&this.guessedText&&"review"||"missing"},Qo=new WeakSet,af=async function(){var n,i,a;const t=h(this,qs);if(!t)return;if(h(this,Rn)){if(t.classList.toggle("done",!!h(this,Ce)),t.setAttribute("data-l10n-id",h(Qe,Qi)[h(this,Kr,kc)]),(n=h(this,qo))==null||n.setAttribute("data-l10n-id",h(Qe,Qi)[`${h(this,Kr,kc)}-label`]),!h(this,Ce)){(i=h(this,xn))==null||i.remove();return}}else{if(!h(this,Ce)&&!h(this,En)){t.classList.remove("done"),(a=h(this,xn))==null||a.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=h(this,xn);if(!e){_(this,xn,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${h(this,ls).id}`;const o=100,l=h(this,ls)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(h(this,vs)),_(this,vs,null)},{once:!0}),t.addEventListener("mouseenter",()=>{_(this,vs,setTimeout(()=>{_(this,vs,null),h(this,xn).classList.add("show"),h(this,ls)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),t.addEventListener("mouseleave",()=>{var c;h(this,vs)&&(clearTimeout(h(this,vs)),_(this,vs,null)),(c=h(this,xn))==null||c.classList.remove("show")},{signal:l})}h(this,En)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=h(this,Ce)),e.parentNode||t.append(e);const s=h(this,ls).getImageForAltText();s==null||s.setAttribute("aria-describedby",e.id)},b(Qe,Qi,null),at(Qe,"_l10n",null);let kf=Qe;var qr,Zs,te,Jo,Ji,Lh,Zr,Ne,Qr,tr,er,Fh,Jr,Ds,Bh,ta,ci,Pn,tl,el,Ns,Vh,Sp,$h,zm,jh,Gm,Uh,Xm,Tp,O_,Cp,M_,Wh,Ym,Hh,Km,zh,qm,Gh,Zm,Ep,k_,Xh,Qm,xp,D_,Ip,N_,Rp,L_,Yh,Jm,ea,Dc;const kt=class kt{constructor(t){b(this,$h);b(this,Uh);b(this,Tp);b(this,Cp);b(this,Wh);b(this,Hh);b(this,zh);b(this,Gh);b(this,Ep);b(this,Xh);b(this,xp);b(this,Ip);b(this,Rp);b(this,Yh);b(this,ea);b(this,qr,null);b(this,Zs,null);b(this,te,null);b(this,Jo,!1);b(this,Ji,null);b(this,Lh,"");b(this,Zr,!1);b(this,Ne,null);b(this,Qr,null);b(this,tr,null);b(this,er,null);b(this,Fh,"");b(this,Jr,!1);b(this,Ds,null);b(this,Bh,!1);b(this,ta,!1);b(this,ci,!1);b(this,Pn,null);b(this,tl,0);b(this,el,0);b(this,Ns,null);at(this,"_editToolbar",null);at(this,"_initialOptions",Object.create(null));at(this,"_initialData",null);at(this,"_isVisible",!0);at(this,"_uiManager",null);at(this,"_focusEventsAllowed",!0);b(this,Vh,!1);b(this,Sp,kt._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:n,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,n],this.pageTranslation=[i,a];const[o,l]=this.parentDimensions;this.x=t.x/o,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=kt.prototype._resizeWithKeyboard,e=Za.TRANSLATE_SMALL,s=Za.TRANSLATE_BIG;return At(this,"_resizerKeyboardManager",new Ad([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],kt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return At(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new _1({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(kt._l10n??(kt._l10n=t),kt._l10nResizer||(kt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),kt._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);kt._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Ft("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return h(this,Vh)}set _isDraggable(t){var e;_(this,Vh,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=h(this,Sp)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):w(this,ea,Dc).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(h(this,Jr)?_(this,Jr,!1):this.parent.setSelected(this))}focusout(t){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,n){const[i,a]=this.parentDimensions;[s,n]=this.screenToPageTranslation(s,n),this.x=(t+s)/i,this.y=(e+n)/a,this.fixAndSetPosition()}translate(t,e){w(this,$h,zm).call(this,this.parentDimensions,t,e)}translateInPage(t,e){h(this,Ds)||_(this,Ds,[this.x,this.y,this.width,this.height]),w(this,$h,zm).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){h(this,Ds)||_(this,Ds,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[n,i]}=this;if(this.x+=t/n,this.y+=e/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,c]=this.getBaseTranslation();a+=l,o+=c;const{style:u}=s;u.left=`${(100*a).toFixed(2)}%`,u.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!h(this,Ds)&&(h(this,Ds)[0]!==this.x||h(this,Ds)[1]!==this.y)}get _hasBeenResized(){return!!h(this,Ds)&&(h(this,Ds)[2]!==this.width||h(this,Ds)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=kt,n=s/t,i=s/e;switch(this.rotation){case 90:return[-n,i];case 180:return[n,i];case 270:return[n,-i];default:return[-n,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,n]}=this;let{x:i,y:a,width:o,height:l}=this;if(o*=s,l*=n,i*=s,a*=n,this._mustFixPosition)switch(t){case 0:i=Math.max(0,Math.min(s-o,i)),a=Math.max(0,Math.min(n-l,a));break;case 90:i=Math.max(0,Math.min(s-l,i)),a=Math.min(n,Math.max(o,a));break;case 180:i=Math.min(s,Math.max(o,i)),a=Math.min(n,Math.max(l,a));break;case 270:i=Math.min(s,Math.max(l,i)),a=Math.max(0,Math.min(n-o,a));break}this.x=i/=s,this.y=a/=n;const[c,u]=this.getBaseTranslation();i+=c,a+=u,e.left=`${(100*i).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var s;return w(s=kt,jh,Gm).call(s,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var s;return w(s=kt,jh,Gm).call(s,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,n]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*t/s).toFixed(2)}%`,h(this,Zr)||(i.height=`${(100*e/n).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,n=s.endsWith("%"),i=!h(this,Zr)&&e.endsWith("%");if(n&&i)return;const[a,o]=this.parentDimensions;n||(t.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!h(this,Zr)&&!i&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}_onResizing(){}altTextFinish(){var t;(t=h(this,te))==null||t.finish()}async addEditToolbar(){return this._editToolbar||h(this,ta)?this._editToolbar:(this._editToolbar=new Nm(this),this.div.append(this._editToolbar.render()),h(this,te)&&await this._editToolbar.addAltText(h(this,te)),this._editToolbar)}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=h(this,te))==null||t.destroy())}addContainer(t){var s;const e=(s=this._editToolbar)==null?void 0:s.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){h(this,te)||(kf.initialize(kt._l10n),_(this,te,new kf(this)),h(this,qr)&&(h(this,te).data=h(this,qr),_(this,qr,null)),await this.addEditToolbar())}get altTextData(){var t;return(t=h(this,te))==null?void 0:t.data}set altTextData(t){h(this,te)&&(h(this,te).data=t)}get guessedAltText(){var t;return(t=h(this,te))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=h(this,te))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=h(this,te))==null?void 0:e.serialize(t)}hasAltText(){return!!h(this,te)&&!h(this,te).isEmpty()}hasAltTextData(){var t;return((t=h(this,te))==null?void 0:t.hasData())??!1}render(){var i;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=h(this,Jo)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),w(this,Xh,Qm).call(this);const[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);const[s,n]=this.getInitialTranslation();return this.translate(s,n),Mf(this,this.div,["pointerdown"]),(i=this._uiManager._editorUndoBar)==null||i.hide(),this.div}pointerdown(t){const{isMac:e}=ns.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(_(this,Jr,!0),this._isDraggable){w(this,Ep,k_).call(this,t);return}w(this,Gh,Zm).call(this,t)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){h(this,Pn)&&clearTimeout(h(this,Pn)),_(this,Pn,setTimeout(()=>{var t;_(this,Pn,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const n=this.parentScale,[i,a]=this.pageDimensions,[o,l]=this.pageTranslation,c=t/n,u=e/n,d=this.x*i,f=this.y*a,p=this.width*i,g=this.height*a;switch(s){case 0:return[d+c+o,a-f-u-g+l,d+c+p+o,a-f-u+l];case 90:return[d+u+o,a-f+c+l,d+u+g+o,a-f+c+p+l];case 180:return[d-c-p+o,a-f+u+l,d-c+o,a-f+u+g+l];case 270:return[d-u-g+o,a-f-c-p+l,d-u+o,a-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,n,i,a]=t,o=i-s,l=a-n;switch(this.rotation){case 0:return[s,e-a,o,l];case 90:return[s,e-n,l,o];case 180:return[i,e-n,o,l];case 270:return[i,e-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){_(this,ta,!0)}disableEditMode(){_(this,ta,!1)}isInEditMode(){return h(this,ta)}shouldGetKeyboardEvents(){return h(this,ci)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:n}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return e<a&&n>0&&t<i&&s>0}rebuild(){w(this,Xh,Qm).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){Ft("An editor must be serializable")}static async deserialize(t,e,s){const n=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});n.rotation=t.rotation,_(n,qr,t.accessibilityData);const[i,a]=n.pageDimensions,[o,l,c,u]=n.getRectInCurrentCoords(t.rect,a);return n.x=o/i,n.y=l/a,n.width=c/i,n.height=u/a,n}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t;if((t=h(this,er))==null||t.abort(),_(this,er,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),h(this,Pn)&&(clearTimeout(h(this,Pn)),_(this,Pn,null)),w(this,ea,Dc).call(this),this.removeEditToolbar(),h(this,Ns)){for(const e of h(this,Ns).values())clearTimeout(e);_(this,Ns,null)}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(w(this,Tp,O_).call(this),h(this,Ne).classList.remove("hidden"),Mf(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),_(this,tr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=h(this,Ne).children;if(!h(this,Zs)){_(this,Zs,Array.from(e));const a=w(this,xp,D_).bind(this),o=w(this,Ip,N_).bind(this),l=this._uiManager._signal;for(const c of h(this,Zs)){const u=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",a,{signal:l}),c.addEventListener("blur",o,{signal:l}),c.addEventListener("focus",w(this,Rp,L_).bind(this,u),{signal:l}),c.setAttribute("data-l10n-id",kt._l10nResizer[u])}}const s=h(this,Zs)[0];let n=0;for(const a of e){if(a===s)break;n++}const i=(360-this.rotation+this.parentRotation)%360/90*(h(this,Zs).length/4);if(i!==n){if(i<n)for(let o=0;o<n-i;o++)h(this,Ne).append(h(this,Ne).firstChild);else if(i>n)for(let o=0;o<i-n;o++)h(this,Ne).firstChild.before(h(this,Ne).lastChild);let a=0;for(const o of e){const c=h(this,Zs)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",kt._l10nResizer[c])}}w(this,Yh,Jm).call(this,0),_(this,ci,!0),h(this,Ne).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){h(this,ci)&&w(this,zh,qm).call(this,h(this,Fh),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){w(this,ea,Dc).call(this),this.div.focus()}select(){var t,e,s;if(this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var n,i;(n=this.div)!=null&&n.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(e=this._editToolbar)==null||e.show(),(s=h(this,te))==null||s.toggleAltTextBadge(!1)}unselect(){var t,e,s,n,i;(t=h(this,Ne))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(n=this._editToolbar)==null||n.hide(),(i=h(this,te))==null||i.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return h(this,Bh)}set isEditing(t){_(this,Bh,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){_(this,Zr,!0);const s=t/e,{style:n}=this.div;n.aspectRatio=s,n.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){h(this,Ns)||_(this,Ns,new Map);const{action:s}=t;let n=h(this,Ns).get(s);n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(t),h(this,Ns).delete(s),h(this,Ns).size===0&&_(this,Ns,null)},kt._telemetryTimeout),h(this,Ns).set(s,n);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),_(this,Jo,!1)}disable(){this.div&&(this.div.tabIndex=-1),_(this,Jo,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};qr=new WeakMap,Zs=new WeakMap,te=new WeakMap,Jo=new WeakMap,Ji=new WeakMap,Lh=new WeakMap,Zr=new WeakMap,Ne=new WeakMap,Qr=new WeakMap,tr=new WeakMap,er=new WeakMap,Fh=new WeakMap,Jr=new WeakMap,Ds=new WeakMap,Bh=new WeakMap,ta=new WeakMap,ci=new WeakMap,Pn=new WeakMap,tl=new WeakMap,el=new WeakMap,Ns=new WeakMap,Vh=new WeakMap,Sp=new WeakMap,$h=new WeakSet,zm=function([t,e],s,n){[s,n]=this.screenToPageTranslation(s,n),this.x+=s/t,this.y+=n/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},jh=new WeakSet,Gm=function(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Uh=new WeakSet,Xm=function(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}},Tp=new WeakSet,O_=function(){if(h(this,Ne))return;_(this,Ne,document.createElement("div")),h(this,Ne).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const n=document.createElement("div");h(this,Ne).append(n),n.classList.add("resizer",s),n.setAttribute("data-resizer-name",s),n.addEventListener("pointerdown",w(this,Cp,M_).bind(this,s),{signal:e}),n.addEventListener("contextmenu",pn,{signal:e}),n.tabIndex=-1}this.div.prepend(h(this,Ne))},Cp=new WeakSet,M_=function(t,e){var u;e.preventDefault();const{isMac:s}=ns.platform;if(e.button!==0||e.ctrlKey&&s)return;(u=h(this,te))==null||u.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,_(this,Qr,[e.screenX,e.screenY]);const i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",w(this,zh,qm).bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",hn,{passive:!1,signal:a}),window.addEventListener("contextmenu",pn,{signal:a}),_(this,tr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{var d;i.abort(),this.parent.togglePointerEvents(!0),(d=h(this,te))==null||d.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=o,this.div.style.cursor=l,w(this,Hh,Km).call(this)};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})},Wh=new WeakSet,Ym=function(t,e,s,n){this.width=s,this.height=n,this.x=t,this.y=e;const[i,a]=this.parentDimensions;this.setDims(i*s,a*n),this.fixAndSetPosition(),this._onResized()},Hh=new WeakSet,Km=function(){if(!h(this,tr))return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:n}=h(this,tr);_(this,tr,null);const i=this.x,a=this.y,o=this.width,l=this.height;i===t&&a===e&&o===s&&l===n||this.addCommands({cmd:w(this,Wh,Ym).bind(this,i,a,o,l),undo:w(this,Wh,Ym).bind(this,t,e,s,n),mustExec:!0})},zh=new WeakSet,qm=function(t,e){const[s,n]=this.parentDimensions,i=this.x,a=this.y,o=this.width,l=this.height,c=kt.MIN_SIZE/s,u=kt.MIN_SIZE/n,d=D=>Math.round(D*1e4)/1e4,f=w(this,Uh,Xm).call(this,this.rotation),p=(D,$)=>[f[0]*D+f[2]*$,f[1]*D+f[3]*$],g=w(this,Uh,Xm).call(this,360-this.rotation),m=(D,$)=>[g[0]*D+g[2]*$,g[1]*D+g[3]*$];let v,y,S=!1,T=!1;switch(t){case"topLeft":S=!0,v=(D,$)=>[0,0],y=(D,$)=>[D,$];break;case"topMiddle":v=(D,$)=>[D/2,0],y=(D,$)=>[D/2,$];break;case"topRight":S=!0,v=(D,$)=>[D,0],y=(D,$)=>[0,$];break;case"middleRight":T=!0,v=(D,$)=>[D,$/2],y=(D,$)=>[0,$/2];break;case"bottomRight":S=!0,v=(D,$)=>[D,$],y=(D,$)=>[0,0];break;case"bottomMiddle":v=(D,$)=>[D/2,$],y=(D,$)=>[D/2,0];break;case"bottomLeft":S=!0,v=(D,$)=>[0,$],y=(D,$)=>[D,0];break;case"middleLeft":T=!0,v=(D,$)=>[0,$/2],y=(D,$)=>[D,$/2];break}const E=v(o,l),A=y(o,l);let C=p(...A);const x=d(i+C[0]),I=d(a+C[1]);let R=1,O=1,P,M;if(e.fromKeyboard)({deltaX:P,deltaY:M}=e);else{const{screenX:D,screenY:$}=e,[H,Y]=h(this,Qr);[P,M]=this.screenToPageTranslation(D-H,$-Y),h(this,Qr)[0]=D,h(this,Qr)[1]=$}if([P,M]=m(P/s,M/n),S){const D=Math.hypot(o,l);R=O=Math.max(Math.min(Math.hypot(A[0]-E[0]-P,A[1]-E[1]-M)/D,1/o,1/l),c/o,u/l)}else T?R=Math.max(c,Math.min(1,Math.abs(A[0]-E[0]-P)))/o:O=Math.max(u,Math.min(1,Math.abs(A[1]-E[1]-M)))/l;const B=d(o*R),F=d(l*O);C=p(...y(B,F));const W=x-C[0],j=I-C[1];h(this,Ds)||_(this,Ds,[this.x,this.y,this.width,this.height]),this.width=B,this.height=F,this.x=W,this.y=j,this.setDims(s*B,n*F),this.fixAndSetPosition(),this._onResizing()},Gh=new WeakSet,Zm=function(t){const{isMac:e}=ns.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},Ep=new WeakSet,k_=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();const s=new AbortController,n=this._uiManager.combinedSignal(s),i={capture:!0,passive:!1,signal:n},a=l=>{s.abort(),_(this,Ji,null),_(this,Jr,!1),this._uiManager.endDragSession()||w(this,Gh,Zm).call(this,l)};e&&(_(this,tl,t.clientX),_(this,el,t.clientY),_(this,Ji,t.pointerId),_(this,Lh,t.pointerType),window.addEventListener("pointermove",l=>{const{clientX:c,clientY:u,pointerId:d}=l;if(d!==h(this,Ji)){hn(l);return}const[f,p]=this.screenToPageTranslation(c-h(this,tl),u-h(this,el));_(this,tl,c),_(this,el,u),this._uiManager.dragSelectedEditors(f,p)},i),window.addEventListener("touchmove",hn,i),window.addEventListener("pointerdown",l=>{l.isPrimary&&l.pointerType===h(this,Lh)&&a(l),hn(l)},i)),this._onStartDragging();const o=l=>{if(!h(this,Ji)||h(this,Ji)===l.pointerId){a(l),this._onStopDragging();return}hn(l)};window.addEventListener("pointerup",o,{signal:n}),window.addEventListener("blur",o,{signal:n})},Xh=new WeakSet,Qm=function(){if(h(this,er)||!this.div)return;_(this,er,new AbortController);const t=this._uiManager.combinedSignal(h(this,er));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},xp=new WeakSet,D_=function(t){kt._resizerKeyboardManager.exec(this,t)},Ip=new WeakSet,N_=function(t){var e;h(this,ci)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==h(this,Ne)&&w(this,ea,Dc).call(this)},Rp=new WeakSet,L_=function(t){_(this,Fh,h(this,ci)?t:"")},Yh=new WeakSet,Jm=function(t){if(h(this,Zs))for(const e of h(this,Zs))e.tabIndex=t},ea=new WeakSet,Dc=function(){_(this,ci,!1),w(this,Yh,Jm).call(this,-1),w(this,Hh,Km).call(this)},b(kt,jh),at(kt,"_l10n",null),at(kt,"_l10nResizer",null),at(kt,"_borderLineWidth",-1),at(kt,"_colorManager",new Bm),at(kt,"_zIndex",1),at(kt,"_telemetryTimeout",1e3);let ne=kt;class _1 extends ne{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ab=3285377520,Is=4294901760,_n=65535;class F_{constructor(t){this.h1=t?t&4294967295:ab,this.h2=t?t&4294967295:ab}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let m=0,v=t.length;m<v;m++){const y=t.charCodeAt(m);y<=255?e[s++]=y:(e[s++]=y>>>8,e[s++]=y&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const n=s>>2,i=s-n*4,a=new Uint32Array(e.buffer,0,n);let o=0,l=0,c=this.h1,u=this.h2;const d=3432918353,f=461845907,p=d&_n,g=f&_n;for(let m=0;m<n;m++)m&1?(o=a[m],o=o*d&Is|o*p&_n,o=o<<15|o>>>17,o=o*f&Is|o*g&_n,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(l=a[m],l=l*d&Is|l*p&_n,l=l<<15|l>>>17,l=l*f&Is|l*g&_n,u^=l,u=u<<13|u>>>19,u=u*5+3864292196);switch(o=0,i){case 3:o^=e[n*4+2]<<16;case 2:o^=e[n*4+1]<<8;case 1:o^=e[n*4],o=o*d&Is|o*p&_n,o=o<<15|o>>>17,o=o*f&Is|o*g&_n,n&1?c^=o:u^=o}this.h1=c,this.h2=u}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Is|t*36045&_n,e=e*4283543511&Is|((e<<16|t>>>16)*2950163797&Is)>>>16,t^=e>>>1,t=t*444984403&Is|t*60499&_n,e=e*3301882366&Is|((e<<16|t>>>16)*3120437893&Is)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const tv=Object.freeze({map:null,hash:"",transfer:void 0});var sa,na,Ee,Pp,B_;class uy{constructor(){b(this,Pp);b(this,sa,!1);b(this,na,null);b(this,Ee,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=h(this,Ee).get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return h(this,Ee).get(t)}remove(t){if(h(this,Ee).delete(t),h(this,Ee).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of h(this,Ee).values())if(e instanceof ne)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=h(this,Ee).get(t);let n=!1;if(s!==void 0)for(const[i,a]of Object.entries(e))s[i]!==a&&(n=!0,s[i]=a);else n=!0,h(this,Ee).set(t,e);n&&w(this,Pp,B_).call(this),e instanceof ne&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return h(this,Ee).has(t)}getAll(){return h(this,Ee).size>0?ry(h(this,Ee)):null}setAll(t){for(const[e,s]of Object.entries(t))this.setValue(e,s)}get size(){return h(this,Ee).size}resetModified(){h(this,sa)&&(_(this,sa,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new V_(this)}get serializable(){if(h(this,Ee).size===0)return tv;const t=new Map,e=new F_,s=[],n=Object.create(null);let i=!1;for(const[a,o]of h(this,Ee)){const l=o instanceof ne?o.serialize(!1,n):o;l&&(t.set(a,l),e.update(`${a}:${JSON.stringify(l)}`),i||(i=!!l.bitmap))}if(i)for(const a of t.values())a.bitmap&&s.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:tv}get editorStats(){let t=null;const e=new Map;for(const s of h(this,Ee).values()){if(!(s instanceof ne))continue;const n=s.telemetryFinalData;if(!n)continue;const{type:i}=n;e.has(i)||e.set(i,Object.getPrototypeOf(s).constructor),t||(t=Object.create(null));const a=t[i]||(t[i]=new Map);for(const[o,l]of Object.entries(n)){if(o==="type")continue;let c=a.get(o);c||(c=new Map,a.set(o,c));const u=c.get(l)??0;c.set(l,u+1)}}for(const[s,n]of e)t[s]=n.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){_(this,na,null)}get modifiedIds(){if(h(this,na))return h(this,na);const t=[];for(const e of h(this,Ee).values())!(e instanceof ne)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return _(this,na,{ids:new Set(t),hash:t.join(",")})}}sa=new WeakMap,na=new WeakMap,Ee=new WeakMap,Pp=new WeakSet,B_=function(){h(this,sa)||(_(this,sa,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Kh;class V_ extends uy{constructor(e){super();b(this,Kh,void 0);const{map:s,hash:n,transfer:i}=e.serializable,a=structuredClone(s,i?{transfer:i}:null);_(this,Kh,{map:a,hash:n,transfer:i})}get print(){Ft("Should not call PrintAnnotationStorage.print")}get serializable(){return h(this,Kh)}get modifiedIds(){return At(this,"modifiedIds",{ids:new Set,hash:""})}}Kh=new WeakMap;var sl;class A1{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){b(this,sl,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),h(this,sl).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(!(!t||h(this,sl).has(t.loadedName))){if(me(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:n,style:i}=t,a=new FontFace(s,n,i);this.addNativeFontFace(a);try{await a.load(),h(this,sl).add(s),e==null||e(t)}catch{ft(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Ft("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(n){throw ft(`Failed to load font '${s.family}': '${n}'.`),t.disableFontFace=!0,n}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const n=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,n)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return At(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(Ye||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),At(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(me(!n.done,"completeRequest() cannot be called twice."),n.done=!0;s.length>0&&s[0].done;){const i=s.shift();setTimeout(i.callback,0)}}const{loadingRequests:s}=this,n={done:!1,complete:e,callback:t};return s.push(n),n}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return At(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(E,A){return E.charCodeAt(A)<<24|E.charCodeAt(A+1)<<16|E.charCodeAt(A+2)<<8|E.charCodeAt(A+3)&255}function n(E,A,C,x){const I=E.substring(0,A),R=E.substring(A+C);return I+x+R}let i,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let c=0;function u(E,A){if(++c>30){ft("Load test font never loaded."),A();return}if(l.font="30px "+E,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){A();return}setTimeout(u.bind(null,E,A))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=n(f,976,d.length,d);const g=16,m=1482184792;let v=s(f,g);for(i=0,a=d.length-3;i<a;i+=4)v=v-m+s(d,i)|0;i<d.length&&(v=v-m+s(d+"XXX",i)|0),f=n(f,g,4,a1(v));const y=`url(data:font/opentype;base64,${btoa(f)});`,S=`@font-face {font-family:"${d}";src:${y}}`;this.insertRule(S);const T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(const E of[t.loadedName,d]){const A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=E,T.append(A)}this._document.body.append(T),u(d,()=>{T.remove(),e.complete()})}}sl=new WeakMap;class w1{constructor(t,{disableFontFace:e=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const n in t)this[n]=t[n];this.disableFontFace=e===!0,this._inspectFont=s}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${d1(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${t}}`}return(s=this._inspectFont)==null||s.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let s;try{s=t.get(this.loadedName+"_path_"+e)}catch(i){ft(`getPathGenerator - ignoring character: "${i}".`)}if(!Array.isArray(s)||s.length===0)return this.compiledGlyphs[e]=function(i,a){};const n=[];for(let i=0,a=s.length;i<a;)switch(s[i++]){case qn.BEZIER_CURVE_TO:{const[o,l,c,u,d,f]=s.slice(i,i+6);n.push(p=>p.bezierCurveTo(o,l,c,u,d,f)),i+=6}break;case qn.MOVE_TO:{const[o,l]=s.slice(i,i+2);n.push(c=>c.moveTo(o,l)),i+=2}break;case qn.LINE_TO:{const[o,l]=s.slice(i,i+2);n.push(c=>c.lineTo(o,l)),i+=2}break;case qn.QUADRATIC_CURVE_TO:{const[o,l,c,u]=s.slice(i,i+4);n.push(d=>d.quadraticCurveTo(o,l,c,u)),i+=4}break;case qn.RESTORE:n.push(o=>o.restore());break;case qn.SAVE:n.push(o=>o.save());break;case qn.SCALE:me(n.length===2,"Scale command is only valid at the third position.");break;case qn.TRANSFORM:{const[o,l,c,u,d,f]=s.slice(i,i+6);n.push(p=>p.transform(o,l,c,u,d,f)),i+=6}break;case qn.TRANSLATE:{const[o,l]=s.slice(i,i+2);n.push(c=>c.translate(o,l)),i+=2}break}return n.push(i=>i.closePath()),this.compiledGlyphs[e]=function(a,o){n[0](a),n[1](a),a.scale(o,-o);for(let l=2,c=n.length;l<c;l++)n[l](a)}}}var qh;class $_{constructor({enableHWA:t=!1}){b(this,qh,!1);_(this,qh,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!h(this,qh)})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Ft("Abstract method `_createCanvas` called.")}}qh=new WeakMap;class S1 extends $_{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class j_{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Ft("Abstract method `_fetch` called.")}}class U_ extends j_{async _fetch(t){const e=await Hg(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):Wg(e)}}xt(4520);class W_{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,n,i){return"none"}destroy(t=!1){}}var ia,nl,hi,ui,He,ra,aa,xe,je,oa,Nc,sr,vo,il,of,nr,yo,Op,H_,Zh,ev,ir,bo,la,Lc,ca,Fc,Qh,sv,ha,Bc;class T1 extends W_{constructor({docId:e,ownerDocument:s=globalThis.document}){super();b(this,xe);b(this,oa);b(this,sr);b(this,il);b(this,nr);b(this,Op);b(this,Zh);b(this,ir);b(this,la);b(this,ca);b(this,Qh);b(this,ha);b(this,ia,void 0);b(this,nl,void 0);b(this,hi,void 0);b(this,ui,void 0);b(this,He,void 0);b(this,ra,void 0);b(this,aa,0);_(this,ui,e),_(this,He,s)}addFilter(e){if(!e)return"none";let s=h(this,xe,je).get(e);if(s)return s;const[n,i,a]=w(this,il,of).call(this,e),o=e.length===1?n:`${n}${i}${a}`;if(s=h(this,xe,je).get(o),s)return h(this,xe,je).set(e,s),s;const l=`g_${h(this,ui)}_transfer_map_${qe(this,aa)._++}`,c=w(this,nr,yo).call(this,l);h(this,xe,je).set(e,c),h(this,xe,je).set(o,c);const u=w(this,ir,bo).call(this,l);return w(this,ca,Fc).call(this,n,i,a,u),c}addHCMFilter(e,s){var g;const n=`${e}-${s}`,i="base";let a=h(this,oa,Nc).get(i);if((a==null?void 0:a.key)===n||(a?((g=a.filter)==null||g.remove(),a.key=n,a.url="none",a.filter=null):(a={key:n,url:"none",filter:null},h(this,oa,Nc).set(i,a)),!e||!s))return a.url;const o=w(this,ha,Bc).call(this,e);e=lt.makeHexColor(...o);const l=w(this,ha,Bc).call(this,s);if(s=lt.makeHexColor(...l),h(this,sr,vo).style.color="",e==="#000000"&&s==="#ffffff"||e===s)return a.url;const c=new Array(256);for(let m=0;m<=255;m++){const v=m/255;c[m]=v<=.03928?v/12.92:((v+.055)/1.055)**2.4}const u=c.join(","),d=`g_${h(this,ui)}_hcm_filter`,f=a.filter=w(this,ir,bo).call(this,d);w(this,ca,Fc).call(this,u,u,u,f),w(this,Zh,ev).call(this,f);const p=(m,v)=>{const y=o[m]/255,S=l[m]/255,T=new Array(v+1);for(let E=0;E<=v;E++)T[E]=y+E/v*(S-y);return T.join(",")};return w(this,ca,Fc).call(this,p(0,5),p(1,5),p(2,5),f),a.url=w(this,nr,yo).call(this,d),a.url}addAlphaFilter(e){let s=h(this,xe,je).get(e);if(s)return s;const[n]=w(this,il,of).call(this,[e]),i=`alpha_${n}`;if(s=h(this,xe,je).get(i),s)return h(this,xe,je).set(e,s),s;const a=`g_${h(this,ui)}_alpha_map_${qe(this,aa)._++}`,o=w(this,nr,yo).call(this,a);h(this,xe,je).set(e,o),h(this,xe,je).set(i,o);const l=w(this,ir,bo).call(this,a);return w(this,Qh,sv).call(this,n,l),o}addLuminosityFilter(e){let s=h(this,xe,je).get(e||"luminosity");if(s)return s;let n,i;if(e?([n]=w(this,il,of).call(this,[e]),i=`luminosity_${n}`):i="luminosity",s=h(this,xe,je).get(i),s)return h(this,xe,je).set(e,s),s;const a=`g_${h(this,ui)}_luminosity_map_${qe(this,aa)._++}`,o=w(this,nr,yo).call(this,a);h(this,xe,je).set(e,o),h(this,xe,je).set(i,o);const l=w(this,ir,bo).call(this,a);return w(this,Op,H_).call(this,l),e&&w(this,Qh,sv).call(this,n,l),o}addHighlightHCMFilter(e,s,n,i,a){var S;const o=`${s}-${n}-${i}-${a}`;let l=h(this,oa,Nc).get(e);if((l==null?void 0:l.key)===o||(l?((S=l.filter)==null||S.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},h(this,oa,Nc).set(e,l)),!s||!n))return l.url;const[c,u]=[s,n].map(w(this,ha,Bc).bind(this));let d=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[p,g]=[i,a].map(w(this,ha,Bc).bind(this));f<d&&([d,f,p,g]=[f,d,g,p]),h(this,sr,vo).style.color="";const m=(T,E,A)=>{const C=new Array(256),x=(f-d)/A,I=T/255,R=(E-T)/(255*A);let O=0;for(let P=0;P<=A;P++){const M=Math.round(d+P*x),B=I+P*R;for(let F=O;F<=M;F++)C[F]=B;O=M+1}for(let P=O;P<256;P++)C[P]=C[O-1];return C.join(",")},v=`g_${h(this,ui)}_hcm_${e}_filter`,y=l.filter=w(this,ir,bo).call(this,v);return w(this,Zh,ev).call(this,y),w(this,ca,Fc).call(this,m(p[0],g[0],5),m(p[1],g[1],5),m(p[2],g[2],5),y),l.url=w(this,nr,yo).call(this,v),l.url}destroy(e=!1){var s,n,i,a;e&&((s=h(this,ra))!=null&&s.size)||((n=h(this,hi))==null||n.parentNode.parentNode.remove(),_(this,hi,null),(i=h(this,nl))==null||i.clear(),_(this,nl,null),(a=h(this,ra))==null||a.clear(),_(this,ra,null),_(this,aa,0))}}ia=new WeakMap,nl=new WeakMap,hi=new WeakMap,ui=new WeakMap,He=new WeakMap,ra=new WeakMap,aa=new WeakMap,xe=new WeakSet,je=function(){return h(this,nl)||_(this,nl,new Map)},oa=new WeakSet,Nc=function(){return h(this,ra)||_(this,ra,new Map)},sr=new WeakSet,vo=function(){if(!h(this,hi)){const e=h(this,He).createElement("div"),{style:s}=e;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const n=h(this,He).createElementNS(Jn,"svg");n.setAttribute("width",0),n.setAttribute("height",0),_(this,hi,h(this,He).createElementNS(Jn,"defs")),e.append(n),n.append(h(this,hi)),h(this,He).body.append(e)}return h(this,hi)},il=new WeakSet,of=function(e){if(e.length===1){const c=e[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=c[f]/255;const d=u.join(",");return[d,d,d]}const[s,n,i]=e,a=new Array(256),o=new Array(256),l=new Array(256);for(let c=0;c<256;c++)a[c]=s[c]/255,o[c]=n[c]/255,l[c]=i[c]/255;return[a.join(","),o.join(","),l.join(",")]},nr=new WeakSet,yo=function(e){if(h(this,ia)===void 0){_(this,ia,"");const s=h(this,He).URL;s!==h(this,He).baseURI&&(zg(s)?ft('#createUrl: ignore "data:"-URL for performance reasons.'):_(this,ia,s.split("#",1)[0]))}return`url(${h(this,ia)}#${e})`},Op=new WeakSet,H_=function(e){const s=h(this,He).createElementNS(Jn,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(s)},Zh=new WeakSet,ev=function(e){const s=h(this,He).createElementNS(Jn,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(s)},ir=new WeakSet,bo=function(e){const s=h(this,He).createElementNS(Jn,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",e),h(this,sr,vo).append(s),s},la=new WeakSet,Lc=function(e,s,n){const i=h(this,He).createElementNS(Jn,s);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),e.append(i)},ca=new WeakSet,Fc=function(e,s,n,i){const a=h(this,He).createElementNS(Jn,"feComponentTransfer");i.append(a),w(this,la,Lc).call(this,a,"feFuncR",e),w(this,la,Lc).call(this,a,"feFuncG",s),w(this,la,Lc).call(this,a,"feFuncB",n)},Qh=new WeakSet,sv=function(e,s){const n=h(this,He).createElementNS(Jn,"feComponentTransfer");s.append(n),w(this,la,Lc).call(this,n,"feFuncA",e)},ha=new WeakSet,Bc=function(e){return h(this,sr,vo).style.color=e,hy(getComputedStyle(h(this,sr,vo)).getPropertyValue("color"))};class z_{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Ft("Abstract method `_fetch` called.")}}class G_ extends z_{async _fetch(t){const e=await Hg(t,"arraybuffer");return new Uint8Array(e)}}if(Ye){let r;try{const t=process.getBuiltinModule("module").createRequire(import.meta.url);try{r=t("@napi-rs/canvas")}catch(e){ft(`Cannot load "@napi-rs/canvas" package: "${e}".`)}}catch{}globalThis.DOMMatrix||(r!=null&&r.DOMMatrix?globalThis.DOMMatrix=r.DOMMatrix:ft("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(r!=null&&r.ImageData?globalThis.ImageData=r.ImageData:ft("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(r!=null&&r.Path2D?globalThis.Path2D=r.Path2D:ft("Cannot polyfill `Path2D`, rendering may be broken."))}async function X_(r){const e=await process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(e)}class C1 extends W_{}class E1 extends $_{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class x1 extends j_{async _fetch(t){return X_(t)}}class I1 extends z_{async _fetch(t){return X_(t)}}const Xe={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function nv(r,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],e,s),r.clip(n)}class dy{getPattern(){Ft("Abstract method `getPattern` called.")}}class R1 extends dy{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,n){let i;if(n===Xe.STROKE||n===Xe.FILL){const a=e.current.getClippedPathBoundingBox(n,Kt(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,c=e.cachedCanvases.getCanvas("pattern",o,l),u=c.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-a[0],-a[1]),s=lt.transform(s,[1,0,0,1,a[0],a[1]]),u.transform(...e.baseTransform),this.matrix&&u.transform(...this.matrix),nv(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),i=t.createPattern(c.canvas,"no-repeat");const d=new DOMMatrix(s);i.setTransform(d)}else nv(t,this._bbox),i=this._createGradient(t);return i}}function Am(r,t,e,s,n,i,a,o){const l=t.coords,c=t.colors,u=r.data,d=r.width*4;let f;l[e+1]>l[s+1]&&(f=e,e=s,s=f,f=i,i=a,a=f),l[s+1]>l[n+1]&&(f=s,s=n,n=f,f=a,a=o,o=f),l[e+1]>l[s+1]&&(f=e,e=s,s=f,f=i,i=a,a=f);const p=(l[e]+t.offsetX)*t.scaleX,g=(l[e+1]+t.offsetY)*t.scaleY,m=(l[s]+t.offsetX)*t.scaleX,v=(l[s+1]+t.offsetY)*t.scaleY,y=(l[n]+t.offsetX)*t.scaleX,S=(l[n+1]+t.offsetY)*t.scaleY;if(g>=S)return;const T=c[i],E=c[i+1],A=c[i+2],C=c[a],x=c[a+1],I=c[a+2],R=c[o],O=c[o+1],P=c[o+2],M=Math.round(g),B=Math.round(S);let F,W,j,D,$,H,Y,K;for(let nt=M;nt<=B;nt++){if(nt<v){const V=nt<g?0:(g-nt)/(g-v);F=p-(p-m)*V,W=T-(T-C)*V,j=E-(E-x)*V,D=A-(A-I)*V}else{let V;nt>S?V=1:v===S?V=0:V=(v-nt)/(v-S),F=m-(m-y)*V,W=C-(C-R)*V,j=x-(x-O)*V,D=I-(I-P)*V}let ut;nt<g?ut=0:nt>S?ut=1:ut=(g-nt)/(g-S),$=p-(p-y)*ut,H=T-(T-R)*ut,Y=E-(E-O)*ut,K=A-(A-P)*ut;const Rt=Math.round(Math.min(F,$)),ht=Math.round(Math.max(F,$));let U=d*nt+Rt*4;for(let V=Rt;V<=ht;V++)ut=(F-V)/(F-$),ut<0?ut=0:ut>1&&(ut=1),u[U++]=W-(W-H)*ut|0,u[U++]=j-(j-Y)*ut|0,u[U++]=D-(D-K)*ut|0,u[U++]=255}}function P1(r,t,e){const s=t.coords,n=t.colors;let i,a;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(s.length/o)-1,c=o-1;for(i=0;i<l;i++){let u=i*o;for(let d=0;d<c;d++,u++)Am(r,e,s[u],s[u+1],s[u+o],n[u],n[u+1],n[u+o]),Am(r,e,s[u+o+1],s[u+1],s[u+o],n[u+o+1],n[u+1],n[u+o])}break;case"triangles":for(i=0,a=s.length;i<a;i+=3)Am(r,e,s[i],s[i+1],s[i+2],n[i],n[i+1],n[i+2]);break;default:throw new Error("illegal figure")}}class O1 extends dy{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-o,u=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*t[1]*1.1)),3e3),p=c/d,g=u/f,m={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/p,scaleY:1/g},v=d+2*2,y=f+2*2,S=s.getCanvas("mesh",v,y),T=S.context,E=T.createImageData(d,f);if(e){const C=E.data;for(let x=0,I=C.length;x<I;x+=4)C[x]=e[0],C[x+1]=e[1],C[x+2]=e[2],C[x+3]=255}for(const C of this._figures)P1(E,C,m);return T.putImageData(E,2,2),{canvas:S.canvas,offsetX:o-2*p,offsetY:l-2*g,scaleX:p,scaleY:g}}getPattern(t,e,s,n){nv(t,this._bbox);let i;if(n===Xe.SHADING)i=lt.singularValueDecompose2dScale(Kt(t));else if(i=lt.singularValueDecompose2dScale(e.baseTransform),this.matrix){const o=lt.singularValueDecompose2dScale(this.matrix);i=[i[0]*o[0],i[1]*o[1]]}const a=this._createMeshCanvas(i,n===Xe.SHADING?null:this._background,e.cachedCanvases);return n!==Xe.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class M1 extends dy{getPattern(){return"hotpink"}}function k1(r){switch(r[0]){case"RadialAxial":return new R1(r);case"Mesh":return new O1(r);case"Dummy":return new M1}throw new Error(`Unknown IR type: ${r[0]}`)}const ob={COLORED:1,UNCOLORED:2},Mp=class Mp{constructor(t,e,s,n,i){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=s,this.canvasGraphicsFactory=n,this.baseTransform=i}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:n,tilingType:i,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),jg("TilingType: "+i);const u=e[0],d=e[1],f=e[2],p=e[3],g=f-u,m=p-d,v=lt.singularValueDecompose2dScale(this.matrix),y=lt.singularValueDecompose2dScale(this.baseTransform),S=v[0]*y[0],T=v[1]*y[1];let E=g,A=m,C=!1,x=!1;const I=Math.ceil(l*S),R=Math.ceil(c*T),O=Math.ceil(g*S),P=Math.ceil(m*T);I>=O?E=l:C=!0,R>=P?A=c:x=!0;const M=this.getSizeAndScale(E,this.ctx.canvas.width,S),B=this.getSizeAndScale(A,this.ctx.canvas.height,T),F=t.cachedCanvases.getCanvas("pattern",M.size,B.size),W=F.context,j=o.createCanvasGraphics(W);if(j.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(j,n,a),W.translate(-M.scale*u,-B.scale*d),j.transform(M.scale,0,0,B.scale,0,0),W.save(),this.clipBbox(j,u,d,f,p),j.baseTransform=Kt(j.ctx),j.executeOperatorList(s),j.endDrawing(),W.restore(),C||x){const D=F.canvas;C&&(E=l),x&&(A=c);const $=this.getSizeAndScale(E,this.ctx.canvas.width,S),H=this.getSizeAndScale(A,this.ctx.canvas.height,T),Y=$.size,K=H.size,nt=t.cachedCanvases.getCanvas("pattern-workaround",Y,K),ut=nt.context,Rt=C?Math.floor(g/l):0,ht=x?Math.floor(m/c):0;for(let U=0;U<=Rt;U++)for(let V=0;V<=ht;V++)ut.drawImage(D,Y*U,K*V,Y,K,0,0,Y,K);return{canvas:nt.canvas,scaleX:$.scale,scaleY:H.scale,offsetX:u,offsetY:d}}return{canvas:F.canvas,scaleX:M.scale,scaleY:B.scale,offsetX:u,offsetY:d}}getSizeAndScale(t,e,s){const n=Math.max(Mp.MAX_PATTERN_SIZE,e);let i=Math.ceil(t*s);return i>=n?i=n:s=i/t,{scale:s,size:i}}clipBbox(t,e,s,n,i){const a=n-e,o=i-s;t.ctx.rect(e,s,a,o),t.current.updateRectMinMax(Kt(t.ctx),[e,s,n,i]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const n=t.ctx,i=t.current;switch(e){case ob.COLORED:const a=this.ctx;n.fillStyle=a.fillStyle,n.strokeStyle=a.strokeStyle,i.fillColor=a.fillStyle,i.strokeColor=a.strokeStyle;break;case ob.UNCOLORED:const o=lt.makeHexColor(s[0],s[1],s[2]);n.fillStyle=o,n.strokeStyle=o,i.fillColor=o,i.strokeColor=o;break;default:throw new r1(`Unsupported paint type: ${e}`)}}getPattern(t,e,s,n){let i=s;n!==Xe.SHADING&&(i=lt.transform(i,e.baseTransform),this.matrix&&(i=lt.transform(i,this.matrix)));const a=this.createPatternCanvas(e);let o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=t.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};at(Mp,"MAX_PATTERN_SIZE",3e3);let iv=Mp;function D1({src:r,srcPos:t=0,dest:e,width:s,height:n,nonBlackColor:i=4294967295,inverseDecode:a=!1}){const o=ns.isLittleEndian?4278190080:255,[l,c]=a?[i,o]:[o,i],u=s>>3,d=s&7,f=r.length;e=new Uint32Array(e.buffer);let p=0;for(let g=0;g<n;g++){for(const v=t+u;t<v;t++){const y=t<f?r[t]:255;e[p++]=y&128?c:l,e[p++]=y&64?c:l,e[p++]=y&32?c:l,e[p++]=y&16?c:l,e[p++]=y&8?c:l,e[p++]=y&4?c:l,e[p++]=y&2?c:l,e[p++]=y&1?c:l}if(d===0)continue;const m=t<f?r[t++]:255;for(let v=0;v<d;v++)e[p++]=m&1<<7-v?c:l}return{srcPos:t,destPos:p}}const lb=16,cb=100,N1=15,hb=10,ub=1e3,ds=16;function L1(r,t){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){t.save(),this.__originalSave()},r.restore=function(){t.restore(),this.__originalRestore()},r.translate=function(s,n){t.translate(s,n),this.__originalTranslate(s,n)},r.scale=function(s,n){t.scale(s,n),this.__originalScale(s,n)},r.transform=function(s,n,i,a,o,l){t.transform(s,n,i,a,o,l),this.__originalTransform(s,n,i,a,o,l)},r.setTransform=function(s,n,i,a,o,l){t.setTransform(s,n,i,a,o,l),this.__originalSetTransform(s,n,i,a,o,l)},r.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},r.rotate=function(s){t.rotate(s),this.__originalRotate(s)},r.clip=function(s){t.clip(s),this.__originalClip(s)},r.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},r.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},r.bezierCurveTo=function(e,s,n,i,a,o){t.bezierCurveTo(e,s,n,i,a,o),this.__originalBezierCurveTo(e,s,n,i,a,o)},r.rect=function(e,s,n,i){t.rect(e,s,n,i),this.__originalRect(e,s,n,i)},r.closePath=function(){t.closePath(),this.__originalClosePath()},r.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class F1{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let n;return this.cache[t]!==void 0?(n=this.cache[t],this.canvasFactory.reset(n,e,s)):(n=this.canvasFactory.create(e,s),this.cache[t]=n),n}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Ud(r,t,e,s,n,i,a,o,l,c){const[u,d,f,p,g,m]=Kt(r);if(d===0&&f===0){const S=a*u+g,T=Math.round(S),E=o*p+m,A=Math.round(E),C=(a+l)*u+g,x=Math.abs(Math.round(C)-T)||1,I=(o+c)*p+m,R=Math.abs(Math.round(I)-A)||1;return r.setTransform(Math.sign(u),0,0,Math.sign(p),T,A),r.drawImage(t,e,s,n,i,0,0,x,R),r.setTransform(u,d,f,p,g,m),[x,R]}if(u===0&&p===0){const S=o*f+g,T=Math.round(S),E=a*d+m,A=Math.round(E),C=(o+c)*f+g,x=Math.abs(Math.round(C)-T)||1,I=(a+l)*d+m,R=Math.abs(Math.round(I)-A)||1;return r.setTransform(0,Math.sign(d),Math.sign(f),0,T,A),r.drawImage(t,e,s,n,i,0,0,R,x),r.setTransform(u,d,f,p,g,m),[R,x]}r.drawImage(t,e,s,n,i,a,o,l,c);const v=Math.hypot(u,d),y=Math.hypot(f,p);return[v*l,y*c]}function B1(r){const{width:t,height:e}=r;if(t>ub||e>ub)return null;const s=1e3,n=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),i=t+1;let a=new Uint8Array(i*(e+1)),o,l,c;const u=t+7&-8;let d=new Uint8Array(u*e),f=0;for(const y of r.data){let S=128;for(;S>0;)d[f++]=y&S?0:255,S>>=1}let p=0;for(f=0,d[f]!==0&&(a[0]=1,++p),l=1;l<t;l++)d[f]!==d[f+1]&&(a[l]=d[f]?2:1,++p),f++;for(d[f]!==0&&(a[l]=2,++p),o=1;o<e;o++){f=o*u,c=o*i,d[f-u]!==d[f]&&(a[c]=d[f]?1:8,++p);let y=(d[f]?4:0)+(d[f-u]?8:0);for(l=1;l<t;l++)y=(y>>2)+(d[f+1]?4:0)+(d[f-u+1]?8:0),n[y]&&(a[c+l]=n[y],++p),f++;if(d[f-u]!==d[f]&&(a[c+l]=d[f]?2:4,++p),p>s)return null}for(f=u*(e-1),c=o*i,d[f]!==0&&(a[c]=8,++p),l=1;l<t;l++)d[f]!==d[f+1]&&(a[c+l]=d[f]?4:8,++p),f++;if(d[f]!==0&&(a[c+l]=4,++p),p>s)return null;const g=new Int32Array([0,i,-1,0,-i,0,0,0,1]),m=new Path2D;for(o=0;p&&o<=e;o++){let y=o*i;const S=y+t;for(;y<S&&!a[y];)y++;if(y===S)continue;m.moveTo(y%i,o);const T=y;let E=a[y];do{const A=g[E];do y+=A;while(!a[y]);const C=a[y];C!==5&&C!==10?(E=C,a[y]=0):(E=C&51*E>>4,a[y]&=E>>2|E<<2),m.lineTo(y%i,y/i|0),a[y]||--p}while(T!==y);--o}return d=null,a=null,function(y){y.save(),y.scale(1/t,-1/e),y.translate(0,-e),y.fill(m),y.beginPath(),y.restore()}}class db{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=h_,this.textMatrixScale=1,this.fontMatrix=Pm,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=$e.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,s){[e,s]=lt.applyTransform([e,s],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(t,e){const s=lt.applyTransform(e,t),n=lt.applyTransform(e.slice(2),t),i=lt.applyTransform([e[0],e[3]],t),a=lt.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],n[0],i[0],a[0]),this.minY=Math.min(this.minY,s[1],n[1],i[1],a[1]),this.maxX=Math.max(this.maxX,s[0],n[0],i[0],a[0]),this.maxY=Math.max(this.maxY,s[1],n[1],i[1],a[1])}updateScalingPathMinMax(t,e){lt.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,s,n,i,a,o,l,c,u){const d=lt.bezierBoundingBox(e,s,n,i,a,o,l,c,u);u||this.updateRectMinMax(t,d)}getPathBoundingBox(t=Xe.FILL,e=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(t===Xe.STROKE){e||Ft("Stroke bounding box must include transform.");const n=lt.singularValueDecompose2dScale(e),i=n[0]*this.lineWidth/2,a=n[1]*this.lineWidth/2;s[0]-=i,s[1]-=a,s[2]+=i,s[3]+=a}return s}updateClipFromPath(){const t=lt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=Xe.FILL,e=null){return lt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function fb(r,t){if(t instanceof ImageData){r.putImageData(t,0,0);return}const e=t.height,s=t.width,n=e%ds,i=(e-n)/ds,a=n===0?i:i+1,o=r.createImageData(s,ds);let l=0,c;const u=t.data,d=o.data;let f,p,g,m;if(t.kind===Jd.GRAYSCALE_1BPP){const v=u.byteLength,y=new Uint32Array(d.buffer,0,d.byteLength>>2),S=y.length,T=s+7>>3,E=4294967295,A=ns.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(g=f<i?ds:n,c=0,p=0;p<g;p++){const C=v-l;let x=0;const I=C>T?s:C*8-7,R=I&-8;let O=0,P=0;for(;x<R;x+=8)P=u[l++],y[c++]=P&128?E:A,y[c++]=P&64?E:A,y[c++]=P&32?E:A,y[c++]=P&16?E:A,y[c++]=P&8?E:A,y[c++]=P&4?E:A,y[c++]=P&2?E:A,y[c++]=P&1?E:A;for(;x<I;x++)O===0&&(P=u[l++],O=128),y[c++]=P&O?E:A,O>>=1}for(;c<S;)y[c++]=0;r.putImageData(o,0,f*ds)}}else if(t.kind===Jd.RGBA_32BPP){for(p=0,m=s*ds*4,f=0;f<i;f++)d.set(u.subarray(l,l+m)),l+=m,r.putImageData(o,0,p),p+=ds;f<a&&(m=s*n*4,d.set(u.subarray(l,l+m)),r.putImageData(o,0,p))}else if(t.kind===Jd.RGB_24BPP)for(g=ds,m=s*g,f=0;f<a;f++){for(f>=i&&(g=n,m=s*g),c=0,p=m;p--;)d[c++]=u[l++],d[c++]=u[l++],d[c++]=u[l++],d[c++]=255;r.putImageData(o,0,f*ds)}else throw new Error(`bad image kind: ${t.kind}`)}function pb(r,t){if(t.bitmap){r.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,n=e%ds,i=(e-n)/ds,a=n===0?i:i+1,o=r.createImageData(s,ds);let l=0;const c=t.data,u=o.data;for(let d=0;d<a;d++){const f=d<i?ds:n;({srcPos:l}=D1({src:c,srcPos:l,dest:u,width:s,height:f,nonBlackColor:0})),r.putImageData(o,0,d*ds)}}function Ic(r,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)r[s]!==void 0&&(t[s]=r[s]);r.setLineDash!==void 0&&(t.setLineDash(r.getLineDash()),t.lineDashOffset=r.lineDashOffset)}function Wd(r){if(r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0),!Ye){const{filter:t}=r;t!=="none"&&t!==""&&(r.filter="none")}}function gb(r,t){if(t)return!0;const e=lt.singularValueDecompose2dScale(r);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*Cr.PDF_TO_CSS_UNITS);return e[0]<=s&&e[1]<=s}const V1=["butt","round","square"],$1=["miter","round","bevel"],j1={},mb={};var Jh,rv,tu,av;const r0=class r0{constructor(t,e,s,n,i,{optionalContentConfig:a,markedContentStack:o=null},l,c){b(this,Jh);b(this,tu);this.ctx=t,this.current=new db(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=n,this.filterFactory=i,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new F1(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:n=null}){const i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Kt(this.compositeCtx))}this.ctx.save(),Wd(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Kt(this.ctx)}executeOperatorList(t,e,s,n){const i=t.argsArray,a=t.fnArray;let o=e||0;const l=i.length;if(l===o)return o;const c=l-o>hb&&typeof s=="function",u=c?Date.now()+N1:0;let d=0;const f=this.commonObjs,p=this.objs;let g;for(;;){if(n!==void 0&&o===n.nextBreakPoint)return n.breakIt(o,s),o;if(g=a[o],g!==Gs.dependency)this[g].apply(this,i[o]);else for(const m of i[o]){const v=m.startsWith("g_")?f:p;if(!v.has(m))return v.get(m,s),o}if(o++,o===l)return o;if(c&&++d>hb){if(Date.now()>u)return s(),o;d=0}}}endDrawing(){w(this,Jh,rv).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),w(this,tu,av).call(this)}_scaleImage(t,e){const s=t.width??t.displayWidth,n=t.height??t.displayHeight;let i=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=s,l=n,c="prescale1",u,d;for(;i>2&&o>1||a>2&&l>1;){let f=o,p=l;i>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/f),a>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/p),u=this.cachedCanvases.getCanvas(c,f,p),d=u.context,d.clearRect(0,0,f,p),d.drawImage(t,0,0,o,l,0,0,f,p),t=u.canvas,o=f,l=p,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:l}}_createMaskCanvas(t){const e=this.ctx,{width:s,height:n}=t,i=this.current.fillColor,a=this.current.patternFill,o=Kt(e);let l,c,u,d;if((t.bitmap||t.data)&&t.count>1){const I=t.bitmap||t.data.buffer;c=JSON.stringify(a?o:[o.slice(0,4),i]),l=this._cachedBitmapsMap.get(I),l||(l=new Map,this._cachedBitmapsMap.set(I,l));const R=l.get(c);if(R&&!a){const O=Math.round(Math.min(o[0],o[2])+o[4]),P=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:R,offsetX:O,offsetY:P}}u=R}u||(d=this.cachedCanvases.getCanvas("maskCanvas",s,n),pb(d.context,t));let f=lt.transform(o,[1/s,0,0,-1/n,0,0]);f=lt.transform(f,[1,0,0,1,0,-n]);const[p,g,m,v]=lt.getAxialAlignedBoundingBox([0,0,s,n],f),y=Math.round(m-p)||1,S=Math.round(v-g)||1,T=this.cachedCanvases.getCanvas("fillCanvas",y,S),E=T.context,A=p,C=g;E.translate(-A,-C),E.transform(...f),u||(u=this._scaleImage(d.canvas,bn(E)),u=u.img,l&&a&&l.set(c,u)),E.imageSmoothingEnabled=gb(Kt(E),t.interpolate),Ud(E,u,0,0,u.width,u.height,0,0,s,n),E.globalCompositeOperation="source-in";const x=lt.transform(bn(E),[1,0,0,1,-A,-C]);return E.fillStyle=a?i.getPattern(e,this,x,Xe.FILL):i,E.fillRect(0,0,s,n),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,T.canvas)),{canvas:T.canvas,offsetX:Math.round(A),offsetY:Math.round(C)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=V1[t]}setLineJoin(t){this.ctx.lineJoin=$1[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx,this.ctx=n.context;const i=this.ctx;i.setTransform(...Kt(this.suspendedCtx)),Ic(this.suspendedCtx,i),L1(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ic(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,n){const i=n[0],a=n[1],o=n[2]-i,l=n[3]-a;o===0||l===0||(this.genericComposeSMask(e.context,s,o,l,e.subtype,e.backdrop,e.transferMap,i,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,n,i,a,o,l,c,u,d){let f=t.canvas,p=l-u,g=c-d;if(a){const v=lt.makeHexColor(...a);if(p<0||g<0||p+s>f.width||g+n>f.height){const y=this.cachedCanvases.getCanvas("maskExtension",s,n),S=y.context;S.drawImage(f,-p,-g),S.globalCompositeOperation="destination-atop",S.fillStyle=v,S.fillRect(0,0,s,n),S.globalCompositeOperation="source-over",f=y.canvas,p=g=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const y=new Path2D;y.rect(p,g,s,n),t.clip(y),t.globalCompositeOperation="destination-atop",t.fillStyle=v,t.fillRect(p,g,s,n),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),i==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):i==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const m=new Path2D;m.rect(l,c,s,n),e.clip(m),e.globalCompositeOperation="destination-in",e.drawImage(f,p,g,s,n,l,c,s,n),e.restore()}save(){this.inSMaskMode?(Ic(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Ic(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,s,n,i,a){this.ctx.transform(t,e,s,n,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){const n=this.ctx,i=this.current;let a=i.x,o=i.y,l,c;const u=Kt(n),d=u[0]===0&&u[3]===0||u[1]===0&&u[2]===0,f=d?s.slice(0):null;for(let p=0,g=0,m=t.length;p<m;p++)switch(t[p]|0){case Gs.rectangle:a=e[g++],o=e[g++];const v=e[g++],y=e[g++],S=a+v,T=o+y;n.moveTo(a,o),v===0||y===0?n.lineTo(S,T):(n.lineTo(S,o),n.lineTo(S,T),n.lineTo(a,T)),d||i.updateRectMinMax(u,[a,o,S,T]),n.closePath();break;case Gs.moveTo:a=e[g++],o=e[g++],n.moveTo(a,o),d||i.updatePathMinMax(u,a,o);break;case Gs.lineTo:a=e[g++],o=e[g++],n.lineTo(a,o),d||i.updatePathMinMax(u,a,o);break;case Gs.curveTo:l=a,c=o,a=e[g+4],o=e[g+5],n.bezierCurveTo(e[g],e[g+1],e[g+2],e[g+3],a,o),i.updateCurvePathMinMax(u,l,c,e[g],e[g+1],e[g+2],e[g+3],a,o,f),g+=6;break;case Gs.curveTo2:l=a,c=o,n.bezierCurveTo(a,o,e[g],e[g+1],e[g+2],e[g+3]),i.updateCurvePathMinMax(u,l,c,a,o,e[g],e[g+1],e[g+2],e[g+3],f),a=e[g+2],o=e[g+3],g+=4;break;case Gs.curveTo3:l=a,c=o,a=e[g+2],o=e[g+3],n.bezierCurveTo(e[g],e[g+1],a,o,a,o),i.updateCurvePathMinMax(u,l,c,e[g],e[g+1],a,o,a,o,f),g+=4;break;case Gs.closePath:n.closePath();break}d&&i.updateScalingPathMinMax(u,f),i.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(t=!0){const e=this.ctx,s=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(e.save(),e.strokeStyle=s.getPattern(e,this,bn(e),Xe.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){const e=this.ctx,s=this.current.fillColor,n=this.current.patternFill;let i=!1;n&&(e.save(),e.fillStyle=s.getPattern(e,this,bn(e),Xe.FILL),i=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),i&&e.restore(),t&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=j1}eoClip(){this.pendingClip=mb}beginText(){this.current.textMatrix=h_,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}e.save(),e.beginPath();for(const s of t)e.setTransform(...s.transform),e.translate(s.x,s.y),s.addToPath(e,s.fontSize);e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var u;const s=this.commonObjs.get(t),n=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(n.fontMatrix=s.fontMatrix||Pm,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&ft("Invalid font matrix for font "+t),e<0?(e=-e,n.fontDirection=-1):n.fontDirection=1,this.current.font=s,this.current.fontSize=e,s.isType3Font)return;const i=s.loadedName||"sans-serif",a=((u=s.systemFontInfo)==null?void 0:u.css)||`"${i}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let c=e;e<lb?c=lb:e>cb&&(c=cb),this.current.fontSizeScale=e/c,this.ctx.font=`${l} ${o} ${c}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,s,n,i,a){this.current.textMatrix=[t,e,s,n,i,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,s,n,i){const a=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,u=o.fontSize/o.fontSizeScale,d=c&$e.FILL_STROKE_MASK,f=!!(c&$e.ADD_TO_PATH_FLAG),p=o.patternFill&&!l.missingFile,g=o.patternStroke&&!l.missingFile;let m;(l.disableFontFace||f||p||g)&&(m=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||p||g?(a.save(),a.translate(e,s),a.beginPath(),m(a,u),(d===$e.FILL||d===$e.FILL_STROKE)&&(n&&a.setTransform(...n),a.fill()),(d===$e.STROKE||d===$e.FILL_STROKE)&&(i&&a.setTransform(...i),a.stroke()),a.restore()):((d===$e.FILL||d===$e.FILL_STROKE)&&a.fillText(t,e,s),(d===$e.STROKE||d===$e.FILL_STROKE)&&a.strokeText(t,e,s)),f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Kt(a),x:e,y:s,fontSize:u,addToPath:m})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let n=3;n<e.length;n+=4)if(e[n]>0&&e[n]<255){s=!0;break}return At(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);const n=e.fontSize;if(n===0)return;const i=this.ctx,a=e.fontSizeScale,o=e.charSpacing,l=e.wordSpacing,c=e.fontDirection,u=e.textHScale*c,d=t.length,f=s.vertical,p=f?1:-1,g=s.defaultVMetrics,m=n*e.fontMatrix[0],v=e.textRenderingMode===$e.FILL&&!s.disableFontFace&&!e.patternFill;i.save(),i.transform(...e.textMatrix),i.translate(e.x,e.y+e.textRise),c>0?i.scale(u,-1):i.scale(u,1);let y,S;if(e.patternFill){i.save();const x=e.fillColor.getPattern(i,this,bn(i),Xe.FILL);y=Kt(i),i.restore(),i.fillStyle=x}if(e.patternStroke){i.save();const x=e.strokeColor.getPattern(i,this,bn(i),Xe.STROKE);S=Kt(i),i.restore(),i.strokeStyle=x}let T=e.lineWidth;const E=e.textMatrixScale;if(E===0||T===0){const x=e.textRenderingMode&$e.FILL_STROKE_MASK;(x===$e.STROKE||x===$e.FILL_STROKE)&&(T=this.getSinglePixelWidth())}else T/=E;if(a!==1&&(i.scale(a,a),T/=a),i.lineWidth=T,s.isInvalidPDFjsFont){const x=[];let I=0;for(const R of t)x.push(R.unicode),I+=R.width;i.fillText(x.join(""),0,0),e.x+=I*m*u,i.restore(),this.compose();return}let A=0,C;for(C=0;C<d;++C){const x=t[C];if(typeof x=="number"){A+=p*x*n/1e3;continue}let I=!1;const R=(x.isSpace?l:0)+o,O=x.fontChar,P=x.accent;let M,B,F=x.width;if(f){const j=x.vmetric||g,D=-(x.vmetric?j[1]:F*.5)*m,$=j[2]*m;F=j?-j[0]:F,M=D/a,B=(A+$)/a}else M=A/a,B=0;if(s.remeasure&&F>0){const j=i.measureText(O).width*1e3/n*a;if(F<j&&this.isFontSubpixelAAEnabled){const D=F/j;I=!0,i.save(),i.scale(D,1),M/=D}else F!==j&&(M+=(F-j)/2e3*n/a)}if(this.contentVisible&&(x.isInFont||s.missingFile)){if(v&&!P)i.fillText(O,M,B);else if(this.paintChar(O,M,B,y,S),P){const j=M+n*P.offset.x/a,D=B-n*P.offset.y/a;this.paintChar(P.fontChar,j,D,y,S)}}const W=f?F*m-R*c:F*m+R*c;A+=W,I&&i.restore()}f?e.y-=A:e.x+=A*u,i.restore(),this.compose()}showType3Text(t){const e=this.ctx,s=this.current,n=s.font,i=s.fontSize,a=s.fontDirection,o=n.vertical?1:-1,l=s.charSpacing,c=s.wordSpacing,u=s.textHScale*a,d=s.fontMatrix||Pm,f=t.length,p=s.textRenderingMode===$e.INVISIBLE;let g,m,v,y;if(!(p||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...s.textMatrix),e.translate(s.x,s.y),e.scale(u,a),g=0;g<f;++g){if(m=t[g],typeof m=="number"){y=o*m*i/1e3,this.ctx.translate(y,0),s.x+=y*u;continue}const S=(m.isSpace?c:0)+l,T=n.charProcOperatorList[m.operatorListId];if(!T){ft(`Type3 character "${m.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=m,this.save(),e.scale(i,i),e.transform(...d),this.executeOperatorList(T),this.restore()),v=lt.applyTransform([m.width,0],d)[0]*i+S,e.translate(v,0),s.x+=v*u}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,n,i,a){this.ctx.rect(s,n,i-s,a-n),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=t[1],n=this.baseTransform||Kt(this.ctx),i={createCanvasGraphics:a=>new r0(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new iv(t,s,this.ctx,i,n)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=lt.makeHexColor(t,e,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=lt.makeHexColor(t,e,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=k1(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,bn(e),Xe.SHADING);const n=bn(e);if(n){const{width:i,height:a}=e.canvas,[o,l,c,u]=lt.getAxialAlignedBoundingBox([0,0,i,a],n);this.ctx.fillRect(o,l,c-o,u-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){Ft("Should not call beginInlineImage")}beginImageData(){Ft("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Kt(this.ctx),e)){const s=e[2]-e[0],n=e[3]-e[1];this.ctx.rect(e[0],e[1],s,n),this.current.updateRectMinMax(Kt(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||jg("TODO: Support non-isolated groups."),t.knockout&&ft("Knockout groups not supported.");const s=Kt(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let n=lt.getAxialAlignedBoundingBox(t.bbox,Kt(e));const i=[0,0,e.canvas.width,e.canvas.height];n=lt.intersect(n,i)||[0,0,0,0];const a=Math.floor(n[0]),o=Math.floor(n[1]),l=Math.max(Math.ceil(n[2])-a,1),c=Math.max(Math.ceil(n[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,c]);let u="groupAt"+this.groupLevel;t.smask&&(u+="_smask_"+this.smaskCounter++%2);const d=this.cachedCanvases.getCanvas(u,l,c),f=d.context;f.translate(-a,-o),f.transform(...s),t.smask?this.smaskStack.push({canvas:d.canvas,context:f,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),Ic(e,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const n=Kt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...n);const i=lt.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],n);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(t,e,s,n,i){if(w(this,Jh,rv).call(this),Wd(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const a=e[2]-e[0],o=e[3]-e[1];if(i&&this.annotationCanvasMap){s=s.slice(),s[4]-=e[0],s[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o;const[l,c]=lt.singularValueDecompose2dScale(Kt(this.ctx)),{viewportScale:u}=this,d=Math.ceil(a*this.outputScaleX*u),f=Math.ceil(o*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(d,f);const{canvas:p,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,o*c),Wd(this.ctx)}else Wd(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new db(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...n)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),w(this,tu,av).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const s=this.ctx,n=this.processingType3;if(n&&(n.compiled===void 0&&(n.compiled=B1(t)),n.compiled)){n.compiled(s);return}const i=this._createMaskCanvas(t),a=i.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,i.offsetX,i.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,n=0,i,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const l=Kt(o);o.transform(e,s,n,i,0,0);const c=this._createMaskCanvas(t);o.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let u=0,d=a.length;u<d;u+=2){const f=lt.transform(l,[e,s,n,i,a[u],a[u+1]]),[p,g]=lt.applyTransform([0,0],f);o.drawImage(c.canvas,p,g)}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,s=this.current.fillColor,n=this.current.patternFill;for(const i of t){const{data:a,width:o,height:l,transform:c}=i,u=this.cachedCanvases.getCanvas("maskCanvas",o,l),d=u.context;d.save();const f=this.getObject(a,i);pb(d,f),d.globalCompositeOperation="source-in",d.fillStyle=n?s.getPattern(d,this,bn(e),Xe.FILL):s,d.fillRect(0,0,o,l),d.restore(),e.save(),e.transform(...c),e.scale(1,-1),Ud(e,u.canvas,0,0,o,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){ft("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,n){if(!this.contentVisible)return;const i=this.getObject(t);if(!i){ft("Dependent image isn't ready yet");return}const a=i.width,o=i.height,l=[];for(let c=0,u=n.length;c<u;c+=2)l.push({transform:[e,0,0,s,n[c],n[c+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(i,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:n}=t,i=this.cachedCanvases.getCanvas("inlineImage",s,n),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",i.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,s=t.height,n=this.ctx;if(this.save(),!Ye){const{filter:o}=n;o!=="none"&&o!==""&&(n.filter="none")}n.scale(1/e,-1/s);let i;if(t.bitmap)i=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)i=t;else{const l=this.cachedCanvases.getCanvas("inlineImage",e,s).context;fb(l,t),i=this.applyTransferMapsToCanvas(l)}const a=this._scaleImage(i,bn(n));n.imageSmoothingEnabled=gb(Kt(n),t.interpolate),Ud(n,a.img,0,0,a.paintWidth,a.paintHeight,0,-s,e,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx;let n;if(t.bitmap)n=t.bitmap;else{const i=t.width,a=t.height,l=this.cachedCanvases.getCanvas("inlineImage",i,a).context;fb(l,t),n=this.applyTransferMapsToCanvas(l)}for(const i of e)s.save(),s.transform(...i.transform),s.scale(1,-1),Ud(s,n,i.x,i.y,i.w,i.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){const e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const s=this.ctx;this.pendingClip&&(e||(this.pendingClip===mb?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=Kt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),n=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,n)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:n,d:i}=this.ctx.getTransform();let a,o;if(s===0&&n===0){const l=Math.abs(e),c=Math.abs(i);if(l===c)if(t===0)a=o=1/l;else{const u=l*t;a=o=u<1?1/u:1}else if(t===0)a=1/l,o=1/c;else{const u=l*t,d=c*t;a=u<1?1/u:1,o=d<1?1/d:1}}else{const l=Math.abs(e*i-s*n),c=Math.hypot(e,s),u=Math.hypot(n,i);if(t===0)a=u/l,o=c/l;else{const d=t*l;a=u>d?u/d:1,o=c>d?c/d:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t){const{ctx:e}=this,{lineWidth:s}=this.current,[n,i]=this.getScaleForStroking();if(e.lineWidth=s||1,n===1&&i===1){e.stroke();return}const a=e.getLineDash();if(t&&e.save(),e.scale(n,i),a.length>0){const o=Math.max(n,i);e.setLineDash(a.map(l=>l/o)),e.lineDashOffset/=o}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};Jh=new WeakSet,rv=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},tu=new WeakSet,av=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}};let ko=r0;for(const r in Gs)ko.prototype[r]!==void 0&&(ko.prototype[Gs[r]]=ko.prototype[r]);var eu,su;class Pi{static get workerPort(){return h(this,eu)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");_(this,eu,t)}static get workerSrc(){return h(this,su)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");_(this,su,t)}}eu=new WeakMap,su=new WeakMap,b(Pi,eu,null),b(Pi,su,"");const Hd={UNKNOWN:0,DATA:1,ERROR:2},pe={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function vb(){}function Rs(r){switch(r instanceof Error||typeof r=="object"&&r!==null||Ft('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new ao(r.message);case"MissingPDFException":return new bd(r.message);case"PasswordException":return new Om(r.message,r.code);case"UnexpectedResponseException":return new Ug(r.message,r.status);case"UnknownErrorException":return new Mm(r.message,r.details);default:return new Mm(r.message,r.toString())}}var rl,kp,Y_,Dp,K_,Np,q_,al,lf;class Vc{constructor(t,e,s){b(this,kp);b(this,Dp);b(this,Np);b(this,al);b(this,rl,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",w(this,kp,Y_).bind(this),{signal:h(this,rl).signal})}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const n=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[n]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:n,data:e},s)}catch(a){i.reject(a)}return i.promise}sendWithStream(t,e,s,n){const i=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const u=Promise.withResolvers();return this.streamControllers[i]={controller:c,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:t,streamId:i,data:e,desiredSize:c.desiredSize},n),u.promise},pull:c=>{const u=Promise.withResolvers();return this.streamControllers[i].pullCall=u,l.postMessage({sourceName:a,targetName:o,stream:pe.PULL,streamId:i,desiredSize:c.desiredSize}),u.promise},cancel:c=>{me(c instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[i].cancelCall=u,this.streamControllers[i].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:pe.CANCEL,streamId:i,reason:Rs(c)}),u.promise}},s)}destroy(){var t;(t=h(this,rl))==null||t.abort(),_(this,rl,null)}}rl=new WeakMap,kp=new WeakSet,Y_=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){w(this,Np,q_).call(this,t);return}if(t.callback){const s=t.callbackId,n=this.callbackCapabilities[s];if(!n)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===Hd.DATA)n.resolve(t.data);else if(t.callback===Hd.ERROR)n.reject(Rs(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,n=t.sourceName,i=this.comObj;Promise.try(e,t.data).then(function(a){i.postMessage({sourceName:s,targetName:n,callback:Hd.DATA,callbackId:t.callbackId,data:a})},function(a){i.postMessage({sourceName:s,targetName:n,callback:Hd.ERROR,callbackId:t.callbackId,reason:Rs(a)})});return}if(t.streamId){w(this,Dp,K_).call(this,t);return}e(t.data)},Dp=new WeakSet,K_=function(t){const e=t.streamId,s=this.sourceName,n=t.sourceName,i=this.comObj,a=this,o=this.actionHandler[t.action],l={enqueue(c,u=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:s,targetName:n,stream:pe.ENQUEUE,streamId:e,chunk:c},d)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:n,stream:pe.CLOSE,streamId:e}),delete a.streamSinks[e])},error(c){me(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:n,stream:pe.ERROR,streamId:e,reason:Rs(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(o,t.data,l).then(function(){i.postMessage({sourceName:s,targetName:n,stream:pe.START_COMPLETE,streamId:e,success:!0})},function(c){i.postMessage({sourceName:s,targetName:n,stream:pe.START_COMPLETE,streamId:e,reason:Rs(c)})})},Np=new WeakSet,q_=function(t){const e=t.streamId,s=this.sourceName,n=t.sourceName,i=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case pe.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(Rs(t.reason));break;case pe.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(Rs(t.reason));break;case pe.PULL:if(!o){i.postMessage({sourceName:s,targetName:n,stream:pe.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||vb).then(function(){i.postMessage({sourceName:s,targetName:n,stream:pe.PULL_COMPLETE,streamId:e,success:!0})},function(c){i.postMessage({sourceName:s,targetName:n,stream:pe.PULL_COMPLETE,streamId:e,reason:Rs(c)})});break;case pe.ENQUEUE:if(me(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case pe.CLOSE:if(me(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),w(this,al,lf).call(this,a,e);break;case pe.ERROR:me(a,"error should have stream controller"),a.controller.error(Rs(t.reason)),w(this,al,lf).call(this,a,e);break;case pe.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(Rs(t.reason)),w(this,al,lf).call(this,a,e);break;case pe.CANCEL:if(!o)break;const l=Rs(t.reason);Promise.try(o.onCancel||vb,l).then(function(){i.postMessage({sourceName:s,targetName:n,stream:pe.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){i.postMessage({sourceName:s,targetName:n,stream:pe.CANCEL_COMPLETE,streamId:e,reason:Rs(c)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},al=new WeakSet,lf=async function(t,e){var s,n,i;await Promise.allSettled([(s=t.startCall)==null?void 0:s.promise,(n=t.pullCall)==null?void 0:n.promise,(i=t.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[e]};var ua,nu;class U1{constructor({parsedData:t,rawData:e}){b(this,ua,void 0);b(this,nu,void 0);_(this,ua,t),_(this,nu,e)}getRaw(){return h(this,nu)}get(t){return h(this,ua).get(t)??null}getAll(){return ry(h(this,ua))}has(t){return h(this,ua).has(t)}}ua=new WeakMap,nu=new WeakMap;const _o=Symbol("INTERNAL");var iu,ru,au,ol;class W1{constructor(t,{name:e,intent:s,usage:n,rbGroups:i}){b(this,iu,!1);b(this,ru,!1);b(this,au,!1);b(this,ol,!0);_(this,iu,!!(t&Es.DISPLAY)),_(this,ru,!!(t&Es.PRINT)),this.name=e,this.intent=s,this.usage=n,this.rbGroups=i}get visible(){if(h(this,au))return h(this,ol);if(!h(this,ol))return!1;const{print:t,view:e}=this.usage;return h(this,iu)?(e==null?void 0:e.viewState)!=="OFF":h(this,ru)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,s=!1){t!==_o&&Ft("Internal method `_setVisible` called."),_(this,au,s),_(this,ol,e)}}iu=new WeakMap,ru=new WeakMap,au=new WeakMap,ol=new WeakMap;var rr,Lt,ll,cl,ou,ov;class H1{constructor(t,e=Es.DISPLAY){b(this,ou);b(this,rr,null);b(this,Lt,new Map);b(this,ll,null);b(this,cl,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,_(this,cl,t.order);for(const s of t.groups)h(this,Lt).set(s.id,new W1(e,s));if(t.baseState==="OFF")for(const s of h(this,Lt).values())s._setVisible(_o,!1);for(const s of t.on)h(this,Lt).get(s)._setVisible(_o,!0);for(const s of t.off)h(this,Lt).get(s)._setVisible(_o,!1);_(this,ll,this.getHash())}}isVisible(t){if(h(this,Lt).size===0)return!0;if(!t)return jg("Optional content group not defined."),!0;if(t.type==="OCG")return h(this,Lt).has(t.id)?h(this,Lt).get(t.id).visible:(ft(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return w(this,ou,ov).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!h(this,Lt).has(e))return ft(`Optional content group not found: ${e}`),!0;if(h(this,Lt).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!h(this,Lt).has(e))return ft(`Optional content group not found: ${e}`),!0;if(!h(this,Lt).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!h(this,Lt).has(e))return ft(`Optional content group not found: ${e}`),!0;if(!h(this,Lt).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!h(this,Lt).has(e))return ft(`Optional content group not found: ${e}`),!0;if(h(this,Lt).get(e).visible)return!1}return!0}return ft(`Unknown optional content policy ${t.policy}.`),!0}return ft(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){var i;const n=h(this,Lt).get(t);if(!n){ft(`Optional content group not found: ${t}`);return}if(s&&e&&n.rbGroups.length)for(const a of n.rbGroups)for(const o of a)o!==t&&((i=h(this,Lt).get(o))==null||i._setVisible(_o,!1,!0));n._setVisible(_o,!!e,!0),_(this,rr,null)}setOCGState({state:t,preserveRB:e}){let s;for(const n of t){switch(n){case"ON":case"OFF":case"Toggle":s=n;continue}const i=h(this,Lt).get(n);if(i)switch(s){case"ON":this.setVisibility(n,!0,e);break;case"OFF":this.setVisibility(n,!1,e);break;case"Toggle":this.setVisibility(n,!i.visible,e);break}}_(this,rr,null)}get hasInitialVisibility(){return h(this,ll)===null||this.getHash()===h(this,ll)}getOrder(){return h(this,Lt).size?h(this,cl)?h(this,cl).slice():[...h(this,Lt).keys()]:null}getGroups(){return h(this,Lt).size>0?ry(h(this,Lt)):null}getGroup(t){return h(this,Lt).get(t)||null}getHash(){if(h(this,rr)!==null)return h(this,rr);const t=new F_;for(const[e,s]of h(this,Lt))t.update(`${e}:${s.visible}`);return _(this,rr,t.hexdigest())}}rr=new WeakMap,Lt=new WeakMap,ll=new WeakMap,cl=new WeakMap,ou=new WeakSet,ov=function(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let n=1;n<e;n++){const i=t[n];let a;if(Array.isArray(i))a=w(this,ou,ov).call(this,i);else if(h(this,Lt).has(i))a=h(this,Lt).get(i).visible;else return ft(`Optional content group not found: ${i}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class z1{constructor(t,{disableRange:e=!1,disableStream:s=!1}){me(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:n,initialData:i,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(i==null?void 0:i.length)>0){const l=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const n=this._rangeReaders.some(function(i){return i._begin!==t?!1:(i._enqueue(s),!0)});me(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,s,n,i;t.total===void 0?(s=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||s.call(e,{loaded:t.loaded}):(i=(n=this._fullRequestReader)==null?void 0:n.onProgress)==null||i.call(n,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){me(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new G1(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new X1(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeReaders.slice(0))s.cancel(t);this._pdfDataRangeTransport.abort()}}class G1{constructor(t,e,s=!1,n=null){this._stream=t,this._done=s||!1,this._filename=ly(n)?n:null,this._queuedChunks=e||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class X1{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Y1(r){let t=!0,e=s("filename\\*","i").exec(r);if(e){e=e[1];let u=o(e);return u=unescape(u),u=l(u),u=c(u),i(u)}if(e=a(r),e){const u=c(e);return i(u)}if(e=s("filename","i").exec(r),e){e=e[1];let u=o(e);return u=c(u),i(u)}function s(u,d){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function n(u,d){if(u){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(u,{fatal:!0}),p=Wg(d);d=f.decode(p),t=!1}catch{}}return d}function i(u){return t&&/[\x80-\xff]/.test(u)&&(u=n("utf-8",u),t&&(u=n("iso-8859-1",u))),u}function a(u){const d=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(u))!==null;){let[,m,v,y]=f;if(m=parseInt(m,10),m in d){if(m===0)break;continue}d[m]=[v,y]}const g=[];for(let m=0;m<d.length&&m in d;++m){let[v,y]=d[m];y=o(y),v&&(y=unescape(y),m===0&&(y=l(y))),g.push(y)}return g.join("")}function o(u){if(u.startsWith('"')){const d=u.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}u=d.join('"')}return u}function l(u){const d=u.indexOf("'");if(d===-1)return u;const f=u.slice(0,d),g=u.slice(d+1).replace(/^[^']*'/,"");return n(f,g)}function c(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,g){if(p==="q"||p==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,v){return String.fromCharCode(parseInt(v,16))}),n(f,g);try{g=atob(g)}catch{}return n(f,g)})}return""}function Z_(r,t){const e=new Headers;if(!r||!t||typeof t!="object")return e;for(const s in t){const n=t[s];n!==void 0&&e.append(s,n)}return e}function Gg(r){try{return new URL(r).origin}catch{}return null}function Q_({responseHeaders:r,isHttp:t,rangeChunkSize:e,disableRange:s}){const n={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(r.get("Content-Length"),10);return!Number.isInteger(i)||(n.suggestedLength=i,i<=2*e)||s||!t||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function J_(r){const t=r.get("Content-Disposition");if(t){let e=Y1(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(ly(e))return e}return null}function Xg(r,t){return r===404||r===0&&t.startsWith("file:")?new bd('Missing PDF "'+t+'".'):new Ug(`Unexpected server response (${r}) while retrieving PDF "${t}".`,r)}function tA(r){return r===200||r===206}function eA(r,t,e){return{method:"GET",headers:r,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function sA(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(ft(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class yb{constructor(t){at(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Z_(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return me(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new K1(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new q1(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class K1{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),n=e.url;fetch(n,eA(s,this._withCredentials,this._abortController)).then(i=>{if(t._responseOrigin=Gg(i.url),!tA(i.status))throw Xg(i.status,n);this._reader=i.body.getReader(),this._headersCapability.resolve();const a=i.headers,{allowRangeRequests:o,suggestedLength:l}=Q_({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=J_(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ao("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:sA(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class q1{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const n=t.source;this._withCredentials=n.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!n.disableStream,this._abortController=new AbortController;const i=new Headers(t.headers);i.append("Range",`bytes=${e}-${s-1}`);const a=n.url;fetch(a,eA(i,this._withCredentials,this._abortController)).then(o=>{const l=Gg(o.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!tA(o.status))throw Xg(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:sA(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const wm=200,Sm=206;function Z1(r){const t=r.response;return typeof t!="string"?t:Wg(t).buffer}class Q1{constructor({url:t,httpHeaders:e,withCredentials:s}){at(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Z_(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(t,e,s){const n={begin:t,end:e};for(const i in s)n[i]=s[i];return this.request(n)}requestFull(t){return this.request(t)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,n=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[i,a]of this.headers)e.setRequestHeader(i,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),n.expectedStatus=Sm):n.expectedStatus=wm,e.responseType="arraybuffer",t.onError&&(e.onerror=function(i){t.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),n.onHeadersReceived=t.onHeadersReceived,n.onDone=t.onDone,n.onError=t.onError,n.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){var n;const s=this.pendingRequests[t];s&&((n=s.onProgress)==null||n.call(s,e))}onStateChange(t,e){var l,c,u;const s=this.pendingRequests[t];if(!s)return;const n=s.xhr;if(n.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),n.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],n.status===0&&this.isHttp){(l=s.onError)==null||l.call(s,n.status);return}const i=n.status||wm;if(!(i===wm&&s.expectedStatus===Sm)&&i!==s.expectedStatus){(c=s.onError)==null||c.call(s,n.status);return}const o=Z1(n);if(i===Sm){const d=n.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);s.onDone({begin:parseInt(f[1],10),chunk:o})}else o?s.onDone({begin:0,chunk:o}):(u=s.onError)==null||u.call(s,n.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class J1{constructor(t){this._source=t,this._manager=new Q1(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return me(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new tC(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new eC(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class tC{constructor(t,e){this._manager=t;const s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=t.requestFull(s),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Gg(e.responseURL);const s=e.getAllResponseHeaders(),n=new Headers(s?s.trim().split(/[\r\n]+/).map(o=>{const[l,...c]=o.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:a}=Q_({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=J_(n),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Xg(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class eC{constructor(t,e,s){this._manager=t;const n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._requestId=t.requestRange(e,s,n),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=Gg((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=Xg(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const sC=/^[a-z][a-z0-9\-+.]+:/i;function nC(r){if(sC.test(r))return new URL(r);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(r))}class iC{constructor(t){this.source=t,this.url=nC(t.url),me(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return me(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new rC(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new aC(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class rC{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(n=>{this._contentLength=n.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},n=>{n.code==="ENOENT"&&(n=new bd(`Missing PDF "${this._url}".`)),this._storedError=n,this._headersCapability.reject(n)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ao("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class aC{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const n=t.source;this._isStreamingSupported=!n.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const oC=1e5,as=30,lC=.8;var Kb,ar,cs,lu,cu,da,di,hu,uu,fa,hl,ul,or,dl,du,fl,pa,fu,pu,ga,ma,gu,lr,pl,Lp,nA,Fp,iA,mu,lv,gl,cf,vu,cv,Bp,rA,Vp,aA;const ie=class ie{constructor({textContentSource:t,container:e,viewport:s}){b(this,Lp);b(this,Fp);b(this,mu);b(this,ar,Promise.withResolvers());b(this,cs,null);b(this,lu,!1);b(this,cu,!!((Kb=globalThis.FontInspector)!=null&&Kb.enabled));b(this,da,null);b(this,di,null);b(this,hu,0);b(this,uu,0);b(this,fa,null);b(this,hl,null);b(this,ul,0);b(this,or,0);b(this,dl,Object.create(null));b(this,du,[]);b(this,fl,null);b(this,pa,[]);b(this,fu,new WeakMap);b(this,pu,null);var l;if(t instanceof ReadableStream)_(this,fl,t);else if(typeof t=="object")_(this,fl,new ReadableStream({start(c){c.enqueue(t),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');_(this,cs,_(this,hl,e)),_(this,or,s.scale*(globalThis.devicePixelRatio||1)),_(this,ul,s.rotation),_(this,di,{div:null,properties:null,ctx:null});const{pageWidth:n,pageHeight:i,pageX:a,pageY:o}=s.rawDims;_(this,pu,[1,0,0,-1,-a,o+i]),_(this,uu,n),_(this,hu,i),w(l=ie,Bp,rA).call(l),qa(e,s),h(this,ar).promise.finally(()=>{h(ie,pl).delete(this),_(this,di,null),_(this,dl,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ns.platform;return At(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{h(this,fa).read().then(({value:e,done:s})=>{if(s){h(this,ar).resolve();return}h(this,da)??_(this,da,e.lang),Object.assign(h(this,dl),e.styles),w(this,Lp,nA).call(this,e.items),t()},h(this,ar).reject)};return _(this,fa,h(this,fl).getReader()),h(ie,pl).add(this),t(),h(this,ar).promise}update({viewport:t,onBefore:e=null}){var i;const s=t.scale*(globalThis.devicePixelRatio||1),n=t.rotation;if(n!==h(this,ul)&&(e==null||e(),_(this,ul,n),qa(h(this,hl),{rotation:n})),s!==h(this,or)){e==null||e(),_(this,or,s);const a={div:null,properties:null,ctx:w(i=ie,gl,cf).call(i,h(this,da))};for(const o of h(this,pa))a.properties=h(this,fu).get(o),a.div=o,w(this,mu,lv).call(this,a)}}cancel(){var e;const t=new ao("TextLayer task cancelled.");(e=h(this,fa))==null||e.cancel(t).catch(()=>{}),_(this,fa,null),h(this,ar).reject(t)}get textDivs(){return h(this,pa)}get textContentItemsStr(){return h(this,du)}static cleanup(){if(!(h(this,pl).size>0)){h(this,ga).clear();for(const{canvas:t}of h(this,ma).values())t.remove();h(this,ma).clear()}}};ar=new WeakMap,cs=new WeakMap,lu=new WeakMap,cu=new WeakMap,da=new WeakMap,di=new WeakMap,hu=new WeakMap,uu=new WeakMap,fa=new WeakMap,hl=new WeakMap,ul=new WeakMap,or=new WeakMap,dl=new WeakMap,du=new WeakMap,fl=new WeakMap,pa=new WeakMap,fu=new WeakMap,pu=new WeakMap,ga=new WeakMap,ma=new WeakMap,gu=new WeakMap,lr=new WeakMap,pl=new WeakMap,Lp=new WeakSet,nA=function(t){var n,i;if(h(this,lu))return;(i=h(this,di)).ctx??(i.ctx=w(n=ie,gl,cf).call(n,h(this,da)));const e=h(this,pa),s=h(this,du);for(const a of t){if(e.length>oC){ft("Ignoring additional textDivs for performance reasons."),_(this,lu,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=h(this,cs);_(this,cs,document.createElement("span")),h(this,cs).classList.add("markedContent"),a.id!==null&&h(this,cs).setAttribute("id",`${a.id}`),o.append(h(this,cs))}else a.type==="endMarkedContent"&&_(this,cs,h(this,cs).parentNode);continue}s.push(a.str),w(this,Fp,iA).call(this,a)}},Fp=new WeakSet,iA=function(t){var m;const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};h(this,pa).push(e);const n=lt.transform(h(this,pu),t.transform);let i=Math.atan2(n[1],n[0]);const a=h(this,dl)[t.fontName];a.vertical&&(i+=Math.PI/2);let o=h(this,cu)&&a.fontSubstitution||a.fontFamily;o=ie.fontFamilyMap.get(o)||o;const l=Math.hypot(n[2],n[3]),c=l*w(m=ie,Vp,aA).call(m,o,h(this,da));let u,d;i===0?(u=n[4],d=n[5]-c):(u=n[4]+c*Math.sin(i),d=n[5]-c*Math.cos(i));const f="calc(var(--scale-factor)*",p=e.style;h(this,cs)===h(this,hl)?(p.left=`${(100*u/h(this,uu)).toFixed(2)}%`,p.top=`${(100*d/h(this,hu)).toFixed(2)}%`):(p.left=`${f}${u.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(h(ie,lr)*l).toFixed(2)}px)`,p.fontFamily=o,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,h(this,cu)&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),i!==0&&(s.angle=i*(180/Math.PI));let g=!1;if(t.str.length>1)g=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const v=Math.abs(t.transform[0]),y=Math.abs(t.transform[3]);v!==y&&Math.max(v,y)/Math.min(v,y)>1.5&&(g=!0)}if(g&&(s.canvasWidth=a.vertical?t.height:t.width),h(this,fu).set(e,s),h(this,di).div=e,h(this,di).properties=s,w(this,mu,lv).call(this,h(this,di)),s.hasText&&h(this,cs).append(e),s.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),h(this,cs).append(v)}},mu=new WeakSet,lv=function(t){var o;const{div:e,properties:s,ctx:n}=t,{style:i}=e;let a="";if(h(ie,lr)>1&&(a=`scale(${1/h(ie,lr)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=i,{canvasWidth:c,fontSize:u}=s;w(o=ie,vu,cv).call(o,n,u*h(this,or),l);const{width:d}=n.measureText(e.textContent);d>0&&(a=`scaleX(${c*h(this,or)/d}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(i.transform=a)},gl=new WeakSet,cf=function(t=null){let e=h(this,ma).get(t||(t=""));if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),h(this,ma).set(t,e),h(this,gu).set(e,{size:0,family:""})}return e},vu=new WeakSet,cv=function(t,e,s){const n=h(this,gu).get(t);e===n.size&&s===n.family||(t.font=`${e}px ${s}`,n.size=e,n.family=s)},Bp=new WeakSet,rA=function(){if(h(this,lr)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),_(this,lr,t.getBoundingClientRect().height),t.remove()},Vp=new WeakSet,aA=function(t,e){const s=h(this,ga).get(t);if(s)return s;const n=w(this,gl,cf).call(this,e);n.canvas.width=n.canvas.height=as,w(this,vu,cv).call(this,n,as,t);const i=n.measureText("");let a=i.fontBoundingBoxAscent,o=Math.abs(i.fontBoundingBoxDescent);if(a){const u=a/(a+o);return h(this,ga).set(t,u),n.canvas.width=n.canvas.height=0,u}n.strokeStyle="red",n.clearRect(0,0,as,as),n.strokeText("g",0,0);let l=n.getImageData(0,0,as,as).data;o=0;for(let u=l.length-1-3;u>=0;u-=4)if(l[u]>0){o=Math.ceil(u/4/as);break}n.clearRect(0,0,as,as),n.strokeText("A",0,as),l=n.getImageData(0,0,as,as).data,a=0;for(let u=0,d=l.length;u<d;u+=4)if(l[u]>0){a=as-Math.floor(u/4/as);break}n.canvas.width=n.canvas.height=0;const c=a?a/(a+o):lC;return h(this,ga).set(t,c),c},b(ie,gl),b(ie,vu),b(ie,Bp),b(ie,Vp),b(ie,ga,new Map),b(ie,ma,new Map),b(ie,gu,new WeakMap),b(ie,lr,null),b(ie,pl,new Set);let qc=ie;class Zc{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function n(i){var l;if(!i)return;let a=null;const o=i.name;if(o==="#text")a=i.value;else if(Zc.shouldBuildText(o))(l=i==null?void 0:i.attributes)!=null&&l.textContent?a=i.attributes.textContent:i.value&&(a=i.value);else return;if(a!==null&&e.push({str:a}),!!i.children)for(const c of i.children)n(c)}return n(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const cC=65536,hC=100,uC=5e3,dC=Ye?E1:S1,fC=Ye?x1:U_,pC=Ye?C1:T1,gC=Ye?I1:G_;function mC(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});const t=new hv,{docId:e}=t,s=r.url?vC(r.url):null,n=r.data?yC(r.data):null,i=r.httpHeaders||null,a=r.withCredentials===!0,o=r.password??null,l=r.range instanceof oA?r.range:null,c=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:cC;let u=r.worker instanceof Do?r.worker:null;const d=r.verbosity,f=typeof r.docBaseUrl=="string"&&!zg(r.docBaseUrl)?r.docBaseUrl:null,p=typeof r.cMapUrl=="string"?r.cMapUrl:null,g=r.cMapPacked!==!1,m=r.CMapReaderFactory||fC,v=typeof r.standardFontDataUrl=="string"?r.standardFontDataUrl:null,y=r.StandardFontDataFactory||gC,S=r.stopAtErrors!==!0,T=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,E=r.isEvalSupported!==!1,A=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!Ye,C=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!Ye&&(ns.platform.isFirefox||!globalThis.chrome),x=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,I=typeof r.disableFontFace=="boolean"?r.disableFontFace:Ye,R=r.fontExtraProperties===!0,O=r.enableXfa===!0,P=r.ownerDocument||globalThis.document,M=r.disableRange===!0,B=r.disableStream===!0,F=r.disableAutoFetch===!0,W=r.pdfBug===!0,j=r.CanvasFactory||dC,D=r.FilterFactory||pC,$=r.enableHWA===!0,H=l?l.length:r.length??NaN,Y=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!Ye&&!I,K=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:m===U_&&y===G_&&p&&v&&Oc(p,document.baseURI)&&Oc(v,document.baseURI);r.canvasFactory&&rb("`canvasFactory`-instance option, please use `CanvasFactory` instead."),r.filterFactory&&rb("`filterFactory`-instance option, please use `FilterFactory` instead.");const nt=null;e1(d);const ut={canvasFactory:new j({ownerDocument:P,enableHWA:$}),filterFactory:new D({docId:e,ownerDocument:P}),cMapReaderFactory:K?null:new m({baseUrl:p,isCompressed:g}),standardFontDataFactory:K?null:new y({baseUrl:v})};if(!u){const U={verbosity:d,port:Pi.workerPort};u=U.port?Do.fromPort(U):new Do(U),t._worker=u}const Rt={docId:e,apiVersion:"4.9.155",data:n,password:o,disableAutoFetch:F,rangeChunkSize:c,length:H,docBaseUrl:f,enableXfa:O,evaluatorOptions:{maxImageSize:T,disableFontFace:I,ignoreErrors:S,isEvalSupported:E,isOffscreenCanvasSupported:A,isImageDecoderSupported:C,canvasMaxAreaInBytes:x,fontExtraProperties:R,useSystemFonts:Y,cMapUrl:K?p:null,standardFontDataUrl:K?v:null}},ht={disableFontFace:I,fontExtraProperties:R,ownerDocument:P,pdfBug:W,styleElement:nt,loadingParams:{disableAutoFetch:F,enableXfa:O}};return u.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const U=u.messageHandler.sendWithPromise("GetDocRequest",Rt,n?[n.buffer]:null);let V;if(l)V=new z1(l,{disableRange:M,disableStream:B});else if(!n){if(!s)throw new Error("getDocument - no `url` parameter provided.");let N;if(Ye)if(Oc(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");N=yb}else N=iC;else N=Oc(s)?yb:J1;V=new N({url:s,length:H,httpHeaders:i,withCredentials:a,rangeChunkSize:c,disableRange:M,disableStream:B})}return U.then(N=>{if(t.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const ct=new Vc(e,N,u.port),pt=new wC(ct,t,V,ht,ut);t._transport=pt,ct.send("Ready",null)})}).catch(t._capability.reject),t}function vC(r){if(r instanceof URL)return r.href;try{return new URL(r,window.location).href}catch{if(Ye&&typeof r=="string")return r}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function yC(r){if(Ye&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return Wg(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r==null?void 0:r.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function bb(r){return typeof r=="object"&&Number.isInteger(r==null?void 0:r.num)&&r.num>=0&&Number.isInteger(r==null?void 0:r.gen)&&r.gen>=0}var $p;const jp=class jp{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${qe(jp,$p)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var t,e,s,n;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(i){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,i}this._transport=null,(n=this._worker)==null||n.destroy(),this._worker=null}};$p=new WeakMap,b(jp,$p,0);let hv=jp;class oA{constructor(t,e,s=!1,n=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners)s(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){Ft("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class bC{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return At(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var cr,fi,hr,Ao,ml,hf;class _C{constructor(t,e,s,n=!1){b(this,hr);b(this,ml);b(this,cr,null);b(this,fi,!1);this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=n?new ib:null,this._pdfBug=n,this.commonObjs=s.commonObjs,this.objs=new lA,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:n=0,dontFlip:i=!1}={}){return new _d({viewBox:this.view,scale:t,rotation:e,offsetX:s,offsetY:n,dontFlip:i})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return At(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:n=Wi.ENABLE,transform:i=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:d=!1}){var E,A;(E=this._stats)==null||E.time("Overall");const f=this._transport.getRenderingIntent(s,n,u,d),{renderingIntent:p,cacheKey:g}=f;_(this,fi,!1),w(this,ml,hf).call(this),o||(o=this._transport.getOptionalContentConfig(p));let m=this._intentStates.get(g);m||(m=Object.create(null),this._intentStates.set(g,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const v=!!(p&Es.PRINT);m.displayReadyCapability||(m.displayReadyCapability=Promise.withResolvers(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(A=this._stats)==null||A.time("Page Request"),this._pumpOperatorList(f));const y=C=>{var x;m.renderTasks.delete(S),(this._maybeCleanupAfterRender||v)&&_(this,fi,!0),w(this,hr,Ao).call(this,!v),C?(S.capability.reject(C),this._abortOperatorList({intentState:m,reason:C instanceof Error?C:new Error(C)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(x=globalThis.Stats)!=null&&x.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new dv({callback:y,params:{canvasContext:t,viewport:e,transform:i,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:c});(m.renderTasks||(m.renderTasks=new Set)).add(S);const T=S.task;return Promise.all([m.displayReadyCapability.promise,o]).then(([C,x])=>{var I;if(this.destroyed){y();return}if((I=this._stats)==null||I.time("Rendering"),!(x.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:C,optionalContentConfig:x}),S.operatorListChanged()}).catch(y),T}getOperatorList({intent:t="display",annotationMode:e=Wi.ENABLE,printAnnotationStorage:s=null,isEditing:n=!1}={}){var c;function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(t,e,s,n,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Zc.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,n){function i(){a.read().then(function({value:l,done:c}){if(c){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),i()},n)}const a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),_(this,fi,!1),w(this,ml,hf).call(this),Promise.all(t)}cleanup(t=!1){_(this,fi,!0);const e=w(this,hr,Ao).call(this,!1);return t&&e&&this._stats&&(this._stats=new ib),e}_startRenderPage(t,e){var n,i;const s=this._intentStates.get(e);s&&((n=this._stats)==null||n.timeEnd("Page Request"),(i=s.displayReadyCapability)==null||i.resolve(t))}_renderPageChunk(t,e){for(let s=0,n=t.length;s<n;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&w(this,hr,Ao).call(this,!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:n}){const{map:i,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:i,modifiedIds:n},a).getReader(),c=this._intentStates.get(e);c.streamReader=l;const u=()=>{l.read().then(({value:d,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,c),u())},d=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();w(this,hr,Ao).call(this,!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(d);else if(c.opListReadCapability)c.opListReadCapability.reject(d);else throw d}})};u()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof oy){let n=hC;e.extraDelay>0&&e.extraDelay<1e3&&(n+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},n);return}}if(t.streamReader.cancel(new ao(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[n,i]of this._intentStates)if(i===t){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}cr=new WeakMap,fi=new WeakMap,hr=new WeakSet,Ao=function(t=!1){if(w(this,ml,hf).call(this),!h(this,fi)||this.destroyed)return!1;if(t)return _(this,cr,setTimeout(()=>{_(this,cr,null),w(this,hr,Ao).call(this,!1)},uC)),!1;for(const{renderTasks:e,operatorList:s}of this._intentStates.values())if(e.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),_(this,fi,!1),!0},ml=new WeakSet,hf=function(){h(this,cr)&&(clearTimeout(h(this,cr)),_(this,cr,null))};var pi,Up;class AC{constructor(){b(this,pi,new Map);b(this,Up,Promise.resolve())}postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};h(this,Up).then(()=>{for(const[n]of h(this,pi))n.call(this,s)})}addEventListener(t,e,s=null){let n=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:i}=s;if(i.aborted){ft("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);n=()=>i.removeEventListener("abort",a),i.addEventListener("abort",a)}h(this,pi).set(e,n)}removeEventListener(t,e){const s=h(this,pi).get(e);s==null||s(),h(this,pi).delete(e)}terminate(){for(const[,t]of h(this,pi))t==null||t();h(this,pi).clear()}}pi=new WeakMap,Up=new WeakMap;var Wp,va,ya,vl,uf,yl,df;const Yt=class Yt{constructor({name:t=null,port:e=null,verbosity:s=s1()}={}){b(this,vl);var n;if(this.name=t,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if((n=h(Yt,ya))!=null&&n.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(h(Yt,ya)||_(Yt,ya,new WeakMap)).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new Vc("main","worker",t),this._messageHandler.on("ready",function(){}),w(this,vl,uf).call(this)}_initialize(){if(h(Yt,va)||h(Yt,yl,df)){this._setupFakeWorker();return}let{workerSrc:t}=Yt;try{Yt._isSameOrigin(window.location.href,t)||(t=Yt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Vc("main","worker",e),n=()=>{i.abort(),s.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=new AbortController;e.addEventListener("error",()=>{this._webWorker||n()},{signal:i.signal}),s.on("test",o=>{if(i.abort(),this.destroyed||!o){n();return}this._messageHandler=s,this._port=e,this._webWorker=e,w(this,vl,uf).call(this)}),s.on("ready",o=>{if(i.abort(),this.destroyed){n();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{jg("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){h(Yt,va)||(ft("Setting up fake worker."),_(Yt,va,!0)),Yt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const e=new AC;this._port=e;const s=`fake${qe(Yt,Wp)._++}`,n=new Vc(s+"_worker",s,e);t.setup(n,e),this._messageHandler=new Vc(s,s+"_worker",e),w(this,vl,uf).call(this)}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){var t,e,s;this.destroyed=!0,(t=this._webWorker)==null||t.terminate(),this._webWorker=null,(e=h(Yt,ya))==null||e.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(t){var s;if(!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const e=(s=h(this,ya))==null?void 0:s.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new Yt(t)}static get workerSrc(){if(Pi.workerSrc)return Pi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return At(this,"_setupFakeWorkerGlobal",(async()=>h(this,yl,df)?h(this,yl,df):(await qb(()=>import(this.workerSrc),[])).WorkerMessageHandler)())}};Wp=new WeakMap,va=new WeakMap,ya=new WeakMap,vl=new WeakSet,uf=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},yl=new WeakSet,df=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},b(Yt,yl),b(Yt,Wp,0),b(Yt,va,!1),b(Yt,ya,void 0),Ye&&(_(Yt,va,!0),Pi.workerSrc||(Pi.workerSrc="./pdf.worker.mjs")),Yt._isSameOrigin=(t,e)=>{let s;try{if(s=new URL(t),!s.origin||s.origin==="null")return!1}catch{return!1}const n=new URL(e,s);return s.origin===n.origin},Yt._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};let Do=Yt;var gi,On,bl,_l,Mn,ba,$c;class wC{constructor(t,e,s,n,i){b(this,ba);b(this,gi,new Map);b(this,On,new Map);b(this,bl,new Map);b(this,_l,new Map);b(this,Mn,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new lA,this.fontLoader=new A1({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return At(this,"annotationStorage",new uy)}getRenderingIntent(t,e=Wi.ENABLE,s=null,n=!1,i=!1){let a=Es.DISPLAY,o=tv;switch(t){case"any":a=Es.ANY;break;case"display":break;case"print":a=Es.PRINT;break;default:ft(`getRenderingIntent - invalid intent: ${t}`)}const l=a&Es.PRINT&&s instanceof V_?s:this.annotationStorage;switch(e){case Wi.DISABLE:a+=Es.ANNOTATIONS_DISABLE;break;case Wi.ENABLE:break;case Wi.ENABLE_FORMS:a+=Es.ANNOTATIONS_FORMS;break;case Wi.ENABLE_STORAGE:a+=Es.ANNOTATIONS_STORAGE,o=l.serializable;break;default:ft(`getRenderingIntent - invalid annotationMode: ${e}`)}n&&(a+=Es.IS_EDITING),i&&(a+=Es.OPLIST);const{ids:c,hash:u}=l.modifiedIds,d=[a,o.hash,u];return{renderingIntent:a,cacheKey:d.join("_"),annotationStorageSerializable:o,modifiedIds:c}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=h(this,Mn))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const n of h(this,On).values())t.push(n._destroy());h(this,On).clear(),h(this,bl).clear(),h(this,_l).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var n,i;this.commonObjs.clear(),this.fontLoader.clear(),h(this,gi).clear(),this.filterFactory.destroy(),qc.cleanup(),(n=this._networkStream)==null||n.cancelAllRequests(new ao("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,n)=>{me(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},n.onPull=()=>{this._fullReader.read().then(function({value:i,done:a}){if(a){n.close();return}me(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{n.error(i)})},n.onCancel=i=>{this._fullReader.cancel(i),n.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:n,isRangeSupported:i,contentLength:a}=this._fullReader;return(!n||!i)&&(this._lastProgress&&((o=e.onProgress)==null||o.call(e,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=e.onProgress)==null||c.call(e,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:n,isRangeSupported:i,contentLength:a}}),t.on("GetRangeReader",(s,n)=>{me(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(s.begin,s.end);if(!i){n.close();return}n.onPull=()=>{i.read().then(function({value:a,done:o}){if(o){n.close();return}me(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{n.error(a)})},n.onCancel=a=>{i.cancel(a),n.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new bC(s,this))}),t.on("DocException",function(s){let n;switch(s.name){case"PasswordException":n=new Om(s.message,s.code);break;case"InvalidPDFException":n=new u_(s.message);break;case"MissingPDFException":n=new bd(s.message);break;case"UnexpectedResponseException":n=new Ug(s.message,s.status);break;case"UnknownErrorException":n=new Mm(s.message,s.details);break;default:Ft("DocException - expected a valid Error.")}e._capability.reject(n)}),t.on("PasswordRequest",s=>{if(_(this,Mn,Promise.withResolvers()),e.onPassword){const n=i=>{i instanceof Error?h(this,Mn).reject(i):h(this,Mn).resolve({password:i})};try{e.onPassword(n,s.code)}catch(i){h(this,Mn).reject(i)}}else h(this,Mn).reject(new Om(s.message,s.code));return h(this,Mn).promise}),t.on("DataLoaded",s=>{var n;(n=e.onProgress)==null||n.call(e,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;h(this,On).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,n,i])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(n){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:c}=this._params;if("error"in i){const p=i.error;ft(`Error during font loading: ${p}`),this.commonObjs.resolve(s,p);break}const u=c&&((a=globalThis.FontInspector)!=null&&a.enabled)?(p,g)=>globalThis.FontInspector.fontAdded(p,g):null,d=new w1(i,{disableFontFace:o,inspectFont:u});this.fontLoader.bind(d).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l&&d.data&&(d.data=null),this.commonObjs.resolve(s,d)});break;case"CopyLocalImage":const{imageRef:f}=i;me(f,"The imageRef must be defined.");for(const p of h(this,On).values())for(const[,g]of p.objs)if((g==null?void 0:g.ref)===f)return g.dataLen?(this.commonObjs.resolve(s,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,i);break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),t.on("obj",([s,n,i,a])=>{var l;if(this.destroyed)return;const o=h(this,On).get(n);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(i){case"Image":o.objs.resolve(s,a),(a==null?void 0:a.dataLen)>ZT&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${i}`)}}}),t.on("DocProgress",s=>{var n;this.destroyed||(n=e.onProgress)==null||n.call(e,{loaded:s.loaded,total:s.total})}),t.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),t.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&ft("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((s=this._fullReader)==null?void 0:s.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=h(this,bl).get(e);if(s)return s;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&h(this,_l).set(i.refStr,t);const a=new _C(e,i,this,this._params.pdfBug);return h(this,On).set(e,a),a});return h(this,bl).set(e,n),n}getPageIndex(t){return bb(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return w(this,ba,$c).call(this,"GetFieldObjects")}hasJSActions(){return w(this,ba,$c).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return w(this,ba,$c).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return w(this,ba,$c).call(this,"GetOptionalContentConfig").then(e=>new H1(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=h(this,gi).get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(n=>{var i,a;return{info:n[0],metadata:n[1]?new U1(n[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return h(this,gi).set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of h(this,On).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),h(this,gi).clear(),this.filterFactory.destroy(!0),qc.cleanup()}}cachedPageNumber(t){if(!bb(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return h(this,_l).get(e)??null}}gi=new WeakMap,On=new WeakMap,bl=new WeakMap,_l=new WeakMap,Mn=new WeakMap,ba=new WeakSet,$c=function(t,e=null){const s=h(this,gi).get(t);if(s)return s;const n=this.messageHandler.sendWithPromise(t,e);return h(this,gi).set(t,n),n};const zd=Symbol("INITIAL_DATA");var Qs,yu,uv;class lA{constructor(){b(this,yu);b(this,Qs,Object.create(null))}get(t,e=null){if(e){const n=w(this,yu,uv).call(this,t);return n.promise.then(()=>e(n.data)),null}const s=h(this,Qs)[t];if(!s||s.data===zd)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=h(this,Qs)[t];return!!e&&e.data!==zd}resolve(t,e=null){const s=w(this,yu,uv).call(this,t);s.data=e,s.resolve()}clear(){var t;for(const e in h(this,Qs)){const{data:s}=h(this,Qs)[e];(t=s==null?void 0:s.bitmap)==null||t.close()}_(this,Qs,Object.create(null))}*[Symbol.iterator](){for(const t in h(this,Qs)){const{data:e}=h(this,Qs)[t];e!==zd&&(yield[t,e])}}}Qs=new WeakMap,yu=new WeakSet,uv=function(t){var e;return(e=h(this,Qs))[t]||(e[t]={...Promise.withResolvers(),data:zd})};var ur;class SC{constructor(t){b(this,ur,null);_(this,ur,t),this.onContinue=null}get promise(){return h(this,ur).capability.promise}cancel(t=0){h(this,ur).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=h(this,ur).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=h(this,ur);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}ur=new WeakMap;var dr,_a;const Fr=class Fr{constructor({callback:t,params:e,objs:s,commonObjs:n,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:u=!1,pdfBug:d=!1,pageColors:f=null}){b(this,dr,null);this.callback=t,this.params=e,this.objs=s,this.commonObjs=n,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new SC(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var o,l;if(this.cancelled)return;if(this._canvas){if(h(Fr,_a).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");h(Fr,_a).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:n,transform:i,background:a}=this.params;this.gfx=new ko(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:n,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(t=null,e=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),h(this,dr)&&(window.cancelAnimationFrame(h(this,dr)),_(this,dr,null)),h(Fr,_a).delete(this._canvas),this.callback(t||new oy(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?_(this,dr,window.requestAnimationFrame(()=>{_(this,dr,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),h(Fr,_a).delete(this._canvas),this.callback())))}};dr=new WeakMap,_a=new WeakMap,b(Fr,_a,new WeakSet);let dv=Fr;const TC="4.9.155",CC="a4eb8407c";xt(670);function _b(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function Rc(r){return Math.max(0,Math.min(255,255*r))}class Ab{static CMYK_G([t,e,s,n]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+n)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Rc(t),[t,t,t]}static G_HTML([t]){const e=_b(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(Rc)}static RGB_HTML(t){return`#${t.map(_b).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,n]){return["RGB",1-Math.min(1,t+n),1-Math.min(1,s+n),1-Math.min(1,e+n)]}static CMYK_rgb([t,e,s,n]){return[Rc(1-Math.min(1,t+n)),Rc(1-Math.min(1,s+n)),Rc(1-Math.min(1,e+n))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const n=1-t,i=1-e,a=1-s,o=Math.min(n,i,a);return["CMYK",n,i,a,o]}}class EC{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),s||(n.setAttribute("width",`${t}px`),n.setAttribute("height",`${e}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${t} ${e}`),n}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Ft("Abstract method `_createSVG` called.")}}class fy extends EC{_createSVG(t){return document.createElementNS(Jn,t)}}class cA{static setupStorage(t,e,s,n,i){const a=n.getValue(e,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),i==="print")break;t.addEventListener("input",o=>{n.setValue(e,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?t.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&t.removeAttribute("checked"),i==="print")break;t.addEventListener("change",o=>{n.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),i==="print")break;t.addEventListener("input",o=>{n.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const l=o.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;n.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:n,linkService:i}){const{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${n}`);for(const[l,c]of Object.entries(a))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}o&&i.addLinkAttributes(t,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(t,a.dataId,e,s)}static render(t){var d,f;const e=t.annotationStorage,s=t.linkService,n=t.xfaHtml,i=t.intent||"display",a=document.createElement(n.name);n.attributes&&this.setAttributes({html:a,element:n,intent:i,linkService:s});const o=i!=="richText",l=t.div;if(l.append(a),t.viewport){const p=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=p}o&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(n.children.length===0){if(n.value){const p=document.createTextNode(n.value);a.append(p),o&&Zc.shouldBuildText(n.name)&&c.push(p)}return{textDivs:c}}const u=[[n,-1,a]];for(;u.length>0;){const[p,g,m]=u.at(-1);if(g+1===p.children.length){u.pop();continue}const v=p.children[++u.at(-1)[1]];if(v===null)continue;const{name:y}=v;if(y==="#text"){const T=document.createTextNode(v.value);c.push(T),m.append(T);continue}const S=(d=v==null?void 0:v.attributes)!=null&&d.xmlns?document.createElementNS(v.attributes.xmlns,y):document.createElement(y);if(m.append(S),v.attributes&&this.setAttributes({html:S,element:v,storage:e,intent:i,linkService:s}),((f=v.children)==null?void 0:f.length)>0)u.push([v,-1,S]);else if(v.value){const T=document.createTextNode(v.value);o&&Zc.shouldBuildText(y)&&c.push(T),S.append(T)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const wd=1e3,xC=9,Qa=new WeakSet;function Sr(r){return{width:r[2]-r[0],height:r[3]-r[1]}}class IC{static create(t){switch(t.data.annotationType){case be.LINK:return new hA(t);case be.TEXT:return new RC(t);case be.WIDGET:switch(t.data.fieldType){case"Tx":return new PC(t);case"Btn":return t.data.radioButton?new fA(t):t.data.checkBox?new MC(t):new kC(t);case"Ch":return new DC(t);case"Sig":return new OC(t)}return new oo(t);case be.POPUP:return new pv(t);case be.FREETEXT:return new yA(t);case be.LINE:return new LC(t);case be.SQUARE:return new FC(t);case be.CIRCLE:return new BC(t);case be.POLYLINE:return new bA(t);case be.CARET:return new $C(t);case be.INK:return new py(t);case be.POLYGON:return new VC(t);case be.HIGHLIGHT:return new _A(t);case be.UNDERLINE:return new jC(t);case be.SQUIGGLY:return new UC(t);case be.STRIKEOUT:return new WC(t);case be.STAMP:return new AA(t);case be.FILEATTACHMENT:return new HC(t);default:return new de(t)}}}var Aa,Al,wl,bu,fv;const a0=class a0{constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:n=!1}={}){b(this,bu);b(this,Aa,null);b(this,Al,!1);b(this,wl,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),n&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t!=null&&t.str||e!=null&&e.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return a0._hasPopupData(this.data)}updateEdited(t){var s;if(!this.container)return;h(this,Aa)||_(this,Aa,{rect:this.data.rect.slice(0)});const{rect:e}=t;e&&w(this,bu,fv).call(this,e),(s=h(this,wl))==null||s.popup.updateEdited(t)}resetEdited(){var t;h(this,Aa)&&(w(this,bu,fv).call(this,h(this,Aa).rect),(t=h(this,wl))==null||t.popup.resetEdited(),_(this,Aa,null))}_createContainer(t){const{data:e,parent:{page:s,viewport:n}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",e.id),this instanceof oo||(i.tabIndex=wd);const{style:a}=i;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(i.title=e.alternativeText),e.noRotate&&i.classList.add("norotate"),!e.rect||this instanceof pv){const{rotation:m}=e;return!e.hasOwnCanvas&&m!==0&&this.setRotation(m,i),i}const{width:o,height:l}=Sr(e.rect);if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const m=e.borderStyle.horizontalCornerRadius,v=e.borderStyle.verticalCornerRadius;if(m>0||v>0){const S=`calc(${m}px * var(--scale-factor)) / calc(${v}px * var(--scale-factor))`;a.borderRadius=S}else if(this instanceof fA){const S=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=S}switch(e.borderStyle.style){case xc.SOLID:a.borderStyle="solid";break;case xc.DASHED:a.borderStyle="dashed";break;case xc.BEVELED:ft("Unimplemented border style: beveled");break;case xc.INSET:ft("Unimplemented border style: inset");break;case xc.UNDERLINE:a.borderBottomStyle="solid";break}const y=e.borderColor||null;y?(_(this,Al,!0),a.borderColor=lt.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):a.borderWidth=0}const c=lt.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:u,pageHeight:d,pageX:f,pageY:p}=n.rawDims;a.left=`${100*(c[0]-f)/u}%`,a.top=`${100*(c[1]-p)/d}%`;const{rotation:g}=e;return e.hasOwnCanvas||g===0?(a.width=`${100*o/u}%`,a.height=`${100*l/d}%`):this.setRotation(g,i),i}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:n}=this.parent.viewport.rawDims,{width:i,height:a}=Sr(this.data.rect);let o,l;t%180===0?(o=100*i/s,l=100*a/n):(o=100*a/s,l=100*i/n),e.style.width=`${o}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,n)=>{const i=n.detail[e],a=i[0],o=i.slice(1);n.target.style[s]=Ab[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:Ab[`${a}_rgb`](o)})};return At(this,"_commonActions",{display:e=>{const{display:s}=e.detail,n=s%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const n of Object.keys(e.detail)){const i=t[n]||s[n];i==null||i(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[n,i]of Object.entries(e)){const a=s[n];if(a){const o={detail:{[n]:i},target:t};a(o),delete e[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,n,i]=this.data.rect.map(m=>Math.fround(m));if(t.length===8){const[m,v,y,S]=t.subarray(2,6);if(n===m&&i===v&&e===y&&s===S)return}const{style:a}=this.container;let o;if(h(this,Al)){const{borderColor:m,borderWidth:v}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${v}">`],this.container.classList.add("hasBorder")}const l=n-e,c=i-s,{svgFactory:u}=this,d=u.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);const f=u.createElement("defs");d.append(f);const p=u.createElement("clipPath"),g=`clippath_${this.data.id}`;p.setAttribute("id",g),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let m=2,v=t.length;m<v;m+=8){const y=t[m],S=t[m+1],T=t[m+2],E=t[m+3],A=u.createElement("rect"),C=(T-e)/l,x=(i-S)/c,I=(y-T)/l,R=(S-E)/c;A.setAttribute("x",C),A.setAttribute("y",x),A.setAttribute("width",I),A.setAttribute("height",R),p.append(A),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${x}" width="${I}" height="${R}"/>`)}h(this,Al)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(d),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:t}=this,e=_(this,wl,new pv({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}render(){Ft("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const n=this._fieldObjects[t];if(n)for(const{page:i,id:a,exportValues:o}of n){if(i===-1||a===e)continue;const l=typeof o=="string"?o:null,c=document.querySelector(`[data-element-id="${a}"]`);if(c&&!Qa.has(c)){ft(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:c})}return s}for(const n of document.getElementsByName(t)){const{exportValue:i}=n,a=n.getAttribute("data-element-id");a!==e&&Qa.has(n)&&s.push({id:a,exportValue:i,domElement:n})}return s}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}};Aa=new WeakMap,Al=new WeakMap,wl=new WeakMap,bu=new WeakSet,fv=function(t){const{container:{style:e},data:{rect:s,rotation:n},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...t);const{width:c,height:u}=Sr(t);e.left=`${100*(t[0]-o)/i}%`,e.top=`${100*(a-t[3]+l)/a}%`,n===0?(e.width=`${100*c/i}%`,e.height=`${100*u/a}%`):this.setRotation(n)};let de=a0;var mi,Mr,Hp,uA,zp,dA;class hA extends de{constructor(e,s=null){super(e,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});b(this,mi);b(this,Hp);b(this,zp);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:s}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let i=!1;return e.url?(s.addLinkAttributes(n,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(n,e.action),i=!0):e.attachment?(w(this,Hp,uA).call(this,n,e.attachment,e.attachmentDest),i=!0):e.setOCGState?(w(this,zp,dA).call(this,n,e.setOCGState),i=!0):e.dest?(this._bindLink(n,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),i=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(n),this.container}_bindLink(e,s){e.href=this.linkService.getDestinationHash(s),e.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&w(this,mi,Mr).call(this)}_bindNamedAction(e,s){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(s),!1),w(this,mi,Mr).call(this)}_bindJSAction(e,s){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(s.actions)){const a=n.get(i);a&&(e[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:i}}),!1})}e.onclick||(e.onclick=()=>!1),w(this,mi,Mr).call(this)}_bindResetFormAction(e,s){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),w(this,mi,Mr).call(this),!this._fieldObjects){ft('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{var d;n==null||n();const{fields:i,refs:a,include:o}=s,l=[];if(i.length!==0||a.length!==0){const f=new Set(a);for(const p of i){const g=this._fieldObjects[p]||[];for(const{id:m}of g)f.add(m)}for(const p of Object.values(this._fieldObjects))for(const g of p)f.has(g.id)===o&&l.push(g)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const c=this.annotationStorage,u=[];for(const f of l){const{id:p}=f;switch(u.push(p),f.type){case"text":{const m=f.defaultValue||"";c.setValue(p,{value:m});break}case"checkbox":case"radiobutton":{const m=f.defaultValue===f.exportValues;c.setValue(p,{value:m});break}case"combobox":case"listbox":{const m=f.defaultValue||"";c.setValue(p,{value:m});break}default:continue}const g=document.querySelector(`[data-element-id="${p}"]`);if(g){if(!Qa.has(g)){ft(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}mi=new WeakSet,Mr=function(){this.container.setAttribute("data-internal-link","")},Hp=new WeakSet,uA=function(e,s,n=null){e.href=this.linkService.getAnchorUrl(""),s.description&&(e.title=s.description),e.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(s.content,s.filename,n),!1},w(this,mi,Mr).call(this)},zp=new WeakSet,dA=function(e,s){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(s),!1),w(this,mi,Mr).call(this)};class RC extends de{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class oo extends de{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ns.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,n,i){s.includes("mouse")?t.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(s,a=>{var o;if(s==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}i&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:i(a)}}))})}_setEventListeners(t,e,s,n){var i,a,o;for(const[l,c]of s)(c==="Action"||(i=this.data.actions)!=null&&i[c])&&((c==="Focus"||c==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,l,c,n),c==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(t,e,"blur","Blur",null):c==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":lt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||xC,i=t.style;let a;const o=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o),u=Math.round(c/(ym*n))||1,d=c/u;a=Math.min(n,l(d/ym))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(n,l(c/ym))}i.fontSize=`calc(${a}px * var(--scale-factor))`,i.color=lt.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(i.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class PC extends oo{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,n){const i=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=s),i.setValue(a.id,{[n]:s})}render(){var n,i;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let c=a.formattedValue||((n=this.data.textContent)==null?void 0:n.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const u={userValue:o,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=c??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",c??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Qa.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=wd,this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",f=>{t.setValue(e,{value:f.target.value}),this.setPropertyOnSiblings(s,"value",f.target.value,"value"),u.formattedValue=null}),s.addEventListener("resetform",f=>{const p=this.data.defaultFieldValue??"";s.value=u.userValue=p,u.formattedValue=null});let d=f=>{const{formattedValue:p}=u;p!=null&&(f.target.value=p),f.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{var m;if(u.focused)return;const{target:g}=p;u.userValue&&(g.value=u.userValue),u.lastCommittedValue=g.value,u.commitKey=1,(m=this.data.actions)!=null&&m.Focus||(u.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const g={value(m){u.userValue=m.detail.value??"",t.setValue(e,{value:u.userValue.toString()}),m.target.value=u.userValue},formattedValue(m){const{formattedValue:v}=m.detail;u.formattedValue=v,v!=null&&m.target!==document.activeElement&&(m.target.value=v),t.setValue(e,{formattedValue:v})},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{var T;const{charLimit:v}=m.detail,{target:y}=m;if(v===0){y.removeAttribute("maxLength");return}y.setAttribute("maxLength",v);let S=u.userValue;!S||S.length<=v||(S=S.slice(0,v),y.value=u.userValue=S,t.setValue(e,{value:S}),(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:1,selStart:y.selectionStart,selEnd:y.selectionEnd}}))}};this._dispatchEventFromSandbox(g,p)}),s.addEventListener("keydown",p=>{var v;u.commitKey=1;let g=-1;if(p.key==="Escape"?g=0:p.key==="Enter"&&!this.data.multiLine?g=2:p.key==="Tab"&&(u.commitKey=3),g===-1)return;const{value:m}=p.target;u.lastCommittedValue!==m&&(u.lastCommittedValue=m,u.userValue=m,(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:m,willCommit:!0,commitKey:g,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const f=d;d=null,s.addEventListener("blur",p=>{var m,v;if(!u.focused||!p.relatedTarget)return;(m=this.data.actions)!=null&&m.Blur||(u.focused=!1);const{value:g}=p.target;u.userValue=g,u.lastCommittedValue!==g&&((v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:g,willCommit:!0,commitKey:u.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),f(p)}),(i=this.data.actions)!=null&&i.Keystroke&&s.addEventListener("beforeinput",p=>{var A;u.lastCommittedValue=null;const{data:g,target:m}=p,{value:v,selectionStart:y,selectionEnd:S}=m;let T=y,E=S;switch(p.inputType){case"deleteWordBackward":{const C=v.substring(0,y).match(/\w*[^\w]*$/);C&&(T-=C[0].length);break}case"deleteWordForward":{const C=v.substring(y).match(/^[^\w]*\w*/);C&&(E+=C[0].length);break}case"deleteContentBackward":y===S&&(T-=1);break;case"deleteContentForward":y===S&&(E+=1);break}p.preventDefault(),(A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,change:g||"",willCommit:!1,selStart:T,selEnd:E}})}),this._setEventListeners(s,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(d&&s.addEventListener("blur",d),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class OC extends oo{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class MC extends oo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let n=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",t.setValue(s,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return Qa.add(i),i.setAttribute("data-element-id",s),i.disabled=e.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=e.fieldName,n&&i.setAttribute("checked",!0),i.setAttribute("exportValue",e.exportValue),i.tabIndex=wd,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const c of this._getElementsByName(o,s)){const u=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=u),t.setValue(c.id,{value:u})}t.setValue(s,{value:l})}),i.addEventListener("resetform",a=>{const o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class fA extends oo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let n=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof n=="string"&&(n=n!==e.buttonValue,t.setValue(s,{value:n})),n)for(const a of this._getElementsByName(e.fieldName,s))t.setValue(a.id,{value:!1});const i=document.createElement("input");if(Qa.add(i),i.setAttribute("data-element-id",s),i.disabled=e.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=e.fieldName,n&&i.setAttribute("checked",!0),i.tabIndex=wd,i.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const c of this._getElementsByName(o,s))t.setValue(c.id,{value:!1});t.setValue(s,{value:l})}),i.addEventListener("resetform",a=>{const o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;i.addEventListener("updatefromsandbox",o=>{const l={value:c=>{const u=a===c.detail.value;for(const d of this._getElementsByName(c.target.name)){const f=u&&d.id===s;d.domElement&&(d.domElement.checked=f),t.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class kC extends hA{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class DC extends oo{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),n=document.createElement("select");Qa.add(n),n.setAttribute("data-element-id",e),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=wd;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",u=>{const d=this.data.defaultFieldValue;for(const f of n.options)f.selected=f.value===d});for(const u of this.data.options){const d=document.createElement("option");d.textContent=u.displayValue,d.value=u.exportValue,s.value.includes(u.exportValue)&&(d.setAttribute("selected",!0),i=!1),n.append(d)}let a=null;if(i){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),n.prepend(u),a=()=>{u.remove(),n.removeEventListener("input",a),a=null},n.addEventListener("input",a)}const o=u=>{const d=u?"value":"textContent",{options:f,multiple:p}=n;return p?Array.prototype.filter.call(f,g=>g.selected).map(g=>g[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let l=o(!1);const c=u=>{const d=u.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",u=>{const d={value(f){a==null||a();const p=f.detail.value,g=new Set(Array.isArray(p)?p:[p]);for(const m of n.options)m.selected=g.has(m.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(f){n.multiple=!0},remove(f){const p=n.options,g=f.detail.remove;p[g].selected=!1,n.remove(g),p.length>0&&Array.prototype.findIndex.call(p,v=>v.selected)===-1&&(p[0].selected=!0),t.setValue(e,{value:o(!0),items:c(f)}),l=o(!1)},clear(f){for(;n.length!==0;)n.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(f){const{index:p,displayValue:g,exportValue:m}=f.detail.insert,v=n.children[p],y=document.createElement("option");y.textContent=g,y.value=m,v?v.before(y):n.append(y),t.setValue(e,{value:o(!0),items:c(f)}),l=o(!1)},items(f){const{items:p}=f.detail;for(;n.length!==0;)n.remove(0);for(const g of p){const{displayValue:m,exportValue:v}=g,y=document.createElement("option");y.textContent=m,y.value=v,n.append(y)}n.options.length>0&&(n.options[0].selected=!0),t.setValue(e,{value:o(!0),items:c(f)}),l=o(!1)},indices(f){const p=new Set(f.detail.indices);for(const g of f.target.options)g.selected=p.has(g.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,u)}),n.addEventListener("input",u=>{var p;const d=o(!0),f=o(!1);t.setValue(e,{value:d}),u.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):n.addEventListener("input",function(u){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class pv extends de{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:de._hasPopupData(e)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const t=this.popup=new NC({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",e.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(s=>`${ay}${s}`).join(",")),this.container}}var Sl,Gp,Xp,Tl,wa,re,vi,Cl,_u,Au,El,yi,Js,bi,wu,_i,Su,Sa,Ta,xl,ff,Tu,gv,Yp,pA,Kp,gA,qp,mA,Zp,vA,Il,pf,Rl,gf,Cu,mv;class NC{constructor({container:t,color:e,elements:s,titleObj:n,modificationDate:i,contentsObj:a,richText:o,parent:l,rect:c,parentRect:u,open:d}){b(this,xl);b(this,Tu);b(this,Yp);b(this,Kp);b(this,qp);b(this,Zp);b(this,Il);b(this,Rl);b(this,Cu);b(this,Sl,w(this,qp,mA).bind(this));b(this,Gp,w(this,Cu,mv).bind(this));b(this,Xp,w(this,Rl,gf).bind(this));b(this,Tl,w(this,Il,pf).bind(this));b(this,wa,null);b(this,re,null);b(this,vi,null);b(this,Cl,null);b(this,_u,null);b(this,Au,null);b(this,El,null);b(this,yi,!1);b(this,Js,null);b(this,bi,null);b(this,wu,null);b(this,_i,null);b(this,Su,null);b(this,Sa,null);b(this,Ta,!1);var f;_(this,re,t),_(this,Su,n),_(this,vi,a),_(this,_i,o),_(this,Au,l),_(this,wa,e),_(this,wu,c),_(this,El,u),_(this,_u,s),_(this,Cl,cy.toDateObject(i)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",h(this,Tl)),p.addEventListener("mouseenter",h(this,Xp)),p.addEventListener("mouseleave",h(this,Gp)),p.classList.add("popupTriggerArea");for(const p of s)(f=p.container)==null||f.addEventListener("keydown",h(this,Sl));h(this,re).hidden=!0,d&&w(this,Il,pf).call(this)}render(){if(h(this,Js))return;const t=_(this,Js,document.createElement("div"));if(t.className="popup",h(this,wa)){const i=t.style.outlineColor=lt.makeHexColor(...h(this,wa));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`:t.style.backgroundColor=lt.makeHexColor(...h(this,wa).map(o=>Math.floor(.7*(255-o)+o)))}const e=document.createElement("span");e.className="header";const s=document.createElement("h1");if(e.append(s),{dir:s.dir,str:s.textContent}=h(this,Su),t.append(e),h(this,Cl)){const i=document.createElement("span");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:h(this,Cl).valueOf()})),e.append(i)}const n=h(this,xl,ff);if(n)cA.render({xfaHtml:n,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(h(this,vi));t.append(i)}h(this,re).append(t)}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const n=t.split(/(?:\r\n?|\n)/);for(let i=0,a=n.length;i<a;++i){const o=n[i];s.append(document.createTextNode(o)),i<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:t,popupContent:e}){var s;h(this,Sa)||_(this,Sa,{contentsObj:h(this,vi),richText:h(this,_i)}),t&&_(this,bi,null),e&&(_(this,_i,w(this,Kp,gA).call(this,e)),_(this,vi,null)),(s=h(this,Js))==null||s.remove(),_(this,Js,null)}resetEdited(){var t;h(this,Sa)&&({contentsObj:qe(this,vi)._,richText:qe(this,_i)._}=h(this,Sa),_(this,Sa,null),(t=h(this,Js))==null||t.remove(),_(this,Js,null),_(this,bi,null))}forceHide(){_(this,Ta,this.isVisible),h(this,Ta)&&(h(this,re).hidden=!0)}maybeShow(){h(this,Ta)&&(h(this,Js)||w(this,Rl,gf).call(this),_(this,Ta,!1),h(this,re).hidden=!1)}get isVisible(){return h(this,re).hidden===!1}}Sl=new WeakMap,Gp=new WeakMap,Xp=new WeakMap,Tl=new WeakMap,wa=new WeakMap,re=new WeakMap,vi=new WeakMap,Cl=new WeakMap,_u=new WeakMap,Au=new WeakMap,El=new WeakMap,yi=new WeakMap,Js=new WeakMap,bi=new WeakMap,wu=new WeakMap,_i=new WeakMap,Su=new WeakMap,Sa=new WeakMap,Ta=new WeakMap,xl=new WeakSet,ff=function(){const t=h(this,_i),e=h(this,vi);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&h(this,_i).html||null},Tu=new WeakSet,gv=function(){var t,e,s;return((s=(e=(t=h(this,xl,ff))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.fontSize)||0},Yp=new WeakSet,pA=function(){var t,e,s;return((s=(e=(t=h(this,xl,ff))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.color)||null},Kp=new WeakSet,gA=function(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},n={style:{color:h(this,Yp,pA),fontSize:h(this,Tu,gv)?`calc(${h(this,Tu,gv)}px * var(--scale-factor))`:""}};for(const i of t.split(`
`))e.push({name:"span",value:i,attributes:n});return s},qp=new WeakSet,mA=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&h(this,yi))&&w(this,Il,pf).call(this)},Zp=new WeakSet,vA=function(){if(h(this,bi)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:n,pageY:i}}}=h(this,Au);let a=!!h(this,El),o=a?h(this,El):h(this,wu);for(const g of h(this,_u))if(!o||lt.intersect(g.data.rect,o)!==null){o=g.data.rect,a=!0;break}const l=lt.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),c=5,u=a?o[2]-o[0]+c:0,d=l[0]+u,f=l[1];_(this,bi,[100*(d-n)/e,100*(f-i)/s]);const{style:p}=h(this,re);p.left=`${h(this,bi)[0]}%`,p.top=`${h(this,bi)[1]}%`},Il=new WeakSet,pf=function(){_(this,yi,!h(this,yi)),h(this,yi)?(w(this,Rl,gf).call(this),h(this,re).addEventListener("click",h(this,Tl)),h(this,re).addEventListener("keydown",h(this,Sl))):(w(this,Cu,mv).call(this),h(this,re).removeEventListener("click",h(this,Tl)),h(this,re).removeEventListener("keydown",h(this,Sl)))},Rl=new WeakSet,gf=function(){h(this,Js)||this.render(),this.isVisible?h(this,yi)&&h(this,re).classList.add("focused"):(w(this,Zp,vA).call(this),h(this,re).hidden=!1,h(this,re).style.zIndex=parseInt(h(this,re).style.zIndex)+1e3)},Cu=new WeakSet,mv=function(){h(this,re).classList.remove("focused"),!(h(this,yi)||!this.isVisible)&&(h(this,re).hidden=!0,h(this,re).style.zIndex=parseInt(h(this,re).style.zIndex)-1e3)};class yA extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=gt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Eu;class LC extends de{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});b(this,Eu,null)}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:s,height:n}=Sr(e.rect),i=this.svgFactory.create(s,n,!0),a=_(this,Eu,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),a.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),a.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),a.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,Eu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Eu=new WeakMap;var xu;class FC extends de{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});b(this,xu,null)}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:s,height:n}=Sr(e.rect),i=this.svgFactory.create(s,n,!0),a=e.borderStyle.width,o=_(this,xu,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",n-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,xu)}addHighlightArea(){this.container.classList.add("highlightArea")}}xu=new WeakMap;var Iu;class BC extends de{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});b(this,Iu,null)}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:s,height:n}=Sr(e.rect),i=this.svgFactory.create(s,n,!0),a=e.borderStyle.width,o=_(this,Iu,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",n/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",n/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,Iu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Iu=new WeakMap;var Ru;class bA extends de{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});b(this,Ru,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:s,borderStyle:n,popupRef:i}}=this;if(!s)return this.container;const{width:a,height:o}=Sr(e),l=this.svgFactory.create(a,o,!0);let c=[];for(let d=0,f=s.length;d<f;d+=2){const p=s[d]-e[0],g=e[3]-s[d+1];c.push(`${p},${g}`)}c=c.join(" ");const u=_(this,Ru,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",c),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),l.append(u),this.container.append(l),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return h(this,Ru)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ru=new WeakMap;class VC extends bA{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class $C extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Pu,Ca,Ou,vv;class py extends de{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});b(this,Ou);b(this,Pu,null);b(this,Ca,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?gt.HIGHLIGHT:gt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:s,inkLists:n,borderStyle:i,popupRef:a}}=this,{transform:o,width:l,height:c}=w(this,Ou,vv).call(this,s,e),u=this.svgFactory.create(l,c,!0),d=_(this,Pu,this.svgFactory.createElement("svg:g"));u.append(d),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let f=0,p=n.length;f<p;f++){const g=this.svgFactory.createElement(this.svgElementName);h(this,Ca).push(g),g.setAttribute("points",n[f].join(",")),d.append(g)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:s,points:n,rect:i}=e,a=h(this,Pu);if(s>=0&&a.setAttribute("stroke-width",s||1),n)for(let o=0,l=h(this,Ca).length;o<l;o++)h(this,Ca)[o].setAttribute("points",n[o].join(","));if(i){const{transform:o,width:l,height:c}=w(this,Ou,vv).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return h(this,Ca)}addHighlightArea(){this.container.classList.add("highlightArea")}}Pu=new WeakMap,Ca=new WeakMap,Ou=new WeakSet,vv=function(e,s){switch(e){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class _A extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=gt.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class jC extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class UC extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class WC extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class AA extends de{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=gt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Mu,ku,yv;class HC extends de{constructor(e){var n;super(e,{isRenderable:!0});b(this,ku);b(this,Mu,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(n=this.linkService.eventBus)==null||n.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:s}=this;let n;s.hasAppearance||s.fillAlpha===0?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),n.addEventListener("dblclick",w(this,ku,yv).bind(this)),_(this,Mu,n);const{isMac:i}=ns.platform;return e.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&w(this,ku,yv).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():n.classList.add("popupTriggerArea"),e.append(n),e}getElementsToTriggerPopup(){return h(this,Mu)}addHighlightArea(){this.container.classList.add("highlightArea")}}Mu=new WeakMap,ku=new WeakSet,yv=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var Du,Ea,xa,Nu,Qp,wA,Lu,bv;class zC{constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:n,page:i,viewport:a,structTreeLayer:o}){b(this,Qp);b(this,Lu);b(this,Du,null);b(this,Ea,null);b(this,xa,new Map);b(this,Nu,null);this.div=t,_(this,Du,e),_(this,Ea,s),_(this,Nu,o||null),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=n}hasEditableAnnotations(){return h(this,xa).size>0}async render(t){var a;const{annotations:e}=t,s=this.div;qa(s,this.viewport);const n=new Map,i={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new fy,annotationStorage:t.annotationStorage||new uy,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const o of e){if(o.noHTML)continue;const l=o.annotationType===be.POPUP;if(l){const d=n.get(o.id);if(!d)continue;i.elements=d}else{const{width:d,height:f}=Sr(o.rect);if(d<=0||f<=0)continue}i.data=o;const c=IC.create(i);if(!c.isRenderable)continue;if(!l&&o.popupRef){const d=n.get(o.popupRef);d?d.push(c):n.set(o.popupRef,[c])}const u=c.render();o.hidden&&(u.style.visibility="hidden"),await w(this,Qp,wA).call(this,u,o.id),c._isEditable&&(h(this,xa).set(c.data.id,c),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(c))}w(this,Lu,bv).call(this)}update({viewport:t}){const e=this.div;this.viewport=t,qa(e,{rotation:t.rotation}),w(this,Lu,bv).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(h(this,xa).values())}getEditableAnnotation(t){return h(this,xa).get(t)}}Du=new WeakMap,Ea=new WeakMap,xa=new WeakMap,Nu=new WeakMap,Qp=new WeakSet,wA=async function(t,e){var a,o;const s=t.firstChild||t,n=s.id=`${ay}${e}`,i=await((a=h(this,Nu))==null?void 0:a.getAriaAttributes(n));if(i)for(const[l,c]of i)s.setAttribute(l,c);this.div.append(t),(o=h(this,Du))==null||o.moveElementInDOM(this.div,t,s,!1)},Lu=new WeakSet,bv=function(){if(!h(this,Ea))return;const t=this.div;for(const[e,s]of h(this,Ea)){const n=t.querySelector(`[data-annotation-id="${e}"]`);if(!n)continue;s.className="annotationContent";const{firstChild:i}=n;i?i.nodeName==="CANVAS"?i.replaceWith(s):i.classList.contains("annotationContent")?i.after(s):i.before(s):n.append(s)}h(this,Ea).clear()};const Gd=/\r\n?|\n/g;var tn,ys,Fu,Ia,bs,Jp,SA,tg,TA,eg,CA,Pl,mf,Ol,vf,Ml,yf,sg,EA,Bu,Av,ng,xA;const jt=class jt extends ne{constructor(e){super({...e,name:"freeTextEditor"});b(this,Jp);b(this,tg);b(this,eg);b(this,Pl);b(this,Ml);b(this,sg);b(this,ng);b(this,tn,void 0);b(this,ys,"");b(this,Fu,`${this.id}-editor`);b(this,Ia,null);b(this,bs,void 0);_(this,tn,e.color||jt._defaultColor||ne._defaultLineColor),_(this,bs,e.fontSize||jt._defaultFontSize)}static get _keyboardManager(){const e=jt.prototype,s=a=>a.isEmpty(),n=Za.TRANSLATE_SMALL,i=Za.TRANSLATE_BIG;return At(this,"_keyboardManager",new Ad([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:s}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[n,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[i,0],checker:s}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:s}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,n],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,i],checker:s}]]))}static initialize(e,s){ne.initialize(e,s);const n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,s){switch(e){case Tt.FREETEXT_SIZE:jt._defaultFontSize=s;break;case Tt.FREETEXT_COLOR:jt._defaultColor=s;break}}updateParams(e,s){switch(e){case Tt.FREETEXT_SIZE:w(this,Jp,SA).call(this,s);break;case Tt.FREETEXT_COLOR:w(this,tg,TA).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Tt.FREETEXT_SIZE,jt._defaultFontSize],[Tt.FREETEXT_COLOR,jt._defaultColor||ne._defaultLineColor]]}get propertiesToUpdate(){return[[Tt.FREETEXT_SIZE,h(this,bs)],[Tt.FREETEXT_COLOR,h(this,tn)]]}_translateEmpty(e,s){this._uiManager.translateSelectedEditors(e,s,!0)}getInitialTranslation(){const e=this.parentScale;return[-jt._internalPadding*e,-(jt._internalPadding+h(this,bs))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(gt.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),_(this,Ia,new AbortController);const e=this._uiManager.combinedSignal(h(this,Ia));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){var e;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",h(this,Fu)),this._isDraggable=!0,(e=h(this,Ia))==null||e.abort(),_(this,Ia,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var e;this.width||(this.enableEditMode(),this.editorDiv.focus(),(e=this._initialOptions)!=null&&e.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=h(this,ys),s=_(this,ys,w(this,eg,CA).call(this).trimEnd());if(e===s)return;const n=i=>{if(_(this,ys,i),!i){this.remove();return}w(this,Ml,yf).call(this),this._uiManager.rebuild(this),w(this,Pl,mf).call(this)};this.addCommands({cmd:()=>{n(s)},undo:()=>{n(e)},mustExec:!1}),w(this,Pl,mf).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){jt._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,s;this.width&&(e=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",h(this,Fu)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:n}=this.editorDiv;if(n.fontSize=`calc(${h(this,bs)}px * var(--scale-factor))`,n.color=h(this,tn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Mf(this,this.div,["dblclick","keydown"]),this.width){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);const[u,d]=this.pageDimensions,[f,p]=this.pageTranslation;let g,m;switch(this.rotation){case 0:g=e+(o[0]-f)/u,m=s+this.height-(o[1]-p)/d;break;case 90:g=e+(o[0]-f)/u,m=s-(o[1]-p)/d,[l,c]=[c,-l];break;case 180:g=e-this.width+(o[0]-f)/u,m=s-(o[1]-p)/d,[l,c]=[-l,-c];break;case 270:g=e+(o[0]-f-this.height*d)/u,m=s+(o[1]-p-this.width*u)/d,[l,c]=[-c,l];break}this.setAt(g*i,m*a,l,c)}else this.setAt(e*i,s*a,this.width*i,this.height*a);w(this,Ml,yf).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var g,m,v;const s=e.clipboardData||window.clipboardData,{types:n}=s;if(n.length===1&&n[0]==="text/plain")return;e.preventDefault();const i=w(g=jt,Bu,Av).call(g,s.getData("text")||"").replaceAll(Gd,`
`);if(!i)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:c}=o,u=[],d=[];if(l.nodeType===Node.TEXT_NODE){const y=l.parentElement;if(d.push(l.nodeValue.slice(c).replaceAll(Gd,"")),y!==this.editorDiv){let S=u;for(const T of this.editorDiv.childNodes){if(T===y){S=d;continue}S.push(w(m=jt,Ol,vf).call(m,T))}}u.push(l.nodeValue.slice(0,c).replaceAll(Gd,""))}else if(l===this.editorDiv){let y=u,S=0;for(const T of this.editorDiv.childNodes)S++===c&&(y=d),y.push(w(v=jt,Ol,vf).call(v,T))}_(this,ys,`${u.join(`
`)}${i}${d.join(`
`)}`),w(this,Ml,yf).call(this);const f=new Range;let p=u.reduce((y,S)=>y+S.length,0);for(const{firstChild:y}of this.editorDiv.childNodes)if(y.nodeType===Node.TEXT_NODE){const S=y.nodeValue.length;if(p<=S){f.setStart(y,p),f.setEnd(y,p);break}p-=S}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(e,s,n){var o;let i=null;if(e instanceof yA){const{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:u,rotation:d,id:f,popupRef:p},textContent:g,textPosition:m,parent:{page:{pageNumber:v}}}=e;if(!g||g.length===0)return null;i=e={annotationType:gt.FREETEXT,color:Array.from(c),fontSize:l,value:g.join(`
`),position:m,pageIndex:v-1,rect:u.slice(0),rotation:d,id:f,deleted:!1,popupRef:p}}const a=await super.deserialize(e,s,n);return _(a,bs,e.fontSize),_(a,tn,lt.makeHexColor(...e.color)),_(a,ys,w(o=jt,Bu,Av).call(o,e.value)),a.annotationElementId=e.id||null,a._initialData=i,a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=jt._internalPadding*this.parentScale,n=this.getRect(s,s),i=ne._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:h(this,tn)),a={annotationType:gt.FREETEXT,color:i,fontSize:h(this,bs),value:w(this,sg,EA).call(this),pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?a:this.annotationElementId&&!w(this,ng,xA).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(e){const s=super.renderAnnotationElement(e);if(this.deleted)return s;const{style:n}=s;n.fontSize=`calc(${h(this,bs)}px * var(--scale-factor))`,n.color=h(this,tn),s.replaceChildren();for(const a of h(this,ys).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),s.append(o)}const i=jt._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(i,i),popupContent:h(this,ys)}),s}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};tn=new WeakMap,ys=new WeakMap,Fu=new WeakMap,Ia=new WeakMap,bs=new WeakMap,Jp=new WeakSet,SA=function(e){const s=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-h(this,bs))*this.parentScale),_(this,bs,i),w(this,Pl,mf).call(this)},n=h(this,bs);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Tt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},tg=new WeakSet,TA=function(e){const s=i=>{_(this,tn,this.editorDiv.style.color=i)},n=h(this,tn);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Tt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},eg=new WeakSet,CA=function(){var n;const e=[];this.editorDiv.normalize();let s=null;for(const i of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(w(n=jt,Ol,vf).call(n,i)),s=i);return e.join(`
`)},Pl=new WeakSet,mf=function(){const[e,s]=this.parentDimensions;let n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{const{currentLayer:i,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",i.div.append(this.div),n=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=n.width/e,this.height=n.height/s):(this.width=n.height/e,this.height=n.width/s),this.fixAndSetPosition()},Ol=new WeakSet,vf=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Gd,"")},Ml=new WeakSet,yf=function(){if(this.editorDiv.replaceChildren(),!!h(this,ys))for(const e of h(this,ys).split(`
`)){const s=document.createElement("div");s.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(s)}},sg=new WeakSet,EA=function(){return h(this,ys).replaceAll(" "," ")},Bu=new WeakSet,Av=function(e){return e.replaceAll(" "," ")},ng=new WeakSet,xA=function(e){const{value:s,fontSize:n,color:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||e.value!==s||e.fontSize!==n||e.color.some((o,l)=>o!==i[l])||e.pageIndex!==a},b(jt,Ol),b(jt,Bu),at(jt,"_freeTextDefaultContent",""),at(jt,"_internalPadding",0),at(jt,"_defaultColor",null),at(jt,"_defaultFontSize",10),at(jt,"_type","freetext"),at(jt,"_editorType",gt.FREETEXT);let _v=jt;class st{toSVGPath(){Ft("Abstract method `toSVGPath` must be implemented.")}get box(){Ft("Abstract getter `box` must be implemented.")}serialize(t,e){Ft("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,n,i,a){a||(a=new Float32Array(t.length));for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o]*n,a[o+1]=s+t[o+1]*i;return a}static _rescaleAndSwap(t,e,s,n,i,a){a||(a=new Float32Array(t.length));for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o+1]*n,a[o+1]=s+t[o]*i;return a}static _translate(t,e,s,n){n||(n=new Float32Array(t.length));for(let i=0,a=t.length;i<a;i+=2)n[i]=e+t[i],n[i+1]=s+t[i+1];return n}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,n,i){switch(i){case 90:return[1-e/s,t/n];case 180:return[1-t/s,1-e/n];case 270:return[e/s,1-t/n];default:return[t/s,e/n]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,n,i,a){return[(t+5*s)/6,(e+5*n)/6,(5*s+i)/6,(5*n+a)/6,(s+i)/2,(n+a)/2]}}at(st,"PRECISION",1e-4);var _s,en,kl,Dl,kn,_t,Ra,Pa,Vu,$u,Nl,Ll,fr,ju,ig,rg,Oa,jc,ag,IA,og,RA,lg,PA,cg,OA,hg,MA,ug,kA;const ii=class ii{constructor({x:t,y:e},s,n,i,a,o=0){b(this,Oa);b(this,ag);b(this,og);b(this,lg);b(this,cg);b(this,hg);b(this,ug);b(this,_s,void 0);b(this,en,[]);b(this,kl,void 0);b(this,Dl,void 0);b(this,kn,[]);b(this,_t,new Float32Array(18));b(this,Ra,void 0);b(this,Pa,void 0);b(this,Vu,void 0);b(this,$u,void 0);b(this,Nl,void 0);b(this,Ll,void 0);b(this,fr,[]);_(this,_s,s),_(this,Ll,i*n),_(this,Dl,a),h(this,_t).set([NaN,NaN,NaN,NaN,t,e],6),_(this,kl,o),_(this,$u,h(ii,ju)*n),_(this,Vu,h(ii,rg)*n),_(this,Nl,n),h(this,fr).push(t,e)}isEmpty(){return isNaN(h(this,_t)[8])}add({x:t,y:e}){var R;_(this,Ra,t),_(this,Pa,e);const[s,n,i,a]=h(this,_s);let[o,l,c,u]=h(this,_t).subarray(8,12);const d=t-c,f=e-u,p=Math.hypot(d,f);if(p<h(this,Vu))return!1;const g=p-h(this,$u),m=g/p,v=m*d,y=m*f;let S=o,T=l;o=c,l=u,c+=v,u+=y,(R=h(this,fr))==null||R.push(t,e);const E=-y/g,A=v/g,C=E*h(this,Ll),x=A*h(this,Ll);return h(this,_t).set(h(this,_t).subarray(2,8),0),h(this,_t).set([c+C,u+x],4),h(this,_t).set(h(this,_t).subarray(14,18),12),h(this,_t).set([c-C,u-x],16),isNaN(h(this,_t)[6])?(h(this,kn).length===0&&(h(this,_t).set([o+C,l+x],2),h(this,kn).push(NaN,NaN,NaN,NaN,(o+C-s)/i,(l+x-n)/a),h(this,_t).set([o-C,l-x],14),h(this,en).push(NaN,NaN,NaN,NaN,(o-C-s)/i,(l-x-n)/a)),h(this,_t).set([S,T,o,l,c,u],6),!this.isEmpty()):(h(this,_t).set([S,T,o,l,c,u],6),Math.abs(Math.atan2(T-l,S-o)-Math.atan2(y,v))<Math.PI/2?([o,l,c,u]=h(this,_t).subarray(2,6),h(this,kn).push(NaN,NaN,NaN,NaN,((o+c)/2-s)/i,((l+u)/2-n)/a),[o,l,S,T]=h(this,_t).subarray(14,18),h(this,en).push(NaN,NaN,NaN,NaN,((S+o)/2-s)/i,((T+l)/2-n)/a),!0):([S,T,o,l,c,u]=h(this,_t).subarray(0,6),h(this,kn).push(((S+5*o)/6-s)/i,((T+5*l)/6-n)/a,((5*o+c)/6-s)/i,((5*l+u)/6-n)/a,((o+c)/2-s)/i,((l+u)/2-n)/a),[c,u,o,l,S,T]=h(this,_t).subarray(12,18),h(this,en).push(((S+5*o)/6-s)/i,((T+5*l)/6-n)/a,((5*o+c)/6-s)/i,((5*l+u)/6-n)/a,((o+c)/2-s)/i,((l+u)/2-n)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=h(this,kn),e=h(this,en);if(isNaN(h(this,_t)[6])&&!this.isEmpty())return w(this,ag,IA).call(this);const s=[];s.push(`M${t[4]} ${t[5]}`);for(let n=6;n<t.length;n+=6)isNaN(t[n])?s.push(`L${t[n+4]} ${t[n+5]}`):s.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);w(this,lg,PA).call(this,s);for(let n=e.length-6;n>=6;n-=6)isNaN(e[n])?s.push(`L${e[n+4]} ${e[n+5]}`):s.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);return w(this,og,RA).call(this,s),s.join(" ")}newFreeDrawOutline(t,e,s,n,i,a){return new DA(t,e,s,n,i,a)}getOutlines(){var d;const t=h(this,kn),e=h(this,en),s=h(this,_t),[n,i,a,o]=h(this,_s),l=new Float32Array((((d=h(this,fr))==null?void 0:d.length)??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(h(this,fr)[f]-n)/a,l[f+1]=(h(this,fr)[f+1]-i)/o;if(l[l.length-2]=(h(this,Ra)-n)/a,l[l.length-1]=(h(this,Pa)-i)/o,isNaN(s[6])&&!this.isEmpty())return w(this,cg,OA).call(this,l);const c=new Float32Array(h(this,kn).length+24+h(this,en).length);let u=t.length;for(let f=0;f<u;f+=2){if(isNaN(t[f])){c[f]=c[f+1]=NaN;continue}c[f]=t[f],c[f+1]=t[f+1]}u=w(this,ug,kA).call(this,c,u);for(let f=e.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(e[f+p])){c[u]=c[u+1]=NaN,u+=2;continue}c[u]=e[f+p],c[u+1]=e[f+p+1],u+=2}return w(this,hg,MA).call(this,c,u),this.newFreeDrawOutline(c,l,h(this,_s),h(this,Nl),h(this,kl),h(this,Dl))}};_s=new WeakMap,en=new WeakMap,kl=new WeakMap,Dl=new WeakMap,kn=new WeakMap,_t=new WeakMap,Ra=new WeakMap,Pa=new WeakMap,Vu=new WeakMap,$u=new WeakMap,Nl=new WeakMap,Ll=new WeakMap,fr=new WeakMap,ju=new WeakMap,ig=new WeakMap,rg=new WeakMap,Oa=new WeakSet,jc=function(){const t=h(this,_t).subarray(4,6),e=h(this,_t).subarray(16,18),[s,n,i,a]=h(this,_s);return[(h(this,Ra)+(t[0]-e[0])/2-s)/i,(h(this,Pa)+(t[1]-e[1])/2-n)/a,(h(this,Ra)+(e[0]-t[0])/2-s)/i,(h(this,Pa)+(e[1]-t[1])/2-n)/a]},ag=new WeakSet,IA=function(){const[t,e,s,n]=h(this,_s),[i,a,o,l]=w(this,Oa,jc).call(this);return`M${(h(this,_t)[2]-t)/s} ${(h(this,_t)[3]-e)/n} L${(h(this,_t)[4]-t)/s} ${(h(this,_t)[5]-e)/n} L${i} ${a} L${o} ${l} L${(h(this,_t)[16]-t)/s} ${(h(this,_t)[17]-e)/n} L${(h(this,_t)[14]-t)/s} ${(h(this,_t)[15]-e)/n} Z`},og=new WeakSet,RA=function(t){const e=h(this,en);t.push(`L${e[4]} ${e[5]} Z`)},lg=new WeakSet,PA=function(t){const[e,s,n,i]=h(this,_s),a=h(this,_t).subarray(4,6),o=h(this,_t).subarray(16,18),[l,c,u,d]=w(this,Oa,jc).call(this);t.push(`L${(a[0]-e)/n} ${(a[1]-s)/i} L${l} ${c} L${u} ${d} L${(o[0]-e)/n} ${(o[1]-s)/i}`)},cg=new WeakSet,OA=function(t){const e=h(this,_t),[s,n,i,a]=h(this,_s),[o,l,c,u]=w(this,Oa,jc).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-s)/i,(e[3]-n)/a,NaN,NaN,NaN,NaN,(e[4]-s)/i,(e[5]-n)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,(e[16]-s)/i,(e[17]-n)/a,NaN,NaN,NaN,NaN,(e[14]-s)/i,(e[15]-n)/a],0),this.newFreeDrawOutline(d,t,h(this,_s),h(this,Nl),h(this,kl),h(this,Dl))},hg=new WeakSet,MA=function(t,e){const s=h(this,en);return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6},ug=new WeakSet,kA=function(t,e){const s=h(this,_t).subarray(4,6),n=h(this,_t).subarray(16,18),[i,a,o,l]=h(this,_s),[c,u,d,f]=w(this,Oa,jc).call(this);return t.set([NaN,NaN,NaN,NaN,(s[0]-i)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(n[0]-i)/o,(n[1]-a)/l],e),e+=24},b(ii,ju,8),b(ii,ig,2),b(ii,rg,h(ii,ju)+h(ii,ig));let Df=ii;var Fl,Ma,Ai,Uu,As,Wu,ce,dg,NA;class DA extends st{constructor(e,s,n,i,a,o){super();b(this,dg);b(this,Fl,void 0);b(this,Ma,new Float32Array(4));b(this,Ai,void 0);b(this,Uu,void 0);b(this,As,void 0);b(this,Wu,void 0);b(this,ce,void 0);_(this,ce,e),_(this,As,s),_(this,Fl,n),_(this,Wu,i),_(this,Ai,a),_(this,Uu,o),this.lastPoint=[NaN,NaN],w(this,dg,NA).call(this,o);const[l,c,u,d]=h(this,Ma);for(let f=0,p=e.length;f<p;f+=2)e[f]=(e[f]-l)/u,e[f+1]=(e[f+1]-c)/d;for(let f=0,p=s.length;f<p;f+=2)s[f]=(s[f]-l)/u,s[f+1]=(s[f+1]-c)/d}toSVGPath(){const e=[`M${h(this,ce)[4]} ${h(this,ce)[5]}`];for(let s=6,n=h(this,ce).length;s<n;s+=6){if(isNaN(h(this,ce)[s])){e.push(`L${h(this,ce)[s+4]} ${h(this,ce)[s+5]}`);continue}e.push(`C${h(this,ce)[s]} ${h(this,ce)[s+1]} ${h(this,ce)[s+2]} ${h(this,ce)[s+3]} ${h(this,ce)[s+4]} ${h(this,ce)[s+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,s,n,i],a){const o=n-e,l=i-s;let c,u;switch(a){case 0:c=st._rescale(h(this,ce),e,i,o,-l),u=st._rescale(h(this,As),e,i,o,-l);break;case 90:c=st._rescaleAndSwap(h(this,ce),e,s,o,l),u=st._rescaleAndSwap(h(this,As),e,s,o,l);break;case 180:c=st._rescale(h(this,ce),n,s,-o,l),u=st._rescale(h(this,As),n,s,-o,l);break;case 270:c=st._rescaleAndSwap(h(this,ce),n,i,-o,-l),u=st._rescaleAndSwap(h(this,As),n,i,-o,-l);break}return{outline:Array.from(c),points:[Array.from(u)]}}get box(){return h(this,Ma)}newOutliner(e,s,n,i,a,o=0){return new Df(e,s,n,i,a,o)}getNewOutline(e,s){const[n,i,a,o]=h(this,Ma),[l,c,u,d]=h(this,Fl),f=a*u,p=o*d,g=n*u+l,m=i*d+c,v=this.newOutliner({x:h(this,As)[0]*f+g,y:h(this,As)[1]*p+m},h(this,Fl),h(this,Wu),e,h(this,Uu),s??h(this,Ai));for(let y=2;y<h(this,As).length;y+=2)v.add({x:h(this,As)[y]*f+g,y:h(this,As)[y+1]*p+m});return v.getOutlines()}}Fl=new WeakMap,Ma=new WeakMap,Ai=new WeakMap,Uu=new WeakMap,As=new WeakMap,Wu=new WeakMap,ce=new WeakMap,dg=new WeakSet,NA=function(e){const s=h(this,ce);let n=s[4],i=s[5],a=n,o=i,l=n,c=i,u=n,d=i;const f=e?Math.max:Math.min;for(let g=6,m=s.length;g<m;g+=6){if(isNaN(s[g]))a=Math.min(a,s[g+4]),o=Math.min(o,s[g+5]),l=Math.max(l,s[g+4]),c=Math.max(c,s[g+5]),d<s[g+5]?(u=s[g+4],d=s[g+5]):d===s[g+5]&&(u=f(u,s[g+4]));else{const v=lt.bezierBoundingBox(n,i,...s.slice(g,g+6));a=Math.min(a,v[0]),o=Math.min(o,v[1]),l=Math.max(l,v[2]),c=Math.max(c,v[3]),d<v[3]?(u=v[2],d=v[3]):d===v[3]&&(u=f(u,v[2]))}n=s[g+4],i=s[g+5]}const p=h(this,Ma);p[0]=a-h(this,Ai),p[1]=o-h(this,Ai),p[2]=l-a+2*h(this,Ai),p[3]=c-o+2*h(this,Ai),this.lastPoint=[u,d]};var Hu,zu,pr,sn,fg,LA,Bl,bf,pg,FA,gg,BA,Gu,Sv;class wv{constructor(t,e=0,s=0,n=!0){b(this,fg);b(this,Bl);b(this,pg);b(this,gg);b(this,Gu);b(this,Hu,void 0);b(this,zu,void 0);b(this,pr,[]);b(this,sn,[]);let i=1/0,a=-1/0,o=1/0,l=-1/0;const u=10**-4;for(const{x:y,y:S,width:T,height:E}of t){const A=Math.floor((y-e)/u)*u,C=Math.ceil((y+T+e)/u)*u,x=Math.floor((S-e)/u)*u,I=Math.ceil((S+E+e)/u)*u,R=[A,x,I,!0],O=[C,x,I,!1];h(this,pr).push(R,O),i=Math.min(i,A),a=Math.max(a,C),o=Math.min(o,x),l=Math.max(l,I)}const d=a-i+2*s,f=l-o+2*s,p=i-s,g=o-s,m=h(this,pr).at(n?-1:-2),v=[m[0],m[2]];for(const y of h(this,pr)){const[S,T,E]=y;y[0]=(S-p)/d,y[1]=(T-g)/f,y[2]=(E-g)/f}_(this,Hu,new Float32Array([p,g,d,f])),_(this,zu,v)}getOutlines(){h(this,pr).sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of h(this,pr))e[3]?(t.push(...w(this,Gu,Sv).call(this,e)),w(this,pg,FA).call(this,e)):(w(this,gg,BA).call(this,e),t.push(...w(this,Gu,Sv).call(this,e)));return w(this,fg,LA).call(this,t)}}Hu=new WeakMap,zu=new WeakMap,pr=new WeakMap,sn=new WeakMap,fg=new WeakSet,LA=function(t){const e=[],s=new Set;for(const a of t){const[o,l,c]=a;e.push([o,l,a],[o,c,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){const l=e[a][2],c=e[a+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const n=[];let i;for(;s.size>0;){const a=s.values().next().value;let[o,l,c,u,d]=a;s.delete(a);let f=o,p=l;for(i=[o,c],n.push(i);;){let g;if(s.has(u))g=u;else if(s.has(d))g=d;else break;s.delete(g),[o,l,c,u,d]=g,f!==o&&(i.push(f,p,o,p===l?l:c),f=o),p=p===l?c:l}i.push(f,p)}return new GC(n,h(this,Hu),h(this,zu))},Bl=new WeakSet,bf=function(t){const e=h(this,sn);let s=0,n=e.length-1;for(;s<=n;){const i=s+n>>1,a=e[i][0];if(a===t)return i;a<t?s=i+1:n=i-1}return n+1},pg=new WeakSet,FA=function([,t,e]){const s=w(this,Bl,bf).call(this,t);h(this,sn).splice(s,0,[t,e])},gg=new WeakSet,BA=function([,t,e]){const s=w(this,Bl,bf).call(this,t);for(let n=s;n<h(this,sn).length;n++){const[i,a]=h(this,sn)[n];if(i!==t)break;if(i===t&&a===e){h(this,sn).splice(n,1);return}}for(let n=s-1;n>=0;n--){const[i,a]=h(this,sn)[n];if(i!==t)break;if(i===t&&a===e){h(this,sn).splice(n,1);return}}},Gu=new WeakSet,Sv=function(t){const[e,s,n]=t,i=[[e,s,n]],a=w(this,Bl,bf).call(this,n);for(let o=0;o<a;o++){const[l,c]=h(this,sn)[o];for(let u=0,d=i.length;u<d;u++){const[,f,p]=i[u];if(!(c<=f||p<=l)){if(f>=l){if(p>c)i[u][1]=c;else{if(d===1)return[];i.splice(u,1),u--,d--}continue}i[u][2]=l,p>c&&i.push([e,c,p])}}}return i};var Xu,Vl;class GC extends st{constructor(e,s,n){super();b(this,Xu,void 0);b(this,Vl,void 0);_(this,Vl,e),_(this,Xu,s),this.lastPoint=n}toSVGPath(){const e=[];for(const s of h(this,Vl)){let[n,i]=s;e.push(`M${n} ${i}`);for(let a=2;a<s.length;a+=2){const o=s[a],l=s[a+1];o===n?(e.push(`V${l}`),i=l):l===i&&(e.push(`H${o}`),n=o)}e.push("Z")}return e.join(" ")}serialize([e,s,n,i],a){const o=[],l=n-e,c=i-s;for(const u of h(this,Vl)){const d=new Array(u.length);for(let f=0;f<u.length;f+=2)d[f]=e+u[f]*l,d[f+1]=i-u[f+1]*c;o.push(d)}return o}get box(){return h(this,Xu)}get classNamesForOutlining(){return["highlightOutline"]}}Xu=new WeakMap,Vl=new WeakMap;class Tv extends Df{newFreeDrawOutline(t,e,s,n,i,a){return new XC(t,e,s,n,i,a)}}class XC extends DA{newOutliner(t,e,s,n,i,a=0){return new Tv(t,e,s,n,i,a)}}var nn,ka,$l,Ae,Yu,jl,Ku,qu,gr,rn,Ul,Zu,Qu,Cv,Ju,Ev,td,xv,wi,kr,mg,VA,Dn,$i;const os=class os{constructor({editor:t=null,uiManager:e=null}){b(this,Qu);b(this,Ju);b(this,td);b(this,wi);b(this,mg);b(this,Dn);b(this,nn,null);b(this,ka,null);b(this,$l,void 0);b(this,Ae,null);b(this,Yu,!1);b(this,jl,!1);b(this,Ku,null);b(this,qu,void 0);b(this,gr,null);b(this,rn,null);b(this,Ul,void 0);var s;t?(_(this,jl,!1),_(this,Ul,Tt.HIGHLIGHT_COLOR),_(this,Ku,t)):(_(this,jl,!0),_(this,Ul,Tt.HIGHLIGHT_DEFAULT_COLOR)),_(this,rn,(t==null?void 0:t._uiManager)||e),_(this,qu,h(this,rn)._eventBus),_(this,$l,(t==null?void 0:t.color)||((s=h(this,rn))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),h(os,Zu)||_(os,Zu,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return At(this,"_keyboardManager",new Ad([[["Escape","mac+Escape"],os.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],os.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],os.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],os.prototype._moveToPrevious],[["Home","mac+Home"],os.prototype._moveToBeginning],[["End","mac+End"],os.prototype._moveToEnd]]))}renderButton(){const t=_(this,nn,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);const e=h(this,rn)._signal;t.addEventListener("click",w(this,wi,kr).bind(this),{signal:e}),t.addEventListener("keydown",w(this,td,xv).bind(this),{signal:e});const s=_(this,ka,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=h(this,$l),t.append(s),t}renderMainDropdown(){const t=_(this,Ae,w(this,Qu,Cv).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}_colorSelectFromKeyboard(t){if(t.target===h(this,nn)){w(this,wi,kr).call(this,t);return}const e=t.target.getAttribute("data-color");e&&w(this,Ju,Ev).call(this,e,t)}_moveToNext(t){var e,s;if(!h(this,Dn,$i)){w(this,wi,kr).call(this,t);return}if(t.target===h(this,nn)){(e=h(this,Ae).firstChild)==null||e.focus();return}(s=t.target.nextSibling)==null||s.focus()}_moveToPrevious(t){var e,s;if(t.target===((e=h(this,Ae))==null?void 0:e.firstChild)||t.target===h(this,nn)){h(this,Dn,$i)&&this._hideDropdownFromKeyboard();return}h(this,Dn,$i)||w(this,wi,kr).call(this,t),(s=t.target.previousSibling)==null||s.focus()}_moveToBeginning(t){var e;if(!h(this,Dn,$i)){w(this,wi,kr).call(this,t);return}(e=h(this,Ae).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!h(this,Dn,$i)){w(this,wi,kr).call(this,t);return}(e=h(this,Ae).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=h(this,Ae))==null||t.classList.add("hidden"),(e=h(this,gr))==null||e.abort(),_(this,gr,null)}_hideDropdownFromKeyboard(){var t;if(!h(this,jl)){if(!h(this,Dn,$i)){(t=h(this,Ku))==null||t.unselect();return}this.hideDropdown(),h(this,nn).focus({preventScroll:!0,focusVisible:h(this,Yu)})}}updateColor(t){if(h(this,ka)&&(h(this,ka).style.backgroundColor=t),!h(this,Ae))return;const e=h(this,rn).highlightColors.values();for(const s of h(this,Ae).children)s.setAttribute("aria-selected",e.next().value===t)}destroy(){var t,e;(t=h(this,nn))==null||t.remove(),_(this,nn,null),_(this,ka,null),(e=h(this,Ae))==null||e.remove(),_(this,Ae,null)}};nn=new WeakMap,ka=new WeakMap,$l=new WeakMap,Ae=new WeakMap,Yu=new WeakMap,jl=new WeakMap,Ku=new WeakMap,qu=new WeakMap,gr=new WeakMap,rn=new WeakMap,Ul=new WeakMap,Zu=new WeakMap,Qu=new WeakSet,Cv=function(){const t=document.createElement("div"),e=h(this,rn)._signal;t.addEventListener("contextmenu",pn,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,n]of h(this,rn).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",n),i.title=s,i.setAttribute("data-l10n-id",h(os,Zu)[s]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=n,i.setAttribute("aria-selected",n===h(this,$l)),i.addEventListener("click",w(this,Ju,Ev).bind(this,n),{signal:e}),t.append(i)}return t.addEventListener("keydown",w(this,td,xv).bind(this),{signal:e}),t},Ju=new WeakSet,Ev=function(t,e){e.stopPropagation(),h(this,qu).dispatch("switchannotationeditorparams",{source:this,type:h(this,Ul),value:t})},td=new WeakSet,xv=function(t){os._keyboardManager.exec(this,t)},wi=new WeakSet,kr=function(t){if(h(this,Dn,$i)){this.hideDropdown();return}if(_(this,Yu,t.detail===0),h(this,gr)||(_(this,gr,new AbortController),window.addEventListener("pointerdown",w(this,mg,VA).bind(this),{signal:h(this,rn).combinedSignal(h(this,gr))})),h(this,Ae)){h(this,Ae).classList.remove("hidden");return}const e=_(this,Ae,w(this,Qu,Cv).call(this));h(this,nn).append(e)},mg=new WeakSet,VA=function(t){var e;(e=h(this,Ae))!=null&&e.contains(t.target)||this.hideDropdown()},Dn=new WeakSet,$i=function(){return h(this,Ae)&&!h(this,Ae).classList.contains("hidden")},b(os,Zu,null);let Nf=os;var Wl,ed,Si,Da,Hl,hs,sd,nd,Na,Ls,ws,Le,zl,Ti,ze,Gl,Fs,id,rd,Iv,Xl,_f,vg,$A,yg,jA,bg,UA,ad,Rv,Ci,Dr,mr,wo,_g,WA,Yl,Af,La,Uc,Ag,HA,wg,zA,Sg,GA,Tg,XA,Cg,YA;const It=class It extends ne{constructor(e){super({...e,name:"highlightEditor"});b(this,rd);b(this,Xl);b(this,vg);b(this,yg);b(this,bg);b(this,ad);b(this,Ci);b(this,_g);b(this,Yl);b(this,La);b(this,Ag);b(this,wg);b(this,Cg);b(this,Wl,null);b(this,ed,0);b(this,Si,void 0);b(this,Da,null);b(this,Hl,null);b(this,hs,null);b(this,sd,null);b(this,nd,0);b(this,Na,null);b(this,Ls,null);b(this,ws,null);b(this,Le,!1);b(this,zl,null);b(this,Ti,void 0);b(this,ze,null);b(this,Gl,"");b(this,Fs,void 0);b(this,id,"");this.color=e.color||It._defaultColor,_(this,Fs,e.thickness||It._defaultThickness),_(this,Ti,e.opacity||It._defaultOpacity),_(this,Si,e.boxes||null),_(this,id,e.methodOfCreation||""),_(this,Gl,e.text||""),this._isDraggable=!1,e.highlightId>-1?(_(this,Le,!0),w(this,Xl,_f).call(this,e),w(this,Ci,Dr).call(this)):h(this,Si)&&(_(this,Wl,e.anchorNode),_(this,ed,e.anchorOffset),_(this,sd,e.focusNode),_(this,nd,e.focusOffset),w(this,rd,Iv).call(this),w(this,Ci,Dr).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const e=It.prototype;return At(this,"_keyboardManager",new Ad([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:h(this,Le)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:h(this,Fs),methodOfCreation:h(this,id)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,s){var n;ne.initialize(e,s),It._defaultColor||(It._defaultColor=((n=s.highlightColors)==null?void 0:n.values().next().value)||"#fff066")}static updateDefaultParams(e,s){switch(e){case Tt.HIGHLIGHT_DEFAULT_COLOR:It._defaultColor=s;break;case Tt.HIGHLIGHT_THICKNESS:It._defaultThickness=s;break}}translateInPage(e,s){}get toolbarPosition(){return h(this,zl)}updateParams(e,s){switch(e){case Tt.HIGHLIGHT_COLOR:w(this,vg,$A).call(this,s);break;case Tt.HIGHLIGHT_THICKNESS:w(this,yg,jA).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Tt.HIGHLIGHT_DEFAULT_COLOR,It._defaultColor],[Tt.HIGHLIGHT_THICKNESS,It._defaultThickness]]}get propertiesToUpdate(){return[[Tt.HIGHLIGHT_COLOR,this.color||It._defaultColor],[Tt.HIGHLIGHT_THICKNESS,h(this,Fs)||It._defaultThickness],[Tt.HIGHLIGHT_FREE,h(this,Le)]]}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(_(this,Hl,new Nf({editor:this})),e.addColorPicker(h(this,Hl))),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(w(this,La,Uc).call(this))}getBaseTranslation(){return[0,0]}getRect(e,s){return super.getRect(e,s,w(this,La,Uc).call(this))}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this.div.focus()}remove(){w(this,ad,Rv).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,Ci,Dr).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var n;let s=!1;this.parent&&!e?w(this,ad,Rv).call(this):e&&(w(this,Ci,Dr).call(this,e),s=!this.parent&&((n=this.div)==null?void 0:n.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),s&&this.select()}rotate(e){var i,a,o;const{drawLayer:s}=this.parent;let n;h(this,Le)?(e=(e-this.rotation+360)%360,n=w(i=It,mr,wo).call(i,h(this,Ls).box,e)):n=w(a=It,mr,wo).call(a,[this.x,this.y,this.width,this.height],e),s.updateProperties(h(this,ws),{bbox:n,root:{"data-main-rotation":e}}),s.updateProperties(h(this,ze),{bbox:w(o=It,mr,wo).call(o,h(this,hs).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();h(this,Gl)&&(e.setAttribute("aria-label",h(this,Gl)),e.setAttribute("role","mark")),h(this,Le)?e.classList.add("free"):this.div.addEventListener("keydown",w(this,_g,WA).bind(this),{signal:this._uiManager._signal});const s=_(this,Na,document.createElement("div"));e.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=h(this,Da);const[n,i]=this.parentDimensions;return this.setDims(this.width*n,this.height*i),Mf(this,h(this,Na),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(h(this,ze),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(h(this,ze),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:w(this,Yl,Af).call(this,!0);break;case 1:case 3:w(this,Yl,Af).call(this,!1);break}}select(){var e;super.select(),h(this,ze)&&((e=this.parent)==null||e.drawLayer.updateProperties(h(this,ze),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),h(this,ze)&&((e=this.parent)==null||e.drawLayer.updateProperties(h(this,ze),{rootClass:{selected:!1}}),h(this,Le)||w(this,Yl,Af).call(this,!1))}get _mustFixPosition(){return!h(this,Le)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(h(this,ws),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(h(this,ze),{rootClass:{hidden:!e}}))}static startHighlighting(e,s,{target:n,x:i,y:a}){const{x:o,y:l,width:c,height:u}=n.getBoundingClientRect(),d=new AbortController,f=e.combinedSignal(d),p=g=>{d.abort(),w(this,Tg,XA).call(this,e,g)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",hn,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",pn,{signal:f}),n.addEventListener("pointermove",w(this,Sg,GA).bind(this,e),{signal:f}),this._freeHighlight=new Tv({x:i,y:a},[o,l,c,u],e.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,s,n){var m,v,y,S;let i=null;if(e instanceof _A){const{data:{quadPoints:T,rect:E,rotation:A,id:C,color:x,opacity:I,popupRef:R},parent:{page:{pageNumber:O}}}=e;i=e={annotationType:gt.HIGHLIGHT,color:Array.from(x),opacity:I,quadPoints:T,boxes:null,pageIndex:O-1,rect:E.slice(0),rotation:A,id:C,deleted:!1,popupRef:R}}else if(e instanceof py){const{data:{inkLists:T,rect:E,rotation:A,id:C,color:x,borderStyle:{rawWidth:I},popupRef:R},parent:{page:{pageNumber:O}}}=e;i=e={annotationType:gt.HIGHLIGHT,color:Array.from(x),thickness:I,inkLists:T,boxes:null,pageIndex:O-1,rect:E.slice(0),rotation:A,id:C,deleted:!1,popupRef:R}}const{color:a,quadPoints:o,inkLists:l,opacity:c}=e,u=await super.deserialize(e,s,n);u.color=lt.makeHexColor(...a),_(u,Ti,c||1),l&&_(u,Fs,e.thickness),u.annotationElementId=e.id||null,u._initialData=i;const[d,f]=u.pageDimensions,[p,g]=u.pageTranslation;if(o){const T=_(u,Si,[]);for(let E=0;E<o.length;E+=8)T.push({x:(o[E]-p)/d,y:1-(o[E+1]-g)/f,width:(o[E+2]-o[E])/d,height:(o[E+1]-o[E+5])/f});w(m=u,rd,Iv).call(m),w(v=u,Ci,Dr).call(v),u.rotate(u.rotation)}else if(l){_(u,Le,!0);const T=l[0],E={x:T[0]-p,y:f-(T[1]-g)},A=new Tv(E,[0,0,d,f],1,h(u,Fs)/2,!0,.001);for(let I=0,R=T.length;I<R;I+=2)E.x=T[I]-p,E.y=f-(T[I+1]-g),A.add(E);const{id:C,clipPathId:x}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:A.toSVGPath()}},!0,!0);w(y=u,Xl,_f).call(y,{highlightOutlines:A.getOutlines(),highlightId:C,clipPathId:x}),w(S=u,Ci,Dr).call(S)}return u}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),n=ne._colorManager.convert(this.color),i={annotationType:gt.HIGHLIGHT,color:n,opacity:h(this,Ti),thickness:h(this,Fs),quadPoints:w(this,Ag,HA).call(this),outlines:w(this,wg,zA).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:w(this,La,Uc).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!w(this,Cg,YA).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Wl=new WeakMap,ed=new WeakMap,Si=new WeakMap,Da=new WeakMap,Hl=new WeakMap,hs=new WeakMap,sd=new WeakMap,nd=new WeakMap,Na=new WeakMap,Ls=new WeakMap,ws=new WeakMap,Le=new WeakMap,zl=new WeakMap,Ti=new WeakMap,ze=new WeakMap,Gl=new WeakMap,Fs=new WeakMap,id=new WeakMap,rd=new WeakSet,Iv=function(){const e=new wv(h(this,Si),.001);_(this,Ls,e.getOutlines()),[this.x,this.y,this.width,this.height]=h(this,Ls).box;const s=new wv(h(this,Si),.0025,.001,this._uiManager.direction==="ltr");_(this,hs,s.getOutlines());const{lastPoint:n}=h(this,hs);_(this,zl,[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height])},Xl=new WeakSet,_f=function({highlightOutlines:e,highlightId:s,clipPathId:n}){var d,f;_(this,Ls,e);const i=1.5;if(_(this,hs,e.getNewOutline(h(this,Fs)/2+i,.0025)),s>=0)_(this,ws,s),_(this,Da,n),this.parent.drawLayer.finalizeDraw(s,{bbox:e.box,path:{d:e.toSVGPath()}}),_(this,ze,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:h(this,hs).box,path:{d:h(this,hs).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(h(this,ws),{bbox:w(d=It,mr,wo).call(d,h(this,Ls).box,(p-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(h(this,ze),{bbox:w(f=It,mr,wo).call(f,h(this,hs).box,p),path:{d:h(this,hs).toSVGPath()}})}const[a,o,l,c]=e.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=c;break;case 90:{const[p,g]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*g/p,this.height=c*p/g;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=c;break;case 270:{const[p,g]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*g/p,this.height=c*p/g;break}}const{lastPoint:u}=h(this,hs);_(this,zl,[(u[0]-a)/l,(u[1]-o)/c])},vg=new WeakSet,$A=function(e){const s=(a,o)=>{var l,c;this.color=a,_(this,Ti,o),(l=this.parent)==null||l.drawLayer.updateProperties(h(this,ws),{root:{fill:a,"fill-opacity":o}}),(c=h(this,Hl))==null||c.updateColor(a)},n=this.color,i=h(this,Ti);this.addCommands({cmd:s.bind(this,e,It._defaultOpacity),undo:s.bind(this,n,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Tt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)},yg=new WeakSet,jA=function(e){const s=h(this,Fs),n=i=>{_(this,Fs,i),w(this,bg,UA).call(this,i)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Tt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},bg=new WeakSet,UA=function(e){if(!h(this,Le))return;w(this,Xl,_f).call(this,{highlightOutlines:h(this,Ls).getNewOutline(e/2)}),this.fixAndSetPosition();const[s,n]=this.parentDimensions;this.setDims(this.width*s,this.height*n)},ad=new WeakSet,Rv=function(){h(this,ws)===null||!this.parent||(this.parent.drawLayer.remove(h(this,ws)),_(this,ws,null),this.parent.drawLayer.remove(h(this,ze)),_(this,ze,null))},Ci=new WeakSet,Dr=function(e=this.parent){h(this,ws)===null&&({id:qe(this,ws)._,clipPathId:qe(this,Da)._}=e.drawLayer.draw({bbox:h(this,Ls).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":h(this,Ti)},rootClass:{highlight:!0,free:h(this,Le)},path:{d:h(this,Ls).toSVGPath()}},!1,!0),_(this,ze,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:h(this,Le)},bbox:h(this,hs).box,path:{d:h(this,hs).toSVGPath()}},h(this,Le))),h(this,Na)&&(h(this,Na).style.clipPath=h(this,Da)))},mr=new WeakSet,wo=function([e,s,n,i],a){switch(a){case 90:return[1-s-i,e,i,n];case 180:return[1-e-n,1-s-i,n,i];case 270:return[s,1-e-n,i,n]}return[e,s,n,i]},_g=new WeakSet,WA=function(e){It._keyboardManager.exec(this,e)},Yl=new WeakSet,Af=function(e){if(!h(this,Wl))return;const s=window.getSelection();e?s.setPosition(h(this,Wl),h(this,ed)):s.setPosition(h(this,sd),h(this,nd))},La=new WeakSet,Uc=function(){return h(this,Le)?this.rotation:0},Ag=new WeakSet,HA=function(){if(h(this,Le))return null;const[e,s]=this.pageDimensions,[n,i]=this.pageTranslation,a=h(this,Si),o=new Float32Array(a.length*8);let l=0;for(const{x:c,y:u,width:d,height:f}of a){const p=c*e+n,g=(1-u)*s+i;o[l]=o[l+4]=p,o[l+1]=o[l+3]=g,o[l+2]=o[l+6]=p+d*e,o[l+5]=o[l+7]=g-f*s,l+=8}return o},wg=new WeakSet,zA=function(e){return h(this,Ls).serialize(e,w(this,La,Uc).call(this))},Sg=new WeakSet,GA=function(e,s){this._freeHighlight.add(s)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Tg=new WeakSet,XA=function(e,s){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Cg=new WeakSet,YA=function(e){const{color:s}=this._initialData;return e.color.some((n,i)=>n!==s[i])},b(It,mr),b(It,Sg),b(It,Tg),at(It,"_defaultColor",null),at(It,"_defaultOpacity",1),at(It,"_defaultThickness",12),at(It,"_type","highlight"),at(It,"_editorType",gt.HIGHLIGHT),at(It,"_freeHighlightId",-1),at(It,"_freeHighlight",null),at(It,"_freeHighlightClipId","");let Lf=It;var Fa;class YC{constructor(){b(this,Fa,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))this.updateProperty(e,s)}updateSVGProperty(t,e){h(this,Fa)[t]=e}toSVGProperties(){const t=h(this,Fa);return _(this,Fa,Object.create(null)),{root:t}}reset(){_(this,Fa,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){Ft("Not implemented")}}Fa=new WeakMap;var Ss,Kl,od,Ov,ld,Mv,cd,kv,Ba,Wc,Eg,KA,ql,wf,Va,Hc,vr,So;const Os=class Os extends ne{constructor(e){super(e);b(this,od);b(this,ld);b(this,cd);b(this,Ba);b(this,Eg);b(this,ql);b(this,Va);b(this,vr);b(this,Ss,null);b(this,Kl,void 0);at(this,"_drawId",null);_(this,Kl,e.mustBeCommitted||!1),e.drawOutlines&&(w(this,od,Ov).call(this,e),w(this,Ba,Wc).call(this))}static _mergeSVGProperties(e,s){const n=new Set(Object.keys(e));for(const[i,a]of Object.entries(s))n.has(i)?Object.assign(e[i],a):e[i]=a;return e}static getDefaultDrawingOptions(e){Ft("Not implemented")}static get typesMap(){Ft("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,s){const n=this.typesMap.get(e);n&&this._defaultDrawingOptions.updateProperty(n,s),this._currentParent&&(this._currentDraw.updateProperty(n,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,s){const n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,s)}static get defaultPropertiesToUpdate(){const e=[],s=this._defaultDrawingOptions;for(const[n,i]of this.typesMap)e.push([n,s[i]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:s}=this;for(const[n,i]of this.constructor.typesMap)e.push([n,s[i]]);return e}_updateProperty(e,s,n){const i=this._drawingOptions,a=i[s],o=l=>{var u;i.updateProperty(s,l);const c=h(this,Ss).updateProperty(s,l);c&&w(this,Va,Hc).call(this,c),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,n),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,Os._mergeSVGProperties(h(this,Ss).getPathResizingSVGProperties(w(this,ql,wf).call(this)),{bbox:w(this,vr,So).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,Os._mergeSVGProperties(h(this,Ss).getPathResizedSVGProperties(w(this,ql,wf).call(this)),{bbox:w(this,vr,So).call(this)}))}_onTranslating(e,s){var n;(n=this.parent)==null||n.drawLayer.updateProperties(this._drawId,{bbox:w(this,vr,So).call(this,e,s)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,Os._mergeSVGProperties(h(this,Ss).getPathTranslatedSVGProperties(w(this,ql,wf).call(this),this.parentDimensions),{bbox:w(this,vr,So).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,h(this,Kl)&&(_(this,Kl,!1),this.commit(),this.parent.setSelected(this),this.isOnScreen&&this.div.focus())}remove(){w(this,cd,kv).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,Ba,Wc).call(this),w(this,Va,Hc).call(this,h(this,Ss).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var n;let s=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),w(this,cd,kv).call(this)):e&&(this._uiManager.addShouldRescale(this),w(this,Ba,Wc).call(this,e),s=!this.parent&&((n=this.div)==null?void 0:n.classList.contains("selectedEditor"))),super.setParent(e),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Os._mergeSVGProperties({bbox:w(this,vr,So).call(this)},h(this,Ss).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&w(this,Va,Hc).call(this,h(this,Ss).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const e=super.render();e.classList.add("draw");const s=document.createElement("div");e.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[n,i]=this.parentDimensions;return this.setDims(this.width*n,this.height*i),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,s,n,i,a){Ft("Not implemented")}static startDrawing(e,s,n,{target:i,offsetX:a,offsetY:o}){var p;const{viewport:{rotation:l}}=e,{width:c,height:u}=i.getBoundingClientRect(),d=new AbortController,f=e.combinedSignal(d);if(window.addEventListener("pointerup",g=>{d.abort(),e.toggleDrawing(!0),this._endDraw(g)},{signal:f}),window.addEventListener("pointerdown",hn,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",pn,{signal:f}),i.addEventListener("pointermove",this._drawMove.bind(this),{signal:f}),e.toggleDrawing(),(p=s._editorUndoBar)==null||p.hide(),this._currentDraw){e.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.startNew(a,o,c,u,l));return}s.updateUIForDefaultProperties(this),this._currentDraw=this.createDrawerInstance(a,o,c,u,l),this._currentDrawingOptions=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(this._currentDrawingOptions.toSVGProperties(),this._currentDraw.defaultSVGProperties),!0,!1)}static _drawMove({offsetX:e,offsetY:s}){this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.add(e,s))}static _endDraw({offsetX:e,offsetY:s}){const n=this._currentParent;if(n.drawLayer.updateProperties(this._currentDrawId,this._currentDraw.end(e,s)),this.supportMultipleDrawings){const i=this._currentDraw,a=this._currentDrawId,o=i.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(a,i.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(a,i.removeLastElement())},mustExec:!1,type:Tt.DRAW_STEP});return}this.endDrawing(!1)}static endDrawing(e){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Tt.DRAW_STEP),!this._currentDraw.isEmpty()){const{pageDimensions:[n,i],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:this._currentDraw.getOutlines(n*a,i*a,a,this._INNER_MARGIN),drawingOptions:this._currentDrawingOptions,mustBeCommitted:!e});return this._cleanup(),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(),null}static _cleanup(){this._currentDrawId=-1,this._currentDraw=null,this._currentDrawingOptions=null,this._currentParent=null}createDrawingOptions(e){}static deserializeDraw(e,s,n,i,a,o){Ft("Not implemented")}static async deserialize(e,s,n){var d,f;const{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:l}}=s.viewport,c=this.deserializeDraw(o,l,i,a,this._INNER_MARGIN,e),u=await super.deserialize(e,s,n);return u.createDrawingOptions(e),w(d=u,od,Ov).call(d,{drawOutlines:c}),w(f=u,Ba,Wc).call(f),u.onScaleChanging(),u.rotate(),u}serializeDraw(e){const[s,n]=this.pageTranslation,[i,a]=this.pageDimensions;return h(this,Ss).serialize([s,n,i,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ss=new WeakMap,Kl=new WeakMap,od=new WeakSet,Ov=function({drawOutlines:e,drawId:s,drawingOptions:n}){_(this,Ss,e),this._drawingOptions||(this._drawingOptions=n),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,e.defaultProperties)):this._drawId=w(this,ld,Mv).call(this,e,this.parent),w(this,Va,Hc).call(this,e.box)},ld=new WeakSet,Mv=function(e,s){const{id:n}=s.drawLayer.draw(Os._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return n},cd=new WeakSet,kv=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Ba=new WeakSet,Wc=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=w(this,ld,Mv).call(this,h(this,Ss),e)}},Eg=new WeakSet,KA=function([e,s,n,i]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[s,1-e,n*(o/a),i*(a/o)];case 180:return[1-e,1-s,n,i];case 270:return[1-s,e,n*(o/a),i*(a/o)];default:return[e,s,n,i]}},ql=new WeakSet,wf=function(){const{x:e,y:s,width:n,height:i,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-s,e,n*(a/o),i*(o/a)];case 180:return[1-e,1-s,n,i];case 270:return[s,1-e,n*(a/o),i*(o/a)];default:return[e,s,n,i]}},Va=new WeakSet,Hc=function(e){if([this.x,this.y,this.width,this.height]=w(this,Eg,KA).call(this,e),this.div){this.fixAndSetPosition();const[s,n]=this.parentDimensions;this.setDims(this.width*s,this.height*n)}this._onResized()},vr=new WeakSet,So=function(){const{x:e,y:s,width:n,height:i,rotation:a,parentRotation:o,parentDimensions:[l,c]}=this;switch((a*4+o)/90){case 1:return[1-s-i,e,i,n];case 2:return[1-e-n,1-s-i,n,i];case 3:return[s,1-e-n,i,n];case 4:return[e,s-n*(l/c),i*(c/l),n*(l/c)];case 5:return[1-s,e,n*(l/c),i*(c/l)];case 6:return[1-e-i*(c/l),1-s,i*(c/l),n*(l/c)];case 7:return[s-n*(l/c),1-e-i*(c/l),n*(l/c),i*(c/l)];case 8:return[e-n,s-i,n,i];case 9:return[1-s,e-n,i,n];case 10:return[1-e,1-s,n,i];case 11:return[s-i,1-e,i,n];case 12:return[e-i*(c/l),s,i*(c/l),n*(l/c)];case 13:return[1-s-n*(l/c),e-i*(c/l),n*(l/c),i*(c/l)];case 14:return[1-e,1-s-n*(l/c),i*(c/l),n*(l/c)];case 15:return[s,1-e,n*(l/c),i*(c/l)];default:return[e,s,n,i]}},at(Os,"_currentDrawId",-1),at(Os,"_currentDraw",null),at(Os,"_currentDrawingOptions",null),at(Os,"_currentParent",null),at(Os,"_INNER_MARGIN",3);let Pv=Os;var Nn,Ie,Re,$a,Zl,us,Fe,Bs,ja,Ua,Wa,Ql,Sf;class KC{constructor(t,e,s,n,i,a){b(this,Ql);b(this,Nn,new Float64Array(6));b(this,Ie,void 0);b(this,Re,void 0);b(this,$a,void 0);b(this,Zl,void 0);b(this,us,void 0);b(this,Fe,"");b(this,Bs,0);b(this,ja,new Ff);b(this,Ua,void 0);b(this,Wa,void 0);_(this,Ua,s),_(this,Wa,n),_(this,$a,i),_(this,Zl,a),[t,e]=w(this,Ql,Sf).call(this,t,e);const o=_(this,Ie,[NaN,NaN,NaN,NaN,t,e]);_(this,us,[t,e]),_(this,Re,[{line:o,points:h(this,us)}]),h(this,Nn).set(o,0)}updateProperty(t,e){t==="stroke-width"&&_(this,Zl,e)}isEmpty(){return!h(this,Re)||h(this,Re).length===0}add(t,e){[t,e]=w(this,Ql,Sf).call(this,t,e);const[s,n,i,a]=h(this,Nn).subarray(2,6),o=t-i,l=e-a;return Math.hypot(h(this,Ua)*o,h(this,Wa)*l)<=2?null:(h(this,us).push(t,e),isNaN(s)?(h(this,Nn).set([i,a,t,e],2),h(this,Ie).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(h(this,Nn)[0])&&h(this,Ie).splice(6,6),h(this,Nn).set([s,n,i,a,t,e],0),h(this,Ie).push(...st.createBezierPoints(s,n,i,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(h(this,us).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,n,i){_(this,Ua,s),_(this,Wa,n),_(this,$a,i),[t,e]=w(this,Ql,Sf).call(this,t,e);const a=_(this,Ie,[NaN,NaN,NaN,NaN,t,e]);_(this,us,[t,e]);const o=h(this,Re).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),h(this,Re).push({line:a,points:h(this,us)}),h(this,Nn).set(a,0),_(this,Bs,0),this.toSVGPath(),null}getLastElement(){return h(this,Re).at(-1)}setLastElement(t){return h(this,Re)?(h(this,Re).push(t),_(this,Ie,t.line),_(this,us,t.points),_(this,Bs,0),{path:{d:this.toSVGPath()}}):h(this,ja).setLastElement(t)}removeLastElement(){if(!h(this,Re))return h(this,ja).removeLastElement();h(this,Re).pop(),_(this,Fe,"");for(let t=0,e=h(this,Re).length;t<e;t++){const{line:s,points:n}=h(this,Re)[t];_(this,Ie,s),_(this,us,n),_(this,Bs,0),this.toSVGPath()}return{path:{d:h(this,Fe)}}}toSVGPath(){const t=st.svgRound(h(this,Ie)[4]),e=st.svgRound(h(this,Ie)[5]);if(h(this,us).length===2)return _(this,Fe,`${h(this,Fe)} M ${t} ${e} Z`),h(this,Fe);if(h(this,us).length<=6){const n=h(this,Fe).lastIndexOf("M");_(this,Fe,`${h(this,Fe).slice(0,n)} M ${t} ${e}`),_(this,Bs,6)}if(h(this,us).length===4){const n=st.svgRound(h(this,Ie)[10]),i=st.svgRound(h(this,Ie)[11]);return _(this,Fe,`${h(this,Fe)} L ${n} ${i}`),_(this,Bs,12),h(this,Fe)}const s=[];h(this,Bs)===0&&(s.push(`M ${t} ${e}`),_(this,Bs,6));for(let n=h(this,Bs),i=h(this,Ie).length;n<i;n+=6){const[a,o,l,c,u,d]=h(this,Ie).slice(n,n+6).map(st.svgRound);s.push(`C${a} ${o} ${l} ${c} ${u} ${d}`)}return _(this,Fe,h(this,Fe)+s.join(" ")),_(this,Bs,h(this,Ie).length),h(this,Fe)}getOutlines(t,e,s,n){const i=h(this,Re).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),h(this,ja).build(h(this,Re),t,e,s,h(this,$a),h(this,Zl),n),_(this,Nn,null),_(this,Ie,null),_(this,Re,null),_(this,Fe,null),h(this,ja)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Nn=new WeakMap,Ie=new WeakMap,Re=new WeakMap,$a=new WeakMap,Zl=new WeakMap,us=new WeakMap,Fe=new WeakMap,Bs=new WeakMap,ja=new WeakMap,Ua=new WeakMap,Wa=new WeakMap,Ql=new WeakSet,Sf=function(t,e){return st._normalizePoint(t,e,h(this,Ua),h(this,Wa),h(this,$a))};var Je,hd,ud,Ts,Ln,Fn,Jl,tc,ec,an,ei,xg,qA,Ig,ZA,Rg,QA;const o0=class o0 extends st{constructor(){super(...arguments);b(this,an);b(this,xg);b(this,Ig);b(this,Rg);b(this,Je,void 0);b(this,hd,0);b(this,ud,void 0);b(this,Ts,void 0);b(this,Ln,void 0);b(this,Fn,void 0);b(this,Jl,void 0);b(this,tc,void 0);b(this,ec,void 0)}build(e,s,n,i,a,o,l){_(this,Ln,s),_(this,Fn,n),_(this,Jl,i),_(this,tc,a),_(this,ec,o),_(this,ud,l??0),_(this,Ts,e),w(this,Ig,ZA).call(this)}setLastElement(e){return h(this,Ts).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return h(this,Ts).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:s}of h(this,Ts)){if(e.push(`M${st.svgRound(s[4])} ${st.svgRound(s[5])}`),s.length===6){e.push("Z");continue}if(s.length===12){e.push(`L${st.svgRound(s[10])} ${st.svgRound(s[11])}`);continue}for(let n=6,i=s.length;n<i;n+=6){const[a,o,l,c,u,d]=s.subarray(n,n+6).map(st.svgRound);e.push(`C${a} ${o} ${l} ${c} ${u} ${d}`)}}return e.join("")}serialize([e,s,n,i],a){const o=[],l=[],[c,u,d,f]=w(this,xg,qA).call(this);let p,g,m,v,y,S,T,E,A;switch(h(this,tc)){case 0:A=st._rescale,p=e,g=s+i,m=n,v=-i,y=e+c*n,S=s+(1-u-f)*i,T=e+(c+d)*n,E=s+(1-u)*i;break;case 90:A=st._rescaleAndSwap,p=e,g=s,m=n,v=i,y=e+u*n,S=s+c*i,T=e+(u+f)*n,E=s+(c+d)*i;break;case 180:A=st._rescale,p=e+n,g=s,m=-n,v=i,y=e+(1-c-d)*n,S=s+u*i,T=e+(1-c)*n,E=s+(u+f)*i;break;case 270:A=st._rescaleAndSwap,p=e+n,g=s+i,m=-n,v=-i,y=e+(1-u-f)*n,S=s+(1-c-d)*i,T=e+(1-u)*n,E=s+(1-c)*i;break}for(const{line:C,points:x}of h(this,Ts))o.push(A(C,p,g,m,v,a?new Array(C.length):null)),l.push(A(x,p,g,m,v,a?new Array(x.length):null));return{lines:o,points:l,rect:[y,S,T,E]}}static deserialize(e,s,n,i,a,{paths:{lines:o,points:l},rotation:c,thickness:u}){const d=[];let f,p,g,m,v;switch(c){case 0:v=st._rescale,f=-e/n,p=s/i+1,g=1/n,m=-1/i;break;case 90:v=st._rescaleAndSwap,f=-s/i,p=-e/n,g=1/i,m=1/n;break;case 180:v=st._rescale,f=e/n+1,p=-s/i,g=-1/n,m=1/i;break;case 270:v=st._rescaleAndSwap,f=s/i+1,p=e/n+1,g=-1/i,m=-1/n;break}if(!o){o=[];for(const S of l){const T=S.length;if(T===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(T===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const E=new Float32Array(3*(T-2));o.push(E);let[A,C,x,I]=S.subarray(0,4);E.set([NaN,NaN,NaN,NaN,A,C],0);for(let R=4;R<T;R+=2){const O=S[R],P=S[R+1];E.set(st.createBezierPoints(A,C,x,I,O,P),(R-2)*3),[A,C,x,I]=[x,I,O,P]}}}for(let S=0,T=o.length;S<T;S++)d.push({line:v(o[S].map(E=>E??NaN),f,p,g,m),points:v(l[S].map(E=>E??NaN),f,p,g,m)});const y=new o0;return y.build(d,n,i,1,c,u,a),y}get box(){return h(this,Je)}updateProperty(e,s){return e==="stroke-width"?w(this,Rg,QA).call(this,s):null}updateParentDimensions([e,s],n){const[i,a]=w(this,an,ei).call(this);_(this,Ln,e),_(this,Fn,s),_(this,Jl,n);const[o,l]=w(this,an,ei).call(this),c=o-i,u=l-a,d=h(this,Je);return d[0]-=c,d[1]-=u,d[2]+=2*c,d[3]+=2*u,d}updateRotation(e){return _(this,hd,e),{path:{transform:this.rotationTransform}}}get viewBox(){return h(this,Je).map(st.svgRound).join(" ")}get defaultProperties(){const[e,s]=h(this,Je);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${st.svgRound(e)} ${st.svgRound(s)}`}}}get rotationTransform(){const[,,e,s]=h(this,Je);let n=0,i=0,a=0,o=0,l=0,c=0;switch(h(this,hd)){case 90:i=s/e,a=-e/s,l=e;break;case 180:n=-1,o=-1,l=e,c=s;break;case 270:i=-s/e,a=e/s,c=s;break;default:return""}return`matrix(${n} ${i} ${a} ${o} ${st.svgRound(l)} ${st.svgRound(c)})`}getPathResizingSVGProperties([e,s,n,i]){const[a,o]=w(this,an,ei).call(this),[l,c,u,d]=h(this,Je);if(Math.abs(u-a)<=st.PRECISION||Math.abs(d-o)<=st.PRECISION){const v=e+n/2-(l+u/2),y=s+i/2-(c+d/2);return{path:{"transform-origin":`${st.svgRound(e)} ${st.svgRound(s)}`,transform:`${this.rotationTransform} translate(${v} ${y})`}}}const f=(n-2*a)/(u-2*a),p=(i-2*o)/(d-2*o),g=u/n,m=d/i;return{path:{"transform-origin":`${st.svgRound(l)} ${st.svgRound(c)}`,transform:`${this.rotationTransform} scale(${g} ${m}) translate(${st.svgRound(a)} ${st.svgRound(o)}) scale(${f} ${p}) translate(${st.svgRound(-a)} ${st.svgRound(-o)})`}}}getPathResizedSVGProperties([e,s,n,i]){const[a,o]=w(this,an,ei).call(this),l=h(this,Je),[c,u,d,f]=l;if(l[0]=e,l[1]=s,l[2]=n,l[3]=i,Math.abs(d-a)<=st.PRECISION||Math.abs(f-o)<=st.PRECISION){const y=e+n/2-(c+d/2),S=s+i/2-(u+f/2);for(const{line:T,points:E}of h(this,Ts))st._translate(T,y,S,T),st._translate(E,y,S,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${st.svgRound(e)} ${st.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(n-2*a)/(d-2*a),g=(i-2*o)/(f-2*o),m=-p*(c+a)+e+a,v=-g*(u+o)+s+o;if(p!==1||g!==1||m!==0||v!==0)for(const{line:y,points:S}of h(this,Ts))st._rescale(y,m,v,p,g,y),st._rescale(S,m,v,p,g,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${st.svgRound(e)} ${st.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,s],n){const[i,a]=n,o=h(this,Je),l=e-o[0],c=s-o[1];if(h(this,Ln)===i&&h(this,Fn)===a)for(const{line:u,points:d}of h(this,Ts))st._translate(u,l,c,u),st._translate(d,l,c,d);else{const u=h(this,Ln)/i,d=h(this,Fn)/a;_(this,Ln,i),_(this,Fn,a);for(const{line:f,points:p}of h(this,Ts))st._rescale(f,l,c,u,d,f),st._rescale(p,l,c,u,d,p);o[2]*=u,o[3]*=d}return o[0]=e,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${st.svgRound(e)} ${st.svgRound(s)}`}}}get defaultSVGProperties(){const e=h(this,Je);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${st.svgRound(e[0])} ${st.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}};Je=new WeakMap,hd=new WeakMap,ud=new WeakMap,Ts=new WeakMap,Ln=new WeakMap,Fn=new WeakMap,Jl=new WeakMap,tc=new WeakMap,ec=new WeakMap,an=new WeakSet,ei=function(e=h(this,ec)){const s=h(this,ud)+e/2*h(this,Jl);return h(this,tc)%180===0?[s/h(this,Ln),s/h(this,Fn)]:[s/h(this,Fn),s/h(this,Ln)]},xg=new WeakSet,qA=function(){const[e,s,n,i]=h(this,Je),[a,o]=w(this,an,ei).call(this,0);return[e+a,s+o,n-2*a,i-2*o]},Ig=new WeakSet,ZA=function(){const e=_(this,Je,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of h(this,Ts)){if(i.length<=12){for(let l=4,c=i.length;l<c;l+=6){const[u,d]=i.subarray(l,l+2);e[0]=Math.min(e[0],u),e[1]=Math.min(e[1],d),e[2]=Math.max(e[2],u),e[3]=Math.max(e[3],d)}continue}let a=i[4],o=i[5];for(let l=6,c=i.length;l<c;l+=6){const[u,d,f,p,g,m]=i.subarray(l,l+6);lt.bezierBoundingBox(a,o,u,d,f,p,g,m,e),a=g,o=m}}const[s,n]=w(this,an,ei).call(this);e[0]=Math.min(1,Math.max(0,e[0]-s)),e[1]=Math.min(1,Math.max(0,e[1]-n)),e[2]=Math.min(1,Math.max(0,e[2]+s)),e[3]=Math.min(1,Math.max(0,e[3]+n)),e[2]-=e[0],e[3]-=e[1]},Rg=new WeakSet,QA=function(e){const[s,n]=w(this,an,ei).call(this);_(this,ec,e);const[i,a]=w(this,an,ei).call(this),[o,l]=[i-s,a-n],c=h(this,Je);return c[0]-=o,c[1]-=l,c[2]+=2*o,c[3]+=2*l,c};let Ff=o0;var sc;const l0=class l0 extends YC{constructor(e){super();b(this,sc,void 0);_(this,sc,e),super.updateProperties({fill:"none",stroke:ne._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,s){e==="stroke-width"&&(s??(s=this["stroke-width"]),s*=h(this,sc).realScale),super.updateSVGProperty(e,s)}clone(){const e=new l0(h(this,sc));return e.updateAll(this),e}};sc=new WeakMap;let Dv=l0;var Pg,JA;const Po=class Po extends Pv{constructor(e){super({...e,name:"inkEditor"});b(this,Pg);this._willKeepAspectRatio=!0}static initialize(e,s){ne.initialize(e,s),this._defaultDrawingOptions=new Dv(s.viewParameters)}static getDefaultDrawingOptions(e){const s=this._defaultDrawingOptions.clone();return s.updateProperties(e),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return At(this,"typesMap",new Map([[Tt.INK_THICKNESS,"stroke-width"],[Tt.INK_COLOR,"stroke"],[Tt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,s,n,i,a){return new KC(e,s,n,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,s,n,i,a,o){return Ff.deserialize(e,s,n,i,a,o)}static async deserialize(e,s,n){let i=null;if(e instanceof py){const{data:{inkLists:o,rect:l,rotation:c,id:u,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:g},parent:{page:{pageNumber:m}}}=e;i=e={annotationType:gt.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:o},boxes:null,pageIndex:m-1,rect:l.slice(0),rotation:c,id:u,deleted:!1,popupRef:g}}const a=await super.deserialize(e,s,n);return a.annotationElementId=e.id||null,a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:s,parent:n}=this;s.updateSVGProperty("stroke-width"),n.drawLayer.updateProperties(e,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:s,opacity:n}){this._drawingOptions=Po.getDefaultDrawingOptions({stroke:lt.makeHexColor(...e),"stroke-width":s,"stroke-opacity":n})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:n,rect:i}=this.serializeDraw(e),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,c={annotationType:gt.INK,color:ne._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:s,points:n},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?c:this.annotationElementId&&!w(this,Pg,JA).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(e){const{points:s,rect:n}=this.serializeDraw(!1);return e.updateEdited({rect:n,thickness:this._drawingOptions["stroke-width"],points:s}),null}};Pg=new WeakSet,JA=function(e){const{color:s,thickness:n,opacity:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((o,l)=>o!==s[l])||e.thickness!==n||e.opacity!==i||e.pageIndex!==a},at(Po,"_type","ink"),at(Po,"_editorType",gt.INK),at(Po,"_defaultDrawingOptions",null);let Nv=Po;var ee,Be,yr,Ei,br,nc,Bn,xi,Vn,Cs,ic,Ha,zc,za,Gc,rc,Tf,dd,Fv,Og,tw,ac,Cf,fd,Bv,oc,Ef,Mg,ew,kg,sw;const Kc=class Kc extends ne{constructor(e){super({...e,name:"stampEditor"});b(this,Ha);b(this,za);b(this,rc);b(this,dd);b(this,Og);b(this,ac);b(this,fd);b(this,oc);b(this,Mg);b(this,kg);b(this,ee,null);b(this,Be,null);b(this,yr,null);b(this,Ei,null);b(this,br,null);b(this,nc,"");b(this,Bn,null);b(this,xi,null);b(this,Vn,null);b(this,Cs,!1);b(this,ic,!1);_(this,Ei,e.bitmapUrl),_(this,br,e.bitmapFile)}static initialize(e,s){ne.initialize(e,s)}static get supportedTypes(){return At(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return At(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,s){s.pasteEditor(gt.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const s=e.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(e=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:n}=this._uiManager;if(!n)throw new Error("No ML.");if(!await n.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=e||this.copyCanvas(null,null,!0).imageData,l=await n.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const c=l.output;return await this.setGuessedAltText(c),s&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var e,s;h(this,Be)&&(_(this,ee,null),this._uiManager.imageManager.deleteId(h(this,Be)),(e=h(this,Bn))==null||e.remove(),_(this,Bn,null),(s=h(this,xi))==null||s.disconnect(),_(this,xi,null),h(this,Vn)&&(clearTimeout(h(this,Vn)),_(this,Vn,null))),super.remove()}rebuild(){if(!this.parent){h(this,Be)&&w(this,rc,Tf).call(this);return}super.rebuild(),this.div!==null&&(h(this,Be)&&h(this,Bn)===null&&w(this,rc,Tf).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(h(this,yr)||h(this,ee)||h(this,Ei)||h(this,br)||h(this,Be))}get isResizable(){return!0}render(){if(this.div)return this.div;let e,s;if(this.width&&(e=this.x,s=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),h(this,ee)?w(this,dd,Fv).call(this):w(this,rc,Tf).call(this),this.width&&!this.annotationElementId){const[n,i]=this.parentDimensions;this.setAt(e*n,s*i,this.width*n,this.height*i)}return this.div}copyCanvas(e,s,n=!1){var p;e||(e=224);const{width:i,height:a}=h(this,ee),o=new Dm;let l=h(this,ee),c=i,u=a,d=null;if(s){if(i>s||a>s){const I=Math.min(s/i,s/a);c=Math.floor(i*I),u=Math.floor(a*I)}d=document.createElement("canvas");const g=d.width=Math.ceil(c*o.sx),m=d.height=Math.ceil(u*o.sy);h(this,Cs)||(l=w(this,ac,Cf).call(this,g,m));const v=d.getContext("2d");v.filter=this._uiManager.hcmFilter;let y="white",S="#cfcfd8";this._uiManager.hcmFilter!=="none"?S="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(y="#8f8f9d",S="#42414d");const T=15,E=T*o.sx,A=T*o.sy,C=new OffscreenCanvas(E*2,A*2),x=C.getContext("2d");x.fillStyle=y,x.fillRect(0,0,E*2,A*2),x.fillStyle=S,x.fillRect(0,0,E,A),x.fillRect(E,A,E,A),v.fillStyle=v.createPattern(C,"repeat"),v.fillRect(0,0,g,m),v.drawImage(l,0,0,l.width,l.height,0,0,g,m)}let f=null;if(n){let g,m;if(o.symmetric&&l.width<e&&l.height<e)g=l.width,m=l.height;else if(l=h(this,ee),i>e||a>e){const S=Math.min(e/i,e/a);g=Math.floor(i*S),m=Math.floor(a*S),h(this,Cs)||(l=w(this,ac,Cf).call(this,g,m))}const y=new OffscreenCanvas(g,m).getContext("2d",{willReadFrequently:!0});y.drawImage(l,0,0,l.width,l.height,0,0,g,m),f={width:g,height:m,data:y.getImageData(0,0,g,m).data}}return{canvas:d,width:c,height:u,imageData:f}}getImageForAltText(){return h(this,Bn)}static async deserialize(e,s,n){var m;let i=null;if(e instanceof AA){const{data:{rect:v,rotation:y,id:S,structParent:T,popupRef:E},container:A,parent:{page:{pageNumber:C}}}=e,x=A.querySelector("canvas"),I=n.imageManager.getFromCanvas(A.id,x);x.remove();const R=((m=await s._structTree.getAriaAttributes(`${ay}${S}`))==null?void 0:m.get("aria-label"))||"";i=e={annotationType:gt.STAMP,bitmapId:I.id,bitmap:I.bitmap,pageIndex:C-1,rect:v.slice(0),rotation:y,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:R},isSvg:!1,structParent:T,popupRef:E}}const a=await super.deserialize(e,s,n),{rect:o,bitmap:l,bitmapUrl:c,bitmapId:u,isSvg:d,accessibilityData:f}=e;u&&n.imageManager.isValidId(u)?(_(a,Be,u),l&&_(a,ee,l)):_(a,Ei,c),_(a,Cs,d);const[p,g]=a.pageDimensions;return a.width=(o[2]-o[0])/p,a.height=(o[3]-o[1])/g,a.annotationElementId=e.id||null,f&&(a.altTextData=f),a._initialData=i,_(a,ic,!!i),a}serialize(e=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n={annotationType:gt.STAMP,bitmapId:h(this,Be),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:h(this,Cs),structTreeParentId:this._structTreeParentId};if(e)return n.bitmapUrl=w(this,oc,Ef).call(this,!0),n.accessibilityData=this.serializeAltText(!0),n;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(n.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=w(this,kg,sw).call(this,n);if(l.isSame)return null;l.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,s===null)return n;s.stamps||(s.stamps=new Map);const o=h(this,Cs)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!s.stamps.has(h(this,Be)))s.stamps.set(h(this,Be),{area:o,serialized:n}),n.bitmap=w(this,oc,Ef).call(this,!1);else if(h(this,Cs)){const l=s.stamps.get(h(this,Be));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=w(this,oc,Ef).call(this,!1))}return n}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}};ee=new WeakMap,Be=new WeakMap,yr=new WeakMap,Ei=new WeakMap,br=new WeakMap,nc=new WeakMap,Bn=new WeakMap,xi=new WeakMap,Vn=new WeakMap,Cs=new WeakMap,ic=new WeakMap,Ha=new WeakSet,zc=function(e,s=!1){if(!e){this.remove();return}_(this,ee,e.bitmap),s||(_(this,Be,e.id),_(this,Cs,e.isSvg)),e.file&&_(this,nc,e.file.name),w(this,dd,Fv).call(this)},za=new WeakSet,Gc=function(){if(_(this,yr,null),this._uiManager.enableWaiting(!1),!!h(this,Bn)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&h(this,ee)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&h(this,ee)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},rc=new WeakSet,Tf=function(){if(h(this,Be)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(h(this,Be)).then(n=>w(this,Ha,zc).call(this,n,!0)).finally(()=>w(this,za,Gc).call(this));return}if(h(this,Ei)){const n=h(this,Ei);_(this,Ei,null),this._uiManager.enableWaiting(!0),_(this,yr,this._uiManager.imageManager.getFromUrl(n).then(i=>w(this,Ha,zc).call(this,i)).finally(()=>w(this,za,Gc).call(this)));return}if(h(this,br)){const n=h(this,br);_(this,br,null),this._uiManager.enableWaiting(!0),_(this,yr,this._uiManager.imageManager.getFromFile(n).then(i=>w(this,Ha,zc).call(this,i)).finally(()=>w(this,za,Gc).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=Kc.supportedTypesStr;const s=this._uiManager._signal;_(this,yr,new Promise(n=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),w(this,Ha,zc).call(this,i)}n()},{signal:s}),e.addEventListener("cancel",()=>{this.remove(),n()},{signal:s})}).finally(()=>w(this,za,Gc).call(this))),e.click()},dd=new WeakSet,Fv=function(){const{div:e}=this;let{width:s,height:n}=h(this,ee);const[i,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*i,n=this.height*a;else if(s>o*i||n>o*a){const d=Math.min(o*i/s,o*a/n);s*=d,n*=d}const[l,c]=this.parentDimensions;this.setDims(s*l/i,n*c/a),this._uiManager.enableWaiting(!1);const u=_(this,Bn,document.createElement("canvas"));u.setAttribute("role","img"),this.addContainer(u),(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),w(this,fd,Bv).call(this,s,n),w(this,Mg,ew).call(this),h(this,ic)||(this.parent.addUndoableEditor(this),_(this,ic,!0)),this._reportTelemetry({action:"inserted_image"}),h(this,nc)&&u.setAttribute("aria-label",h(this,nc))},Og=new WeakSet,tw=function(e,s){var o;const[n,i]=this.parentDimensions;this.width=e/n,this.height=s/i,(o=this._initialOptions)!=null&&o.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,h(this,Vn)!==null&&clearTimeout(h(this,Vn)),_(this,Vn,setTimeout(()=>{_(this,Vn,null),w(this,fd,Bv).call(this,e,s)},200))},ac=new WeakSet,Cf=function(e,s){const{width:n,height:i}=h(this,ee);let a=n,o=i,l=h(this,ee);for(;a>2*e||o>2*s;){const c=a,u=o;a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(a,o);d.getContext("2d").drawImage(l,0,0,c,u,0,0,a,o),l=d.transferToImageBitmap()}return l},fd=new WeakSet,Bv=function(e,s){const n=new Dm,i=Math.ceil(e*n.sx),a=Math.ceil(s*n.sy),o=h(this,Bn);if(!o||o.width===i&&o.height===a)return;o.width=i,o.height=a;const l=h(this,Cs)?h(this,ee):w(this,ac,Cf).call(this,i,a),c=o.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(l,0,0,l.width,l.height,0,0,i,a)},oc=new WeakSet,Ef=function(e){if(e){if(h(this,Cs)){const i=this._uiManager.imageManager.getSvgUrl(h(this,Be));if(i)return i}const s=document.createElement("canvas");return{width:s.width,height:s.height}=h(this,ee),s.getContext("2d").drawImage(h(this,ee),0,0),s.toDataURL()}if(h(this,Cs)){const[s,n]=this.pageDimensions,i=Math.round(this.width*s*Cr.PDF_TO_CSS_UNITS),a=Math.round(this.height*n*Cr.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,a);return o.getContext("2d").drawImage(h(this,ee),0,0,h(this,ee).width,h(this,ee).height,0,0,i,a),o.transferToImageBitmap()}return structuredClone(h(this,ee))},Mg=new WeakSet,ew=function(){this._uiManager._signal&&(_(this,xi,new ResizeObserver(e=>{const s=e[0].contentRect;s.width&&s.height&&w(this,Og,tw).call(this,s.width,s.height)})),h(this,xi).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var e;(e=h(this,xi))==null||e.disconnect(),_(this,xi,null)},{once:!0}))},kg=new WeakSet,sw=function(e){var o;const{pageIndex:s,accessibilityData:{altText:n}}=this._initialData,i=e.pageIndex===s,a=(((o=e.accessibilityData)==null?void 0:o.alt)||"")===n;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},at(Kc,"_type","stamp"),at(Kc,"_editorType",gt.STAMP);let Lv=Kc;var Ga,lc,$n,_r,Ii,Vs,Ar,cc,on,Ge,Ri,ot,wr,Dg,nw,$s,An,pd,$v,gd,jv,hc,xf;const zs=class zs{constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:n,accessibilityManager:i,annotationLayer:a,drawLayer:o,textLayer:l,viewport:c,l10n:u}){b(this,Dg);b(this,$s);b(this,pd);b(this,gd);b(this,hc);b(this,Ga,void 0);b(this,lc,!1);b(this,$n,null);b(this,_r,null);b(this,Ii,null);b(this,Vs,new Map);b(this,Ar,!1);b(this,cc,!1);b(this,on,null);b(this,Ge,null);b(this,Ri,null);b(this,ot,void 0);const d=[...h(zs,wr).values()];if(!zs._initialized){zs._initialized=!0;for(const f of d)f.initialize(u,t)}t.registerEditorTypes(d),_(this,ot,t),this.pageIndex=e,this.div=s,_(this,Ga,i),_(this,$n,a),this.viewport=c,_(this,Ge,l),this.drawLayer=o,this._structTree=n,h(this,ot).addLayer(this)}get isEmpty(){return h(this,Vs).size===0}get isInvisible(){return this.isEmpty&&h(this,ot).getMode()===gt.NONE}updateToolbar(t){h(this,ot).updateToolbar(t)}updateMode(t=h(this,ot).getMode()){switch(w(this,hc,xf).call(this),t){case gt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case gt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case gt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of h(zs,wr).values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=h(this,Ge))==null?void 0:e.div)}setEditingState(t){h(this,ot).setEditingState(t)}addCommands(t){h(this,ot).addCommands(t)}cleanUndoStack(t){h(this,ot).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=h(this,$n))==null||e.div.classList.toggle("disabled",!t)}async enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const t=new Set;for(const s of h(this,Vs).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(h(this,ot).removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!h(this,$n))return;const e=h(this,$n).getEditableAnnotations();for(const s of e){if(s.hide(),h(this,ot).isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const n=await this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}}disable(){var n;_(this,cc,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,e=new Map;for(const i of h(this,Vs).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){t.set(i.annotationElementId,i);continue}else e.set(i.annotationElementId,i);(n=this.getEditableAnnotation(i.annotationElementId))==null||n.show(),i.remove()}if(h(this,$n)){const i=h(this,$n).getEditableAnnotations();for(const a of i){const{id:o}=a.data;if(h(this,ot).isDeletedAnnotationElement(o))continue;let l=e.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=t.get(o),l&&(h(this,ot).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}w(this,hc,xf).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of h(zs,wr).values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),_(this,cc,!1)}getEditableAnnotation(t){var e;return((e=h(this,$n))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){h(this,ot).getActive()!==t&&h(this,ot).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=h(this,Ge))!=null&&t.div&&!h(this,Ri)){_(this,Ri,new AbortController);const e=h(this,ot).combinedSignal(h(this,Ri));h(this,Ge).div.addEventListener("pointerdown",w(this,Dg,nw).bind(this),{signal:e}),h(this,Ge).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=h(this,Ge))!=null&&t.div&&h(this,Ri)&&(h(this,Ri).abort(),_(this,Ri,null),h(this,Ge).div.classList.remove("highlighting"))}enableClick(){if(h(this,_r))return;_(this,_r,new AbortController);const t=h(this,ot).combinedSignal(h(this,_r));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t}),this.div.addEventListener("pointerup",this.pointerup.bind(this),{signal:t})}disableClick(){var t;(t=h(this,_r))==null||t.abort(),_(this,_r,null)}attach(t){h(this,Vs).set(t.id,t);const{annotationElementId:e}=t;e&&h(this,ot).isDeletedAnnotationElement(e)&&h(this,ot).removeDeletedAnnotationElement(t)}detach(t){var e;h(this,Vs).delete(t.id),(e=h(this,Ga))==null||e.removePointerInTextLayer(t.contentDiv),!h(this,cc)&&t.annotationElementId&&h(this,ot).addDeletedAnnotationElement(t)}remove(t){this.detach(t),h(this,ot).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(h(this,ot).addDeletedAnnotationElement(t.annotationElementId),ne.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),h(this,ot).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(),h(this,ot).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var s;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!h(this,Ii)&&(t._focusEventsAllowed=!1,_(this,Ii,setTimeout(()=>{_(this,Ii,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:h(this,ot)._signal}),e.focus())},0))),t._structTreeParentId=(s=h(this,Ga))==null?void 0:s.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return h(this,ot).getId()}combinedSignal(t){return h(this,ot).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=h(this,$s,An))==null?void 0:t.canCreateNewEmptyEditor()}pasteEditor(t,e){h(this,ot).updateToolbar(t),h(this,ot).updateMode(t);const{offsetX:s,offsetY:n}=w(this,gd,jv).call(this),i=this.getNextId(),a=w(this,pd,$v).call(this,{parent:this,id:i,x:s,y:n,uiManager:h(this,ot),isCentered:!0,...e});a&&this.add(a)}async deserialize(t){var e;return await((e=h(zs,wr).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,h(this,ot)))||null}createAndAddNewEditor(t,e,s={}){const n=this.getNextId(),i=w(this,pd,$v).call(this,{parent:this,id:n,x:t.offsetX,y:t.offsetY,uiManager:h(this,ot),isCentered:e,...s});return i&&this.add(i),i}addNewEditor(){this.createAndAddNewEditor(w(this,gd,jv).call(this),!0)}setSelected(t){h(this,ot).setSelected(t)}toggleSelected(t){h(this,ot).toggleSelected(t)}unselect(t){h(this,ot).unselect(t)}pointerup(t){var s;const{isMac:e}=ns.platform;if(!(t.button!==0||t.ctrlKey&&e)&&t.target===this.div&&h(this,Ar)&&(_(this,Ar,!1),!((s=h(this,$s,An))!=null&&s.isDrawer&&h(this,$s,An).supportMultipleDrawings))){if(!h(this,lc)){_(this,lc,!0);return}if(h(this,ot).getMode()===gt.STAMP){h(this,ot).unselectAll();return}this.createAndAddNewEditor(t,!1)}}pointerdown(t){var n;if(h(this,ot).getMode()===gt.HIGHLIGHT&&this.enableTextSelection(),h(this,Ar)){_(this,Ar,!1);return}const{isMac:e}=ns.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(_(this,Ar,!0),(n=h(this,$s,An))!=null&&n.isDrawer){this.startDrawingSession(t);return}const s=h(this,ot).getActive();_(this,lc,!s||s.isEmpty())}startDrawingSession(t){if(this.div.focus(),h(this,on)){h(this,$s,An).startDrawing(this,h(this,ot),!1,t);return}h(this,ot).setCurrentDrawingSession(this),_(this,on,new AbortController);const e=h(this,ot).combinedSignal(h(this,on));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&this.commitOrRemove()},{signal:e}),h(this,$s,An).startDrawing(this,h(this,ot),!1,t)}endDrawingSession(t=!1){return h(this,on)?(h(this,ot).setCurrentDrawingSession(null),h(this,on).abort(),_(this,on,null),h(this,$s,An).endDrawing(t)):null}findNewParent(t,e,s){const n=h(this,ot).findParent(e,s);return n===null||n===this?!1:(n.changeParent(t),!0)}commitOrRemove(){return h(this,on)?(this.endDrawingSession(),!0):!1}onScaleChanging(){h(this,on)&&h(this,$s,An).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=h(this,ot).getActive())==null?void 0:t.parent)===this&&(h(this,ot).commitOrRemove(),h(this,ot).setActiveEditor(null)),h(this,Ii)&&(clearTimeout(h(this,Ii)),_(this,Ii,null));for(const s of h(this,Vs).values())(e=h(this,Ga))==null||e.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,h(this,Vs).clear(),h(this,ot).removeLayer(this)}render({viewport:t}){this.viewport=t,qa(this.div,t);for(const e of h(this,ot).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){h(this,ot).commitOrRemove(),w(this,hc,xf).call(this);const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,qa(this.div,{rotation:s}),e!==s)for(const n of h(this,Vs).values())n.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return h(this,ot).viewParameters.realScale}};Ga=new WeakMap,lc=new WeakMap,$n=new WeakMap,_r=new WeakMap,Ii=new WeakMap,Vs=new WeakMap,Ar=new WeakMap,cc=new WeakMap,on=new WeakMap,Ge=new WeakMap,Ri=new WeakMap,ot=new WeakMap,wr=new WeakMap,Dg=new WeakSet,nw=function(t){h(this,ot).unselectAll();const{target:e}=t;if(e===h(this,Ge).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&h(this,Ge).div.contains(e)){const{isMac:s}=ns.platform;if(t.button!==0||t.ctrlKey&&s)return;h(this,ot).showAllEditors("highlight",!0,!0),h(this,Ge).div.classList.add("free"),this.toggleDrawing(),Lf.startHighlighting(this,h(this,ot).direction==="ltr",{target:h(this,Ge).div,x:t.x,y:t.y}),h(this,Ge).div.addEventListener("pointerup",()=>{h(this,Ge).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:h(this,ot)._signal}),t.preventDefault()}},$s=new WeakSet,An=function(){return h(zs,wr).get(h(this,ot).getMode())},pd=new WeakSet,$v=function(t){const e=h(this,$s,An);return e?new e.prototype.constructor(t):null},gd=new WeakSet,jv=function(){const{x:t,y:e,width:s,height:n}=this.div.getBoundingClientRect(),i=Math.max(0,t),a=Math.max(0,e),o=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+n),c=(i+o)/2-t,u=(a+l)/2-e,[d,f]=this.viewport.rotation%180===0?[c,u]:[u,c];return{offsetX:d,offsetY:f}},hc=new WeakSet,xf=function(){for(const t of h(this,Vs).values())t.isEmpty()&&t.remove()},at(zs,"_initialized",!1),b(zs,wr,new Map([_v,Nv,Lv,Lf].map(t=>[t._editorType,t])));let Vv=zs;var ln,md,ts,Xa,Ng,iw,vd,Wv,Lg,rw,yd,Hv;const Ue=class Ue{constructor({pageIndex:t}){b(this,vd);b(this,Lg);b(this,yd);b(this,ln,null);b(this,md,0);b(this,ts,new Map);b(this,Xa,new Map);this.pageIndex=t}setParent(t){if(!h(this,ln)){_(this,ln,t);return}if(h(this,ln)!==t){if(h(this,ts).size>0)for(const e of h(this,ts).values())e.remove(),t.append(e);_(this,ln,t)}}static get _svgFactory(){return At(this,"_svgFactory",new fy)}draw(t,e=!1,s=!1){const n=qe(this,md)._++,i=w(this,vd,Wv).call(this),a=Ue._svgFactory.createElement("defs");i.append(a);const o=Ue._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),e&&h(this,Xa).set(n,o);const c=s?w(this,Lg,rw).call(this,a,l):null,u=Ue._svgFactory.createElement("use");return i.append(u),u.setAttribute("href",`#${l}`),this.updateProperties(i,t),h(this,ts).set(n,i),{id:n,clipPathId:`url(#${c})`}}drawOutline(t,e){const s=qe(this,md)._++,n=w(this,vd,Wv).call(this),i=Ue._svgFactory.createElement("defs");n.append(i);const a=Ue._svgFactory.createElement("path");i.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const d=Ue._svgFactory.createElement("mask");i.append(d),l=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const f=Ue._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=Ue._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${o}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const c=Ue._svgFactory.createElement("use");n.append(c),c.setAttribute("href",`#${o}`),l&&c.setAttribute("mask",`url(#${l})`);const u=c.cloneNode();return n.append(u),c.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(n,t),h(this,ts).set(s,n),s}finalizeDraw(t,e){h(this,Xa).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var l;if(!e)return;const{root:s,bbox:n,rootClass:i,path:a}=e,o=typeof t=="number"?h(this,ts).get(t):t;if(o){if(s&&w(this,yd,Hv).call(this,o,s),n&&w(l=Ue,Ng,iw).call(l,o,n),i){const{classList:c}=o;for(const[u,d]of Object.entries(i))c.toggle(u,d)}if(a){const u=o.firstChild.firstChild;w(this,yd,Hv).call(this,u,a)}}}updateParent(t,e){if(e===this)return;const s=h(this,ts).get(t);s&&(h(e,ln).append(s),h(this,ts).delete(t),h(e,ts).set(t,s))}remove(t){h(this,Xa).delete(t),h(this,ln)!==null&&(h(this,ts).get(t).remove(),h(this,ts).delete(t))}destroy(){_(this,ln,null);for(const t of h(this,ts).values())t.remove();h(this,ts).clear(),h(this,Xa).clear()}};ln=new WeakMap,md=new WeakMap,ts=new WeakMap,Xa=new WeakMap,Ng=new WeakSet,iw=function(t,[e,s,n,i]){const{style:a}=t;a.top=`${100*s}%`,a.left=`${100*e}%`,a.width=`${100*n}%`,a.height=`${100*i}%`},vd=new WeakSet,Wv=function(){const t=Ue._svgFactory.create(1,1,!0);return h(this,ln).append(t),t.setAttribute("aria-hidden",!0),t},Lg=new WeakSet,rw=function(t,e){const s=Ue._svgFactory.createElement("clipPath");t.append(s);const n=`clip_${e}`;s.setAttribute("id",n),s.setAttribute("clipPathUnits","objectBoundingBox");const i=Ue._svgFactory.createElement("use");return s.append(i),i.setAttribute("href",`#${e}`),i.classList.add("clip"),n},yd=new WeakSet,Hv=function(t,e){for(const[s,n]of Object.entries(e))n===null?t.removeAttribute(s):t.setAttribute(s,n)},b(Ue,Ng);let Uv=Ue;globalThis.pdfjsTestingUtils={HighlightOutliner:wv};dt.AbortException;dt.AnnotationEditorLayer;dt.AnnotationEditorParamsType;dt.AnnotationEditorType;dt.AnnotationEditorUIManager;dt.AnnotationLayer;dt.AnnotationMode;dt.ColorPicker;dt.DOMSVGFactory;dt.DrawLayer;dt.FeatureTest;var qC=dt.GlobalWorkerOptions;dt.ImageKind;dt.InvalidPDFException;dt.MissingPDFException;dt.OPS;dt.OutputScale;dt.PDFDataRangeTransport;dt.PDFDateString;dt.PDFWorker;dt.PasswordResponses;dt.PermissionFlag;dt.PixelsPerInch;dt.RenderingCancelledException;dt.TextLayer;dt.UnexpectedResponseException;dt.Util;dt.VerbosityLevel;dt.XfaLayer;dt.build;dt.createValidAbsoluteUrl;dt.fetchData;var ZC=dt.getDocument;dt.getFilenameFromUrl;dt.getPdfFilenameFromUrl;dt.getXfaPageViewport;dt.isDataScheme;dt.isPdfFile;dt.noContextMenu;dt.normalizeUnicode;dt.setLayerDimensions;dt.shadow;dt.stopEvent;dt.version;const QC="/acchymns-dev/assets/pdf.worker.min-d314b1b3.mjs",JC=ny({__name:"PDFWrapper",props:{src:{}},emits:["error"],setup(r,{emit:t}){qC.workerSrc=QC;const e=r,s=t;let n=Mt();return Zb([e],async()=>{var a;n.value&&n.value.hasChildNodes()&&(n.value.innerHTML="");let i;try{i=await ZC(e.src).promise}catch{s("error");return}for(let o=1;o<=i.numPages;o++){let l=document.createElement("canvas"),c=await i.getPage(o);const u=iy.getPlatform()=="web"?5:window.devicePixelRatio;let d=c.getViewport({scale:u});l.height=d.height,l.width=d.width;let f=l.getContext("2d");if(f===null){s("error");return}try{await c.render({canvasContext:f,viewport:d}).promise,l.style.width="100%";const p=l.toDataURL("image/png"),g=document.createElement("img");g.classList.add("song-img"),g.src=p,(a=n.value)==null||a.appendChild(g)}catch{s("error");return}}},{immediate:!0}),(i,a)=>(Gt(),se("div",{ref_key:"root",ref:n,class:"container"},null,512))}});const tE={key:0,class:"fallback-container"},eE=["src"],sE=ny({__name:"SongContainer",props:{book:{},number:{}},setup(r,{expose:t}){const e=r;let s=Mt(""),n=Mt();function i(E,A,C){const x=A+"."+C[E].fileExtension;return`${C[E].srcUrl}/songs/${x}`}function a(){return m.getTransform().scale}t({getZoom:a});let o=Mt(""),l=Mt(!1);const c=jS("(prefers-color-scheme: dark)"),u=Oo("ACCOptions.overrideSystemTheme",!1),d=Oo("ACCOptions.overrideDarkMode",!1);let f=Oo("ACCOptions.songInverted",!1);const p=Pf(()=>u.value?d.value:c.value),g=Pf(()=>p.value&&f.value);let m;const v=iy.getPlatform()!=="web";let y;Qb(async()=>{m=KT(n.value,{beforeWheel:E=>E.shiftKey,maxZoom:3,minZoom:v?1:.25,bounds:!0,boundsPadding:v?1:.5,zoomDoubleClickSpeed:1}),v&&setInterval(()=>{T.refresh()},10),y=await Jb(),Zb([e],()=>{if(l.value=!1,y[e.book]==null){l.value=!0;return}const E=i(e.book,e.number,y);s.value=y[e.book].fileExtension,o.value=E},{immediate:!0})});class S{constructor(A){at(this,"_observer");at(this,"_observedNodes");this._observer=A,this._observedNodes=new Set}observe(A){this._observedNodes.add(A),this._observer.observe(A)}unobserve(A){try{this._observedNodes.delete(A),this._observer.unobserve(A)}catch(C){console.log(C)}}disconnect(){try{this._observedNodes.clear(),this._observer.disconnect()}catch(A){console.log(A)}}refresh(){for(let A of this._observedNodes)try{this._observer.unobserve(A),this._observer.observe(A)}catch(C){console.log(C)}}}const T=new S(new IntersectionObserver((E,A)=>{for(const C of E){let x=C.boundingClientRect;C.intersectionRect.height<x.height?m.setVerticalPan(!0):m.setVerticalPan(!1)}},{root:null,rootMargin:"0px",threshold:1}));return US(async()=>{v&&T.observe(n.value)}),(E,A)=>Z(l)?(Gt(),se("div",tE,A[2]||(A[2]=[it("img",{src:NS,class:"wifi-fallback"},null,-1)]))):(Gt(),se("div",{key:1,ref_key:"panzoom_container",ref:n,class:"panzoom-container"},[Z(s)=="pdf"?(Gt(),t_(JC,{key:0,onError:A[0]||(A[0]=C=>ji(l)?l.value=!0:l=!0),src:Z(o),class:Hs(["song-img",{"inverted-song":g.value}])},null,8,["src","class"])):Z(s)!==""?(Gt(),se("img",{key:1,onError:A[1]||(A[1]=C=>ji(l)?l.value=!0:l=!0),src:Z(o),class:Hs(["song-img",{"inverted-song":g.value}])},null,42,eE)):Ps("",!0)],512))}});const nE=WS(sE,[["__scopeId","data-v-5d167db5"]]),aw="14.7.77",wb=(r,t,e)=>({endTime:t,insertTime:e,type:"exponentialRampToValue",value:r}),Sb=(r,t,e)=>({endTime:t,insertTime:e,type:"linearRampToValue",value:r}),zv=(r,t)=>({startTime:t,type:"setValue",value:r}),ow=(r,t,e)=>({duration:e,startTime:t,type:"setValueCurve",values:r}),lw=(r,t,{startTime:e,target:s,timeConstant:n})=>s+(t-s)*Math.exp((e-r)/n),xo=r=>r.type==="exponentialRampToValue",Bf=r=>r.type==="linearRampToValue",Ui=r=>xo(r)||Bf(r),gy=r=>r.type==="setValue",si=r=>r.type==="setValueCurve",Vf=(r,t,e,s)=>{const n=r[t];return n===void 0?s:Ui(n)||gy(n)?n.value:si(n)?n.values[n.values.length-1]:lw(e,Vf(r,t-1,n.startTime,s),n)},Tb=(r,t,e,s,n)=>e===void 0?[s.insertTime,n]:Ui(e)?[e.endTime,e.value]:gy(e)?[e.startTime,e.value]:si(e)?[e.startTime+e.duration,e.values[e.values.length-1]]:[e.startTime,Vf(r,t-1,e.startTime,n)],Gv=r=>r.type==="cancelAndHold",Xv=r=>r.type==="cancelScheduledValues",Bi=r=>Gv(r)||Xv(r)?r.cancelTime:xo(r)||Bf(r)?r.endTime:r.startTime,Cb=(r,t,e,{endTime:s,value:n})=>e===n?n:0<e&&0<n||e<0&&n<0?e*(n/e)**((r-t)/(s-t)):0,Eb=(r,t,e,{endTime:s,value:n})=>e+(r-t)/(s-t)*(n-e),iE=(r,t)=>{const e=Math.floor(t),s=Math.ceil(t);return e===s?r[e]:(1-(t-e))*r[e]+(1-(s-t))*r[s]},rE=(r,{duration:t,startTime:e,values:s})=>{const n=(r-e)/t*(s.length-1);return iE(s,n)},Xd=r=>r.type==="setTarget";class aE{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=Bi(t);if(Gv(t)||Xv(t)){const s=this._automationEvents.findIndex(i=>Xv(t)&&si(i)?i.startTime+i.duration>=e:Bi(i)>=e),n=this._automationEvents[s];if(s!==-1&&(this._automationEvents=this._automationEvents.slice(0,s)),Gv(t)){const i=this._automationEvents[this._automationEvents.length-1];if(n!==void 0&&Ui(n)){if(i!==void 0&&Xd(i))throw new Error("The internal list is malformed.");const a=i===void 0?n.insertTime:si(i)?i.startTime+i.duration:Bi(i),o=i===void 0?this._defaultValue:si(i)?i.values[i.values.length-1]:i.value,l=xo(n)?Cb(e,a,o,n):Eb(e,a,o,n),c=xo(n)?wb(l,e,this._currenTime):Sb(l,e,this._currenTime);this._automationEvents.push(c)}if(i!==void 0&&Xd(i)&&this._automationEvents.push(zv(this.getValue(e),e)),i!==void 0&&si(i)&&i.startTime+i.duration>e){const a=e-i.startTime,o=(i.values.length-1)/i.duration,l=Math.max(2,1+Math.ceil(a*o)),c=a/(l-1)*o,u=i.values.slice(0,l);if(c<1)for(let d=1;d<l;d+=1){const f=c*d%1;u[d]=i.values[d-1]*(1-f)+i.values[d]*f}this._automationEvents[this._automationEvents.length-1]=ow(u,i.startTime,a)}}}else{const s=this._automationEvents.findIndex(a=>Bi(a)>e),n=s===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(n!==void 0&&si(n)&&Bi(n)+n.duration>e)return!1;const i=xo(t)?wb(t.value,t.endTime,this._currenTime):Bf(t)?Sb(t.value,e,this._currenTime):t;if(s===-1)this._automationEvents.push(i);else{if(si(t)&&e+t.duration>Bi(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,i)}}return!0}flush(t){const e=this._automationEvents.findIndex(s=>Bi(s)>t);if(e>1){const s=this._automationEvents.slice(e-1),n=s[0];Xd(n)&&s.unshift(zv(Vf(this._automationEvents,e-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=s}}getValue(t){if(this._automationEvents.length===0)return this._defaultValue;const e=this._automationEvents.findIndex(a=>Bi(a)>t),s=this._automationEvents[e],n=(e===-1?this._automationEvents.length:e)-1,i=this._automationEvents[n];if(i!==void 0&&Xd(i)&&(s===void 0||!Ui(s)||s.insertTime>t))return lw(t,Vf(this._automationEvents,n-1,i.startTime,this._defaultValue),i);if(i!==void 0&&gy(i)&&(s===void 0||!Ui(s)))return i.value;if(i!==void 0&&si(i)&&(s===void 0||!Ui(s)||i.startTime+i.duration>t))return t<i.startTime+i.duration?rE(t,i):i.values[i.values.length-1];if(i!==void 0&&Ui(i)&&(s===void 0||!Ui(s)))return i.value;if(s!==void 0&&xo(s)){const[a,o]=Tb(this._automationEvents,n,i,s,this._defaultValue);return Cb(t,a,o,s)}if(s!==void 0&&Bf(s)){const[a,o]=Tb(this._automationEvents,n,i,s,this._defaultValue);return Eb(t,a,o,s)}return this._defaultValue}}const oE=r=>({cancelTime:r,type:"cancelAndHold"}),lE=r=>({cancelTime:r,type:"cancelScheduledValues"}),cE=(r,t)=>({endTime:t,type:"exponentialRampToValue",value:r}),hE=(r,t)=>({endTime:t,type:"linearRampToValue",value:r}),uE=(r,t,e)=>({startTime:t,target:r,timeConstant:e,type:"setTarget"}),dE=()=>new DOMException("","AbortError"),fE=r=>(t,e,[s,n,i],a)=>{r(t[n],[e,s,i],o=>o[0]===e&&o[1]===s,a)},pE=r=>(t,e,s)=>{const n=[];for(let i=0;i<s.numberOfInputs;i+=1)n.push(new Set);r.set(t,{activeInputs:n,outputs:new Set,passiveInputs:new WeakMap,renderer:e})},gE=r=>(t,e)=>{r.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})},uc=new WeakSet,cw=new WeakMap,my=new WeakMap,hw=new WeakMap,vy=new WeakMap,Yg=new WeakMap,uw=new WeakMap,Yv=new WeakMap,Kv=new WeakMap,qv=new WeakMap,dw={construct(){return dw}},mE=r=>{try{const t=new Proxy(r,dw);new t}catch{return!1}return!0},xb=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,Ib=(r,t)=>{const e=[];let s=r.replace(/^[\s]+/,""),n=s.match(xb);for(;n!==null;){const i=n[1].slice(1,-1),a=n[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,t).toString());e.push(a),s=s.slice(n[0].length).replace(/^[\s]+/,""),n=s.match(xb)}return[e.join(";"),s]},Rb=r=>{if(r!==void 0&&!Array.isArray(r))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Pb=r=>{if(!mE(r))throw new TypeError("The given value for processorCtor should be a constructor.");if(r.prototype===null||typeof r.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},vE=(r,t,e,s,n,i,a,o,l,c,u,d,f)=>{let p=0;return(g,m,v={credentials:"omit"})=>{const y=u.get(g);if(y!==void 0&&y.has(m))return Promise.resolve();const S=c.get(g);if(S!==void 0){const A=S.get(m);if(A!==void 0)return A}const T=i(g),E=T.audioWorklet===void 0?n(m).then(([A,C])=>{const[x,I]=Ib(A,C),R=`${x};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${I}
})})(window,'_AWGS')`;return e(R)}).then(()=>{const A=f._AWGS.pop();if(A===void 0)throw new SyntaxError;s(T.currentTime,T.sampleRate,()=>A(class{},void 0,(C,x)=>{if(C.trim()==="")throw t();const I=Kv.get(T);if(I!==void 0){if(I.has(C))throw t();Pb(x),Rb(x.parameterDescriptors),I.set(C,x)}else Pb(x),Rb(x.parameterDescriptors),Kv.set(T,new Map([[C,x]]))},T.sampleRate,void 0,void 0))}):Promise.all([n(m),Promise.resolve(r(d,d))]).then(([[A,C],x])=>{const I=p+1;p=I;const[R,O]=Ib(A,C),F=`${R};((AudioWorkletProcessor,registerProcessor)=>{${O}
})(${x?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${x?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${x?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${I}',class extends AudioWorkletProcessor{process(){return !1}})`,W=new Blob([F],{type:"application/javascript; charset=utf-8"}),j=URL.createObjectURL(W);return T.audioWorklet.addModule(j,v).then(()=>{if(o(T))return T;const D=a(T);return D.audioWorklet.addModule(j,v).then(()=>D)}).then(D=>{if(l===null)throw new SyntaxError;try{new l(D,`__sac${I}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(j))});return S===void 0?c.set(g,new Map([[m,E]])):S.set(m,E),E.then(()=>{const A=u.get(g);A===void 0?u.set(g,new Set([m])):A.add(m)}).finally(()=>{const A=c.get(g);A!==void 0&&A.delete(m)}),E}},gn=(r,t)=>{const e=r.get(t);if(e===void 0)throw new Error("A value with the given key could not be found.");return e},Kg=(r,t)=>{const e=Array.from(r).filter(t);if(e.length>1)throw Error("More than one element was found.");if(e.length===0)throw Error("No element was found.");const[s]=e;return r.delete(s),s},fw=(r,t,e,s)=>{const n=gn(r,t),i=Kg(n,a=>a[0]===e&&a[1]===s);return n.size===0&&r.delete(t),i},Sd=r=>gn(uw,r),dc=r=>{if(uc.has(r))throw new Error("The AudioNode is already stored.");uc.add(r),Sd(r).forEach(t=>t(!0))},pw=r=>"port"in r,Td=r=>{if(!uc.has(r))throw new Error("The AudioNode is not stored.");uc.delete(r),Sd(r).forEach(t=>t(!1))},Zv=(r,t)=>{!pw(r)&&t.every(e=>e.size===0)&&Td(r)},yE=(r,t,e,s,n,i,a,o,l,c,u,d,f)=>{const p=new WeakMap;return(g,m,v,y,S)=>{const{activeInputs:T,passiveInputs:E}=i(m),{outputs:A}=i(g),C=o(g),x=I=>{const R=l(m),O=l(g);if(I){const P=fw(E,g,v,y);r(T,g,P,!1),!S&&!d(g)&&e(O,R,v,y),f(m)&&dc(m)}else{const P=s(T,g,v,y);t(E,y,P,!1),!S&&!d(g)&&n(O,R,v,y);const M=a(m);if(M===0)u(m)&&Zv(m,T);else{const B=p.get(m);B!==void 0&&clearTimeout(B),p.set(m,setTimeout(()=>{u(m)&&Zv(m,T)},M*1e3))}}};return c(A,[m,v,y],I=>I[0]===m&&I[1]===v&&I[2]===y,!0)?(C.add(x),u(g)?r(T,g,[v,y,x],!0):t(E,y,[g,v,x],!0),!0):!1}},bE=r=>(t,e,[s,n,i],a)=>{const o=t.get(s);o===void 0?t.set(s,new Set([[n,e,i]])):r(o,[n,e,i],l=>l[0]===n&&l[1]===e,a)},_E=r=>(t,e)=>{const s=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(s).connect(t.destination);const n=()=>{e.removeEventListener("ended",n),e.disconnect(s),s.disconnect()};e.addEventListener("ended",n)},AE=r=>(t,e)=>{r(t).add(e)},wE={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},SE=(r,t,e,s,n,i)=>class extends r{constructor(o,l){const c=n(o),u={...wE,...l},d=s(c,u),f=i(c)?t():null;super(o,!1,d,f),this._nativeAnalyserNode=d}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(o){this._nativeAnalyserNode.fftSize=o}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(o){const l=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=o,!(o>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=l,e()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(o){const l=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=o,!(this._nativeAnalyserNode.maxDecibels>o))throw this._nativeAnalyserNode.minDecibels=l,e()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(o){this._nativeAnalyserNode.smoothingTimeConstant=o}getByteFrequencyData(o){this._nativeAnalyserNode.getByteFrequencyData(o)}getByteTimeDomainData(o){this._nativeAnalyserNode.getByteTimeDomainData(o)}getFloatFrequencyData(o){this._nativeAnalyserNode.getFloatFrequencyData(o)}getFloatTimeDomainData(o){this._nativeAnalyserNode.getFloatTimeDomainData(o)}},Ke=(r,t)=>r.context===t,TE=(r,t,e)=>()=>{const s=new WeakMap,n=async(i,a)=>{let o=t(i);if(!Ke(o,a)){const c={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=r(a,c)}return s.set(a,o),await e(i,a,o),o};return{render(i,a){const o=s.get(a);return o!==void 0?Promise.resolve(o):n(i,a)}}},$f=r=>{try{r.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Wn=()=>new DOMException("","IndexSizeError"),yy=r=>{r.getChannelData=(t=>e=>{try{return t.call(r,e)}catch(s){throw s.code===12?Wn():s}})(r.getChannelData)},CE={numberOfChannels:1},EE=(r,t,e,s,n,i,a,o)=>{let l=null;return class gw{constructor(u){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:d,numberOfChannels:f,sampleRate:p}={...CE,...u};l===null&&(l=new n(1,1,44100));const g=s!==null&&t(i,i)?new s({length:d,numberOfChannels:f,sampleRate:p}):l.createBuffer(f,d,p);if(g.numberOfChannels===0)throw e();return typeof g.copyFromChannel!="function"?(a(g),yy(g)):t($f,()=>$f(g))||o(g),r.add(g),g}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===gw.prototype||r.has(u)}}},fs=-34028234663852886e22,es=-fs,Mi=r=>uc.has(r),xE={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},IE=(r,t,e,s,n,i,a,o)=>class extends r{constructor(c,u){const d=i(c),f={...xE,...u},p=n(d,f),g=a(d),m=g?t():null;super(c,!1,p,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=e(this,g,p.playbackRate,es,fs)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,c!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?o(this,c):null;this._nativeAudioBufferSourceNode.onended=u;const d=this._nativeAudioBufferSourceNode.onended;this._onended=d!==null&&d===u?c:d}get playbackRate(){return this._playbackRate}start(c=0,u=0,d){if(this._nativeAudioBufferSourceNode.start(c,u,d),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=d===void 0?[c,u]:[c,u,d]),this.context.state!=="closed"){dc(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),Mi(this)&&Td(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=c)}},RE=(r,t,e,s,n)=>()=>{const i=new WeakMap;let a=null,o=null;const l=async(c,u)=>{let d=e(c);const f=Ke(d,u);if(!f){const p={buffer:d.buffer,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,loop:d.loop,loopEnd:d.loopEnd,loopStart:d.loopStart,playbackRate:d.playbackRate.value};d=t(u,p),a!==null&&d.start(...a),o!==null&&d.stop(o)}return i.set(u,d),f?await r(u,c.playbackRate,d.playbackRate):await s(u,c.playbackRate,d.playbackRate),await n(c,u,d),d};return{set start(c){a=c},set stop(c){o=c},render(c,u){const d=i.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},PE=r=>"playbackRate"in r,OE=r=>"frequency"in r&&"gain"in r,ME=r=>"offset"in r,kE=r=>!("frequency"in r)&&"gain"in r,DE=r=>"detune"in r&&"frequency"in r,NE=r=>"pan"in r,ss=r=>gn(cw,r),Cd=r=>gn(hw,r),Qv=(r,t)=>{const{activeInputs:e}=ss(r);e.forEach(n=>n.forEach(([i])=>{t.includes(r)||Qv(i,[...t,r])}));const s=PE(r)?[r.playbackRate]:pw(r)?Array.from(r.parameters.values()):OE(r)?[r.Q,r.detune,r.frequency,r.gain]:ME(r)?[r.offset]:kE(r)?[r.gain]:DE(r)?[r.detune,r.frequency]:NE(r)?[r.pan]:[];for(const n of s){const i=Cd(n);i!==void 0&&i.activeInputs.forEach(([a])=>Qv(a,t))}Mi(r)&&Td(r)},mw=r=>{Qv(r.destination,[])},LE=r=>r===void 0||typeof r=="number"||typeof r=="string"&&(r==="balanced"||r==="interactive"||r==="playback"),FE=(r,t,e,s,n,i,a,o,l)=>class extends r{constructor(u={}){if(l===null)throw new Error("Missing the native AudioContext constructor.");let d;try{d=new l(u)}catch(g){throw g.code===12&&g.message==="sampleRate is not in range"?e():g}if(d===null)throw s();if(!LE(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&d.sampleRate!==u.sampleRate)throw e();super(d,2);const{latencyHint:f}=u,{sampleRate:p}=d;if(this._baseLatency=typeof d.baseLatency=="number"?d.baseLatency:f==="balanced"?512/p:f==="interactive"||f===void 0?256/p:f==="playback"?1024/p:Math.max(2,Math.min(128,Math.round(f*p/128)))*128/p,this._nativeAudioContext=d,l.name==="webkitAudioContext"?(this._nativeGainNode=d.createGain(),this._nativeOscillatorNode=d.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(d.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,d.state==="running"){this._state="suspended";const g=()=>{this._state==="suspended"&&(this._state=null),d.removeEventListener("statechange",g)};d.addEventListener("statechange",g)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),mw(this)}))}createMediaElementSource(u){return new n(this,{mediaElement:u})}createMediaStreamDestination(){return new i(this)}createMediaStreamSource(u){return new a(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new o(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,d)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?u():this.resume().then(u,d)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?t():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?t():u})}},BE=(r,t,e,s,n,i,a,o)=>class extends r{constructor(c,u){const d=i(c),f=a(d),p=n(d,u,f),g=f?t(o):null;super(c,!1,p,g),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw e();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},VE=r=>{const t=new WeakMap,e=async(s,n)=>{const i=n.destination;return t.set(n,i),await r(s,n,i),i};return{render(s,n){const i=t.get(n);return i!==void 0?Promise.resolve(i):e(s,n)}}},$E=(r,t,e,s,n,i,a,o)=>(l,c)=>{const u=c.listener,d=()=>{const A=new Float32Array(1),C=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),x=a(c);let I=!1,R=[0,0,-1,0,1,0],O=[0,0,0];const P=()=>{if(I)return;I=!0;const W=s(c,256,9,0);W.onaudioprocess=({inputBuffer:j})=>{const D=[i(j,A,0),i(j,A,1),i(j,A,2),i(j,A,3),i(j,A,4),i(j,A,5)];D.some((H,Y)=>H!==R[Y])&&(u.setOrientation(...D),R=D);const $=[i(j,A,6),i(j,A,7),i(j,A,8)];$.some((H,Y)=>H!==O[Y])&&(u.setPosition(...$),O=$)},C.connect(W)},M=W=>j=>{j!==R[W]&&(R[W]=j,u.setOrientation(...R))},B=W=>j=>{j!==O[W]&&(O[W]=j,u.setPosition(...O))},F=(W,j,D)=>{const $=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:j});$.connect(C,0,W),$.start(),Object.defineProperty($.offset,"defaultValue",{get(){return j}});const H=r({context:l},x,$.offset,es,fs);return o(H,"value",Y=>()=>Y.call(H),Y=>K=>{try{Y.call(H,K)}catch(nt){if(nt.code!==9)throw nt}P(),x&&D(K)}),H.cancelAndHoldAtTime=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.cancelAndHoldAtTime),H.cancelScheduledValues=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.cancelScheduledValues),H.exponentialRampToValueAtTime=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.exponentialRampToValueAtTime),H.linearRampToValueAtTime=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.linearRampToValueAtTime),H.setTargetAtTime=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.setTargetAtTime),H.setValueAtTime=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.setValueAtTime),H.setValueCurveAtTime=(Y=>x?()=>{throw n()}:(...K)=>{const nt=Y.apply(H,K);return P(),nt})(H.setValueCurveAtTime),H};return{forwardX:F(0,0,M(0)),forwardY:F(1,0,M(1)),forwardZ:F(2,-1,M(2)),positionX:F(6,0,B(0)),positionY:F(7,0,B(1)),positionZ:F(8,0,B(2)),upX:F(3,0,M(3)),upY:F(4,1,M(4)),upZ:F(5,0,M(5))}},{forwardX:f,forwardY:p,forwardZ:g,positionX:m,positionY:v,positionZ:y,upX:S,upY:T,upZ:E}=u.forwardX===void 0?d():u;return{get forwardX(){return f},get forwardY(){return p},get forwardZ(){return g},get positionX(){return m},get positionY(){return v},get positionZ(){return y},get upX(){return S},get upY(){return T},get upZ(){return E}}},jf=r=>"context"in r,Ed=r=>jf(r[0]),lo=(r,t,e,s)=>{for(const n of r)if(e(n)){if(s)return!1;throw Error("The set contains at least one similar element.")}return r.add(t),!0},Ob=(r,t,[e,s],n)=>{lo(r,[t,e,s],i=>i[0]===t&&i[1]===e,n)},Mb=(r,[t,e,s],n)=>{const i=r.get(t);i===void 0?r.set(t,new Set([[e,s]])):lo(i,[e,s],a=>a[0]===e,n)},mc=r=>"inputs"in r,Uf=(r,t,e,s)=>{if(mc(t)){const n=t.inputs[s];return r.connect(n,e,0),[n,e,0]}return r.connect(t,e,s),[t,e,s]},vw=(r,t,e)=>{for(const s of r)if(s[0]===t&&s[1]===e)return r.delete(s),s;return null},jE=(r,t,e)=>Kg(r,s=>s[0]===t&&s[1]===e),yw=(r,t)=>{if(!Sd(r).delete(t))throw new Error("Missing the expected event listener.")},bw=(r,t,e)=>{const s=gn(r,t),n=Kg(s,i=>i[0]===e);return s.size===0&&r.delete(t),n},Wf=(r,t,e,s)=>{mc(t)?r.disconnect(t.inputs[s],e,0):r.disconnect(t,e,s)},Xt=r=>gn(my,r),Qc=r=>gn(vy,r),Ja=r=>Yv.has(r),If=r=>!uc.has(r),kb=(r,t)=>new Promise(e=>{if(t!==null)e(!0);else{const s=r.createScriptProcessor(256,1,1),n=r.createGain(),i=r.createBuffer(1,2,44100),a=i.getChannelData(0);a[0]=1,a[1]=1;const o=r.createBufferSource();o.buffer=i,o.loop=!0,o.connect(s).connect(r.destination),o.connect(n),o.disconnect(n),s.onaudioprocess=l=>{const c=l.inputBuffer.getChannelData(0);Array.prototype.some.call(c,u=>u===1)?e(!0):e(!1),o.stop(),s.onaudioprocess=null,o.disconnect(s),s.disconnect(r.destination)},o.start()}}),Tm=(r,t)=>{const e=new Map;for(const s of r)for(const n of s){const i=e.get(n);e.set(n,i===void 0?1:i+1)}e.forEach((s,n)=>t(n,s))},Hf=r=>"context"in r,UE=r=>{const t=new Map;r.connect=(e=>(s,n=0,i=0)=>{const a=Hf(s)?e(s,n,i):e(s,n),o=t.get(s);return o===void 0?t.set(s,[{input:i,output:n}]):o.every(l=>l.input!==i||l.output!==n)&&o.push({input:i,output:n}),a})(r.connect.bind(r)),r.disconnect=(e=>(s,n,i)=>{if(e.apply(r),s===void 0)t.clear();else if(typeof s=="number")for(const[a,o]of t){const l=o.filter(c=>c.output!==s);l.length===0?t.delete(a):t.set(a,l)}else if(t.has(s))if(n===void 0)t.delete(s);else{const a=t.get(s);if(a!==void 0){const o=a.filter(l=>l.output!==n&&(l.input!==i||i===void 0));o.length===0?t.delete(s):t.set(s,o)}}for(const[a,o]of t)o.forEach(l=>{Hf(a)?r.connect(a,l.output,l.input):r.connect(a,l.output)})})(r.disconnect)},WE=(r,t,e,s)=>{const{activeInputs:n,passiveInputs:i}=Cd(t),{outputs:a}=ss(r),o=Sd(r),l=c=>{const u=Xt(r),d=Qc(t);if(c){const f=bw(i,r,e);Ob(n,r,f,!1),!s&&!Ja(r)&&u.connect(d,e)}else{const f=jE(n,r,e);Mb(i,f,!1),!s&&!Ja(r)&&u.disconnect(d,e)}};return lo(a,[t,e],c=>c[0]===t&&c[1]===e,!0)?(o.add(l),Mi(r)?Ob(n,r,[e,l],!0):Mb(i,[r,e,l],!0),!0):!1},HE=(r,t,e,s)=>{const{activeInputs:n,passiveInputs:i}=ss(t),a=vw(n[s],r,e);return a===null?[fw(i,r,e,s)[2],!1]:[a[2],!0]},zE=(r,t,e)=>{const{activeInputs:s,passiveInputs:n}=Cd(t),i=vw(s,r,e);return i===null?[bw(n,r,e)[1],!1]:[i[2],!0]},by=(r,t,e,s,n)=>{const[i,a]=HE(r,e,s,n);if(i!==null&&(yw(r,i),a&&!t&&!Ja(r)&&Wf(Xt(r),Xt(e),s,n)),Mi(e)){const{activeInputs:o}=ss(e);Zv(e,o)}},_y=(r,t,e,s)=>{const[n,i]=zE(r,e,s);n!==null&&(yw(r,n),i&&!t&&!Ja(r)&&Xt(r).disconnect(Qc(e),s))},GE=(r,t)=>{const e=ss(r),s=[];for(const n of e.outputs)Ed(n)?by(r,t,...n):_y(r,t,...n),s.push(n[0]);return e.outputs.clear(),s},XE=(r,t,e)=>{const s=ss(r),n=[];for(const i of s.outputs)i[1]===e&&(Ed(i)?by(r,t,...i):_y(r,t,...i),n.push(i[0]),s.outputs.delete(i));return n},YE=(r,t,e,s,n)=>{const i=ss(r);return Array.from(i.outputs).filter(a=>a[0]===e&&(s===void 0||a[1]===s)&&(n===void 0||a[2]===n)).map(a=>(Ed(a)?by(r,t,...a):_y(r,t,...a),i.outputs.delete(a),a[0]))},KE=(r,t,e,s,n,i,a,o,l,c,u,d,f,p,g,m)=>class extends c{constructor(y,S,T,E){super(T),this._context=y,this._nativeAudioNode=T;const A=u(y);d(A)&&e(kb,()=>kb(A,m))!==!0&&UE(T),my.set(this,T),uw.set(this,new Set),y.state!=="closed"&&S&&dc(this),r(this,E,T)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,S=0,T=0){if(S<0||S>=this._nativeAudioNode.numberOfOutputs)throw n();const E=u(this._context),A=g(E);if(f(y)||p(y))throw i();if(jf(y)){const I=Xt(y);try{const O=Uf(this._nativeAudioNode,I,S,T),P=If(this);(A||P)&&this._nativeAudioNode.disconnect(...O),this.context.state!=="closed"&&!P&&If(y)&&dc(y)}catch(O){throw O.code===12?i():O}if(t(this,y,S,T,A)){const O=l([this],y);Tm(O,s(A))}return y}const C=Qc(y);if(C.name==="playbackRate"&&C.maxValue===1024)throw a();try{this._nativeAudioNode.connect(C,S),(A||If(this))&&this._nativeAudioNode.disconnect(C,S)}catch(I){throw I.code===12?i():I}if(WE(this,y,S,A)){const I=l([this],y);Tm(I,s(A))}}disconnect(y,S,T){let E;const A=u(this._context),C=g(A);if(y===void 0)E=GE(this,C);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw n();E=XE(this,C,y)}else{if(S!==void 0&&(S<0||S>=this.numberOfOutputs)||jf(y)&&T!==void 0&&(T<0||T>=y.numberOfInputs))throw n();if(E=YE(this,C,y,S,T),E.length===0)throw i()}for(const x of E){const I=l([this],x);Tm(I,o)}}},qE=(r,t,e,s,n,i,a,o,l,c,u,d,f)=>(p,g,m,v=null,y=null)=>{const S=m.value,T=new aE(S),E=g?s(T):null,A={get defaultValue(){return S},get maxValue(){return v===null?m.maxValue:v},get minValue(){return y===null?m.minValue:y},get value(){return m.value},set value(C){m.value=C,A.setValueAtTime(C,p.context.currentTime)},cancelAndHoldAtTime(C){if(typeof m.cancelAndHoldAtTime=="function")E===null&&T.flush(p.context.currentTime),T.add(n(C)),m.cancelAndHoldAtTime(C);else{const x=Array.from(T).pop();E===null&&T.flush(p.context.currentTime),T.add(n(C));const I=Array.from(T).pop();m.cancelScheduledValues(C),x!==I&&I!==void 0&&(I.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(I.value,I.endTime):I.type==="linearRampToValue"?m.linearRampToValueAtTime(I.value,I.endTime):I.type==="setValue"?m.setValueAtTime(I.value,I.startTime):I.type==="setValueCurve"&&m.setValueCurveAtTime(I.values,I.startTime,I.duration))}return A},cancelScheduledValues(C){return E===null&&T.flush(p.context.currentTime),T.add(i(C)),m.cancelScheduledValues(C),A},exponentialRampToValueAtTime(C,x){if(C===0)throw new RangeError;if(!Number.isFinite(x)||x<0)throw new RangeError;const I=p.context.currentTime;return E===null&&T.flush(I),Array.from(T).length===0&&(T.add(c(S,I)),m.setValueAtTime(S,I)),T.add(a(C,x)),m.exponentialRampToValueAtTime(C,x),A},linearRampToValueAtTime(C,x){const I=p.context.currentTime;return E===null&&T.flush(I),Array.from(T).length===0&&(T.add(c(S,I)),m.setValueAtTime(S,I)),T.add(o(C,x)),m.linearRampToValueAtTime(C,x),A},setTargetAtTime(C,x,I){return E===null&&T.flush(p.context.currentTime),T.add(l(C,x,I)),m.setTargetAtTime(C,x,I),A},setValueAtTime(C,x){return E===null&&T.flush(p.context.currentTime),T.add(c(C,x)),m.setValueAtTime(C,x),A},setValueCurveAtTime(C,x,I){const R=C instanceof Float32Array?C:new Float32Array(C);if(d!==null&&d.name==="webkitAudioContext"){const O=x+I,P=p.context.sampleRate,M=Math.ceil(x*P),B=Math.floor(O*P),F=B-M,W=new Float32Array(F);for(let D=0;D<F;D+=1){const $=(R.length-1)/I*((M+D)/P-x),H=Math.floor($),Y=Math.ceil($);W[D]=H===Y?R[H]:(1-($-H))*R[H]+(1-(Y-$))*R[Y]}E===null&&T.flush(p.context.currentTime),T.add(u(W,x,I)),m.setValueCurveAtTime(W,x,I);const j=B/P;j<O&&f(A,W[W.length-1],j),f(A,R[R.length-1],O)}else E===null&&T.flush(p.context.currentTime),T.add(u(R,x,I)),m.setValueCurveAtTime(R,x,I);return A}};return e.set(A,m),t.set(A,p),r(A,E),A},ZE=r=>({replay(t){for(const e of r)if(e.type==="exponentialRampToValue"){const{endTime:s,value:n}=e;t.exponentialRampToValueAtTime(n,s)}else if(e.type==="linearRampToValue"){const{endTime:s,value:n}=e;t.linearRampToValueAtTime(n,s)}else if(e.type==="setTarget"){const{startTime:s,target:n,timeConstant:i}=e;t.setTargetAtTime(n,s,i)}else if(e.type==="setValue"){const{startTime:s,value:n}=e;t.setValueAtTime(n,s)}else if(e.type==="setValueCurve"){const{duration:s,startTime:n,values:i}=e;t.setValueCurveAtTime(i,n,s)}else throw new Error("Can't apply an unknown automation.")}});class _w{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((s,n)=>t.call(e,s,n,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const QE={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},JE=(r,t,e,s,n,i,a,o,l,c,u,d,f,p)=>class extends t{constructor(m,v,y){var S;const T=o(m),E=l(T),A=u({...QE,...y});f(A);const C=Kv.get(T),x=C==null?void 0:C.get(v),I=E||T.state!=="closed"?T:(S=a(T))!==null&&S!==void 0?S:T,R=n(I,E?null:m.baseLatency,c,v,x,A),O=E?s(v,A,x):null;super(m,!0,R,O);const P=[];R.parameters.forEach((B,F)=>{const W=e(this,E,B);P.push([F,W])}),this._nativeAudioWorkletNode=R,this._onprocessorerror=null,this._parameters=new _w(P),E&&r(T,this);const{activeInputs:M}=i(this);d(R,M)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const v=typeof m=="function"?p(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=v;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===v?m:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function zf(r,t,e,s,n){if(typeof r.copyFromChannel=="function")t[e].byteLength===0&&(t[e]=new Float32Array(128)),r.copyFromChannel(t[e],s,n);else{const i=r.getChannelData(s);if(t[e].byteLength===0)t[e]=i.slice(n,n+128);else{const a=new Float32Array(i.buffer,n*Float32Array.BYTES_PER_ELEMENT,128);t[e].set(a)}}}const Aw=(r,t,e,s,n)=>{typeof r.copyToChannel=="function"?t[e].byteLength!==0&&r.copyToChannel(t[e],s,n):t[e].byteLength!==0&&r.getChannelData(s).set(t[e],n)},Gf=(r,t)=>{const e=[];for(let s=0;s<r;s+=1){const n=[],i=typeof t=="number"?t:t[s];for(let a=0;a<i;a+=1)n.push(new Float32Array(128));e.push(n)}return e},tx=(r,t)=>{const e=gn(qv,r),s=Xt(t);return gn(e,s)},ex=async(r,t,e,s,n,i,a)=>{const o=t===null?Math.ceil(r.context.length/128)*128:t.length,l=s.channelCount*s.numberOfInputs,c=n.reduce((v,y)=>v+y,0),u=c===0?null:e.createBuffer(c,o,e.sampleRate);if(i===void 0)throw new Error("Missing the processor constructor.");const d=ss(r),f=await tx(e,r),p=Gf(s.numberOfInputs,s.channelCount),g=Gf(s.numberOfOutputs,n),m=Array.from(r.parameters.keys()).reduce((v,y)=>({...v,[y]:new Float32Array(128)}),{});for(let v=0;v<o;v+=128){if(s.numberOfInputs>0&&t!==null)for(let y=0;y<s.numberOfInputs;y+=1)for(let S=0;S<s.channelCount;S+=1)zf(t,p[y],S,S,v);i.parameterDescriptors!==void 0&&t!==null&&i.parameterDescriptors.forEach(({name:y},S)=>{zf(t,m,y,l+S,v)});for(let y=0;y<s.numberOfInputs;y+=1)for(let S=0;S<n[y];S+=1)g[y][S].byteLength===0&&(g[y][S]=new Float32Array(128));try{const y=p.map((T,E)=>d.activeInputs[E].size===0?[]:T),S=a(v/e.sampleRate,e.sampleRate,()=>f.process(y,g,m));if(u!==null)for(let T=0,E=0;T<s.numberOfOutputs;T+=1){for(let A=0;A<n[T];A+=1)Aw(u,g[T],A,E+A,v);E+=n[T]}if(!S)break}catch(y){r.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},sx=(r,t,e,s,n,i,a,o,l,c,u,d,f,p,g,m)=>(v,y,S)=>{const T=new WeakMap;let E=null;const A=async(C,x)=>{let I=u(C),R=null;const O=Ke(I,x),P=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(d===null){const M=P.reduce((j,D)=>j+D,0),B=n(x,{channelCount:Math.max(1,M),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,M)}),F=[];for(let j=0;j<C.numberOfOutputs;j+=1)F.push(s(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:P[j]}));const W=a(x,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});W.connect=t.bind(null,F),W.disconnect=l.bind(null,F),R=[B,F,W]}else O||(I=new d(x,v));if(T.set(x,R===null?I:R[2]),R!==null){if(E===null){if(S===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const D=C.channelCount*C.numberOfInputs,$=S.parameterDescriptors===void 0?0:S.parameterDescriptors.length,H=D+$;E=ex(C,H===0?null:await(async()=>{const K=new f(H,Math.ceil(C.context.length/128)*128,x.sampleRate),nt=[],ut=[];for(let U=0;U<y.numberOfInputs;U+=1)nt.push(a(K,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),ut.push(n(K,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const Rt=await Promise.all(Array.from(C.parameters.values()).map(async U=>{const V=i(K,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:U.value});return await p(K,U,V.offset),V})),ht=s(K,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,D+$)});for(let U=0;U<y.numberOfInputs;U+=1){nt[U].connect(ut[U]);for(let V=0;V<y.channelCount;V+=1)ut[U].connect(ht,V,U*y.channelCount+V)}for(const[U,V]of Rt.entries())V.connect(ht,0,D+U),V.start(0);return ht.connect(K.destination),await Promise.all(nt.map(U=>g(C,K,U))),m(K)})(),x,y,P,S,c)}const M=await E,B=e(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[F,W,j]=R;M!==null&&(B.buffer=M,B.start(0)),B.connect(F);for(let D=0,$=0;D<C.numberOfOutputs;D+=1){const H=W[D];for(let Y=0;Y<P[D];Y+=1)F.connect(H,$+Y,Y);$+=P[D]}return j}if(O)for(const[M,B]of C.parameters.entries())await r(x,B,I.parameters.get(M));else for(const[M,B]of C.parameters.entries())await p(x,B,I.parameters.get(M));return await g(C,x,I),I};return{render(C,x){o(x,C);const I=T.get(x);return I!==void 0?Promise.resolve(I):A(C,x)}}},nx=(r,t,e,s,n,i,a,o,l,c,u,d,f,p,g,m,v,y,S,T)=>class extends g{constructor(A,C){super(A,C),this._nativeContext=A,this._audioWorklet=r===void 0?void 0:{addModule:(x,I)=>r(this,x,I)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new n(this)}createBuffer(A,C,x){return new e({length:C,numberOfChannels:A,sampleRate:x})}createBufferSource(){return new s(this)}createChannelMerger(A=6){return new i(this,{numberOfInputs:A})}createChannelSplitter(A=6){return new a(this,{numberOfOutputs:A})}createConstantSource(){return new o(this)}createConvolver(){return new l(this)}createDelay(A=1){return new u(this,{maxDelayTime:A})}createDynamicsCompressor(){return new d(this)}createGain(){return new f(this)}createIIRFilter(A,C){return new p(this,{feedback:C,feedforward:A})}createOscillator(){return new m(this)}createPanner(){return new v(this)}createPeriodicWave(A,C,x={disableNormalization:!1}){return new y(this,{...x,imag:C,real:A})}createStereoPanner(){return new S(this)}createWaveShaper(){return new T(this)}decodeAudioData(A,C,x){return c(this._nativeContext,A).then(I=>(typeof C=="function"&&C(I),I),I=>{throw typeof x=="function"&&x(I),I})}},ix={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},rx=(r,t,e,s,n,i,a,o)=>class extends r{constructor(c,u){const d=i(c),f={...ix,...u},p=n(d,f),g=a(d),m=g?e():null;super(c,!1,p,m),this._Q=t(this,g,p.Q,es,fs),this._detune=t(this,g,p.detune,1200*Math.log2(es),-1200*Math.log2(es)),this._frequency=t(this,g,p.frequency,c.sampleRate/2,0),this._gain=t(this,g,p.gain,40*Math.log10(es),fs),this._nativeBiquadFilterNode=p,o(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(c){this._nativeBiquadFilterNode.type=c}getFrequencyResponse(c,u,d){try{this._nativeBiquadFilterNode.getFrequencyResponse(c,u,d)}catch(f){throw f.code===11?s():f}if(c.length!==u.length||u.length!==d.length)throw s()}},ax=(r,t,e,s,n)=>()=>{const i=new WeakMap,a=async(o,l)=>{let c=e(o);const u=Ke(c,l);if(!u){const d={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=t(l,d)}return i.set(l,c),u?(await r(l,o.Q,c.Q),await r(l,o.detune,c.detune),await r(l,o.frequency,c.frequency),await r(l,o.gain,c.gain)):(await s(l,o.Q,c.Q),await s(l,o.detune,c.detune),await s(l,o.frequency,c.frequency),await s(l,o.gain,c.gain)),await n(o,l,c),c};return{render(o,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):a(o,l)}}},ox=(r,t)=>(e,s)=>{const n=t.get(e);if(n!==void 0)return n;const i=r.get(e);if(i!==void 0)return i;try{const a=s();return a instanceof Promise?(r.set(e,a),a.catch(()=>!1).then(o=>(r.delete(e),t.set(e,o),o))):(t.set(e,a),a)}catch{return t.set(e,!1),!1}},lx={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},cx=(r,t,e,s,n)=>class extends r{constructor(a,o){const l=s(a),c={...lx,...o},u=e(l,c),d=n(l)?t():null;super(a,!1,u,d)}},hx=(r,t,e)=>()=>{const s=new WeakMap,n=async(i,a)=>{let o=t(i);if(!Ke(o,a)){const c={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=r(a,c)}return s.set(a,o),await e(i,a,o),o};return{render(i,a){const o=s.get(a);return o!==void 0?Promise.resolve(o):n(i,a)}}},ux={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},dx=(r,t,e,s,n,i)=>class extends r{constructor(o,l){const c=s(o),u=i({...ux,...l}),d=e(c,u),f=n(c)?t():null;super(o,!1,d,f)}},fx=(r,t,e)=>()=>{const s=new WeakMap,n=async(i,a)=>{let o=t(i);if(!Ke(o,a)){const c={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=r(a,c)}return s.set(a,o),await e(i,a,o),o};return{render(i,a){const o=s.get(a);return o!==void 0?Promise.resolve(o):n(i,a)}}},px=r=>(t,e,s)=>r(e,t,s),gx=r=>(t,e,s=0,n=0)=>{const i=t[s];if(i===void 0)throw r();return Hf(e)?i.connect(e,0,n):i.connect(e,0)},mx=r=>(t,e)=>{const s=r(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),n=t.createBuffer(1,2,44100);return s.buffer=n,s.loop=!0,s.connect(e),s.start(),()=>{s.stop(),s.disconnect(e)}},vx={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},yx=(r,t,e,s,n,i,a)=>class extends r{constructor(l,c){const u=n(l),d={...vx,...c},f=s(u,d),p=i(u),g=p?e():null;super(l,!1,f,g),this._constantSourceNodeRenderer=g,this._nativeConstantSourceNode=f,this._offset=t(this,p,f.offset,es,fs),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(l){const c=typeof l=="function"?a(this,l):null;this._nativeConstantSourceNode.onended=c;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===c?l:u}start(l=0){if(this._nativeConstantSourceNode.start(l),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=l),this.context.state!=="closed"){dc(this);const c=()=>{this._nativeConstantSourceNode.removeEventListener("ended",c),Mi(this)&&Td(this)};this._nativeConstantSourceNode.addEventListener("ended",c)}}stop(l=0){this._nativeConstantSourceNode.stop(l),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=l)}},bx=(r,t,e,s,n)=>()=>{const i=new WeakMap;let a=null,o=null;const l=async(c,u)=>{let d=e(c);const f=Ke(d,u);if(!f){const p={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,offset:d.offset.value};d=t(u,p),a!==null&&d.start(a),o!==null&&d.stop(o)}return i.set(u,d),f?await r(u,c.offset,d.offset):await s(u,c.offset,d.offset),await n(c,u,d),d};return{set start(c){a=c},set stop(c){o=c},render(c,u){const d=i.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},_x=r=>t=>(r[0]=t,r[0]),Ax={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},wx=(r,t,e,s,n,i)=>class extends r{constructor(o,l){const c=s(o),u={...Ax,...l},d=e(c,u),p=n(c)?t():null;super(o,!1,d,p),this._isBufferNullified=!1,this._nativeConvolverNode=d,u.buffer!==null&&i(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(o){if(this._nativeConvolverNode.buffer=o,o===null&&this._nativeConvolverNode.buffer!==null){const l=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=l.createBuffer(1,1,l.sampleRate),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(o){this._nativeConvolverNode.normalize=o}},Sx=(r,t,e)=>()=>{const s=new WeakMap,n=async(i,a)=>{let o=t(i);if(!Ke(o,a)){const c={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=r(a,c)}return s.set(a,o),mc(o)?await e(i,a,o.inputs[0]):await e(i,a,o),o};return{render(i,a){const o=s.get(a);return o!==void 0?Promise.resolve(o):n(i,a)}}},Tx=(r,t)=>(e,s,n)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(e,s,n)}catch(i){throw i.name==="SyntaxError"?r():i}},Cx=()=>new DOMException("","DataCloneError"),Db=r=>{const{port1:t,port2:e}=new MessageChannel;return new Promise(s=>{const n=()=>{e.onmessage=null,t.close(),e.close(),s()};e.onmessage=()=>n();try{t.postMessage(r,[r])}catch{}finally{n()}})},Ex=(r,t,e,s,n,i,a,o,l,c,u)=>(d,f)=>{const p=a(d)?d:i(d);if(n.has(f)){const g=e();return Promise.reject(g)}try{n.add(f)}catch{}return t(l,()=>l(p))?p.decodeAudioData(f).then(g=>(Db(f).catch(()=>{}),t(o,()=>o(g))||u(g),r.add(g),g)):new Promise((g,m)=>{const v=async()=>{try{await Db(f)}catch{}},y=S=>{m(S),v()};try{p.decodeAudioData(f,S=>{typeof S.copyFromChannel!="function"&&(c(S),yy(S)),r.add(S),v().then(()=>g(S))},S=>{y(S===null?s():S)})}catch(S){y(S)}})},xx=(r,t,e,s,n,i,a,o)=>(l,c)=>{const u=t.get(l);if(u===void 0)throw new Error("Missing the expected cycle count.");const d=i(l.context),f=o(d);if(u===c){if(t.delete(l),!f&&a(l)){const p=s(l),{outputs:g}=e(l);for(const m of g)if(Ed(m)){const v=s(m[0]);r(p,v,m[1],m[2])}else{const v=n(m[0]);p.connect(v,m[1])}}}else t.set(l,u-c)},Ix={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Rx=(r,t,e,s,n,i,a)=>class extends r{constructor(l,c){const u=n(l),d={...Ix,...c},f=s(u,d),p=i(u),g=p?e(d.maxDelayTime):null;super(l,!1,f,g),this._delayTime=t(this,p,f.delayTime),a(this,d.maxDelayTime)}get delayTime(){return this._delayTime}},Px=(r,t,e,s,n)=>i=>{const a=new WeakMap,o=async(l,c)=>{let u=e(l);const d=Ke(u,c);if(!d){const f={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:i};u=t(c,f)}return a.set(c,u),d?await r(c,l.delayTime,u.delayTime):await s(c,l.delayTime,u.delayTime),await n(l,c,u),u};return{render(l,c){const u=a.get(c);return u!==void 0?Promise.resolve(u):o(l,c)}}},Ox=r=>(t,e,s,n)=>r(t[n],i=>i[0]===e&&i[1]===s),Mx=r=>(t,e)=>{r(t).delete(e)},kx=r=>"delayTime"in r,Dx=(r,t,e)=>function s(n,i){const a=jf(i)?i:e(r,i);if(kx(a))return[];if(n[0]===a)return[n];if(n.includes(a))return[];const{outputs:o}=t(a);return Array.from(o).map(l=>s([...n,a],l[0])).reduce((l,c)=>l.concat(c),[])},Yd=(r,t,e)=>{const s=t[e];if(s===void 0)throw r();return s},Nx=r=>(t,e=void 0,s=void 0,n=0)=>e===void 0?t.forEach(i=>i.disconnect()):typeof e=="number"?Yd(r,t,e).disconnect():Hf(e)?s===void 0?t.forEach(i=>i.disconnect(e)):n===void 0?Yd(r,t,s).disconnect(e,0):Yd(r,t,s).disconnect(e,0,n):s===void 0?t.forEach(i=>i.disconnect(e)):Yd(r,t,s).disconnect(e,0),Lx={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Fx=(r,t,e,s,n,i,a,o)=>class extends r{constructor(c,u){const d=i(c),f={...Lx,...u},p=s(d,f),g=a(d),m=g?e():null;super(c,!1,p,m),this._attack=t(this,g,p.attack),this._knee=t(this,g,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=t(this,g,p.ratio),this._release=t(this,g,p.release),this._threshold=t(this,g,p.threshold),o(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(c){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=c,c>2)throw this._nativeDynamicsCompressorNode.channelCount=u,n()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(c){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=c,c==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,n()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Bx=(r,t,e,s,n)=>()=>{const i=new WeakMap,a=async(o,l)=>{let c=e(o);const u=Ke(c,l);if(!u){const d={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=t(l,d)}return i.set(l,c),u?(await r(l,o.attack,c.attack),await r(l,o.knee,c.knee),await r(l,o.ratio,c.ratio),await r(l,o.release,c.release),await r(l,o.threshold,c.threshold)):(await s(l,o.attack,c.attack),await s(l,o.knee,c.knee),await s(l,o.ratio,c.ratio),await s(l,o.release,c.release),await s(l,o.threshold,c.threshold)),await n(o,l,c),c};return{render(o,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):a(o,l)}}},Vx=()=>new DOMException("","EncodingError"),$x=r=>t=>new Promise((e,s)=>{if(r===null){s(new SyntaxError);return}const n=r.document.head;if(n===null)s(new SyntaxError);else{const i=r.document.createElement("script"),a=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(a),l=r.onerror,c=()=>{r.onerror=l,URL.revokeObjectURL(o)};r.onerror=(u,d,f,p,g)=>{if(d===o||d===r.location.href&&f===1&&p===1)return c(),s(g),!1;if(l!==null)return l(u,d,f,p,g)},i.onerror=()=>{c(),s(new SyntaxError)},i.onload=()=>{c(),e()},i.src=o,i.type="module",n.appendChild(i)}}),jx=r=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(e,s,n){if(s!==null){let i=this._listeners.get(s);i===void 0&&(i=r(this,s),typeof s=="function"&&this._listeners.set(s,i)),this._nativeEventTarget.addEventListener(e,i,n)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,s,n){const i=s===null?void 0:this._listeners.get(s);this._nativeEventTarget.removeEventListener(e,i===void 0?null:i,n)}},Ux=r=>(t,e,s)=>{Object.defineProperties(r,{currentFrame:{configurable:!0,get(){return Math.round(t*e)}},currentTime:{configurable:!0,get(){return t}}});try{return s()}finally{r!==null&&(delete r.currentFrame,delete r.currentTime)}},Wx=r=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw r()},Hx={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},zx=(r,t,e,s,n,i)=>class extends r{constructor(o,l){const c=n(o),u={...Hx,...l},d=s(c,u),f=i(c),p=f?e():null;super(o,!1,d,p),this._gain=t(this,f,d.gain,es,fs)}get gain(){return this._gain}},Gx=(r,t,e,s,n)=>()=>{const i=new WeakMap,a=async(o,l)=>{let c=e(o);const u=Ke(c,l);if(!u){const d={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=t(l,d)}return i.set(l,c),u?await r(l,o.gain,c.gain):await s(l,o.gain,c.gain),await n(o,l,c),c};return{render(o,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):a(o,l)}}},Xx=(r,t)=>e=>t(r,e),Yx=r=>t=>{const e=r(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer},Kx=r=>t=>{var e;return(e=r.get(t))!==null&&e!==void 0?e:0},qx=r=>t=>{const e=r(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return e.renderer},Zx=r=>t=>r.get(t),Pe=()=>new DOMException("","InvalidStateError"),Qx=r=>t=>{const e=r.get(t);if(e===void 0)throw Pe();return e},Jx=(r,t)=>e=>{let s=r.get(e);if(s!==void 0)return s;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),r.set(e,s),s},tI=r=>t=>{const e=r.get(t);if(e===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return e},qg=()=>new DOMException("","InvalidAccessError"),eI=r=>{r.getFrequencyResponse=(t=>(e,s,n)=>{if(e.length!==s.length||s.length!==n.length)throw qg();return t.call(r,e,s,n)})(r.getFrequencyResponse)},sI={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},nI=(r,t,e,s,n,i)=>class extends r{constructor(o,l){const c=s(o),u=n(c),d={...sI,...l},f=t(c,u?null:o.baseLatency,d),p=u?e(d.feedback,d.feedforward):null;super(o,!1,f,p),eI(f),this._nativeIIRFilterNode=f,i(this,1)}getFrequencyResponse(o,l,c){return this._nativeIIRFilterNode.getFrequencyResponse(o,l,c)}},ww=(r,t,e,s,n,i,a,o,l,c,u)=>{const d=c.length;let f=o;for(let p=0;p<d;p+=1){let g=e[0]*c[p];for(let m=1;m<n;m+=1){const v=f-m&l-1;g+=e[m]*i[v],g-=r[m]*a[v]}for(let m=n;m<s;m+=1)g+=e[m]*i[f-m&l-1];for(let m=n;m<t;m+=1)g-=r[m]*a[f-m&l-1];i[f]=c[p],a[f]=g,f=f+1&l-1,u[p]=g}return f},iI=(r,t,e,s)=>{const n=e instanceof Float64Array?e:new Float64Array(e),i=s instanceof Float64Array?s:new Float64Array(s),a=n.length,o=i.length,l=Math.min(a,o);if(n[0]!==1){for(let g=0;g<a;g+=1)i[g]/=n[0];for(let g=1;g<o;g+=1)n[g]/=n[0]}const c=32,u=new Float32Array(c),d=new Float32Array(c),f=t.createBuffer(r.numberOfChannels,r.length,r.sampleRate),p=r.numberOfChannels;for(let g=0;g<p;g+=1){const m=r.getChannelData(g),v=f.getChannelData(g);u.fill(0),d.fill(0),ww(n,a,i,o,l,u,d,0,c,m,v)}return f},rI=(r,t,e,s,n)=>(i,a)=>{const o=new WeakMap;let l=null;const c=async(u,d)=>{let f=null,p=t(u);const g=Ke(p,d);if(d.createIIRFilter===void 0?f=r(d,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):g||(p=d.createIIRFilter(a,i)),o.set(d,f===null?p:f),f!==null){if(l===null){if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new e(u.context.destination.channelCount,u.context.length,d.sampleRate);l=(async()=>{await s(u,v,v.destination);const y=await n(v);return iI(y,d,i,a)})()}const m=await l;return f.buffer=m,f.start(0),f}return await s(u,d,p),p};return{render(u,d){const f=o.get(d);return f!==void 0?Promise.resolve(f):c(u,d)}}},aI=(r,t,e,s,n,i)=>a=>(o,l)=>{const c=r.get(o);if(c===void 0){if(!a&&i(o)){const u=s(o),{outputs:d}=e(o);for(const f of d)if(Ed(f)){const p=s(f[0]);t(u,p,f[1],f[2])}else{const p=n(f[0]);u.disconnect(p,f[1])}}r.set(o,l)}else r.set(o,c+l)},oI=(r,t)=>e=>{const s=r.get(e);return t(s)||t(e)},lI=(r,t)=>e=>r.has(e)||t(e),cI=(r,t)=>e=>r.has(e)||t(e),hI=(r,t)=>e=>{const s=r.get(e);return t(s)||t(e)},uI=r=>t=>r!==null&&t instanceof r,dI=r=>t=>r!==null&&typeof r.AudioNode=="function"&&t instanceof r.AudioNode,fI=r=>t=>r!==null&&typeof r.AudioParam=="function"&&t instanceof r.AudioParam,pI=(r,t)=>e=>r(e)||t(e),gI=r=>t=>r!==null&&t instanceof r,mI=r=>r!==null&&r.isSecureContext,vI=(r,t,e,s)=>class extends r{constructor(i,a){const o=e(i),l=t(o,a);if(s(o))throw TypeError();super(i,!0,l,null),this._nativeMediaElementAudioSourceNode=l}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},yI={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},bI=(r,t,e,s)=>class extends r{constructor(i,a){const o=e(i);if(s(o))throw new TypeError;const l={...yI,...a},c=t(o,l);super(i,!1,c,null),this._nativeMediaStreamAudioDestinationNode=c}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},_I=(r,t,e,s)=>class extends r{constructor(i,a){const o=e(i),l=t(o,a);if(s(o))throw new TypeError;super(i,!0,l,null),this._nativeMediaStreamAudioSourceNode=l}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},AI=(r,t,e)=>class extends r{constructor(n,i){const a=e(n),o=t(a,i);super(n,!0,o,null)}},wI=(r,t,e,s,n,i)=>class extends e{constructor(o,l){super(o),this._nativeContext=o,Yg.set(this,o),s(o)&&n.set(o,new Set),this._destination=new r(this,l),this._listener=t(this,o),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(o){const l=typeof o=="function"?i(this,o):null;this._nativeContext.onstatechange=l;const c=this._nativeContext.onstatechange;this._onstatechange=c!==null&&c===l?o:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Jc=r=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const e=r.decodeAudioData(t.buffer,()=>{});return e===void 0?!1:(e.catch(()=>{}),!0)}catch{}return!1},SI=(r,t)=>(e,s,n)=>{const i=new Set;return e.connect=(a=>(o,l=0,c=0)=>{const u=i.size===0;if(t(o))return a.call(e,o,l,c),r(i,[o,l,c],d=>d[0]===o&&d[1]===l&&d[2]===c,!0),u&&s(),o;a.call(e,o,l),r(i,[o,l],d=>d[0]===o&&d[1]===l,!0),u&&s()})(e.connect),e.disconnect=(a=>(o,l,c)=>{const u=i.size>0;if(o===void 0)a.apply(e),i.clear();else if(typeof o=="number"){a.call(e,o);for(const f of i)f[1]===o&&i.delete(f)}else{t(o)?a.call(e,o,l,c):a.call(e,o,l);for(const f of i)f[0]===o&&(l===void 0||f[1]===l)&&(c===void 0||f[2]===c)&&i.delete(f)}const d=i.size===0;u&&d&&n()})(e.disconnect),e},Zt=(r,t,e)=>{const s=t[e];s!==void 0&&s!==r[e]&&(r[e]=s)},we=(r,t)=>{Zt(r,t,"channelCount"),Zt(r,t,"channelCountMode"),Zt(r,t,"channelInterpretation")},Nb=r=>typeof r.getFloatTimeDomainData=="function",TI=r=>{r.getFloatTimeDomainData=t=>{const e=new Uint8Array(t.length);r.getByteTimeDomainData(e);const s=Math.max(e.length,r.fftSize);for(let n=0;n<s;n+=1)t[n]=(e[n]-128)*.0078125;return t}},CI=(r,t)=>(e,s)=>{const n=e.createAnalyser();if(we(n,s),!(s.maxDecibels>s.minDecibels))throw t();return Zt(n,s,"fftSize"),Zt(n,s,"maxDecibels"),Zt(n,s,"minDecibels"),Zt(n,s,"smoothingTimeConstant"),r(Nb,()=>Nb(n))||TI(n),n},EI=r=>r===null?null:r.hasOwnProperty("AudioBuffer")?r.AudioBuffer:null,ae=(r,t,e)=>{const s=t[e];s!==void 0&&s!==r[e].value&&(r[e].value=s)},xI=r=>{r.start=(t=>{let e=!1;return(s=0,n=0,i)=>{if(e)throw Pe();t.call(r,s,n,i),e=!0}})(r.start)},Ay=r=>{r.start=(t=>(e=0,s=0,n)=>{if(typeof n=="number"&&n<0||s<0||e<0)throw new RangeError("The parameters can't be negative.");t.call(r,e,s,n)})(r.start)},wy=r=>{r.stop=(t=>(e=0)=>{if(e<0)throw new RangeError("The parameter can't be negative.");t.call(r,e)})(r.stop)},II=(r,t,e,s,n,i,a,o,l,c,u)=>(d,f)=>{const p=d.createBufferSource();return we(p,f),ae(p,f,"playbackRate"),Zt(p,f,"buffer"),Zt(p,f,"loop"),Zt(p,f,"loopEnd"),Zt(p,f,"loopStart"),t(e,()=>e(d))||xI(p),t(s,()=>s(d))||l(p),t(n,()=>n(d))||c(p,d),t(i,()=>i(d))||Ay(p),t(a,()=>a(d))||u(p,d),t(o,()=>o(d))||wy(p),r(d,p),p},RI=r=>r===null?null:r.hasOwnProperty("AudioContext")?r.AudioContext:r.hasOwnProperty("webkitAudioContext")?r.webkitAudioContext:null,PI=(r,t)=>(e,s,n)=>{const i=e.destination;if(i.channelCount!==s)try{i.channelCount=s}catch{}n&&i.channelCountMode!=="explicit"&&(i.channelCountMode="explicit"),i.maxChannelCount===0&&Object.defineProperty(i,"maxChannelCount",{value:s});const a=r(e,{channelCount:s,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return t(a,"channelCount",o=>()=>o.call(a),o=>l=>{o.call(a,l);try{i.channelCount=l}catch(c){if(l>i.maxChannelCount)throw c}}),t(a,"channelCountMode",o=>()=>o.call(a),o=>l=>{o.call(a,l),i.channelCountMode=l}),t(a,"channelInterpretation",o=>()=>o.call(a),o=>l=>{o.call(a,l),i.channelInterpretation=l}),Object.defineProperty(a,"maxChannelCount",{get:()=>i.maxChannelCount}),a.connect(i),a},OI=r=>r===null?null:r.hasOwnProperty("AudioWorkletNode")?r.AudioWorkletNode:null,MI=r=>{const{port1:t}=new MessageChannel;try{t.postMessage(r)}finally{t.close()}},kI=(r,t,e,s,n)=>(i,a,o,l,c,u)=>{if(o!==null)try{const d=new o(i,l,u),f=new Map;let p=null;if(Object.defineProperties(d,{channelCount:{get:()=>u.channelCount,set:()=>{throw r()}},channelCountMode:{get:()=>"explicit",set:()=>{throw r()}},onprocessorerror:{get:()=>p,set:g=>{typeof p=="function"&&d.removeEventListener("processorerror",p),p=typeof g=="function"?g:null,typeof p=="function"&&d.addEventListener("processorerror",p)}}}),d.addEventListener=(g=>(...m)=>{if(m[0]==="processorerror"){const v=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(v!==null){const y=f.get(m[1]);y!==void 0?m[1]=y:(m[1]=S=>{S.type==="error"?(Object.defineProperties(S,{type:{value:"processorerror"}}),v(S)):v(new ErrorEvent(m[0],{...S}))},f.set(v,m[1]))}}return g.call(d,"error",m[1],m[2]),g.call(d,...m)})(d.addEventListener),d.removeEventListener=(g=>(...m)=>{if(m[0]==="processorerror"){const v=f.get(m[1]);v!==void 0&&(f.delete(m[1]),m[1]=v)}return g.call(d,"error",m[1],m[2]),g.call(d,m[0],m[1],m[2])})(d.removeEventListener),u.numberOfOutputs!==0){const g=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return d.connect(g).connect(i.destination),n(d,()=>g.disconnect(),()=>g.connect(i.destination))}return d}catch(d){throw d.code===11?s():d}if(c===void 0)throw s();return MI(u),t(i,a,c,u)},Sw=(r,t)=>r===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(r*t))))),DI=r=>new Promise((t,e)=>{const{port1:s,port2:n}=new MessageChannel;s.onmessage=({data:i})=>{s.close(),n.close(),t(i)},s.onmessageerror=({data:i})=>{s.close(),n.close(),e(i)},n.postMessage(r)}),NI=async(r,t)=>{const e=await DI(t);return new r(e)},LI=(r,t,e,s)=>{let n=qv.get(r);n===void 0&&(n=new WeakMap,qv.set(r,n));const i=NI(e,s);return n.set(t,i),i},FI=(r,t,e,s,n,i,a,o,l,c,u,d,f)=>(p,g,m,v)=>{if(v.numberOfInputs===0&&v.numberOfOutputs===0)throw l();const y=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(y.some(G=>G<1))throw l();if(y.length!==v.numberOfOutputs)throw t();if(v.channelCountMode!=="explicit")throw l();const S=v.channelCount*v.numberOfInputs,T=y.reduce((G,q)=>G+q,0),E=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(S+E>6||T>6)throw l();const A=new MessageChannel,C=[],x=[];for(let G=0;G<v.numberOfInputs;G+=1)C.push(a(p,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),x.push(n(p,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const I=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:G,maxValue:q,minValue:Pt,name:Ot}of m.parameterDescriptors){const mt=i(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:v.parameterData[Ot]!==void 0?v.parameterData[Ot]:G===void 0?0:G});Object.defineProperties(mt.offset,{defaultValue:{get:()=>G===void 0?0:G},maxValue:{get:()=>q===void 0?es:q},minValue:{get:()=>Pt===void 0?fs:Pt}}),I.push(mt)}const R=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,S+E)}),O=Sw(g,p.sampleRate),P=o(p,O,S+E,Math.max(1,T)),M=n(p,{channelCount:Math.max(1,T),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,T)}),B=[];for(let G=0;G<v.numberOfOutputs;G+=1)B.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[G]}));for(let G=0;G<v.numberOfInputs;G+=1){C[G].connect(x[G]);for(let q=0;q<v.channelCount;q+=1)x[G].connect(R,q,G*v.channelCount+q)}const F=new _w(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:G},q)=>{const Pt=I[q];return Pt.connect(R,0,S+q),Pt.start(0),[G,Pt.offset]}));R.connect(P);let W=v.channelInterpretation,j=null;const D=v.numberOfOutputs===0?[P]:B,$={get bufferSize(){return O},get channelCount(){return v.channelCount},set channelCount(G){throw e()},get channelCountMode(){return v.channelCountMode},set channelCountMode(G){throw e()},get channelInterpretation(){return W},set channelInterpretation(G){for(const q of C)q.channelInterpretation=G;W=G},get context(){return P.context},get inputs(){return C},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return j},set onprocessorerror(G){typeof j=="function"&&$.removeEventListener("processorerror",j),j=typeof G=="function"?G:null,typeof j=="function"&&$.addEventListener("processorerror",j)},get parameters(){return F},get port(){return A.port2},addEventListener(...G){return P.addEventListener(G[0],G[1],G[2])},connect:r.bind(null,D),disconnect:c.bind(null,D),dispatchEvent(...G){return P.dispatchEvent(G[0])},removeEventListener(...G){return P.removeEventListener(G[0],G[1],G[2])}},H=new Map;A.port1.addEventListener=(G=>(...q)=>{if(q[0]==="message"){const Pt=typeof q[1]=="function"?q[1]:typeof q[1]=="object"&&q[1]!==null&&typeof q[1].handleEvent=="function"?q[1].handleEvent:null;if(Pt!==null){const Ot=H.get(q[1]);Ot!==void 0?q[1]=Ot:(q[1]=mt=>{u(p.currentTime,p.sampleRate,()=>Pt(mt))},H.set(Pt,q[1]))}}return G.call(A.port1,q[0],q[1],q[2])})(A.port1.addEventListener),A.port1.removeEventListener=(G=>(...q)=>{if(q[0]==="message"){const Pt=H.get(q[1]);Pt!==void 0&&(H.delete(q[1]),q[1]=Pt)}return G.call(A.port1,q[0],q[1],q[2])})(A.port1.removeEventListener);let Y=null;Object.defineProperty(A.port1,"onmessage",{get:()=>Y,set:G=>{typeof Y=="function"&&A.port1.removeEventListener("message",Y),Y=typeof G=="function"?G:null,typeof Y=="function"&&(A.port1.addEventListener("message",Y),A.port1.start())}}),m.prototype.port=A.port1;let K=null;LI(p,$,m,v).then(G=>K=G);const ut=Gf(v.numberOfInputs,v.channelCount),Rt=Gf(v.numberOfOutputs,y),ht=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((G,{name:q})=>({...G,[q]:new Float32Array(128)}),{});let U=!0;const V=()=>{v.numberOfOutputs>0&&P.disconnect(M);for(let G=0,q=0;G<v.numberOfOutputs;G+=1){const Pt=B[G];for(let Ot=0;Ot<y[G];Ot+=1)M.disconnect(Pt,q+Ot,Ot);q+=y[G]}},N=new Map;P.onaudioprocess=({inputBuffer:G,outputBuffer:q})=>{if(K!==null){const Pt=d($);for(let Ot=0;Ot<O;Ot+=128){for(let mt=0;mt<v.numberOfInputs;mt+=1)for(let Ht=0;Ht<v.channelCount;Ht+=1)zf(G,ut[mt],Ht,Ht,Ot);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:mt},Ht)=>{zf(G,ht,mt,S+Ht,Ot)});for(let mt=0;mt<v.numberOfInputs;mt+=1)for(let Ht=0;Ht<y[mt];Ht+=1)Rt[mt][Ht].byteLength===0&&(Rt[mt][Ht]=new Float32Array(128));try{const mt=ut.map((Oe,tt)=>{if(Pt[tt].size>0)return N.set(tt,O/128),Oe;const yt=N.get(tt);return yt===void 0?[]:(Oe.every(Q=>Q.every(Ws=>Ws===0))&&(yt===1?N.delete(tt):N.set(tt,yt-1)),Oe)});U=u(p.currentTime+Ot/p.sampleRate,p.sampleRate,()=>K.process(mt,Rt,ht));for(let Oe=0,tt=0;Oe<v.numberOfOutputs;Oe+=1){for(let L=0;L<y[Oe];L+=1)Aw(q,Rt[Oe],L,tt+L,Ot);tt+=y[Oe]}}catch(mt){U=!1,$.dispatchEvent(new ErrorEvent("processorerror",{colno:mt.colno,filename:mt.filename,lineno:mt.lineno,message:mt.message}))}if(!U){for(let mt=0;mt<v.numberOfInputs;mt+=1){C[mt].disconnect(x[mt]);for(let Ht=0;Ht<v.channelCount;Ht+=1)x[Ot].disconnect(R,Ht,mt*v.channelCount+Ht)}if(m.parameterDescriptors!==void 0){const mt=m.parameterDescriptors.length;for(let Ht=0;Ht<mt;Ht+=1){const Oe=I[Ht];Oe.disconnect(R,0,S+Ht),Oe.stop()}}R.disconnect(P),P.onaudioprocess=null,ct?V():Ct();break}}}};let ct=!1;const pt=a(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),rt=()=>P.connect(pt).connect(p.destination),Ct=()=>{P.disconnect(pt),pt.disconnect()},Dt=()=>{if(U){Ct(),v.numberOfOutputs>0&&P.connect(M);for(let G=0,q=0;G<v.numberOfOutputs;G+=1){const Pt=B[G];for(let Ot=0;Ot<y[G];Ot+=1)M.connect(Pt,q+Ot,Ot);q+=y[G]}}ct=!0},ye=()=>{U&&(rt(),V()),ct=!1};return rt(),f($,Dt,ye)},Tw=(r,t)=>{const e=r.createBiquadFilter();return we(e,t),ae(e,t,"Q"),ae(e,t,"detune"),ae(e,t,"frequency"),ae(e,t,"gain"),Zt(e,t,"type"),e},BI=(r,t)=>(e,s)=>{const n=e.createChannelMerger(s.numberOfInputs);return r!==null&&r.name==="webkitAudioContext"&&t(e,n),we(n,s),n},VI=r=>{const t=r.numberOfOutputs;Object.defineProperty(r,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw Pe()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:e=>{if(e!=="explicit")throw Pe()}}),Object.defineProperty(r,"channelInterpretation",{get:()=>"discrete",set:e=>{if(e!=="discrete")throw Pe()}})},xd=(r,t)=>{const e=r.createChannelSplitter(t.numberOfOutputs);return we(e,t),VI(e),e},$I=(r,t,e,s,n)=>(i,a)=>{if(i.createConstantSource===void 0)return e(i,a);const o=i.createConstantSource();return we(o,a),ae(o,a,"offset"),t(s,()=>s(i))||Ay(o),t(n,()=>n(i))||wy(o),r(i,o),o},vc=(r,t)=>(r.connect=t.connect.bind(t),r.disconnect=t.disconnect.bind(t),r),jI=(r,t,e,s)=>(n,{offset:i,...a})=>{const o=n.createBuffer(1,2,44100),l=t(n,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=e(n,{...a,gain:i}),u=o.getChannelData(0);u[0]=1,u[1]=1,l.buffer=o,l.loop=!0;const d={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(g){c.channelCount=g},get channelCountMode(){return c.channelCountMode},set channelCountMode(g){c.channelCountMode=g},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(g){c.channelInterpretation=g},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(g){l.onended=g},addEventListener(...g){return l.addEventListener(g[0],g[1],g[2])},dispatchEvent(...g){return l.dispatchEvent(g[0])},removeEventListener(...g){return l.removeEventListener(g[0],g[1],g[2])},start(g=0){l.start.call(l,g)},stop(g=0){l.stop.call(l,g)}},f=()=>l.connect(c),p=()=>l.disconnect(c);return r(n,l),s(vc(d,c),f,p)},UI=(r,t)=>(e,s)=>{const n=e.createConvolver();if(we(n,s),s.disableNormalization===n.normalize&&(n.normalize=!s.disableNormalization),Zt(n,s,"buffer"),s.channelCount>2||(t(n,"channelCount",i=>()=>i.call(n),i=>a=>{if(a>2)throw r();return i.call(n,a)}),s.channelCountMode==="max"))throw r();return t(n,"channelCountMode",i=>()=>i.call(n),i=>a=>{if(a==="max")throw r();return i.call(n,a)}),n},Cw=(r,t)=>{const e=r.createDelay(t.maxDelayTime);return we(e,t),ae(e,t,"delayTime"),e},WI=r=>(t,e)=>{const s=t.createDynamicsCompressor();if(we(s,e),e.channelCount>2||e.channelCountMode==="max")throw r();return ae(s,e,"attack"),ae(s,e,"knee"),ae(s,e,"ratio"),ae(s,e,"release"),ae(s,e,"threshold"),s},gs=(r,t)=>{const e=r.createGain();return we(e,t),ae(e,t,"gain"),e},HI=r=>(t,e,s)=>{if(t.createIIRFilter===void 0)return r(t,e,s);const n=t.createIIRFilter(s.feedforward,s.feedback);return we(n,s),n};function zI(r,t){const e=t[0]*t[0]+t[1]*t[1];return[(r[0]*t[0]+r[1]*t[1])/e,(r[1]*t[0]-r[0]*t[1])/e]}function GI(r,t){return[r[0]*t[0]-r[1]*t[1],r[0]*t[1]+r[1]*t[0]]}function Lb(r,t){let e=[0,0];for(let s=r.length-1;s>=0;s-=1)e=GI(e,t),e[0]+=r[s];return e}const XI=(r,t,e,s)=>(n,i,{channelCount:a,channelCountMode:o,channelInterpretation:l,feedback:c,feedforward:u})=>{const d=Sw(i,n.sampleRate),f=c instanceof Float64Array?c:new Float64Array(c),p=u instanceof Float64Array?u:new Float64Array(u),g=f.length,m=p.length,v=Math.min(g,m);if(g===0||g>20)throw s();if(f[0]===0)throw t();if(m===0||m>20)throw s();if(p[0]===0)throw t();if(f[0]!==1){for(let I=0;I<m;I+=1)p[I]/=f[0];for(let I=1;I<g;I+=1)f[I]/=f[0]}const y=e(n,d,a,a);y.channelCount=a,y.channelCountMode=o,y.channelInterpretation=l;const S=32,T=[],E=[],A=[];for(let I=0;I<a;I+=1){T.push(0);const R=new Float32Array(S),O=new Float32Array(S);R.fill(0),O.fill(0),E.push(R),A.push(O)}y.onaudioprocess=I=>{const R=I.inputBuffer,O=I.outputBuffer,P=R.numberOfChannels;for(let M=0;M<P;M+=1){const B=R.getChannelData(M),F=O.getChannelData(M);T[M]=ww(f,g,p,m,v,E[M],A[M],T[M],S,B,F)}};const C=n.sampleRate/2;return vc({get bufferSize(){return d},get channelCount(){return y.channelCount},set channelCount(I){y.channelCount=I},get channelCountMode(){return y.channelCountMode},set channelCountMode(I){y.channelCountMode=I},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(I){y.channelInterpretation=I},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...I){return y.addEventListener(I[0],I[1],I[2])},dispatchEvent(...I){return y.dispatchEvent(I[0])},getFrequencyResponse(I,R,O){if(I.length!==R.length||R.length!==O.length)throw r();const P=I.length;for(let M=0;M<P;M+=1){const B=-Math.PI*(I[M]/C),F=[Math.cos(B),Math.sin(B)],W=Lb(p,F),j=Lb(f,F),D=zI(W,j);R[M]=Math.sqrt(D[0]*D[0]+D[1]*D[1]),O[M]=Math.atan2(D[1],D[0])}},removeEventListener(...I){return y.removeEventListener(I[0],I[1],I[2])}},y)},YI=(r,t)=>r.createMediaElementSource(t.mediaElement),KI=(r,t)=>{const e=r.createMediaStreamDestination();return we(e,t),e.numberOfOutputs===1&&Object.defineProperty(e,"numberOfOutputs",{get:()=>0}),e},qI=(r,{mediaStream:t})=>{const e=t.getAudioTracks();e.sort((i,a)=>i.id<a.id?-1:i.id>a.id?1:0);const s=e.slice(0,1),n=r.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(n,"mediaStream",{value:t}),n},ZI=(r,t)=>(e,{mediaStreamTrack:s})=>{if(typeof e.createMediaStreamTrackSource=="function")return e.createMediaStreamTrackSource(s);const n=new MediaStream([s]),i=e.createMediaStreamSource(n);if(s.kind!=="audio")throw r();if(t(e))throw new TypeError;return i},QI=r=>r===null?null:r.hasOwnProperty("OfflineAudioContext")?r.OfflineAudioContext:r.hasOwnProperty("webkitOfflineAudioContext")?r.webkitOfflineAudioContext:null,JI=(r,t,e,s,n,i)=>(a,o)=>{const l=a.createOscillator();return we(l,o),ae(l,o,"detune"),ae(l,o,"frequency"),o.periodicWave!==void 0?l.setPeriodicWave(o.periodicWave):Zt(l,o,"type"),t(e,()=>e(a))||Ay(l),t(s,()=>s(a))||i(l,a),t(n,()=>n(a))||wy(l),r(a,l),l},tR=r=>(t,e)=>{const s=t.createPanner();return s.orientationX===void 0?r(t,e):(we(s,e),ae(s,e,"orientationX"),ae(s,e,"orientationY"),ae(s,e,"orientationZ"),ae(s,e,"positionX"),ae(s,e,"positionY"),ae(s,e,"positionZ"),Zt(s,e,"coneInnerAngle"),Zt(s,e,"coneOuterAngle"),Zt(s,e,"coneOuterGain"),Zt(s,e,"distanceModel"),Zt(s,e,"maxDistance"),Zt(s,e,"panningModel"),Zt(s,e,"refDistance"),Zt(s,e,"rolloffFactor"),s)},eR=(r,t,e,s,n,i,a,o,l,c)=>(u,{coneInnerAngle:d,coneOuterAngle:f,coneOuterGain:p,distanceModel:g,maxDistance:m,orientationX:v,orientationY:y,orientationZ:S,panningModel:T,positionX:E,positionY:A,positionZ:C,refDistance:x,rolloffFactor:I,...R})=>{const O=u.createPanner();if(R.channelCount>2||R.channelCountMode==="max")throw a();we(O,R);const P={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},M=e(u,{...P,channelInterpretation:"speakers",numberOfInputs:6}),B=s(u,{...R,gain:1}),F=s(u,{...P,gain:1}),W=s(u,{...P,gain:0}),j=s(u,{...P,gain:0}),D=s(u,{...P,gain:0}),$=s(u,{...P,gain:0}),H=s(u,{...P,gain:0}),Y=n(u,256,6,1),K=i(u,{...P,curve:new Float32Array([1,1]),oversample:"none"});let nt=[v,y,S],ut=[E,A,C];const Rt=new Float32Array(1);Y.onaudioprocess=({inputBuffer:N})=>{const ct=[l(N,Rt,0),l(N,Rt,1),l(N,Rt,2)];ct.some((rt,Ct)=>rt!==nt[Ct])&&(O.setOrientation(...ct),nt=ct);const pt=[l(N,Rt,3),l(N,Rt,4),l(N,Rt,5)];pt.some((rt,Ct)=>rt!==ut[Ct])&&(O.setPosition(...pt),ut=pt)},Object.defineProperty(W.gain,"defaultValue",{get:()=>0}),Object.defineProperty(j.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(H.gain,"defaultValue",{get:()=>0});const ht={get bufferSize(){},get channelCount(){return O.channelCount},set channelCount(N){if(N>2)throw a();B.channelCount=N,O.channelCount=N},get channelCountMode(){return O.channelCountMode},set channelCountMode(N){if(N==="max")throw a();B.channelCountMode=N,O.channelCountMode=N},get channelInterpretation(){return O.channelInterpretation},set channelInterpretation(N){B.channelInterpretation=N,O.channelInterpretation=N},get coneInnerAngle(){return O.coneInnerAngle},set coneInnerAngle(N){O.coneInnerAngle=N},get coneOuterAngle(){return O.coneOuterAngle},set coneOuterAngle(N){O.coneOuterAngle=N},get coneOuterGain(){return O.coneOuterGain},set coneOuterGain(N){if(N<0||N>1)throw t();O.coneOuterGain=N},get context(){return O.context},get distanceModel(){return O.distanceModel},set distanceModel(N){O.distanceModel=N},get inputs(){return[B]},get maxDistance(){return O.maxDistance},set maxDistance(N){if(N<0)throw new RangeError;O.maxDistance=N},get numberOfInputs(){return O.numberOfInputs},get numberOfOutputs(){return O.numberOfOutputs},get orientationX(){return F.gain},get orientationY(){return W.gain},get orientationZ(){return j.gain},get panningModel(){return O.panningModel},set panningModel(N){O.panningModel=N},get positionX(){return D.gain},get positionY(){return $.gain},get positionZ(){return H.gain},get refDistance(){return O.refDistance},set refDistance(N){if(N<0)throw new RangeError;O.refDistance=N},get rolloffFactor(){return O.rolloffFactor},set rolloffFactor(N){if(N<0)throw new RangeError;O.rolloffFactor=N},addEventListener(...N){return B.addEventListener(N[0],N[1],N[2])},dispatchEvent(...N){return B.dispatchEvent(N[0])},removeEventListener(...N){return B.removeEventListener(N[0],N[1],N[2])}};d!==ht.coneInnerAngle&&(ht.coneInnerAngle=d),f!==ht.coneOuterAngle&&(ht.coneOuterAngle=f),p!==ht.coneOuterGain&&(ht.coneOuterGain=p),g!==ht.distanceModel&&(ht.distanceModel=g),m!==ht.maxDistance&&(ht.maxDistance=m),v!==ht.orientationX.value&&(ht.orientationX.value=v),y!==ht.orientationY.value&&(ht.orientationY.value=y),S!==ht.orientationZ.value&&(ht.orientationZ.value=S),T!==ht.panningModel&&(ht.panningModel=T),E!==ht.positionX.value&&(ht.positionX.value=E),A!==ht.positionY.value&&(ht.positionY.value=A),C!==ht.positionZ.value&&(ht.positionZ.value=C),x!==ht.refDistance&&(ht.refDistance=x),I!==ht.rolloffFactor&&(ht.rolloffFactor=I),(nt[0]!==1||nt[1]!==0||nt[2]!==0)&&O.setOrientation(...nt),(ut[0]!==0||ut[1]!==0||ut[2]!==0)&&O.setPosition(...ut);const U=()=>{B.connect(O),r(B,K,0,0),K.connect(F).connect(M,0,0),K.connect(W).connect(M,0,1),K.connect(j).connect(M,0,2),K.connect(D).connect(M,0,3),K.connect($).connect(M,0,4),K.connect(H).connect(M,0,5),M.connect(Y).connect(u.destination)},V=()=>{B.disconnect(O),o(B,K,0,0),K.disconnect(F),F.disconnect(M),K.disconnect(W),W.disconnect(M),K.disconnect(j),j.disconnect(M),K.disconnect(D),D.disconnect(M),K.disconnect($),$.disconnect(M),K.disconnect(H),H.disconnect(M),M.disconnect(Y),Y.disconnect(u.destination)};return c(vc(ht,O),U,V)},sR=r=>(t,{disableNormalization:e,imag:s,real:n})=>{const i=s instanceof Float32Array?s:new Float32Array(s),a=n instanceof Float32Array?n:new Float32Array(n),o=t.createPeriodicWave(a,i,{disableNormalization:e});if(Array.from(s).length<2)throw r();return o},Id=(r,t,e,s)=>r.createScriptProcessor(t,e,s),nR=(r,t)=>(e,s)=>{const n=s.channelCountMode;if(n==="clamped-max")throw t();if(e.createStereoPanner===void 0)return r(e,s);const i=e.createStereoPanner();return we(i,s),ae(i,s,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>n,set:a=>{if(a!==n)throw t()}}),i},iR=(r,t,e,s,n,i)=>{const o=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},d=(g,m,v,y)=>{const S=new Float32Array(16385),T=new Float32Array(16385);for(let R=0;R<16385;R+=1){const O=R/16384*l;S[R]=Math.cos(O),T[R]=Math.sin(O)}const E=e(g,{...c,gain:0}),A=s(g,{...u,curve:S}),C=s(g,{...u,curve:o}),x=e(g,{...c,gain:0}),I=s(g,{...u,curve:T});return{connectGraph(){m.connect(E),m.connect(C.inputs===void 0?C:C.inputs[0]),m.connect(x),C.connect(v),v.connect(A.inputs===void 0?A:A.inputs[0]),v.connect(I.inputs===void 0?I:I.inputs[0]),A.connect(E.gain),I.connect(x.gain),E.connect(y,0,0),x.connect(y,0,1)},disconnectGraph(){m.disconnect(E),m.disconnect(C.inputs===void 0?C:C.inputs[0]),m.disconnect(x),C.disconnect(v),v.disconnect(A.inputs===void 0?A:A.inputs[0]),v.disconnect(I.inputs===void 0?I:I.inputs[0]),A.disconnect(E.gain),I.disconnect(x.gain),E.disconnect(y,0,0),x.disconnect(y,0,1)}}},f=(g,m,v,y)=>{const S=new Float32Array(16385),T=new Float32Array(16385),E=new Float32Array(16385),A=new Float32Array(16385),C=Math.floor(16385/2);for(let D=0;D<16385;D+=1)if(D>C){const $=(D-C)/(16384-C)*l;S[D]=Math.cos($),T[D]=Math.sin($),E[D]=0,A[D]=1}else{const $=D/(16384-C)*l;S[D]=1,T[D]=0,E[D]=Math.cos($),A[D]=Math.sin($)}const x=t(g,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),I=e(g,{...c,gain:0}),R=s(g,{...u,curve:S}),O=e(g,{...c,gain:0}),P=s(g,{...u,curve:T}),M=s(g,{...u,curve:o}),B=e(g,{...c,gain:0}),F=s(g,{...u,curve:E}),W=e(g,{...c,gain:0}),j=s(g,{...u,curve:A});return{connectGraph(){m.connect(x),m.connect(M.inputs===void 0?M:M.inputs[0]),x.connect(I,0),x.connect(O,0),x.connect(B,1),x.connect(W,1),M.connect(v),v.connect(R.inputs===void 0?R:R.inputs[0]),v.connect(P.inputs===void 0?P:P.inputs[0]),v.connect(F.inputs===void 0?F:F.inputs[0]),v.connect(j.inputs===void 0?j:j.inputs[0]),R.connect(I.gain),P.connect(O.gain),F.connect(B.gain),j.connect(W.gain),I.connect(y,0,0),B.connect(y,0,0),O.connect(y,0,1),W.connect(y,0,1)},disconnectGraph(){m.disconnect(x),m.disconnect(M.inputs===void 0?M:M.inputs[0]),x.disconnect(I,0),x.disconnect(O,0),x.disconnect(B,1),x.disconnect(W,1),M.disconnect(v),v.disconnect(R.inputs===void 0?R:R.inputs[0]),v.disconnect(P.inputs===void 0?P:P.inputs[0]),v.disconnect(F.inputs===void 0?F:F.inputs[0]),v.disconnect(j.inputs===void 0?j:j.inputs[0]),R.disconnect(I.gain),P.disconnect(O.gain),F.disconnect(B.gain),j.disconnect(W.gain),I.disconnect(y,0,0),B.disconnect(y,0,0),O.disconnect(y,0,1),W.disconnect(y,0,1)}}},p=(g,m,v,y,S)=>{if(m===1)return d(g,v,y,S);if(m===2)return f(g,v,y,S);throw n()};return(g,{channelCount:m,channelCountMode:v,pan:y,...S})=>{if(v==="max")throw n();const T=r(g,{...S,channelCount:1,channelCountMode:v,numberOfInputs:2}),E=e(g,{...S,channelCount:m,channelCountMode:v,gain:1}),A=e(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:C,disconnectGraph:x}=p(g,m,E,A,T);Object.defineProperty(A.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"maxValue",{get:()=>1}),Object.defineProperty(A.gain,"minValue",{get:()=>-1});const I={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(M){E.channelCount!==M&&(R&&x(),{connectGraph:C,disconnectGraph:x}=p(g,M,E,A,T),R&&C()),E.channelCount=M},get channelCountMode(){return E.channelCountMode},set channelCountMode(M){if(M==="clamped-max"||M==="max")throw n();E.channelCountMode=M},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(M){E.channelInterpretation=M},get context(){return E.context},get inputs(){return[E]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get pan(){return A.gain},addEventListener(...M){return E.addEventListener(M[0],M[1],M[2])},dispatchEvent(...M){return E.dispatchEvent(M[0])},removeEventListener(...M){return E.removeEventListener(M[0],M[1],M[2])}};let R=!1;const O=()=>{C(),R=!0},P=()=>{x(),R=!1};return i(vc(I,T),O,P)}},rR=(r,t,e,s,n,i,a)=>(o,l)=>{const c=o.createWaveShaper();if(i!==null&&i.name==="webkitAudioContext"&&o.createGain().gain.automationRate===void 0)return e(o,l);we(c,l);const u=l.curve===null||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(u!==null&&u.length<2)throw t();Zt(c,{curve:u},"curve"),Zt(c,l,"oversample");let d=null,f=!1;return a(c,"curve",m=>()=>m.call(c),m=>v=>(m.call(c,v),f&&(s(v)&&d===null?d=r(o,c):!s(v)&&d!==null&&(d(),d=null)),v)),n(c,()=>{f=!0,s(c.curve)&&(d=r(o,c))},()=>{f=!1,d!==null&&(d(),d=null)})},aR=(r,t,e,s,n)=>(i,{curve:a,oversample:o,...l})=>{const c=i.createWaveShaper(),u=i.createWaveShaper();we(c,l),we(u,l);const d=e(i,{...l,gain:1}),f=e(i,{...l,gain:-1}),p=e(i,{...l,gain:1}),g=e(i,{...l,gain:-1});let m=null,v=!1,y=null;const S={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(A){d.channelCount=A,f.channelCount=A,c.channelCount=A,p.channelCount=A,u.channelCount=A,g.channelCount=A},get channelCountMode(){return c.channelCountMode},set channelCountMode(A){d.channelCountMode=A,f.channelCountMode=A,c.channelCountMode=A,p.channelCountMode=A,u.channelCountMode=A,g.channelCountMode=A},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(A){d.channelInterpretation=A,f.channelInterpretation=A,c.channelInterpretation=A,p.channelInterpretation=A,u.channelInterpretation=A,g.channelInterpretation=A},get context(){return c.context},get curve(){return y},set curve(A){if(A!==null&&A.length<2)throw t();if(A===null)c.curve=A,u.curve=A;else{const C=A.length,x=new Float32Array(C+2-C%2),I=new Float32Array(C+2-C%2);x[0]=A[0],I[0]=-A[C-1];const R=Math.ceil((C+1)/2),O=(C+1)/2-1;for(let P=1;P<R;P+=1){const M=P/R*O,B=Math.floor(M),F=Math.ceil(M);x[P]=B===F?A[B]:(1-(M-B))*A[B]+(1-(F-M))*A[F],I[P]=B===F?-A[C-1-B]:-((1-(M-B))*A[C-1-B])-(1-(F-M))*A[C-1-F]}x[R]=C%2===1?A[R-1]:(A[R-2]+A[R-1])/2,c.curve=x,u.curve=I}y=A,v&&(s(y)&&m===null?m=r(i,d):m!==null&&(m(),m=null))},get inputs(){return[d]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(A){c.oversample=A,u.oversample=A},addEventListener(...A){return d.addEventListener(A[0],A[1],A[2])},dispatchEvent(...A){return d.dispatchEvent(A[0])},removeEventListener(...A){return d.removeEventListener(A[0],A[1],A[2])}};a!==null&&(S.curve=a instanceof Float32Array?a:new Float32Array(a)),o!==S.oversample&&(S.oversample=o);const T=()=>{d.connect(c).connect(p),d.connect(f).connect(u).connect(g).connect(p),v=!0,s(y)&&(m=r(i,d))},E=()=>{d.disconnect(c),c.disconnect(p),d.disconnect(f),f.disconnect(u),u.disconnect(g),g.disconnect(p),v=!1,m!==null&&(m(),m=null)};return n(vc(S,p),T,E)},rs=()=>new DOMException("","NotSupportedError"),oR={numberOfChannels:1},lR=(r,t,e,s,n)=>class extends r{constructor(a,o,l){let c;if(typeof a=="number"&&o!==void 0&&l!==void 0)c={length:o,numberOfChannels:a,sampleRate:l};else if(typeof a=="object")c=a;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:d,sampleRate:f}={...oR,...c},p=s(d,u,f);t(Jc,()=>Jc(p))||p.addEventListener("statechange",(()=>{let g=0;const m=v=>{this._state==="running"&&(g>0?(p.removeEventListener("statechange",m),v.stopImmediatePropagation(),this._waitForThePromiseToSettle(v)):g+=1)};return m})()),super(p,d),this._length=u,this._nativeOfflineAudioContext=p,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(e()):(this._state="running",n(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,mw(this)}))}_waitForThePromiseToSettle(a){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(a):setTimeout(()=>this._waitForThePromiseToSettle(a))}},cR={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},hR=(r,t,e,s,n,i,a)=>class extends r{constructor(l,c){const u=n(l),d={...cR,...c},f=e(u,d),p=i(u),g=p?s():null,m=l.sampleRate/2;super(l,!1,f,g),this._detune=t(this,p,f.detune,153600,-153600),this._frequency=t(this,p,f.frequency,m,-m),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=g,this._oscillatorNodeRenderer!==null&&d.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=d.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(l){const c=typeof l=="function"?a(this,l):null;this._nativeOscillatorNode.onended=c;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===c?l:u}get type(){return this._nativeOscillatorNode.type}set type(l){this._nativeOscillatorNode.type=l,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(l){this._nativeOscillatorNode.setPeriodicWave(l),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=l)}start(l=0){if(this._nativeOscillatorNode.start(l),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=l),this.context.state!=="closed"){dc(this);const c=()=>{this._nativeOscillatorNode.removeEventListener("ended",c),Mi(this)&&Td(this)};this._nativeOscillatorNode.addEventListener("ended",c)}}stop(l=0){this._nativeOscillatorNode.stop(l),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=l)}},uR=(r,t,e,s,n)=>()=>{const i=new WeakMap;let a=null,o=null,l=null;const c=async(u,d)=>{let f=e(u);const p=Ke(f,d);if(!p){const g={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:a===null?void 0:a,type:f.type};f=t(d,g),o!==null&&f.start(o),l!==null&&f.stop(l)}return i.set(d,f),p?(await r(d,u.detune,f.detune),await r(d,u.frequency,f.frequency)):(await s(d,u.detune,f.detune),await s(d,u.frequency,f.frequency)),await n(u,d,f),f};return{set periodicWave(u){a=u},set start(u){o=u},set stop(u){l=u},render(u,d){const f=i.get(d);return f!==void 0?Promise.resolve(f):c(u,d)}}},dR={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},fR=(r,t,e,s,n,i,a)=>class extends r{constructor(l,c){const u=n(l),d={...dR,...c},f=e(u,d),p=i(u),g=p?s():null;super(l,!1,f,g),this._nativePannerNode=f,this._orientationX=t(this,p,f.orientationX,es,fs),this._orientationY=t(this,p,f.orientationY,es,fs),this._orientationZ=t(this,p,f.orientationZ,es,fs),this._positionX=t(this,p,f.positionX,es,fs),this._positionY=t(this,p,f.positionY,es,fs),this._positionZ=t(this,p,f.positionZ,es,fs),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(l){this._nativePannerNode.coneInnerAngle=l}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(l){this._nativePannerNode.coneOuterAngle=l}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(l){this._nativePannerNode.coneOuterGain=l}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(l){this._nativePannerNode.distanceModel=l}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(l){this._nativePannerNode.maxDistance=l}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(l){this._nativePannerNode.panningModel=l}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(l){this._nativePannerNode.refDistance=l}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(l){this._nativePannerNode.rolloffFactor=l}},pR=(r,t,e,s,n,i,a,o,l,c)=>()=>{const u=new WeakMap;let d=null;const f=async(p,g)=>{let m=null,v=i(p);const y={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation},S={...y,coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,panningModel:v.panningModel,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor},T=Ke(v,g);if("bufferSize"in v)m=s(g,{...y,gain:1});else if(!T){const E={...S,orientationX:v.orientationX.value,orientationY:v.orientationY.value,orientationZ:v.orientationZ.value,positionX:v.positionX.value,positionY:v.positionY.value,positionZ:v.positionZ.value};v=n(g,E)}if(u.set(g,m===null?v:m),m!==null){if(d===null){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");const P=new a(6,p.context.length,g.sampleRate),M=t(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});M.connect(P.destination),d=(async()=>{const B=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(F,W)=>{const j=e(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:W===0?1:0});return await o(P,F,j.offset),j}));for(let F=0;F<6;F+=1)B[F].connect(M,0,F),B[F].start(0);return c(P)})()}const E=await d,A=s(g,{...y,gain:1});await l(p,g,A);const C=[];for(let P=0;P<E.numberOfChannels;P+=1)C.push(E.getChannelData(P));let x=[C[0][0],C[1][0],C[2][0]],I=[C[3][0],C[4][0],C[5][0]],R=s(g,{...y,gain:1}),O=n(g,{...S,orientationX:x[0],orientationY:x[1],orientationZ:x[2],positionX:I[0],positionY:I[1],positionZ:I[2]});A.connect(R).connect(O.inputs[0]),O.connect(m);for(let P=128;P<E.length;P+=128){const M=[C[0][P],C[1][P],C[2][P]],B=[C[3][P],C[4][P],C[5][P]];if(M.some((F,W)=>F!==x[W])||B.some((F,W)=>F!==I[W])){x=M,I=B;const F=P/g.sampleRate;R.gain.setValueAtTime(0,F),R=s(g,{...y,gain:0}),O=n(g,{...S,orientationX:x[0],orientationY:x[1],orientationZ:x[2],positionX:I[0],positionY:I[1],positionZ:I[2]}),R.gain.setValueAtTime(1,F),A.connect(R).connect(O.inputs[0]),O.connect(m)}}return m}return T?(await r(g,p.orientationX,v.orientationX),await r(g,p.orientationY,v.orientationY),await r(g,p.orientationZ,v.orientationZ),await r(g,p.positionX,v.positionX),await r(g,p.positionY,v.positionY),await r(g,p.positionZ,v.positionZ)):(await o(g,p.orientationX,v.orientationX),await o(g,p.orientationY,v.orientationY),await o(g,p.orientationZ,v.orientationZ),await o(g,p.positionX,v.positionX),await o(g,p.positionY,v.positionY),await o(g,p.positionZ,v.positionZ)),mc(v)?await l(p,g,v.inputs[0]):await l(p,g,v),v};return{render(p,g){const m=u.get(g);return m!==void 0?Promise.resolve(m):f(p,g)}}},gR={disableNormalization:!1},mR=(r,t,e,s)=>class Ew{constructor(i,a){const o=t(i),l=s({...gR,...a}),c=r(o,l);return e.add(c),c}static[Symbol.hasInstance](i){return i!==null&&typeof i=="object"&&Object.getPrototypeOf(i)===Ew.prototype||e.has(i)}},vR=(r,t)=>(e,s,n)=>(r(s).replay(n),t(s,e,n)),yR=(r,t,e)=>async(s,n,i)=>{const a=r(s);await Promise.all(a.activeInputs.map((o,l)=>Array.from(o).map(async([c,u])=>{const f=await t(c).render(c,n),p=s.context.destination;!e(c)&&(s!==p||!e(s))&&f.connect(i,u,l)})).reduce((o,l)=>[...o,...l],[]))},bR=(r,t,e)=>async(s,n,i)=>{const a=t(s);await Promise.all(Array.from(a.activeInputs).map(async([o,l])=>{const u=await r(o).render(o,n);e(o)||u.connect(i,l)}))},_R=(r,t,e,s)=>n=>r(Jc,()=>Jc(n))?Promise.resolve(r(s,s)).then(i=>{if(!i){const a=e(n,512,0,1);n.oncomplete=()=>{a.onaudioprocess=null,a.disconnect()},a.onaudioprocess=()=>n.currentTime,a.connect(n.destination)}return n.startRendering()}):new Promise(i=>{const a=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.oncomplete=o=>{a.disconnect(),i(o.renderedBuffer)},a.connect(n.destination),n.startRendering()}),AR=r=>(t,e)=>{r.set(t,e)},wR=r=>(t,e)=>r.set(t,e),SR=(r,t,e,s,n,i,a,o)=>(l,c)=>e(l).render(l,c).then(()=>Promise.all(Array.from(s(c)).map(u=>e(u).render(u,c)))).then(()=>n(c)).then(u=>(typeof u.copyFromChannel!="function"?(a(u),yy(u)):t(i,()=>i(u))||o(u),r.add(u),u)),TR={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},CR=(r,t,e,s,n,i)=>class extends r{constructor(o,l){const c=n(o),u={...TR,...l},d=e(c,u),f=i(c),p=f?s():null;super(o,!1,d,p),this._pan=t(this,f,d.pan)}get pan(){return this._pan}},ER=(r,t,e,s,n)=>()=>{const i=new WeakMap,a=async(o,l)=>{let c=e(o);const u=Ke(c,l);if(!u){const d={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=t(l,d)}return i.set(l,c),u?await r(l,o.pan,c.pan):await s(l,o.pan,c.pan),mc(c)?await n(o,l,c.inputs[0]):await n(o,l,c),c};return{render(o,l){const c=i.get(l);return c!==void 0?Promise.resolve(c):a(o,l)}}},xR=r=>()=>{if(r===null)return!1;try{new r({length:1,sampleRate:44100})}catch{return!1}return!0},IR=(r,t)=>async()=>{if(r===null)return!0;if(t===null)return!1;const e=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),n=URL.createObjectURL(e);let i=!1,a=!1;try{await s.audioWorklet.addModule(n);const o=new r(s,"a",{numberOfOutputs:0}),l=s.createOscillator();o.port.onmessage=()=>i=!0,o.onprocessorerror=()=>a=!0,l.connect(o),l.start(0),await s.startRendering()}catch{}finally{URL.revokeObjectURL(n)}return i&&!a},RR=(r,t)=>()=>{if(t===null)return Promise.resolve(!1);const e=new t(1,1,44100),s=r(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(n=>{e.oncomplete=()=>{s.disconnect(),n(e.currentTime!==0)},e.startRendering()})},PR=()=>new DOMException("","UnknownError"),OR={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},MR=(r,t,e,s,n,i,a)=>class extends r{constructor(l,c){const u=n(l),d={...OR,...c},f=e(u,d),g=i(u)?s():null;super(l,!0,f,g),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(l){if(l===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(l.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=l}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(l){this._nativeWaveShaperNode.oversample=l}},kR=(r,t,e)=>()=>{const s=new WeakMap,n=async(i,a)=>{let o=t(i);if(!Ke(o,a)){const c={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=r(a,c)}return s.set(a,o),mc(o)?await e(i,a,o.inputs[0]):await e(i,a,o),o};return{render(i,a){const o=s.get(a);return o!==void 0?Promise.resolve(o):n(i,a)}}},DR=()=>typeof window>"u"?null:window,NR=(r,t)=>e=>{e.copyFromChannel=(s,n,i=0)=>{const a=r(i),o=r(n);if(o>=e.numberOfChannels)throw t();const l=e.length,c=e.getChannelData(o),u=s.length;for(let d=a<0?-a:0;d+a<l&&d<u;d+=1)s[d]=c[d+a]},e.copyToChannel=(s,n,i=0)=>{const a=r(i),o=r(n);if(o>=e.numberOfChannels)throw t();const l=e.length,c=e.getChannelData(o),u=s.length;for(let d=a<0?-a:0;d+a<l&&d<u;d+=1)c[d+a]=s[d]}},LR=r=>t=>{t.copyFromChannel=(e=>(s,n,i=0)=>{const a=r(i),o=r(n);if(a<t.length)return e.call(t,s,o,a)})(t.copyFromChannel),t.copyToChannel=(e=>(s,n,i=0)=>{const a=r(i),o=r(n);if(a<t.length)return e.call(t,s,o,a)})(t.copyToChannel)},FR=r=>(t,e)=>{const s=e.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=s),r(t,"buffer",n=>()=>{const i=n.call(t);return i===s?null:i},n=>i=>n.call(t,i===null?s:i))},BR=(r,t)=>(e,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw r()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw r()}});const n=e.createBufferSource();t(s,()=>{const o=s.numberOfInputs;for(let l=0;l<o;l+=1)n.connect(s,0,l)},()=>n.disconnect(s))},xw=(r,t,e)=>r.copyFromChannel===void 0?r.getChannelData(e)[0]:(r.copyFromChannel(t,e),t[0]),Iw=r=>{if(r===null)return!1;const t=r.length;return t%2!==0?r[Math.floor(t/2)]!==0:r[t/2-1]+r[t/2]!==0},Rd=(r,t,e,s)=>{let n=r;for(;!n.hasOwnProperty(t);)n=Object.getPrototypeOf(n);const{get:i,set:a}=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(r,t,{get:e(i),set:s(a)})},VR=r=>({...r,outputChannelCount:r.outputChannelCount!==void 0?r.outputChannelCount:r.numberOfInputs===1&&r.numberOfOutputs===1?[r.channelCount]:Array.from({length:r.numberOfOutputs},()=>1)}),$R=r=>({...r,channelCount:r.numberOfOutputs}),jR=r=>{const{imag:t,real:e}=r;return t===void 0?e===void 0?{...r,imag:[0,0],real:[0,0]}:{...r,imag:Array.from(e,()=>0),real:e}:e===void 0?{...r,imag:t,real:Array.from(t,()=>0)}:{...r,imag:t,real:e}},Rw=(r,t,e)=>{try{r.setValueAtTime(t,e)}catch(s){if(s.code!==9)throw s;Rw(r,t,e+1e-7)}},UR=r=>{const t=r.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},WR=r=>{const t=r.createBufferSource(),e=r.createBuffer(1,1,44100);t.buffer=e;try{t.start(0,1)}catch{return!1}return!0},HR=r=>{const t=r.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},Sy=r=>{const t=r.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},Pw=r=>{const t=r.createBuffer(1,1,44100),e=r.createBufferSource();e.buffer=t,e.start(),e.stop();try{return e.stop(),!0}catch{return!1}},Ty=r=>{const t=r.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},zR=r=>{const{port1:t,port2:e}=new MessageChannel;try{t.postMessage(r)}finally{t.close(),e.close()}},GR=r=>{r.start=(t=>(e=0,s=0,n)=>{const i=r.buffer,a=i===null?s:Math.min(i.duration,s);i!==null&&a>i.duration-.5/r.context.sampleRate?t.call(r,e,0,0):t.call(r,e,a,n)})(r.start)},Ow=(r,t)=>{const e=t.createGain();r.connect(e);const s=(n=>()=>{n.call(r,e),r.removeEventListener("ended",s)})(r.disconnect);r.addEventListener("ended",s),vc(r,e),r.stop=(n=>{let i=!1;return(a=0)=>{if(i)try{n.call(r,a)}catch{e.gain.setValueAtTime(0,a)}else n.call(r,a),i=!0}})(r.stop)},yc=(r,t)=>e=>{const s={value:r};return Object.defineProperties(e,{currentTarget:s,target:s}),typeof t=="function"?t.call(r,e):t.handleEvent.call(r,e)},XR=fE(lo),YR=bE(lo),KR=Ox(Kg),Mw=new WeakMap,qR=Kx(Mw),vn=ox(new Map,new WeakMap),jn=DR(),kw=CI(vn,Wn),Cy=Yx(ss),Ve=yR(ss,Cy,Ja),ZR=TE(kw,Xt,Ve),zt=Qx(Yg),Di=QI(jn),Bt=gI(Di),Dw=new WeakMap,Nw=jx(yc),Pd=RI(jn),Ey=uI(Pd),xy=dI(jn),Lw=fI(jn),th=OI(jn),fe=KE(pE(cw),yE(XR,YR,Uf,KR,Wf,ss,qR,Sd,Xt,lo,Mi,Ja,If),vn,aI(Yv,Wf,ss,Xt,Qc,Mi),Wn,qg,rs,xx(Uf,Yv,ss,Xt,Qc,zt,Mi,Bt),Dx(Dw,ss,gn),Nw,zt,Ey,xy,Lw,Bt,th),QR=SE(fe,ZR,Wn,kw,zt,Bt),Iy=new WeakSet,Fb=EI(jn),Fw=_x(new Uint32Array(1)),Ry=NR(Fw,Wn),Py=LR(Fw),JR=EE(Iy,vn,rs,Fb,Di,xR(Fb),Ry,Py),Zg=_E(gs),Bw=bR(Cy,Cd,Ja),Hn=px(Bw),bc=II(Zg,vn,UR,WR,HR,Sy,Pw,Ty,GR,FR(Rd),Ow),zn=vR(qx(Cd),Bw),tP=RE(Hn,bc,Xt,zn,Ve),yn=qE(gE(hw),Dw,vy,ZE,oE,lE,cE,hE,uE,zv,ow,Pd,Rw),eP=IE(fe,tP,yn,Pe,bc,zt,Bt,yc),sP=BE(fe,VE,Wn,Pe,PI(gs,Rd),zt,Bt,Ve),nP=ax(Hn,Tw,Xt,zn,Ve),co=wR(Mw),iP=rx(fe,yn,nP,qg,Tw,zt,Bt,co),Rr=SI(lo,xy),rP=BR(Pe,Rr),Pr=BI(Pd,rP),aP=hx(Pr,Xt,Ve),oP=cx(fe,aP,Pr,zt,Bt),lP=fx(xd,Xt,Ve),cP=dx(fe,lP,xd,zt,Bt,$R),hP=jI(Zg,bc,gs,Rr),_c=$I(Zg,vn,hP,Sy,Ty),uP=bx(Hn,_c,Xt,zn,Ve),dP=yx(fe,yn,uP,_c,zt,Bt,yc),Vw=UI(rs,Rd),fP=Sx(Vw,Xt,Ve),pP=wx(fe,fP,Vw,zt,Bt,co),gP=Px(Hn,Cw,Xt,zn,Ve),mP=Rx(fe,yn,gP,Cw,zt,Bt,co),$w=WI(rs),vP=Bx(Hn,$w,Xt,zn,Ve),yP=Fx(fe,yn,vP,$w,rs,zt,Bt,co),bP=Gx(Hn,gs,Xt,zn,Ve),_P=zx(fe,yn,bP,gs,zt,Bt),AP=XI(qg,Pe,Id,rs),Qg=_R(vn,gs,Id,RR(gs,Di)),wP=rI(bc,Xt,Di,Ve,Qg),SP=HI(AP),TP=nI(fe,SP,wP,zt,Bt,co),CP=$E(yn,Pr,_c,Id,rs,xw,Bt,Rd),jw=new WeakMap,EP=wI(sP,CP,Nw,Bt,jw,yc),Uw=JI(Zg,vn,Sy,Pw,Ty,Ow),xP=uR(Hn,Uw,Xt,zn,Ve),IP=hR(fe,yn,Uw,xP,zt,Bt,yc),Ww=mx(bc),RP=aR(Ww,Pe,gs,Iw,Rr),Jg=rR(Ww,Pe,RP,Iw,Rr,Pd,Rd),PP=eR(Uf,Pe,Pr,gs,Id,Jg,rs,Wf,xw,Rr),Hw=tR(PP),OP=pR(Hn,Pr,_c,gs,Hw,Xt,Di,zn,Ve,Qg),MP=fR(fe,yn,Hw,OP,zt,Bt,co),kP=sR(Wn),DP=mR(kP,zt,new WeakSet,jR),NP=iR(Pr,xd,gs,Jg,rs,Rr),zw=nR(NP,rs),LP=ER(Hn,zw,Xt,zn,Ve),FP=CR(fe,yn,zw,LP,zt,Bt),BP=kR(Jg,Xt,Ve),VP=MR(fe,Pe,Jg,BP,zt,Bt,co),Gw=mI(jn),Oy=Ux(jn),Xw=new WeakMap,$P=Jx(Xw,Di),jP=Gw?vE(vn,rs,$x(jn),Oy,Wx(dE),zt,$P,Bt,th,new WeakMap,new WeakMap,IR(th,Di),jn):void 0,UP=pI(Ey,Bt),WP=Ex(Iy,vn,Cx,Vx,new WeakSet,zt,UP,$f,Jc,Ry,Py),Yw=nx(jP,QR,JR,eP,iP,oP,cP,dP,pP,WP,mP,yP,_P,TP,EP,IP,MP,DP,FP,VP),HP=vI(fe,YI,zt,Bt),zP=bI(fe,KI,zt,Bt),GP=_I(fe,qI,zt,Bt),XP=ZI(Pe,Bt),YP=AI(fe,XP,zt),KP=FE(Yw,Pe,rs,PR,HP,zP,GP,YP,Pd),My=tI(jw),qP=AE(My),Kw=gx(Wn),ZP=Mx(My),qw=Nx(Wn),Zw=new WeakMap,QP=Xx(Zw,gn),JP=FI(Kw,Wn,Pe,Pr,xd,_c,gs,Id,rs,qw,Oy,QP,Rr),tO=kI(Pe,JP,gs,rs,Rr),eO=sx(Hn,Kw,bc,Pr,xd,_c,gs,ZP,qw,Oy,Xt,th,Di,zn,Ve,Qg),sO=Zx(Xw),nO=AR(Zw),Bb=Gw?JE(qP,fe,yn,eO,tO,ss,sO,zt,Bt,th,VR,nO,zR,yc):void 0,iO=Tx(rs,Di),rO=SR(Iy,vn,Cy,My,Qg,$f,Ry,Py),aO=lR(Yw,vn,Pe,iO,rO),oO=oI(Yg,Ey),lO=lI(my,xy),cO=cI(vy,Lw),hO=hI(Yg,Bt);function vt(r,t){if(!r)throw new Error(t)}function Er(r,t,e=1/0){if(!(t<=r&&r<=e))throw new RangeError(`Value must be within [${t}, ${e}], got: ${r}`)}function Qw(r){!r.isOffline&&r.state!=="running"&&tS('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Jw=console;function uO(...r){Jw.log(...r)}function tS(...r){Jw.warn(...r)}function Us(r){return typeof r>"u"}function St(r){return!Us(r)}function dO(r){return typeof r=="function"}function to(r){return typeof r=="number"}function Ya(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object}function fO(r){return typeof r=="boolean"}function fn(r){return Array.isArray(r)}function Un(r){return typeof r=="string"}function Kd(r){return Un(r)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(r)}function pO(r){return new KP(r)}function gO(r,t,e){return new aO(r,t,e)}const Ka=typeof self=="object"?self:null,mO=Ka&&(Ka.hasOwnProperty("AudioContext")||Ka.hasOwnProperty("webkitAudioContext"));function vO(r,t,e){return vt(St(Bb),"This node only works in a secure context (https or localhost)"),new Bb(r,t,e)}class yO{constructor(t,e,s){this._callback=t,this._type=e,this._updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(t*1e3,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function eo(r){return cO(r)}function Tr(r){return lO(r)}function Rf(r){return hO(r)}function To(r){return oO(r)}function eS(r){return r instanceof AudioBuffer}function bO(r,t){return r==="value"||eo(t)||Tr(t)||eS(t)}function No(r,...t){if(!t.length)return r;const e=t.shift();if(Ya(r)&&Ya(e))for(const s in e)bO(s,e[s])?r[s]=e[s]:Ya(e[s])?(r[s]||Object.assign(r,{[s]:{}}),No(r[s],e[s])):Object.assign(r,{[s]:e[s]});return No(r,...t)}function _O(r,t){return r.length===t.length&&r.every((e,s)=>t[s]===e)}function J(r,t,e=[],s){const n={},i=Array.from(t);if(Ya(i[0])&&s&&!Reflect.has(i[0],s)&&(Object.keys(i[0]).some(o=>Reflect.has(r,o))||(No(n,{[s]:i[0]}),e.splice(e.indexOf(s),1),i.shift())),i.length===1&&Ya(i[0]))No(n,i[0]);else for(let a=0;a<e.length;a++)St(i[a])&&(n[e[a]]=i[a]);return No(r,n)}function AO(r){return r.constructor.getDefaults()}function Lo(r,t){return Us(r)?t:r}function Vb(r,t){return t.forEach(e=>{Reflect.has(r,e)&&delete r[e]}),r}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Ni{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Ka&&this.toString()===Ka.TONE_DEBUG_CLASS)&&uO(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Ni.version=aw;const ky=1e-6;function Xf(r,t){return r>t+ky}function Jv(r,t){return Xf(r,t)||cn(r,t)}function sS(r,t){return r+ky<t}function cn(r,t){return Math.abs(r-t)<ky}function wO(r,t,e){return Math.max(Math.min(r,e),t)}class Gn extends Ni{constructor(){super(),this.name="Timeline",this._timeline=[];const t=J(Gn.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(vt(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];vt(Jv(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(t){const e=this._timeline.indexOf(t);return e!==-1&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(cn(this._timeline[e].time,t)){for(let s=e;s>=0&&cn(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else this._timeline.length===1&&Jv(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(this._timeline.length===0)return-1;let s=0;const n=this._timeline.length;let i=n;if(n>0&&this._timeline[n-1][e]<=t)return n-1;for(;s<i;){let a=Math.floor(s+(i-s)/2);const o=this._timeline[a],l=this._timeline[a+1];if(cn(o[e],t)){for(let c=a;c<this._timeline.length;c++){const u=this._timeline[c];if(cn(u[e],t))a=c;else break}return a}else{if(sS(o[e],t)&&Xf(l[e],t))return a;Xf(o[e],t)?i=a:s=a+1}}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return s!==-1&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let n=this._search(t),i=this._search(e);return n!==-1&&i!==-1?(this._timeline[n].time!==t&&(n+=1),this._timeline[i].time===e&&(i-=1),this._iterate(s,n,i)):n===-1&&this._iterate(s,0,i),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(s!==-1&&cn(this._timeline[s].time,t)){let n=s;for(let i=s;i>=0&&cn(this._timeline[i].time,t);i--)n=i;this._iterate(i=>{e(i)},n,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const nS=[];function tm(r){nS.push(r)}function SO(r){nS.forEach(t=>t(r))}const iS=[];function em(r){iS.push(r)}function TO(r){iS.forEach(t=>t(r))}class Od extends Ni{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(n=>{Us(this._events)&&(this._events={}),this._events.hasOwnProperty(n)||(this._events[n]=[]),this._events[n].push(e)}),this}once(t,e){const s=(...n)=>{e(...n),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach(n=>{if(Us(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Us(e))this._events[t]=[];else{const i=this._events[t];for(let a=i.length-1;a>=0;a--)i[a]===e&&i.splice(a,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let n=0,i=s.length;n<i;n++)s[n].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const s=Object.getOwnPropertyDescriptor(Od.prototype,e);Object.defineProperty(t.prototype,e,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class rS extends Od{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Md extends rS{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Gn,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=J(Md.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=pO({latencyHint:t.latencyHint}),this._ticker=new yO(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(SO(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return vt(To(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return vt(To(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return vt(To(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){vt(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){vt(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){vt(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){vt(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return vO(this.rawContext,t,e)}addAudioWorkletModule(t,e){return ve(this,void 0,void 0,function*(){vt(St(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)})}workletsAreReady(){return ve(this,void 0,void 0,function*(){const t=[];this._workletModules.forEach(e=>t.push(e)),yield Promise.all(t)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Un(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25;break}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return To(this._context)?this._context.resume():Promise.resolve()}close(){return ve(this,void 0,void 0,function*(){To(this._context)&&(yield this._context.close()),this._initialized&&TO(this)})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let i=0;i<s.length;i++)s[i]=t;const n=this._context.createBufferSource();return n.channelCount=1,n.channelCountMode="explicit",n.buffer=e,n.loop=!0,n.start(0),this._constants.set(t,n),n}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,n=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),n()},id:s,time:i+e})};return n(),s}}class CO extends rS{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,s){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return ve(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}}function oe(r,t){fn(t)?t.forEach(e=>oe(r,e)):Object.defineProperty(r,t,{enumerable:!0,writable:!1})}function aS(r,t){fn(t)?t.forEach(e=>aS(r,e)):Object.defineProperty(r,t,{writable:!0})}const Wt=()=>{};class Ut extends Ni{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Wt;const t=J(Ut.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&eS(t.url)||t.url instanceof Ut?this.set(t.url):Un(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:Wt,onload:Wt,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:un().sampleRate}set(t){return t instanceof Ut?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return ve(this,void 0,void 0,function*(){const e=Ut.load(t).then(s=>{this.set(s),this.onload(this)});Ut.downloads.push(e);try{yield e}finally{const s=Ut.downloads.indexOf(e);Ut.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=fn(t)&&t[0].length>0,s=e?t.length:1,n=e?t[0].length:t.length,i=un(),a=i.createBuffer(s,n,i.sampleRate),o=!e&&s===1?[t]:t;for(let l=0;l<s;l++)a.copyToChannel(o[l],l);return this._buffer=a,this}toMono(t){if(to(t))this.fromArray(this.toArray(t));else{let e=new Float32Array(this.length);const s=this.numberOfChannels;for(let n=0;n<s;n++){const i=this.toArray(n);for(let a=0;a<i.length;a++)e[a]+=i[a]}e=e.map(n=>n/s),this.fromArray(e)}return this}toArray(t){if(to(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{const e=[];for(let s=0;s<this.numberOfChannels;s++)e[s]=this.getChannelData(s);return e}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const s=Math.floor(t*this.sampleRate),n=Math.floor(e*this.sampleRate);vt(s<n,"The start time must be less than the end time");const i=n-s,a=un().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let o=0;o<this.numberOfChannels;o++)a.copyToChannel(this.getChannelData(o).subarray(s,n),o);return new Ut(a)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new Ut().fromArray(t)}static fromUrl(t){return ve(this,void 0,void 0,function*(){return yield new Ut().load(t)})}static load(t){return ve(this,void 0,void 0,function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const o=e[1].split("|");let l=o[0];for(const c of o)if(Ut.supportsType(c)){l=c;break}t=t.replace(e[0],l)}const s=Ut.baseUrl===""||Ut.baseUrl.endsWith("/")?Ut.baseUrl:Ut.baseUrl+"/",n=yield fetch(s+t);if(!n.ok)throw new Error(`could not load url: ${t}`);const i=yield n.arrayBuffer();return yield un().decodeAudioData(i)})}static supportsType(t){const e=t.split("."),s=e[e.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return ve(this,void 0,void 0,function*(){for(yield Promise.resolve();Ut.downloads.length;)yield Ut.downloads[0]})}}Ut.baseUrl="";Ut.downloads=[];class Dy extends Md{constructor(){super({clockSource:"offline",context:Rf(arguments[0])?arguments[0]:gO(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Rf(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Rf(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return ve(this,void 0,void 0,function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s===0&&(yield new Promise(n=>setTimeout(n,1)))}})}render(t=!0){return ve(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Ut(e)})}close(){return Promise.resolve()}}const oS=new CO;let Fo=oS;function un(){return Fo===oS&&mO&&EO(new Md),Fo}function EO(r){To(r)?Fo=new Md(r):Rf(r)?Fo=new Dy(r):Fo=r}function xO(){return Fo.resume()}if(Ka&&!Ka.TONE_SILENCE_LOGGING){const t=` * Tone.js v${aw} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function IO(r){return Math.pow(10,r/20)}function RO(r){return 20*(Math.log(r)/Math.LN10)}function lS(r){return Math.pow(2,r/12)}let sm=440;function PO(){return sm}function OO(r){sm=r}function ty(r){return Math.round(cS(r))}function cS(r){return 69+12*Math.log2(r/sm)}function MO(r){return sm*Math.pow(2,(r-69)/12)}class Ny extends Ni{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),n=e==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/s)*n},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(Math.floor(e)*3))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let n=0;return t&&t!=="0"&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(n+=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(n+=this._beatsToUnits(parseFloat(s)/4)),n},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Ny&&this.fromType(this._val),Us(this._val))return this._noArg();if(Un(this._val)&&Us(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Ya(this._val)){let t=0;for(const e in this._val)if(St(this._val[e])){const s=this._val[e],n=new this.constructor(this.context,e).valueOf()*s;t+=n}return t}if(St(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}else return Un(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class dn extends Ny{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new dn(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),n=this.valueOf(),o=Math.round(n/s)*s-n;return n+o*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const a=Math.pow(2,i);e.push(a+"n."),e.push(a+"n"),e.push(a+"t")}e.push("0");let s=e[0],n=new dn(this.context,e[0]).toSeconds();return e.forEach(i=>{const a=new dn(this.context,i).toSeconds();Math.abs(a-t)<Math.abs(n-t)&&(s=i,n=a)}),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let n=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=n.toString();return i.length>3&&(n=parseFloat(parseFloat(i).toFixed(3))),[s,e,n].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ty(this.toFrequency())}_now(){return this.context.now()}}class js extends dn{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return PO()}static set A4(t){OO(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:js.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=kO[t.toLowerCase()]+(parseInt(e,10)+1)*12;return this.defaultUnits==="midi"?n:js.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let n=1;return t&&t!=="0"&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(n*=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(n*=this._beatsToUnits(parseFloat(s)/4)),n}}})}transpose(t){return new js(this.context,this.valueOf()*lS(t))}harmonize(t){return t.map(e=>this.transpose(e))}toMidi(){return ty(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/js.A4);let s=Math.round(12*e)+57;const n=Math.floor(s/12);return n<0&&(s+=-12*n),DO[s%12]+n.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(t*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return MO(t)}static ftom(t){return ty(t)}}const kO={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},DO=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Yc extends dn{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ps extends Ni{constructor(){super();const t=J(ps.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:un()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new dn(this.context,t).toSeconds()}toFrequency(t){return new js(this.context,t).toFrequency()}toTicks(t){return new Yc(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(s=>{Us(t[s])&&delete e[s]}),e}get(){const t=AO(this);return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const s=this[e];St(s)&&St(s.value)&&St(s.setValueAtTime)?t[e]=s.value:s instanceof ps?t[e]=s._getPartialProperties(t[e]):fn(s)||to(s)||Un(s)||fO(s)?t[e]=s:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&St(this[e])&&(this[e]&&St(this[e].value)&&St(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof ps?this[e].set(t[e]):this[e]=t[e])}),this}}class Ly extends Gn{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return e!==null?e.state:this._initial}setStateAtTime(t,e,s){return Er(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){const s=this._search(e);for(let n=s;n>=0;n--){const i=this._timeline[n];if(i.state===t)return i}}getNextState(t,e){const s=this._search(e);if(s!==-1)for(let n=s;n<this._timeline.length;n++){const i=this._timeline[n];if(i.state===t)return i}}}class qt extends ps{constructor(){super(J(qt.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=J(qt.getDefaults(),arguments,["param","units","convert"]);for(vt(St(t.param)&&(eo(t.param)||t.param instanceof qt),"param must be an AudioParam");!eo(t.param);)t.param=t.param._param;this._swappable=St(t.swappable)?t.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Gn(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,St(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(ps.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return St(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return St(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return St(this.maxValue)&&St(this.minValue)&&Er(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?IO(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?RO(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),n=this._fromType(t);return vt(isFinite(n)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),n=this._events.get(e);let i=this._initialValue;if(n===null)i=this._initialValue;else if(n.type==="setTargetAtTime"&&(s===null||s.type==="setValueAtTime")){const a=this._events.getBefore(n.time);let o;a===null?o=this._initialValue:o=a.value,n.type==="setTargetAtTime"&&(i=this._exponentialApproach(n.time,o,n.value,n.constant,e))}else if(s===null)i=n.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let a=n.value;if(n.type==="setTargetAtTime"){const o=this._events.getBefore(n.time);o===null?a=this._initialValue:a=o.value}s.type==="linearRampToValueAtTime"?i=this._linearInterpolate(n.time,a,s.time,s.value,e):i=this._exponentialInterpolate(n.time,a,s.time,s.value,e)}else i=n.value;return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(e)===0&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),n=this.toSeconds(e);return vt(isFinite(s)&&isFinite(n),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:n,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,n),this._param.linearRampToValueAtTime(s,n),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=cn(s,0)?this._minOutput:s,this._assertRange(s);const n=this.toSeconds(e);return vt(isFinite(s)&&isFinite(n),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:n,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,n),this._param.exponentialRampToValueAtTime(s,n),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const n=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,n),this.cancelAndHoldAtTime(e+s*.9),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const n=this._fromType(t);vt(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(n),vt(isFinite(n)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:i,type:"setTargetAtTime",value:n}),this.log(this.units,"setTargetAtTime",t,i,s),this._param.setTargetAtTime(n,i,s),this}setValueCurveAtTime(t,e,s,n=1){s=this.toSeconds(s),e=this.toSeconds(e);const i=this._fromType(t[0])*n;this.setValueAtTime(this._toType(i),e);const a=s/(t.length-1);for(let o=1;o<t.length;o++){const l=this._fromType(t[o])*n;this.linearRampToValueAtTime(this._toType(l),e+o*a)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return vt(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));vt(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const n=this._events.get(e),i=this._events.getAfter(e);return n&&cn(n.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),i.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),e):i.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&s.type==="setTargetAtTime"){const n=this._events.getAfter(s.time),i=n?n.time:e+2,a=(i-e)/10;for(let o=e;o<i;o+=a)t.linearRampToValueAtTime(this.getValueAtTime(o),o)}return this._events.forEachAfter(this.context.currentTime,n=>{n.type==="cancelScheduledValues"?t.cancelScheduledValues(n.time):n.type==="setTargetAtTime"?t.setTargetAtTime(n.value,n.time,n.constant):t[n.type](n.value,n.time)}),this}setParam(t){vt(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,n,i){return s+(e-s)*Math.exp(-(i-t)/n)}_linearInterpolate(t,e,s,n,i){return e+(n-e)*((i-t)/(s-t))}_exponentialInterpolate(t,e,s,n,i){return e*Math.pow(n/e,(i-t)/(s-t))}}class wt extends ps{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return St(this.input)?eo(this.input)||this.input instanceof qt?1:this.input.numberOfInputs:0}get numberOfOutputs(){return St(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return St(t)&&(t instanceof wt||Tr(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(s=>{s.channelCount=t.channelCount,s.channelCountMode=t.channelCountMode,s.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();vt(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return Ac(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return tS("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return NO(this,t,e,s),this}chain(...t){return ey(this,...t),this}fan(...t){return t.forEach(e=>this.connect(e)),this}dispose(){return super.dispose(),St(this.input)&&(this.input instanceof wt?this.input.dispose():Tr(this.input)&&this.input.disconnect()),St(this.output)&&(this.output instanceof wt?this.output.dispose():Tr(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function ey(...r){const t=r.shift();r.reduce((e,s)=>(e instanceof wt?e.connect(s):Tr(e)&&Ac(e,s),s),t)}function Ac(r,t,e=0,s=0){for(vt(St(r),"Cannot connect from undefined node"),vt(St(t),"Cannot connect to undefined node"),(t instanceof wt||Tr(t))&&vt(t.numberOfInputs>0,"Cannot connect to node with no inputs"),vt(r.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof wt||t instanceof qt;)St(t.input)&&(t=t.input);for(;r instanceof wt;)St(r.output)&&(r=r.output);eo(t)?r.connect(t,e):r.connect(t,e,s)}function NO(r,t,e=0,s=0){if(St(t))for(;t instanceof wt;)t=t.input;for(;!Tr(r);)St(r.output)&&(r=r.output);eo(t)?r.disconnect(t,e):Tr(t)?r.disconnect(t,e,s):r.disconnect()}class is extends wt{constructor(){super(J(is.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=J(is.getDefaults(),arguments,["gain","units"]);this.gain=new qt({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),oe(this,"gain")}static getDefaults(){return Object.assign(wt.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class fc extends wt{constructor(t){super(t),this.onended=Wt,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new is({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const s=this.toSeconds(e);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(wt.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Wt})}_startGain(t,e=1){vt(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){vt(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?e*2:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Wt&&(this.onended(this),this.onended=Wt,!this.context.isOffline)){const t=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),vt(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Yf extends fc{constructor(){super(J(Yf.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=J(Yf.getDefaults(),arguments,["offset"]);Ac(this._source,this._gainNode),this.offset=new qt({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(fc.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Se extends wt{constructor(){super(J(Se.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=J(Se.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Yf({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(wt.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return Fy(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,n){return this._param.setValueCurveAtTime(t,e,s,n),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Fy(r,t,e,s){(t instanceof qt||eo(t)||t instanceof Se&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof Se&&(t.overridden=!0)),Ac(r,t,e,s)}class Kf extends qt{constructor(){super(J(Kf.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Gn(1/0),this._multiplier=1;const t=J(Kf.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(qt.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const n=this._fromType(t),i=this._events.get(e),a=Math.round(Math.max(1/s,1));for(let o=0;o<=a;o++){const l=s*o+e,c=this._exponentialApproach(i.time,i.value,n,s,l);this.linearRampToValueAtTime(this._toType(c),l)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const n=this._events.get(s),i=this._events.previousEvent(n),a=this._getTicksUntilEvent(i,s);return n.ticks=Math.max(a,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const n=this._events.get(s),i=this._events.previousEvent(n),a=this._getTicksUntilEvent(i,s);return n.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),n=this._events.get(e),i=Math.round(Math.max((e-n.time)*10,1)),a=(e-n.time)/i;for(let o=0;o<=i;o++){const l=a*o+n.time,c=this._exponentialInterpolate(n.time,n.value,e,s,l);this.linearRampToValueAtTime(this._toType(c),l)}return this}_getTicksUntilEvent(t,e){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Us(t.ticks)){const a=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(a,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let n=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&i.type==="setValueAtTime"&&(n=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+n)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),n=this.getTicksAtTime(e);return this.getTimeOfTick(n+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&s.type==="linearRampToValueAtTime"&&e.value!==s.value){const n=this._fromType(this.getValueAtTime(e.time)),a=(this._fromType(this.getValueAtTime(s.time))-n)/(s.time-e.time),o=Math.sqrt(Math.pow(n,2)-2*a*(e.ticks-t)),l=(-n+o)/a,c=(-n-o)/a;return(l>0?l:c)+e.time}else return e?e.value===0?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),n=this.toSeconds(t),i=this.getTicksAtTime(s);return this.getTicksAtTime(s+n)-i}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class qf extends Se{constructor(){super(J(qf.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=J(qf.getDefaults(),arguments,["value"]);this.input=this._param=new Kf({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Se.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Zf extends ps{constructor(){super(J(Zf.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Ly,this._tickOffset=new Gn;const t=J(Zf.getDefaults(),arguments,["frequency"]);this.frequency=new qf({context:this.context,units:t.units,value:t.frequency}),oe(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ps.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),St(e)&&this.setTicksAtTime(e,s)),this}stop(t){const e=this.toSeconds(t);if(this._state.getValueAtTime(e)==="stopped"){const s=this._state.get(e);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let i=s,a=0;return this._state.forEachBetween(s.time,e+this.sampleTime,o=>{let l=i.time;const c=this._tickOffset.get(o.time);c&&c.time>=i.time&&(a=c.ticks,l=c.time),i.state==="started"&&o.state!=="started"&&(a+=this.frequency.getTicksAtTime(o.time)-this.frequency.getTicksAtTime(l)),i=o}),this._state.remove(n),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let n=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,a=>{let o=n.time;const l=this._tickOffset.get(a.time);l&&l.time>=n.time&&(i=l.seconds,o=l.time),n.state==="started"&&a.state!=="started"&&(i+=a.time-o),n=a}),this._state.remove(s),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),n=this._state.get(e),i=Math.max(s.time,n.time),a=this.frequency.getTicksAtTime(i)+t-s.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(t,e,s){let n=this._state.get(t);this._state.forEachBetween(t,e,a=>{n&&n.state==="started"&&a.state!=="started"&&this.forEachTickBetween(Math.max(n.time,t),a.time-this.sampleTime,s),n=a});let i=null;if(n&&n.state==="started"){const a=Math.max(n.time,t),o=this.frequency.getTicksAtTime(a),l=this.frequency.getTicksAtTime(n.time),c=o-l;let u=Math.ceil(c)-c;u=cn(u,1)?0:u;let d=this.frequency.getTimeOfTick(o+u);for(;d<e;){try{s(d,Math.round(this.getTicksAtTime(d)))}catch(f){i=f;break}d+=this.frequency.getDurationOfTicks(1,d)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class eh extends ps{constructor(){super(J(eh.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Wt,this._lastUpdate=0,this._state=new Ly("stopped"),this._boundLoop=this._loop.bind(this);const t=J(eh.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Zf({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,oe(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ps.getDefaults(),{callback:Wt,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Qw(this.context);const s=this.toSeconds(t);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),n=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(n+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,s=>{switch(s.state){case"started":const n=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,n);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time);break}}),this._tickSource.forEachTickBetween(t,e,(s,n)=>{this.callback(s,n)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Od.mixin(eh);class By extends Ni{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=J(By.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const s=t.urls[e];this.add(e,s,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Wt,onload:Wt,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return vt(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,s=Wt,n=Wt){return Un(e)?this._buffers.set(t.toString(),new Ut(this.baseUrl+e,s,n)):this._buffers.set(t.toString(),new Ut(e,s,n)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class Oi extends Yc{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class LO extends ps{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Gn,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}tm(r=>{r.draw=new LO({context:r})});em(r=>{r.draw.dispose()});class FO extends Ni{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){vt(St(t.time),"Events must have a time property"),vt(St(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new BO(t.time,t.time+t.duration,t);for(this._root===null?this._root=e:this._root.insert(e),this._length++;e!==null;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(this._root!==null){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,e=>this.remove(e)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,e){t.parent!==null?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{const e=t.getBalance();let s,n=null;if(e>0)if(t.left.right===null)s=t.left,s.right=t.right,n=s;else{for(s=t.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,n=s.parent,s.left=t.left,s.right=t.right)}else if(t.right.left===null)s=t.right,s.left=t.left,n=s;else{for(s=t.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,n=s.parent,s.left=t.left,s.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=s:t.parent.right=s:this._setRoot(s),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),n=t.right;n&&(t.right=n.left,n.left=t),e!==null?s?e.left=n:e.right=n:this._setRoot(n)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),n=t.left;n&&(t.left=n.right,n.right=t),e!==null?s?e.left=n:e.right=n:this._setRoot(n)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){const e=[];if(this._root.search(t,e),e.length>0){let s=e[0];for(let n=1;n<e.length;n++)e[n].low>s.low&&(s=e[n]);return s.event}}return null}forEach(t){if(this._root!==null){const e=[];this._root.traverse(s=>e.push(s)),e.forEach(s=>{s.event&&t(s.event)})}return this}forEachAtTime(t,e){if(this._root!==null){const s=[];this._root.search(t,s),s.forEach(n=>{n.event&&e(n.event)})}return this}forEachFrom(t,e){if(this._root!==null){const s=[];this._root.searchAfter(t,s),s.forEach(n=>{n.event&&e(n.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class BO{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(this.left!==null&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),!(this.low>t)&&this.right!==null&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),this.left!==null&&this.left.searchAfter(t,e)),this.right!==null&&this.right.searchAfter(t,e)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class so extends wt{constructor(){super(J(so.getDefaults(),arguments,["volume"])),this.name="Volume";const t=J(so.getDefaults(),arguments,["volume"]);this.input=this.output=new is({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,oe(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(wt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Qf extends wt{constructor(){super(J(Qf.getDefaults(),arguments)),this.name="Destination",this.input=new so({context:this.context}),this.output=new is({context:this.context}),this.volume=this.input.volume;const t=J(Qf.getDefaults(),arguments);ey(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(wt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),ey(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}tm(r=>{r.destination=new Qf({context:r})});em(r=>{r.destination.dispose()});class VO extends Ni{constructor(t){super(),this.name="TimelineValue",this._timeline=new Gn({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class xr{constructor(t,e){this.id=xr._eventId++;const s=Object.assign(xr.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=s.time}static getDefaults(){return{callback:Wt,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}xr._eventId=0;class Vy extends xr{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(Vy.getDefaults(),e);this.duration=new Oi(t.context,s.duration).valueOf(),this._interval=new Oi(t.context,s.interval).valueOf(),this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},xr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Oi(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Oi(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Oi(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class sh extends ps{constructor(){super(J(sh.getDefaults(),arguments)),this.name="Transport",this._loop=new VO(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Gn,this._repeatedEvents=new FO,this._syncedSignals=[],this._swingAmount=0;const t=J(sh.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new eh({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),oe(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(ps.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!==0&&e%(this._swingTicks*2)!==0){const s=e%(this._swingTicks*2)/(this._swingTicks*2),n=Math.sin(s*Math.PI)*this._swingAmount;t+=new Oi(this.context,this._swingTicks*2/3).toSeconds()*n}this._timeline.forEachAtTime(e,s=>s.invoke(t))}schedule(t,e){const s=new xr(this,{callback:t,time:new Yc(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,n=1/0){const i=new Vy(this,{callback:t,duration:new dn(this.context,n).toTicks(),interval:new dn(this.context,e).toTicks(),time:new Yc(this.context,s).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const s=new xr(this,{callback:t,once:!0,time:new Yc(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(e,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new Oi(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let s;return St(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){fn(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new dn(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new dn(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Oi(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Oi(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(e),n=this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e),i=e+n;this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{const e=this.now(),s=this.getTicksAtTime(e),n=t-s%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(t.getValueAtTime(n)!==0){const a=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/a}else e=0}const s=new is(e);return this.bpm.connect(s),s.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:s,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.ratio.dispose(),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),aS(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Od.mixin(sh);tm(r=>{r.transport=new sh({context:r})});em(r=>{r.transport.dispose()});class xs extends wt{constructor(t){super(t),this.input=void 0,this._state=new Ly("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Wt,this._syncedStop=Wt,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new so({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,oe(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(wt.getDefaults(),{mute:!1,onstop:Wt,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let n=Us(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(n=this._clampToCurrentTime(n),!this._synced&&this._state.getValueAtTime(n)==="started")vt(Xf(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,e,s);else if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){const i=this._state.get(n);i&&(i.offset=this.toSeconds(Lo(e,0)),i.duration=s?this.toSeconds(s):void 0);const a=this.context.transport.schedule(o=>{this._start(o,e,s)},n);this._scheduled.push(a),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else Qw(this.context),this._start(n,e,s);return this}stop(t){let e=Us(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),this._state.getValueAtTime(e)==="started"||St(this._state.getNextState("started",e))){if(this.log("stop",e),!this._synced)this._stop(e);else{const s=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(s)}this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const s=this._state.get(e);if(s&&s.state==="started"&&s.time!==e){const n=e-this.toSeconds(s.time);let i;s.duration&&(i=this.toSeconds(s.duration)-n),this._start(t,this.toSeconds(s.offset)+n,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(e)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Wt,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class nh extends fc{constructor(){super(J(nh.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=J(nh.getDefaults(),arguments,["url","onload"]);Ac(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new qt({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Ut(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(fc.getDefaults(),{url:new Ut,loop:!1,loopEnd:0,loopStart:0,onload:Wt,onerror:Wt,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,n=1){vt(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,n),this.loop?e=Lo(e,this.loopStart):e=Lo(e,0);let a=Math.max(this.toSeconds(e),0);if(this.loop){const o=this.toSeconds(this.loopEnd)||this.buffer.duration,l=this.toSeconds(this.loopStart),c=o-l;Jv(a,o)&&(a=(a-l)%c+l),cn(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,sS(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,a)),St(s)){let o=this.toSeconds(s);o=Math.max(o,0),this.stop(i+o)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function ho(r,t){return ve(this,void 0,void 0,function*(){const e=t/r.context.sampleRate,s=new Dy(1,e,r.context.sampleRate);return new r.constructor(Object.assign(r.get(),{frequency:2/e,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class Jf extends fc{constructor(){super(J(Jf.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=J(Jf.getDefaults(),arguments,["frequency","type"]);Ac(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new qt({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new qt({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),oe(this,["frequency","detune"])}static getDefaults(){return Object.assign(fc.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ue extends xs{constructor(){super(J(ue.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=J(ue.getDefaults(),arguments,["frequency","type"]);this.frequency=new Se({context:this.context,units:"frequency",value:t.frequency}),oe(this,"frequency"),this.detune=new Se({context:this.context,units:"cents",value:t.detune}),oe(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(xs.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new Jf({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return ue._periodicWaveCache.find(e=>e.phase===this._phase&&_O(e.partials,this._partials));{const t=ue._periodicWaveCache.find(e=>e.type===this._type&&e.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&e)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{const s=this._getCachedPeriodicWave();if(St(s)){const{partials:n,wave:i}=s;this._wave=i,this._partials=n,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[n,i]=this._getRealImaginary(t,this._phase),a=this.context.createPeriodicWave(n,i);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),ue._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:n,type:this._type,wave:this._wave}),ue._periodicWaveCache.length>100&&ue._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Er(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),this._type!=="custom")t===0?this.type=e:this.type=e+t.toString();else{const n=new Float32Array(t);this._partials.forEach((i,a)=>n[a]=i),this._partials=Array.from(n),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const i=new Float32Array(n),a=new Float32Array(n);let o=1;if(t==="custom"){if(o=this._partials.length+1,this._partialCount=this._partials.length,n=o,this._partials.length===0)return[i,a]}else{const l=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);l?(o=parseInt(l[2],10)+1,this._partialCount=parseInt(l[2],10),t=l[1],o=Math.max(o,2),n=o):this._partialCount=0,this._partials=[]}for(let l=1;l<n;++l){const c=2/(l*Math.PI);let u;switch(t){case"sine":u=l<=o?1:0,this._partials[l-1]=u;break;case"square":u=l&1?2*c:0,this._partials[l-1]=u;break;case"sawtooth":u=c*(l&1?1:-1),this._partials[l-1]=u;break;case"triangle":l&1?u=2*(c*c)*(l-1>>1&1?-1:1):u=0,this._partials[l-1]=u;break;case"custom":u=this._partials[l-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}u!==0?(i[l]=-u*Math.sin(e*l),a[l]=u*Math.cos(e*l)):(i[l]=0,a[l]=0)}return[i,a]}_inverseFFT(t,e,s){let n=0;const i=t.length;for(let a=0;a<i;a++)n+=t[a]*Math.cos(a*s)+e[a]*Math.sin(a*s);return n}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const n=Math.PI*2,i=32;for(let a=0;a<i;a++)s=Math.max(this._inverseFFT(t,e,a/i*n),s);return wO(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ue._periodicWaveCache=[];class nm extends wt{constructor(){super(Object.assign(J(nm.getDefaults(),arguments,["context"])))}connect(t,e=0,s=0){return Fy(this,t,e,s),this}}class ih extends nm{constructor(){super(Object.assign(J(ih.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=J(ih.getDefaults(),arguments,["mapping","length"]);fn(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):dO(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Se.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let n=0,i=e;n<i;n++){const a=n/(i-1)*2-1;s[n]=t(a,n)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){const e=["none","2x","4x"].some(s=>s.includes(t));vt(e,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class $O extends nm{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ih({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class no extends Se{constructor(){super(Object.assign(J(no.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=J(no.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new is({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Se.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class rh extends xs{constructor(){super(J(rh.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new $O({context:this.context}),this._modulationNode=new is({context:this.context});const t=J(rh.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ue({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ue({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new no({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),oe(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ue.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class ah extends xs{constructor(){super(J(ah.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new is({context:this.context,gain:0});const t=J(ah.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ue({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Se({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ue({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new no({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new no({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),oe(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ue.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class pc extends xs{constructor(){super(J(pc.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new is({context:this.context,gain:0}),this._thresh=new ih({context:this.context,mapping:e=>e<=0?-1:1});const t=J(pc.getDefaults(),arguments,["frequency","width"]);this.width=new Se({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ue({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),oe(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(xs.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class oh extends xs{constructor(){super(J(oh.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=J(oh.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Se({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Se({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,oe(this,["frequency","detune"])}static getDefaults(){return Object.assign(ue.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach((n,i)=>n.detune.value=e+s*i)}}get count(){return this._oscillators.length}set count(t){if(Er(t,1),this._oscillators.length!==t){this._forEach(e=>e.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const s=new ue({context:this.context,volume:-6-t*1.1,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:e===0?()=>this.onstop(this):Wt});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,this.state==="started"&&this._forEach(e=>e.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((e,s)=>e.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class lh extends xs{constructor(){super(J(lh.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new no({context:this.context,value:2});const t=J(lh.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new pc({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ue({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),oe(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(xs.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const $b={am:rh,fat:oh,fm:ah,oscillator:ue,pulse:pc,pwm:lh};class ch extends xs{constructor(){super(J(ch.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=J(ch.getDefaults(),arguments,["frequency","type"]);this.frequency=new Se({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Se({context:this.context,units:"cents",value:t.detune}),oe(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ue.getDefaults(),ah.getDefaults(),rh.getDefaults(),oh.getDefaults(),pc.getDefaults(),lh.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(e=>this._sourceType===e)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=$b[t],s=this.now();if(this._oscillator){const n=this._oscillator;n.stop(s),this.context.setTimeout(()=>n.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(e=this._oscillator.type),t==="fm"?this.type="fm"+e:t==="am"?this.type="am"+e:t==="fat"?this.type="fat"+e:t==="oscillator"?this.type=e:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,e){return t instanceof $b[e]}get baseType(){return this._oscillator.baseType}set baseType(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&t!=="pulse"&&t!=="pwm"&&(this._oscillator.baseType=t)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(t){this._getOscType(this._oscillator,"fat")&&to(t)&&(this._oscillator.count=t)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(t){this._getOscType(this._oscillator,"fat")&&to(t)&&(this._oscillator.spread=t)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Un(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(t=1024){return ve(this,void 0,void 0,function*(){return ho(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function hS(r,t=1/0){const e=new WeakMap;return function(s,n){Reflect.defineProperty(s,n,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){Er(i,r,t),e.set(this,i)}})}}function Li(r,t=1/0){const e=new WeakMap;return function(s,n){Reflect.defineProperty(s,n,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(i){Er(this.toSeconds(i),r,t),e.set(this,i)}})}}class hh extends xs{constructor(){super(J(hh.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=J(hh.getDefaults(),arguments,["url","onload"]);this._buffer=new Ut({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(xs.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Wt,onerror:Wt,playbackRate:1,reverse:!1})}load(t){return ve(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=Wt){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){this._loop?e=Lo(e,this._loopStart):e=Lo(e,0);const n=this.toSeconds(e),i=s;s=Lo(s,Math.max(this._buffer.duration-n,0));let a=this.toSeconds(s);a=a/this._playbackRate,t=this.toSeconds(t);const o=new nh({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(t+a),this._state.setStateAtTime("stopped",t+a,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Us(i)?o.start(t,n):o.start(t,n,a-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(s=>s.stop(e))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){this._stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="started"){const n=this.toSeconds(t);this._stop(s),this._start(s,n)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Er(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Er(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(n=>n.cancelStop())),this._activeSources.forEach(n=>{n.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}mn([Li(0)],hh.prototype,"fadeIn",void 0);mn([Li(0)],hh.prototype,"fadeOut",void 0);class ki extends wt{constructor(){super(J(ki.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Se({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=J(ki.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(wt.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Un(t))return t;{let s;for(s in qd)if(qd[s][e]===t)return s;return t}}_setCurve(t,e,s){if(Un(s)&&Reflect.has(qd,s)){const n=qd[s];Ya(n)?t!=="_decayCurve"&&(this[t]=n[e]):this[t]=n}else if(fn(s)&&t!=="_decayCurve")this[t]=s;else throw new Error("Envelope: invalid curve: "+s)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){vt(["linear","exponential"].some(e=>e===t),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),a=this.getValueAtTime(t);if(a>0){const o=1/n;n=(1-a)/o}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(e,n,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let o=this._attackCurve;for(let l=1;l<o.length;l++)if(o[l-1]<=a&&a<=o[l]){o=this._attackCurve.slice(l),o[0]=a;break}this._sig.setValueCurveAtTime(o,t,n,e)}if(i&&this.sustain<1){const o=e*this.sustain,l=t+n;this.log("decay",l),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(o,i+l):this._sig.exponentialApproachValueAtTime(o,l,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,t):(vt(fn(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return Fy(this,t,e,s),this}asArray(t=1024){return ve(this,void 0,void 0,function*(){const e=t/this.context.sampleRate,s=new Dy(1,e,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=n+this.toSeconds(this.release),a=i*.1,o=i+a,l=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:s}));return l._sig.toDestination(),l.triggerAttackRelease(e*(n+a)/o,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}mn([Li(0)],ki.prototype,"attack",void 0);mn([Li(0)],ki.prototype,"decay",void 0);mn([hS(0,1)],ki.prototype,"sustain",void 0);mn([Li(0)],ki.prototype,"release",void 0);const qd=(()=>{let t,e;const s=[];for(t=0;t<128;t++)s[t]=Math.sin(t/(128-1)*(Math.PI/2));const n=[],i=6.4;for(t=0;t<128-1;t++){e=t/(128-1);const f=Math.sin(e*(Math.PI*2)*i-Math.PI/2)+1;n[t]=f/10+e*.83}n[128-1]=1;const a=[],o=5;for(t=0;t<128;t++)a[t]=Math.ceil(t/(128-1)*o)/o;const l=[];for(t=0;t<128;t++)e=t/(128-1),l[t]=.5*(1-Math.cos(Math.PI*e));const c=[];for(t=0;t<128;t++){e=t/(128-1);const f=Math.pow(e,3)*4+.2,p=Math.cos(f*Math.PI*2*e);c[t]=Math.abs(p*(1-e))}function u(f){const p=new Array(f.length);for(let g=0;g<f.length;g++)p[g]=1-f[g];return p}function d(f){return f.slice(0).reverse()}return{bounce:{In:u(c),Out:c},cosine:{In:s,Out:d(s)},exponential:"exponential",linear:"linear",ripple:{In:n,Out:u(n)},sine:{In:l,Out:u(l)},step:{In:a,Out:u(a)}}})();class io extends wt{constructor(){super(J(io.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=J(io.getDefaults(),arguments);this._volume=this.output=new so({context:this.context,volume:t.volume}),this.volume=this._volume.volume,oe(this,"volume")}static getDefaults(){return Object.assign(wt.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...n)=>{const i=n[e],a=this.context.transport.schedule(o=>{n[e]=o,s.apply(this,n)},i);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,s,n){const i=this.toSeconds(s),a=this.toSeconds(e);return this.triggerAttack(t,i,n),this.triggerRelease(i+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ro extends io{constructor(){super(J(ro.getDefaults(),arguments));const t=J(ro.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(io.getDefaults(),{detune:0,onsilence:Wt,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const n=this.toSeconds(e);return this._triggerEnvelopeAttack(n,s),this.setNote(t,n),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),n=t instanceof js?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const i=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,i,s)}else this.frequency.setValueAtTime(n,s);return this}}mn([Li(0)],ro.prototype,"portamento",void 0);class $y extends ki{constructor(){super(J($y.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new is({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class uh extends ro{constructor(){super(J(uh.getDefaults(),arguments)),this.name="Synth";const t=J(uh.getDefaults(),arguments);this.oscillator=new ch(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new $y(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),oe(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ro.getDefaults(),{envelope:Object.assign(Vb(ki.getDefaults(),Object.keys(wt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Vb(ch.getDefaults(),[...Object.keys(xs.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class dh extends uh{constructor(){super(J(dh.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=J(dh.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,oe(this,["oscillator","envelope"])}static getDefaults(){return No(ro.getDefaults(),uh.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),n=this.toFrequency(t instanceof js?t.toFrequency():t),i=n*this.octaves;return this.oscillator.frequency.setValueAtTime(i,s),this.oscillator.frequency.exponentialRampToValueAtTime(n,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}mn([hS(0)],dh.prototype,"octaves",void 0);mn([Li(0)],dh.prototype,"pitchDecay",void 0);const uS=new Set;function jy(r){uS.add(r)}function dS(r,t){const e=`registerProcessor("${r}", ${t})`;uS.add(e)}const jO=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;jy(jO);const UO=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;jy(UO);const WO=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;jy(WO);const HO="feedback-comb-filter",zO=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;dS(HO,zO);class gc extends io{constructor(){super(J(gc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=J(gc.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach(s=>{const n=parseInt(s,10);if(vt(Kd(s)||to(n)&&isFinite(n),`url key is neither a note or midi pitch: ${s}`),Kd(s)){const i=new js(this.context,s).toMidi();e[i]=t.urls[s]}else to(n)&&isFinite(n)&&(e[n]=t.urls[n])}),this._buffers=new By({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(io.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Wt,onerror:Wt,release:.1,urls:{}})}_findClosest(t){let s=0;for(;s<96;){if(this._buffers.has(t+s))return-s;if(this._buffers.has(t-s))return s;s++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach(n=>{const i=cS(new js(this.context,n).toFrequency()),a=Math.round(i),o=i-a,l=this._findClosest(a),c=a-l,u=this._buffers.get(c),d=lS(l+o),f=new nh({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:d}).connect(this.output);f.start(e,0,u.duration/d,s),fn(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){const p=this._activeSources.get(a),g=p.indexOf(f);g!==-1&&p.splice(g,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(s=>{const n=new js(this.context,s).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const i=this._activeSources.get(n);e=this.toSeconds(e),i.forEach(a=>{a.stop(e)}),this._activeSources.set(n,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,n=1){const i=this.toSeconds(s);return this.triggerAttack(t,i,n),fn(e)?(vt(fn(t),"notes must be an array when duration is array"),t.forEach((a,o)=>{const l=e[Math.min(o,e.length-1)];this.triggerRelease(a,i+this.toSeconds(l))})):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,s){if(vt(Kd(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Kd(t)){const n=new js(this.context,t).toMidi();this._buffers.add(n,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(e=>e.dispose())}),this._activeSources.clear(),this}}mn([Li(0)],gc.prototype,"attack",void 0);mn([Li(0)],gc.prototype,"release",void 0);class tp extends wt{constructor(){super(Object.assign(J(tp.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=J(tp.getDefaults(),arguments,["pan"]);this.pan=new qt({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",oe(this,"pan")}static getDefaults(){return Object.assign(wt.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const GO="bit-crusher",XO=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;dS(GO,XO);class he extends wt{constructor(){super(J(he.getDefaults(),arguments,["solo"])),this.name="Solo";const t=J(he.getDefaults(),arguments,["solo"]);this.input=this.output=new is({context:this.context}),he._allSolos.has(this.context)||he._allSolos.set(this.context,new Set),he._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(wt.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),he._allSolos.get(this.context).forEach(e=>e._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){he._soloed.has(this.context)||he._soloed.set(this.context,new Set),he._soloed.get(this.context).add(this)}_removeSolo(){he._soloed.has(this.context)&&he._soloed.get(this.context).delete(this)}_isSoloed(){return he._soloed.has(this.context)&&he._soloed.get(this.context).has(this)}_noSolos(){return!he._soloed.has(this.context)||he._soloed.has(this.context)&&he._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),he._allSolos.get(this.context).delete(this),this._removeSolo(),this}}he._allSolos=new Map;he._soloed=new Map;class ep extends wt{constructor(){super(J(ep.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=J(ep.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new tp({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new so({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,oe(this,["pan","volume"])}static getDefaults(){return Object.assign(wt.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Nr extends wt{constructor(){super(J(Nr.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=J(Nr.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new he({solo:t.solo,context:this.context}),this._panVol=this.output=new ep({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),oe(this,["pan","volume"])}static getDefaults(){return Object.assign(wt.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Nr.buses.has(t)||Nr.buses.set(t,new is({context:this.context})),Nr.buses.get(t)}send(t,e=0){const s=this._getBus(t),n=new is({context:this.context,units:"decibels",gain:e});return this.connect(n),n.connect(s),n}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Nr.buses=new Map;class YO extends wt{constructor(){super(...arguments),this.name="Listener",this.positionX=new qt({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new qt({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new qt({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new qt({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new qt({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new qt({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new qt({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new qt({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new qt({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(wt.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}tm(r=>{r.listener=new YO({context:r})});em(r=>{r.listener.dispose()});un().transport;un().destination;un().destination;un().listener;un().draw;const KO=un();function qO(){return Ut.loaded()}const fS=["A2","C3","A3","C4","A4","C5"],jb={F2:"/acchymns-dev/assets/note_icons/F2.svg",G2:"/acchymns-dev/assets/note_icons/G2.svg",A2:"/acchymns-dev/assets/note_icons/A2.svg",B2:"/acchymns-dev/assets/note_icons/B2.svg",C3:"/acchymns-dev/assets/note_icons/C3.svg",D3:"/acchymns-dev/assets/note_icons/D3.svg",E3:"/acchymns-dev/assets/note_icons/E3.svg",F3:"/acchymns-dev/assets/note_icons/F3.svg",G3:"/acchymns-dev/assets/note_icons/G3.svg",A3:"/acchymns-dev/assets/note_icons/A3.svg",B3:"/acchymns-dev/assets/note_icons/B3.svg",C4:"/acchymns-dev/assets/note_icons/C4.svg"},ZO={A3:"/acchymns-dev/assets/note_icons/treble/A3.svg",B3:"/acchymns-dev/assets/note_icons/treble/B3.svg",C4:"/acchymns-dev/assets/note_icons/treble/C4.svg",D4:"/acchymns-dev/assets/note_icons/treble/D4.svg",E4:"/acchymns-dev/assets/note_icons/treble/E4.svg",F4:"/acchymns-dev/assets/note_icons/treble/F4.svg",G4:"/acchymns-dev/assets/note_icons/treble/G4.svg",A4:"/acchymns-dev/assets/note_icons/treble/A4.svg",B4:"/acchymns-dev/assets/note_icons/treble/B4.svg",C5:"/acchymns-dev/assets/note_icons/treble/C5.svg",D5:"/acchymns-dev/assets/note_icons/treble/D5.svg",E5:"/acchymns-dev/assets/note_icons/treble/E5.svg",F5:"/acchymns-dev/assets/note_icons/treble/F5.svg",G5:"/acchymns-dev/assets/note_icons/treble/G5.svg",A5:"/acchymns-dev/assets/note_icons/treble/A5.svg",B5:"/acchymns-dev/assets/note_icons/treble/B5.svg",C6:"/acchymns-dev/assets/note_icons/treble/C6.svg"},pS=Object.fromEntries(fS.map(r=>[r,!1])),Co=new gc().toDestination();KO.lookAhead=.05;for(const r of fS)fetch(`/acchymns-dev/assets/notes/${r}.mp3`).then(async t=>{const e=URL.createObjectURL(await t.blob());Co.add(r,e),pS[r]=!0});const Ub=Oo("ACCOptions.playbackInterval",.25),Wb=Oo("ACCOptions.playbackDuration",2.5),QO=Oo("ACCOptions.staggered",!0),Xc=Mt(!1),Cm=[],JO={async play(r){if(Xc.value)return;if(Xc.value=!0,await xO(),!Object.values(pS).every(s=>s)){console.log("Not all notes have been loaded!");return}if(!Co.loaded){console.log("Sampler hasn't loaded!");return}console.log("attempting to start notes"),console.log(...Z(r)),await qO();let t,e=0;if(QO.value){for(const[s,n]of Z(r).entries()){const i=setTimeout(()=>{Co.triggerAttack(n)},Ub.value*s*1e3);Cm.push(i),e++}t=Wb.value+Ub.value*Z(r).length}else Co.triggerAttack(Z(r)),t=Wb.value;Cm[e]=setTimeout(()=>{Co.releaseAll(),Xc.value=!1},t*1e3)},stop(){for(const r of Cm)clearTimeout(r);Co.releaseAll(),Xc.value=!1}};function tM(){return{player:JO,isPlaying:Xc}}const Hb="M 152.218 81.663 C 150.413 82.553, 147.938 84.680, 146.718 86.390 L 144.500 89.500 144.500 256 C 144.500 420.939, 144.519 422.525, 146.500 425.182 C 147.600 426.658, 150.171 428.814, 152.212 429.975 C 155.792 432.010, 156.970 432.075, 185.212 431.793 C 214.393 431.501, 214.512 431.491, 217.712 429.090 C 219.479 427.765, 221.616 425.222, 222.462 423.439 C 223.827 420.563, 224 401.681, 224 255.937 L 224 91.676 221.534 87.468 C 220.096 85.013, 217.637 82.581, 215.633 81.630 C 212.705 80.241, 208.014 80.003, 183.849 80.023 C 159.785 80.042, 155.004 80.290, 152.218 81.663 M 296.218 81.663 C 294.413 82.553, 291.938 84.680, 290.718 86.390 L 288.500 89.500 288.500 256 C 288.500 420.939, 288.519 422.525, 290.500 425.182 C 291.600 426.658, 294.171 428.814, 296.212 429.975 C 299.792 432.010, 300.970 432.075, 329.212 431.793 C 358.393 431.501, 358.512 431.491, 361.712 429.090 C 363.479 427.765, 365.616 425.222, 366.462 423.439 C 367.827 420.563, 368 401.681, 368 255.937 L 368 91.676 365.534 87.468 C 364.096 85.013, 361.637 82.581, 359.633 81.630 C 356.705 80.241, 352.014 80.003, 327.849 80.023 C 303.785 80.042, 299.004 80.290, 296.218 81.663",Em="M 119.920 74.343 C 116.852 75.605, 112.720 77.875, 110.738 79.386 C 108.756 80.898, 105.951 83.686, 104.505 85.582 C 103.059 87.478, 100.666 91.610, 99.188 94.765 L 96.500 100.500 96.500 256 L 96.500 411.500 99.674 418.201 C 101.426 421.899, 104.923 426.976, 107.478 429.531 C 110.024 432.077, 114.670 435.352, 117.804 436.809 C 122.104 438.810, 125.487 439.549, 131.609 439.826 C 138.461 440.137, 140.630 439.816, 145.609 437.755 C 148.849 436.413, 207.525 401.759, 276 360.745 C 344.475 319.731, 402.390 284.548, 404.700 282.561 C 407.227 280.387, 410.216 276.275, 412.200 272.244 C 415.234 266.082, 415.500 264.774, 415.500 256 C 415.500 247.226, 415.234 245.918, 412.200 239.756 C 410.228 235.748, 407.212 231.593, 404.700 229.421 C 402.390 227.423, 343.800 191.866, 274.500 150.404 C 205.200 108.943, 146.507 74.341, 144.072 73.510 C 141.636 72.680, 136.461 72.011, 132.572 72.024 C 127.527 72.041, 123.901 72.705, 119.920 74.343";function eM(r){return new Promise((t,e)=>{setTimeout(()=>{t(!0)},r)})}async function sM(r,t){for(let e=0;e<=1;e+=.1)await eM(10),r(t(e))}var Uy={},Wy={},im={},Hy={},Qt={};Object.defineProperty(Qt,"__esModule",{value:!0});Qt._=void 0;Qt.SPACE=" ";Qt.FILL="fill";Qt.NONE="none";Qt.DRAW_LINE_VERTICAL="V";Qt.DRAW_LINE_HORIZONTAL="H";Qt.DRAW_LINE="L";Qt.CLOSE_PATH="Z";Qt.MOVE_CURSOR="M";Qt.DRAW_CURVE_CUBIC_BEZIER="C";Qt.DRAW_CURVE_SMOOTH="S";Qt.DRAW_CURVE_QUADRATIC="Q";Qt.DRAW_CURVE_QUADRATIC_CONTINUATION="T";Qt.DRAW_ARC="A";var zy={};Object.defineProperty(zy,"__esModule",{value:!0});function nM(r){return typeof r=="string"}zy.isString=nM;var Xn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var t=Math;r.abs=t.abs,r.min=t.min,r.max=t.max,r.floor=t.floor,r.round=t.round,r.sqrt=t.sqrt,r.pow=t.pow,r.cos=t.cos,r.asin=t.asin,r.sin=t.sin,r.tan=t.tan,r.PI=t.PI,r.QUADRATIC_RATIO=2/3,r.EPSILON=r.pow(2,-52)})(Xn);Object.defineProperty(Hy,"__esModule",{value:!0});var xm=Qt,iM=zy,rM=Xn;function aM(r,t){if(t===void 0&&(t=rM.round),iM.isString(r))return r;for(var e=[],s=0;s<r.length;s++){var n=r[s];e.push(xm.MOVE_CURSOR,t(n[0]),t(n[1]),xm.DRAW_CURVE_CUBIC_BEZIER);for(var i=void 0,a=2;a<n.length;a+=6){var o=t(n[a]),l=t(n[a+1]),c=t(n[a+2]),u=t(n[a+3]),d=t(n[a+4]),f=t(n[a+5]),p=o==d&&c==d&&l==f&&u==f;(!p||i!=(i=""+o+l+c+u+d+f))&&e.push(o,l,c,u,d,f)}}return e.join(xm.SPACE)}Hy.renderPath=aM;var wc={};Object.defineProperty(wc,"__esModule",{value:!0});var oM=Qt;function lM(){throw new Error(Array.prototype.join.call(arguments,oM.SPACE))}wc.raiseError=lM;var Gy={},Xy={},Sc={},Yy={};Object.defineProperty(Yy,"__esModule",{value:!0});var cM=typeof window<"u"&&window.navigator.userAgent;Yy.isEdge=/(MSIE |Trident\/|Edge\/)/i.test(cM);Object.defineProperty(Sc,"__esModule",{value:!0});var hM=Yy,uM=hM.isEdge?Array:Float32Array;function dM(r){return new uM(r)}Sc.createNumberArray=dM;var rm={};Object.defineProperty(rm,"__esModule",{value:!0});var Zd=Xn;function fM(r){for(var t=r[0],e=r[1],s=e,n=t,i=2;i<r.length;i+=6){var a=r[i+4],o=r[i+5];t=Zd.min(t,a),n=Zd.max(n,a),e=Zd.min(e,o),s=Zd.max(s,o)}return{x:t,w:n-t,y:e,h:s-e}}function pM(r,t,e){var s=fM(e);return{x:s.x+s.w*r,y:s.y+s.h*t}}rm.computeAbsoluteOrigin=pM;Object.defineProperty(Xy,"__esModule",{value:!0});var gM=Sc,mM=rm;function gS(r,t,e){var s=r.length,n=t.length;if(s<n)return gS(t,r,e);t.length=s;for(var i=n;i<s;i++){var a=r[i],o=e.x,l=e.y;if(!e.absolute){var c=mM.computeAbsoluteOrigin(o,l,a);o=c.x,l=c.y}for(var u=gM.createNumberArray(a.length),d=0;d<a.length;d+=2)u[d]=o,u[d+1]=l;t[i]=u}}Xy.fillSegments=gS;var Ky={},qy={};Object.defineProperty(qy,"__esModule",{value:!0});var vM=Sc;function yM(r,t){var e=r.length,s=e-t,n=vM.createNumberArray(t),i;for(i=0;i<t;i++)n[i]=r[i];for(i=t;i<e;i++)r[i-t]=r[i];for(i=0;i<t;i++)r[s+i]=n[i]}qy.rotatePoints=yM;var am={};Object.defineProperty(am,"__esModule",{value:!0});var bM=Xn;function _M(r,t,e,s){return bM.sqrt((r-e)*(r-e)+(t-s)*(t-s))}am.distance=_M;Object.defineProperty(Ky,"__esModule",{value:!0});var AM=qy,wM=Qt,SM=am,TM=rm;function CM(r,t,e,s){var n=s.length;if(!(s[n-2]!==s[0]||s[n-1]!==s[1])){if(!r){var i=TM.computeAbsoluteOrigin(t,e,s);t=i.x,e=i.y}var a=s.slice(2);n=a.length;for(var o,l,c=0;c<n;c+=6){var u=SM.distance(t,t,a[c],a[c+1]);(l===wM._||u<l)&&(l=u,o=c)}AM.rotatePoints(a,o),s[0]=a[n-2],s[1]=a[n-1];for(var c=0;c<a.length;c++)s[c+2]=a[c]}}Ky.normalizePoints=CM;var om={};Object.defineProperty(om,"__esModule",{value:!0});var EM=Xn,xM=Sc;function IM(r,t){for(var e=r[0].length,s=0;s<e;s++){var n=r[0][s],i=r[1][s],a=EM.max(n.length+t,i.length+t);r[0][s]=sy(n,a),r[1][s]=sy(i,a)}}om.fillPoints=IM;function sy(r,t){var e=t-r.length,s=Math.ceil(t/r.length),n=xM.createNumberArray(t);n[0]=r[0],n[1]=r[1];for(var i=1,a=1;a<t-1;){n[++a]=r[++i],n[++a]=r[++i],n[++a]=r[++i],n[++a]=r[++i];var o=n[++a]=r[++i],l=n[++a]=r[++i];if(e)for(var c=0;c<s&&e;c++)n[a+5]=n[a+3]=n[a+1]=o,n[a+6]=n[a+4]=n[a+2]=l,a+=6,e-=6}return n}om.fillSubpath=sy;var Zy={},Qy={};Object.defineProperty(Qy,"__esModule",{value:!0});var RM=Xn,PM=am;function OM(r){for(var t=r.length,e=r[t-2],s=r[t-1],n=0,i=0;i<t;i+=6)n+=PM.distance(r[i],r[i+1],e,s),e=r[i],s=r[i+1];return RM.floor(n)}Qy.perimeterPoints=OM;Object.defineProperty(Zy,"__esModule",{value:!0});var MM=Qy;function kM(r){return r.map(function(t){return{points:t,perimeter:MM.perimeterPoints(t)}}).sort(function(t,e){return e.perimeter-t.perimeter}).map(function(t){return t.points})}Zy.getSortedSegments=kM;Object.defineProperty(Gy,"__esModule",{value:!0});var DM=Xy,zb=Ky,NM=om,Im=Qt,LM=wc,Gb=Zy;function FM(r,t,e){e.optimize===Im.FILL&&(r=Gb.getSortedSegments(r),t=Gb.getSortedSegments(t)),r.length!==t.length&&(e.optimize===Im.FILL?DM.fillSegments(r,t,e.origin):LM.raiseError("optimize:none requires equal lengths"));var s=Array(2);if(s[0]=r,s[1]=t,e.optimize===Im.FILL){for(var n=e.origin,i=n.x,a=n.y,o=n.absolute,l=0;l<r.length;l++)zb.normalizePoints(o,i,a,s[0][l]),zb.normalizePoints(o,i,a,s[1][l]);NM.fillPoints(s,e.addPoints*6)}return s}Gy.normalizePaths=FM;var Jy={};Object.defineProperty(Jy,"__esModule",{value:!0});function BM(r,t){for(var e in t)r.hasOwnProperty(e)||(r[e]=t[e]);return r}Jy.fillObject=BM;Object.defineProperty(im,"__esModule",{value:!0});var VM=Hy,Io=Xn,$M=wc,jM=Gy,UM=Jy,WM=Sc,mS=Qt,HM={addPoints:0,optimize:mS.FILL,origin:{x:0,y:0},precision:0};function zM(r,t){t=UM.fillObject(t,HM),(!r||r.length<2)&&$M.raiseError("invalid arguments");for(var e=r.length-1,s=Array(e),n=0;n<e;n++)s[n]=GM(r[n],r[n+1],t);var i=t.precision?function(a){return a.toFixed(t.precision)}:mS._;return function(a){var o=e*a,l=Io.min(Io.floor(o),e-1);return VM.renderPath(s[l]((o-l)/(l+1)),i)}}im.interpolatePath=zM;function GM(r,t,e){var s=jM.normalizePaths(r.getData(),t.getData(),e),n=s[0].length;return function(i){if(Io.abs(i-0)<Io.EPSILON)return r.getStringData();if(Io.abs(i-1)<Io.EPSILON)return t.getStringData();for(var a=Array(n),o=0;o<n;o++)a[o]=vS(s[0][o],s[1][o],i);return a}}function vS(r,t,e){for(var s=r.length,n=WM.createNumberArray(s),i=0;i<s;i++)n[i]=r[i]+(t[i]-r[i])*e;return n}im.mixPoints=vS;var lm={},t0={},e0={},s0={};Object.defineProperty(s0,"__esModule",{value:!0});var XM=Qt;function YM(r,t){return r===XM._?t:r}s0.coalesce=YM;var n0={};Object.defineProperty(n0,"__esModule",{value:!0});var ge=Xn,Xb=ge.PI*120/180,Qd=ge.PI*2;function yS(r,t,e,s,n,i,a,o,l,c,u,d,f){if(e<=0||s<=0)return[r,t,o,l,o,l];var p=ge.PI/180*(+n||0),g=ge.cos(p),m=ge.sin(p),v=!!c;if(!v){var y=r,S=o;r=y*g-t*-m,t=y*-m+t*g,o=S*g-l*-m,l=S*-m+l*g;var T=(r-o)/2,E=(t-l)/2,A=T*T/(e*e)+E*E/(s*s);A>1&&(A=ge.sqrt(A),e=A*e,s=A*s);var C=(i===a?-1:1)*ge.sqrt(ge.abs((e*e*s*s-e*e*E*E-s*s*T*T)/(e*e*E*E+s*s*T*T)));d=C*e*E/s+(r+o)/2,f=C*-s*T/e+(t+l)/2,c=ge.asin((t-f)/s),u=ge.asin((l-f)/s),r<d&&(c=ge.PI-c),o<d&&(u=ge.PI-u),c<0&&(c+=Qd),u<0&&(u+=Qd),a&&c>u&&(c-=Qd),!a&&u>c&&(u-=Qd)}var x;if(ge.abs(u-c)>Xb){var I=u,R=o,O=l;u=c+Xb*(a&&u>c?1:-1),o=d+e*ge.cos(u),l=f+s*ge.sin(u),x=yS(o,l,e,s,n,0,a,R,O,u,I,d,f)}else x=[];var P=4/3*ge.tan((u-c)/4);if(x.splice(0,0,2*r-(r+P*e*ge.sin(c)),2*t-(t-P*s*ge.cos(c)),o+P*e*ge.sin(u),l-P*s*ge.cos(u),o,l),!v)for(var M=0,B=x.length;M<B;M+=2){var F=x[M],W=x[M+1];x[M]=F*g-W*m,x[M+1]=F*m+W*g}return x}n0.arcToCurve=yS;Object.defineProperty(e0,"__esModule",{value:!0});var bt=Qt,mo=s0,KM=wc,Vi=Xn,qM=n0,ZM={M:2,H:1,V:1,L:2,Z:0,C:6,S:4,Q:4,T:2,A:7};function Zn(r,t,e,s,n,i,a){var o=r.x,l=r.y;r.x=mo.coalesce(i,o),r.y=mo.coalesce(a,l),r.current.push(mo.coalesce(t,o),e=mo.coalesce(e,l),s=mo.coalesce(s,o),n=mo.coalesce(n,l),r.x,r.y),r.lc=r.c}function QM(r){var t=r.c,e=r.t,s=r.x,n=r.y;if(t===bt.DRAW_LINE_VERTICAL)e[0]+=n;else if(t===bt.DRAW_LINE_HORIZONTAL)e[0]+=s;else if(t===bt.DRAW_ARC)e[5]+=s,e[6]+=n;else for(var i=0;i<e.length;i+=2)e[i]+=s,e[i+1]+=n}function JM(r){return r.replace(/[\^\s]*([mhvlzcsqta]|\-?\d*\.?\d+)[,\$\s]*/gi," $1").replace(/([mhvlzcsqta])/gi," $1").trim().split("  ").map(tk)}function tk(r){return r.split(bt.SPACE).map(ek)}function ek(r,t){return t===0?r:+r}function sk(r){for(var t={x:0,y:0,segments:[]},e=JM(r),s=0;s<e.length;s++){var n=e[s],i=n[0],a=i.toUpperCase(),o=a!==bt.CLOSE_PATH&&a!==i;t.c=a;var l=ZM[a],c=n,u=1;do{t.t=c.length===1?c:c.slice(u,u+l),o&&QM(t);var d=t.t,f=t.x,p=t.y,g=void 0,m=void 0,v=void 0,y=void 0,S=void 0,T=void 0;if(a===bt.MOVE_CURSOR)t.segments.push(t.current=[t.x=d[0],t.y=d[1]]);else if(a===bt.DRAW_LINE_HORIZONTAL)Zn(t,bt._,bt._,bt._,bt._,d[0],bt._);else if(a===bt.DRAW_LINE_VERTICAL)Zn(t,bt._,bt._,bt._,bt._,bt._,d[0]);else if(a===bt.DRAW_LINE)Zn(t,bt._,bt._,bt._,bt._,d[0],d[1]);else if(a===bt.CLOSE_PATH)Zn(t,bt._,bt._,bt._,bt._,t.current[0],t.current[1]);else if(a===bt.DRAW_CURVE_CUBIC_BEZIER)Zn(t,d[0],d[1],d[2],d[3],d[4],d[5]),t.cx=d[2],t.cy=d[3];else if(a===bt.DRAW_CURVE_SMOOTH){var E=t.lc!==bt.DRAW_CURVE_SMOOTH&&t.lc!==bt.DRAW_CURVE_CUBIC_BEZIER;g=E?bt._:f*2-t.cx,m=E?bt._:p*2-t.cy,Zn(t,g,m,d[0],d[1],d[2],d[3]),t.cx=d[0],t.cy=d[1]}else if(a===bt.DRAW_CURVE_QUADRATIC){var A=d[0],C=d[1];v=d[2],y=d[3],Zn(t,f+(A-f)*Vi.QUADRATIC_RATIO,p+(C-p)*Vi.QUADRATIC_RATIO,v+(A-v)*Vi.QUADRATIC_RATIO,y+(C-y)*Vi.QUADRATIC_RATIO,v,y),t.cx=A,t.cy=C}else if(a===bt.DRAW_CURVE_QUADRATIC_CONTINUATION)v=d[0],y=d[1],t.lc===bt.DRAW_CURVE_QUADRATIC||t.lc===bt.DRAW_CURVE_QUADRATIC_CONTINUATION?(g=f+(f*2-t.cx-f)*Vi.QUADRATIC_RATIO,m=p+(p*2-t.cy-p)*Vi.QUADRATIC_RATIO,S=v+(f*2-t.cx-v)*Vi.QUADRATIC_RATIO,T=y+(p*2-t.cy-y)*Vi.QUADRATIC_RATIO):(g=S=f,m=T=p),Zn(t,g,m,S,T,v,y),t.cx=S,t.cy=T;else if(a===bt.DRAW_ARC)for(var x=qM.arcToCurve(f,p,d[0],d[1],d[2],d[3],d[4],d[5],d[6]),I=0;I<x.length;I+=6)Zn(t,x[I],x[I+1],x[I+2],x[I+3],x[I+4],x[I+5]);else KM.raiseError(t.c," is not supported");u+=l}while(u<c.length)}return t.segments}e0.parsePoints=sk;Object.defineProperty(t0,"__esModule",{value:!0});var nk=wc,Yb=e0,ik=Qt,rk=/^([#|\.]|path)/i;function ak(r){if(Array.isArray(r))return{data:r,stringData:ik._};var t;if(typeof r=="string"&&rk.test(r)?r=document.querySelector(r):t=r,typeof r=="string")return{data:Yb.parsePoints(r),stringData:t};var e=r;return e.tagName.toUpperCase()==="PATH"?(t=e.getAttribute("d"),{data:Yb.parsePoints(t),stringData:t}):nk.raiseError("Unsupported element ",e.tagName)}t0.convertToPathData=ak;Object.defineProperty(lm,"__esModule",{value:!0});var ok=t0,lk=Xn,Rm=Qt,ck=function(){function r(t){var e=ok.convertToPathData(t),s=e.data,n=e.stringData;this.data=s,this.stringData=n}return r.prototype.getData=function(){return this.data},r.prototype.getStringData=function(){return this.stringData||(this.stringData=this.render())},r.prototype.render=function(t){t===void 0&&(t=lk.round);for(var e=this.data,s=[],n=0;n<e.length;n++){var i=e[n];s.push(Rm.MOVE_CURSOR,t(i[0]),t(i[1]),Rm.DRAW_CURVE_CUBIC_BEZIER);for(var a=void 0,o=2;o<i.length;o+=6){var l=t(i[o]),c=t(i[o+1]),u=t(i[o+2]),d=t(i[o+3]),f=t(i[o+4]),p=t(i[o+5]),g=l==f&&u==f&&c==p&&d==p;(!g||a!=(a=""+l+c+u+d+f+p))&&s.push(l,c,u,d,f,p)}}return s.join(Rm.SPACE)},r}();lm.Path=ck;Object.defineProperty(Wy,"__esModule",{value:!0});var hk=im,uk=lm;function dk(r,t){return hk.interpolatePath(r.map(function(e){return new uk.Path(e)}),t||{})}Wy.interpolate=dk;Object.defineProperty(Uy,"__esModule",{value:!0});var fk=Wy,pk=Uy.interpolate=fk.interpolate,gk=lm;Uy.Path=gk.Path;const Qn=HS("ScreenOrientation",{web:()=>qb(()=>import("./web-183299c9.js"),["assets/web-183299c9.js","assets/index-d8b98756.js","assets/index-e6823b2f.css"]).then(r=>new r.ScreenOrientationWeb)}),mk={class:"title"},vk={class:"title--left"},yk={class:"title--center"},bk={class:"title--right"},_k=["src"],Ak={key:0,class:"page-button-container left"},wk={key:1,class:"page-button-container right"},Sk={class:"verse-list"},Tk=["onClick"],Ck={class:"timestamp-left"},Ek={class:"progress-bar"},xk=["value","onInput"],Ik={class:"timestamp-right"},Rk=["d"],Pk={key:2,class:"media-controls"},Ok=["d"],Mk={class:"timestamp"},kk={class:"progress-bar-large"},Dk=["value","onInput"],Nk={class:"timestamp"},Lk={key:3,class:"starting-notes-container"},Fk={class:"note-container"},Bk=["onClick"],Vk={class:"note-button"},$k=["src"],jk={class:"note-name"},xD=ny({__name:"SongDisplayView",props:{book:{},number:{}},setup(r){const t=r,e=zS(),{player:s,isPlaying:n}=tM(),i=Mt([]),a=Mt("Unknown"),o=Mt(0);var l=iy.getPlatform()!=="web";const c=Mt(),u=GS("bookmarks",[]);let d=Mt(!1),f=Mt([]);const p=iT(),g=Pf(()=>u.value.findIndex(tt=>tt.book==t.book&&tt.number==t.number)!=-1),m=Mt(!1),v=Mt(!1);async function y(){if(!g.value)u.value.push(t),await pm.show({text:`#${t.number} added to Bookmarks`});else{const tt=u.value.findIndex(L=>L.book==t.book&&L.number==t.number);u.value.splice(tt,1),await pm.show({text:`#${t.number} removed from Bookmarks`})}}class S{constructor(){at(this,"start");at(this,"previous");at(this,"height");at(this,"visible");at(this,"elastic");this.start=0,this.previous=0,this.visible=!1,this.elastic=!1,this.height=screen.orientation.type.includes("landscape")?.8:.4}dragFallOff(L){var yt=(Math.log(L+.368)+1)/4;return yt}dragStart(L,yt){L.preventDefault(),this.previous=this.height,this.start=1-yt/window.innerHeight}drag(L,yt){L.preventDefault(),v.value?this.height=1-yt/window.innerHeight-this.start+this.previous:this.height=this.dragFallOff(1-yt/window.innerHeight-this.start)+this.previous,(this.height<(v.value?.2:.1)||isNaN(this.height))&&(O.value&&!P.value||(this.height=v.value?.2:.1)),(this.height<=.01||isNaN(this.height))&&(this.height=.005)}dragEnd(L){L.preventDefault(),this.height>(v.value?.4:.2)?this.height=v.value?.8:.4:O.value&&P.value==!1?(this.height=.005,setTimeout(()=>{this.visible=!1},250)):this.height=v.value?.2:.1,this.elastic=!0,setTimeout(()=>{this.elastic=!1},250)}}let T=Mt(new S),E=Mt(),A=Mt(!1),C;function x(tt){tt.addEventListener("loadedmetadata",()=>{console.log("Audio Loaded!"),A.value=!0,B.value=(tt==null?void 0:tt.duration)||0,N(null,!1)}),tt.addEventListener("error",()=>{console.error("Error loading audio"),A.value=!1,N(null,!0)})}Qb(async()=>{const tt=await D0(t.book),L=await Jb();if(c.value=L[t.book],tt!=null){const yt=tt[t.number];a.value=(yt==null?void 0:yt.title)??"Unknown",i.value=((yt==null?void 0:yt.notes)??[]).reverse(),o.value=Object.keys(tt).length,m.value=(await N0.getStatus()).connected,m.value?(E.value=new Audio(`https://acchymnsmedia.s3.us-east-2.amazonaws.com/${t.book}/${t.number}.mp3`),E.value.preload="metadata",x(E.value)):(A.value=!1,E.value=new Audio),N(null,!0),N0.addListener("networkStatusChange",async Q=>{var Ws,uo;m.value=Q.connected,m.value?(E.value=new Audio(`https://acchymnsmedia.s3.us-east-2.amazonaws.com/${t.book}/${t.number}.mp3`),E.value.preload="metadata",x(E.value),(uo=E.value)==null||uo.load()):((Ws=E.value)==null||Ws.pause(),pt(),P.value=!1,A.value=!1,E.value=new Audio,N(null,!0))})}else console.log("book doesn't exist"),await XS(t.book);C=(await Qn.orientation()).type,(await Qn.orientation()).type=="portrait-primary"?v.value=!1:(await Qn.orientation()).type.includes("landscape")&&(v.value=!0),Qn.addListener("screenOrientationChange",async()=>{C!=(await Qn.orientation()).type&&((await Qn.orientation()).type=="portrait-primary"?(v.value=!1,C=(await Qn.orientation()).type):(await Qn.orientation()).type.includes("landscape")&&(v.value=!0,C=(await Qn.orientation()).type),O.value?T.value.height=v.value?.8:.4:T.value.height=v.value?.2:.1)})}),YS(()=>{var tt;s.stop(),(tt=E.value)==null||tt.pause(),E.value=void 0});let I=Mt(!0),R=Mt({x:0,y:0}),O=Mt(!1),P=Mt(!1),M=Mt(0),B=Mt(0),F=-1,W=Mt(!1),j=Mt(),D=Mt();const $=Mt(!1),H=Mt(null),Y=[tt=>$.value=!1,{ignore:[H]}];function K(){d.value=!1}async function nt(){var tt,L;p.church_id.value!=null&&(await nT(e_(),p.church_id.value,t.number,((tt=c.value)==null?void 0:tt.name.medium)||t.book,f.value,((L=c.value)==null?void 0:L.primaryColor)||"#000000"),K())}const ut=async()=>{var Q;if(M.value=((Q=E.value)==null?void 0:Q.currentTime)||0,E.value==null)return;let tt=j.value,L=D.value,yt=E.value.currentTime/E.value.duration*100;tt&&(tt.style.background=`linear-gradient(to right, var(--color) 0%, var(--color) ${yt}%, var(--slider-base) ${yt}%, var(--slider-base) 100%)`),L&&(L.style.background=`linear-gradient(to right, var(--color) 0%, var(--color) ${yt}%, var(--slider-base) ${yt}%, var(--slider-base) 100%)`),E.value.ended&&W.value==!1&&(pt(),P.value=!1,clearInterval(F))};async function Rt(){P.value&&rt(),s.stop(),s.play(i)}async function ht(tt){P.value&&rt(),s.stop(),s.play([tt])}async function U(){T.value.visible=!T.value.visible,T.value.height=v.value?.8:.4}async function V(){var tt;T.value.visible=!1,T.value.height=v.value?.8:.4,(tt=E.value)==null||tt.pause(),pt(),P.value=!1}function N(tt,L){tt&&tt.preventDefault(),O.value=L,n.value=!T.value.visible}let ct=Mt(Em);function pt(){let tt=P.value?[Hb,Em]:[Em,Hb],L=pk(tt,{addPoints:0,origin:{x:0,y:0},optimize:"fill",precision:0});sM(yt=>{ct.value=yt},L)}async function rt(){var tt,L;pt(),P.value?((L=E.value)==null||L.pause(),clearInterval(F)):((tt=E.value)==null||tt.play(),ut(),F=setInterval(()=>{ut()},1e3,0)),P.value=!P.value}function Ct(){var tt,L,yt;W.value=!1,P.value&&((tt=E.value)!=null&&tt.paused)&&!((L=E.value)!=null&&L.ended)&&((yt=E.value)==null||yt.play())}function Dt(tt){W.value=!0;let L=E.value;L!=null&&(L.currentTime=L.duration*tt/100,ut())}function ye(tt){let L=Math.floor(tt/60),yt=Math.floor(tt%60);return`${L}:${yt<10?"0":""}${yt}`}function G(){I.value=!I.value}function q(){if(A.value==!1){T.value.height=.005,T.value.elastic=!0,setTimeout(()=>{T.value.elastic=!1,T.value.visible=!1},250);return}T.value.height=v.value?.2:.1,T.value.elastic=!0,setTimeout(()=>{T.value.elastic=!1},250)}async function Pt(tt){const L=await D0(t.book);if(L==null){console.error("Error loading song metadata. Cannot traverse song.");return}const yt=Object.keys(L).sort((Ws,uo)=>Ws.localeCompare(uo,"en",{numeric:!0})),Q=yt.findIndex(Ws=>Ws==t.number);if(Q==-1){console.error("Error finding song in metadata. Cannot traverse song.");return}if(Q+tt<0||Q+tt>=yt.length){console.error("Cannot traverse song. Out of bounds.");return}await e.replace(`/display/${t.book}/${yt[Q+tt]}`)}function Ot(tt){let L=tt.replace("#","").replace("b","");return i.value.indexOf(tt)>1||!Object.keys(jb).includes(L)?ZO[L]:jb[L]}async function mt(){var tt;await M0.share({title:`${a.value}`,text:`#${t.number} from ${(tt=c.value)==null?void 0:tt.name.medium} available online now!`,url:`https://acchymns.app/display/${t.book}/${t.number}`})}async function Ht(){await aT().report(t)&&await pm.show({text:"Issue reported successfully"})}const Oe=Mt(!1);return M0.canShare().then(tt=>Oe.value=tt.value),(tt,L)=>{var yt;return Gt(),se(Bd,null,[it("div",{class:Hs(["full",{dark:$.value}])},null,2),it("div",{class:Hs(["menu",{"menu-hidden":!Z(I)}])},[it("div",mk,[it("div",vk,[it("img",{onClick:L[0]||(L[0]=Q=>Z(e).back()),class:"ionicon",src:O0})]),it("div",yk,[it("h1",null,"#"+Kn(t.number),1)]),it("div",bk,[i.value.length!=0?(Gt(),se(Bd,{key:0},[Z(T).visible?(Gt(),se("img",{key:1,class:"ionicon",onClick:L[2]||(L[2]=Q=>U()),src:V0})):(Gt(),se("img",{key:0,onClick:L[1]||(L[1]=Q=>U()),class:"ionicon",src:oT}))],64)):Ps("",!0),it("img",{class:"ionicon",ref_key:"dropdown_button",ref:H,onClick:L[3]||(L[3]=Q=>$.value=!$.value),src:LS},null,512),L0((Gt(),t_(FS,{class:"dropdown-menu",dropdown_open:$.value},{default:KS(()=>[it("div",{onClick:L[4]||(L[4]=()=>{y(),$.value=!1})},[L[29]||(L[29]=it("div",null,"Bookmark",-1)),it("img",{class:"ionicon",src:g.value?"/assets/bookmark.svg":"/assets/bookmark-outline.svg"},null,8,_k)]),Oe.value?(Gt(),se("div",{key:0,onClick:L[5]||(L[5]=()=>{mt(),$.value=!1})},L[30]||(L[30]=[it("div",null,"Share",-1),it("img",{class:"ionicon",src:BS},null,-1)]))):Ps("",!0),it("div",{onClick:L[6]||(L[6]=()=>{Ht(),$.value=!1})},L[31]||(L[31]=[it("div",null,"Report Issue",-1),it("img",{class:"ionicon",src:lT},null,-1)])),Z(p).is_authorized.value&&!Z(d)?(Gt(),se("div",{key:1,onClick:L[7]||(L[7]=()=>{ji(d)?d.value=!0:d=!0,$.value=!1})},L[32]||(L[32]=[it("div",null,"Broadcast",-1),it("img",{class:"ionicon",src:cT},null,-1)]))):Ps("",!0)]),_:1},8,["dropdown_open"])),[[Z(B0),Y]])])])],2),Z(T).height<.7||!Z(T).visible?(Gt(),se("div",Ak,[it("div",{class:Hs(["page-button",{"arrow-hidden-left":!Z(I)||Number(t.number)==1}])},[it("img",{onClick:L[8]||(L[8]=Q=>Pt(-1)),class:"ionicon",src:O0})],2)])):Ps("",!0),Z(T).height<.7||!Z(T).visible?(Gt(),se("div",wk,[it("div",{class:Hs(["page-button",{"arrow-hidden-right":!Z(I)||Number(t.number)==o.value}])},[it("img",{onClick:L[9]||(L[9]=Q=>Pt(1)),class:"ionicon",src:VS})],2)])):Ps("",!0),Z(p).is_authorized&&Z(d)?L0((Gt(),se("div",{key:2,class:"broadcast-container",onTouchmove:L[12]||(L[12]=Q=>Q.preventDefault())},[L[33]||(L[33]=it("h1",null,"Broadcast",-1)),it("div",{class:"close-button"},[it("img",{onClick:K,class:"ionicon",src:k0})]),it("h3",null,Kn(((yt=c.value)==null?void 0:yt.name.medium)||t.book)+" - #"+Kn(t.number),1),L[34]||(L[34]=it("br",null,null,-1)),L[35]||(L[35]=it("h3",null,"Verses",-1)),it("a",{class:Hs(["verse",{"verse-selected":Z(f)[0]==-2}]),onClick:L[10]||(L[10]=()=>{Z(f)[0]==-2?ji(f)?f.value=[]:f=[]:ji(f)?f.value=[-2]:f=[-2]})}," All ",2),L[36]||(L[36]=it("br",null,null,-1)),it("div",Sk,[(Gt(),se(Bd,null,F0(12,Q=>it("a",{key:Q,class:Hs(["verse",{"verse-selected":Z(f).includes(Q)}]),onClick:()=>{Z(f)[0]==-2&&(ji(f)?f.value=[]:f=[]),Z(f).includes(Q)?Z(f).splice(Z(f).indexOf(Q),1):Z(f).push(Q)}},Kn(Q),11,Tk)),64))]),it("button",{class:"send-button",onClick:L[11]||(L[11]=Q=>nt())},"Send")],32)),[[Z(B0),K]]):Ps("",!0),it("div",{class:Hs(["media-panel-content",{"hidden-panel":!Z(T).visible||!Z(I),elastic:Z(T).elastic}]),style:Fi("height:"+Z(T).height*100+"%")},[L[42]||(L[42]=it("div",{class:"media-panel-blur"},null,-1)),Z(l)?(Gt(),se("div",{key:0,class:"handle-bar-container",onTouchstart:L[13]||(L[13]=Q=>Z(T).dragStart(Q,Q.touches[0].pageY)),onTouchmove:L[14]||(L[14]=Q=>Z(T).drag(Q,Q.touches[0].pageY)),onTouchend:L[15]||(L[15]=Q=>Z(T).dragEnd(Q))},L[37]||(L[37]=[it("div",{class:"handle-bar"},null,-1)]),32)):Ps("",!0),it("div",{class:"close-button",style:Fi({opacity:Z(T).height<(v.value?.3:.15)?"0":"1"})},[it("img",{onClick:L[16]||(L[16]=Q=>V()),class:"ionicon",src:k0})],4),Z(T).height<=(v.value?.3:.15)&&Z(T).visible&&Z(A)?(Gt(),se("div",{key:1,class:"mini-playback-container",style:Fi({opacity:Z(T).height<=(v.value?.2:.1)?"1":"0"})},[it("p",Ck,Kn(ye(Z(M))),1),it("div",Ek,[it("input",{type:"range",ref_key:"mini_timeline",ref:D,class:"media-timeline",value:Z(M)/Z(B)*100,onInput:Q=>Dt(Number(Q.target.value)),onChange:L[17]||(L[17]=Q=>Ct()),style:Fi({background:`linear-gradient(to right, var(--color) 0%, var(--color) ${Z(M)/Z(B)*100}%, var(--slider-base) ${Z(M)/Z(B)*100}%, var(--slider-base) 100%)`})},null,44,xk)]),it("p",Ik,Kn(ye(Z(B))),1),(Gt(),se("svg",{onClick:L[18]||(L[18]=Q=>rt()),class:"mini-play-button",viewBox:"0 0 512 512"},[it("path",{id:"svg_content",class:"play-button-path",d:Z(ct)},null,8,Rk)]))],4)):Ps("",!0),it("div",{class:"media-type",style:Fi({opacity:Z(T).height<(v.value?.4:.2)?"0":"1"})},[Z(A)&&m.value?(Gt(),se("div",{key:0,class:Hs(Z(O)?"media-type-indicator":"media-type-indicator-active"),onClick:L[19]||(L[19]=Q=>N(Q,!1))},L[38]||(L[38]=[it("p",{class:"media-type-title"},"Piano",-1)]),2)):Ps("",!0),it("div",{class:Hs(Z(O)?"media-type-indicator-active":"media-type-indicator"),onClick:L[20]||(L[20]=Q=>N(Q,!0))},L[39]||(L[39]=[it("p",{class:"media-type-title"},"Starting Notes",-1)]),2)],4),!Z(O)&&Z(T).visible?(Gt(),se("div",Pk,[it("div",{class:"playback-container",style:Fi({opacity:Z(T).height<(v.value?.5:.25)?"0":"1"})},[(Gt(),se("svg",{onClick:L[21]||(L[21]=Q=>rt()),class:"play-button",viewBox:"0 0 512 512"},[it("path",{id:"svg_content",class:"play-button-path",d:Z(ct)},null,8,Ok)]))],4),it("div",{class:"timeline",style:Fi({opacity:Z(T).height<(v.value?.8:.4)?"0":"1"})},[it("p",Mk,Kn(ye(Z(M))),1),it("div",kk,[it("input",{type:"range",ref_key:"large_timeline",ref:j,class:"media-timeline",value:Z(M)/Z(B)*100,onInput:Q=>Dt(Number(Q.target.value)),onChange:L[22]||(L[22]=Q=>Ct()),style:Fi({background:`linear-gradient(to right, var(--color) 0%, var(--color) ${Z(M)/Z(B)*100}%, var(--slider-base) ${Z(M)/Z(B)*100}%, var(--slider-base) 100%)`})},null,44,Dk)]),it("p",Nk,Kn(ye(Z(B))),1)],4)])):Ps("",!0),Z(O)?(Gt(),se("div",Lk,[it("div",Fk,[it("div",{class:"note-button",onClick:L[23]||(L[23]=Q=>Rt())},L[40]||(L[40]=[it("img",{class:"ionicon starting-note-icon-all",src:V0},null,-1)])),L[41]||(L[41]=it("p",{class:"note-name"},"All",-1))]),(Gt(!0),se(Bd,null,F0(i.value,Q=>(Gt(),se("div",{key:Q,class:"note-container",onClick:Ws=>ht(Q)},[it("div",Vk,[it("img",{class:"ionicon starting-note-icon",src:Ot(Q)},null,8,$k)]),it("p",jk,Kn(Q),1)],8,Bk))),128))])):Ps("",!0)],6),it("div",{class:"w-100",style:{height:"100vh"},onMousedown:L[24]||(L[24]=Q=>ji(R)?R.value={x:Q.screenX,y:Q.screenY}:R={x:Q.screenX,y:Q.screenY}),onMouseup:L[25]||(L[25]=Q=>{Math.abs(Z(R).x-Q.screenX)<5&&Math.abs(Z(R).y-Q.screenY)<5&&G()}),onTouchstart:L[26]||(L[26]=Q=>ji(R)?R.value={x:Q.touches[0].screenX,y:Q.touches[0].screenY}:R={x:Q.touches[0].screenX,y:Q.touches[0].screenY}),onTouchend:L[27]||(L[27]=Q=>{Math.abs(Z(R).x-Q.changedTouches[0].screenX)<5&&Math.abs(Z(R).y-Q.changedTouches[0].screenY)<5&&G()}),onTouchmove:L[28]||(L[28]=Q=>q())},[qS(nE,{book:t.book,number:t.number},null,8,["book","number"])],32)],64)}}});export{xD as default};
