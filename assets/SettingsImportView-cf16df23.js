import{d as L,r as x,ak as U,S as F,b as W,H as D,al as o,O as q,k as l,l as n,X as j,a8 as G,q as d,am as $,F as g,s as b,v as X,a6 as O,x as a,p as _,w as C,an as z,ai as E,m,M as h,ac as J,_ as K,T as P,ao as Q,ap as Y,aq as Z,ar as tt,as as et,at as st,ah as nt,G as at}from"./index-da7e3611.js";import{_ as it}from"./chevron-back-outline-c47e6776.js";import{_ as ot}from"./close-caff5f58.js";import{T as i}from"./index-a272ef03.js";const lt="/assets/enter-outline.svg",rt="/assets/arrow-down-circle-outline.svg",ct="/assets/trash-outline.svg",ut={class:"menu"},dt={class:"title"},mt={class:"main-content"},ft={class:"input-option reference-option"},pt=["disabled"],wt={key:0},yt={key:1,class:"warning-label-container"},vt=["onClick"],gt={key:2},_t={key:3,class:"warning-label-container"},ht={class:"button-array"},kt=["onClick"],xt=["onClick"],Dt={key:4},bt={class:"button-array"},Ct=["onClick"],Et=L({__name:"SettingsImportView",setup(It){let r=x(new Map),f=x(new Map);U(async()=>{f.value.forEach(async(e,t)=>{await e.cancel(),r.value.delete(t)})});const p=F("bookSources",[]);let I=W("import_books_tooltip_complete",!1);const w=D(()=>p.value.filter(t=>t.status==o.PREVIEW)),k=D(()=>p.value.filter(e=>e.status==o.IMPORTED)),S=D(()=>p.value.filter(e=>e.status==o.DOWNLOADED)),y=x("");async function T(e,t=!0){let s=p.value.find(u=>u.id==e.id);if(s==null)return!1;if((await P.getStatus()).connected)h.getPlatform()!=="web"&&await Q(s);else return await i.show({text:"No internet connection."}),!1;let v=null;try{const u=new AbortController,A=setTimeout(()=>u.abort(),2e3);v=await fetch(s.src+"/summary.json",{method:"HEAD",signal:u.signal}),clearTimeout(A)}catch(u){if(u.name=="TypeError")return await i.show({text:"Failed to load hymnal!"}),!1;if(u.name!="AbortError")throw u}return v==null||!v.ok||v.status!=200?(await i.show({text:"Failed to load hymnal!"}),!1):s.status!=o.IMPORTED?(s.status=o.IMPORTED,t&&await i.show({text:"Successfully imported hymnal!"}),!0):(await i.show({text:"Hymnal already imported!"}),!1)}async function B(e){if(e=e.toUpperCase(),e in O){const t=p.value.find(s=>s.id==e);if(t==null)return;t.status==o.IMPORTED||t.status==o.DOWNLOADED?await i.show({text:`Hymnal (${e}) already imported!`}):await T(t,!1)&&await i.show({text:`Successfully imported hymnal (${e})!`})}else await i.show({text:`Unknown hymnal reference (${e})!`})}async function H(e){if((await P.getStatus()).connected){let t=Y(e,(s,c)=>N(s,c),(s,c)=>V(s,c));f.value.set(e.id,t)}else await i.show({text:"No internet connection."});console.log("Downloads:",f.value)}async function N(e,t){r.value.set(e.id,t)}async function V(e,t){e.src=t,e.status=o.DOWNLOADED,await i.show({text:"Successfully downloaded hymnal!"})}q(()=>{I.value||(I.value=!0)});async function M(e){var t;e.status=Object.keys(Z).includes(e.id)?o.PREVIEW:o.HIDDEN,f.value.has(e.id)&&((t=f.value.get(e.id))==null||t.cancel(),r.value.delete(e.id)),h.getPlatform()!=="web"&&await tt(e),await i.show({text:"Successfully removed hymnal!"})}async function R(e){e.status=o.IMPORTED,e.src=O[e.id],await et.rmdir({directory:st.Documents,path:`Hymnals/${e.id}`,recursive:!0}),r.value.delete(e.id),nt(),await i.show({text:"Successfully deleted hymnal!"})}return(e,t)=>(a(),l(g,null,[n("div",ut,[n("div",dt,[n("img",{onClick:t[0]||(t[0]=s=>e.$router.back()),class:"ionicon title--left",src:it}),t[3]||(t[3]=n("h1",{class:"title--center"},"Import Hymnals",-1))])]),n("div",mt,[n("div",ft,[j(n("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),type:"text",class:"search-bar",placeholder:"Book Code"},null,512),[[G,y.value,void 0,{trim:!0}]]),n("a",{disabled:y.value.length===0,onClick:t[2]||(t[2]=s=>B(y.value)),class:"reference-button"},t[4]||(t[4]=[n("img",{class:"ionicon enter-button-icon",src:lt},null,-1)]),8,pt)]),w.value.length!=0?(a(),l("h2",wt,"Available Hymnals")):d("",!0),w.value.length!=0?(a(),l("div",yt,t[5]||(t[5]=[n("img",{class:"ionicon warning-icon",src:$},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(g,null,b(w.value,s=>(a(),_(E,{key:s.id,src:s.src,"with-link":!1},{default:C(()=>[n("button",{onClick:c=>T(s)},t[6]||(t[6]=[n("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:z},null,-1)]),8,vt)]),_:2},1032,["src"]))),128))]),k.value.length!=0?(a(),l("h2",gt,"Imported Hymnals")):d("",!0),k.value.length!=0&&w.value.length==0?(a(),l("div",_t,t[7]||(t[7]=[n("img",{class:"ionicon warning-icon",src:$},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(g,null,b(k.value,s=>(a(),_(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:C(()=>[n("div",ht,[(m(r).get(s.id)||0)<1&&m(h).getPlatform()!=="web"?(a(),l("button",{key:0,onClick:c=>H(s)},t[8]||(t[8]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:rt},null,-1)]),8,kt)):d("",!0),(m(r).get(s.id||"")||0)>=1&&(m(r).get(s.id||"")||0)<100&&m(h).getPlatform()!=="web"?(a(),_(J,{key:1,radius:15,progress:m(r).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress"])):d("",!0),n("button",{onClick:c=>M(s)},t[9]||(t[9]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ot},null,-1)]),8,xt)])]),_:2},1032,["src"]))),128))]),S.value.length!=0?(a(),l("h2",Dt,"Downloaded Hymnals")):d("",!0),n("div",null,[(a(!0),l(g,null,b(S.value,s=>(a(),_(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:C(()=>[n("div",bt,[n("button",{onClick:c=>R(s)},t[10]||(t[10]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ct},null,-1)]),8,Ct)])]),_:2},1032,["src"]))),128))]),t[11]||(t[11]=n("div",{style:{"padding-bottom":"200px"}},null,-1))]),X(K,{current_page:"settings"})],64))}});const Pt=at(Et,[["__scopeId","data-v-68cc60d2"]]);export{Pt as default};
