var K=Object.defineProperty;var W=(p,t,s)=>t in p?K(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s;var S=(p,t,s)=>(W(p,typeof t!="symbol"?t+"":t,s),s);import{d as G,o as U,a as X,f as Y,r as v,H as R,L as Z,c as J,g as Q,X as tt,Y as st,Z as et,$ as ot,n as rt,j as it,k as $,l as a,V as H,a0 as nt,m as D,A as z,F as O,s as N,W as at,t as F,q as T,p as P,x as y,z as V,w as lt,R as ct,B as ht,_ as ut}from"./index-16f93515.js";import{s as I,K as E}from"./index-84a5d9f8.js";import{v as dt}from"./index-31f7bfe4.js";const pt="/acchymns-dev/assets/filter-outline.svg";class q{constructor(t,s,e){S(this,"r",0);S(this,"g",0);S(this,"b",0);this.set(t,s,e)}toString(){return`rgb(${Math.round(this.r)}, ${Math.round(this.g)}, ${Math.round(this.b)})`}set(t,s,e){this.r=this.clamp(t),this.g=this.clamp(s),this.b=this.clamp(e)}hueRotate(t=0){t=t/180*Math.PI;const s=Math.sin(t),e=Math.cos(t);this.multiply([.213+e*.787-s*.213,.715-e*.715-s*.715,.072-e*.072+s*.928,.213-e*.213+s*.143,.715+e*.285+s*.14,.072-e*.072-s*.283,.213-e*.213-s*.787,.715-e*.715+s*.715,.072+e*.928+s*.072])}grayscale(t=1){this.multiply([.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)])}sepia(t=1){this.multiply([.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)])}saturate(t=1){this.multiply([.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t])}multiply(t){const s=this.clamp(this.r*t[0]+this.g*t[1]+this.b*t[2]),e=this.clamp(this.r*t[3]+this.g*t[4]+this.b*t[5]),r=this.clamp(this.r*t[6]+this.g*t[7]+this.b*t[8]);this.r=s,this.g=e,this.b=r}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-(.5*t)+.5)}linear(t=1,s=0){this.r=this.clamp(this.r*t+s*255),this.g=this.clamp(this.g*t+s*255),this.b=this.clamp(this.b*t+s*255)}invert(t=1){this.r=this.clamp((t+this.r/255*(1-2*t))*255),this.g=this.clamp((t+this.g/255*(1-2*t))*255),this.b=this.clamp((t+this.b/255*(1-2*t))*255)}hsl(){const t=this.r/255,s=this.g/255,e=this.b/255,r=Math.max(t,s,e),c=Math.min(t,s,e);let u=0,b=0;const m=(r+c)/2;if(r===c)u=b=0;else{const d=r-c;switch(b=m>.5?d/(2-r-c):d/(r+c),r){case t:u=(s-e)/d+(s<e?6:0);break;case s:u=(e-t)/d+2;break;case e:u=(t-s)/d+4;break}u/=6}return{h:u*100,s:b*100,l:m*100}}clamp(t){return t>255?t=255:t<0&&(t=0),t}}class mt{constructor(t){S(this,"target");S(this,"targetHSL");S(this,"reusedColor");this.target=t,this.targetHSL=t.hsl(),this.reusedColor=new q(0,0,0)}solve(){const t=this.solveNarrow(this.solveWide());return{values:t.values,loss:t.loss,filter:this.css(t.values??[])}}solveWide(){const e=[60,180,18e3,600,1.2,1.2];let r={loss:1/0};for(let c=0;r.loss>25&&c<3;c++){const u=[50,20,3750,50,100,100],b=this.spsa(5,e,15,u,1e3);b.loss<r.loss&&(r=b)}return r}solveNarrow(t){const s=t.loss,e=2,r=s+1,c=[.25*r,.25*r,r,.25*r,.2*r,.2*r];return this.spsa(s,c,e,t.values,500)}spsa(t,s,e,r,c){const b=.16666666666666666;let m=null,d=1/0;const M=new Array(6),w=new Array(6),A=new Array(6);for(let h=0;h<c;h++){const g=e/Math.pow(h+1,b);for(let l=0;l<6;l++)M[l]=Math.random()>.5?1:-1,w[l]=r[l]+g*M[l],A[l]=r[l]-g*M[l];const f=this.loss(w)-this.loss(A);for(let l=0;l<6;l++){const x=f/(2*g)*M[l],C=s[l]/Math.pow(t+h+1,1);r[l]=L(r[l]-C*x,l)}const B=this.loss(r);B<d&&(m=r.slice(0),d=B)}return{values:m,loss:d};function L(h,g){let f=100;return g===2?f=7500:(g===4||g===5)&&(f=200),g===3?h>f?h%=f:h<0&&(h=f+h%f):h<0?h=0:h>f&&(h=f),h}}loss(t){const s=this.reusedColor;s.set(0,0,0),s.invert(t[0]/100),s.sepia(t[1]/100),s.saturate(t[2]/100),s.hueRotate(t[3]*3.6),s.brightness(t[4]/100),s.contrast(t[5]/100);const e=s.hsl();return Math.abs(s.r-this.target.r)+Math.abs(s.g-this.target.g)+Math.abs(s.b-this.target.b)+Math.abs(e.h-this.targetHSL.h)+Math.abs(e.s-this.targetHSL.s)+Math.abs(e.l-this.targetHSL.l)}css(t){function s(e,r=1){return Math.round(t[e]*r)}return`filter: invert(${s(0)}%) sepia(${s(1)}%) saturate(${s(2)}%) hue-rotate(${s(3,3.6)}deg) brightness(${s(4)}%) contrast(${s(5)}%);`}}function ft(p){const t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;p=p.replace(t,(e,r,c,u)=>r+r+c+c+u+u);const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return s?[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]:null}const _t={class:"search-bar"},bt={class:"filters"},gt={class:"dropdown-content-wrapper"},kt=["src"],vt=["onClick"],yt={class:"dropdown-content-item"},wt=["src"],Mt={class:"dropdown-content-text"},St={key:0,style:{"margin-top":"10px","margin-bottom":"10px"}},$t={class:"songlist"},At={class:"song__title"},Ct={class:"book__title"},Ft={class:"booktext--right"},Lt={class:"song__number"},j=50,Ht=G({__name:"SearchView",setup(p){U((n,o)=>{ht(o.fullPath)});const t=X(),s=Y("searchParams",{search:"",bookFilters:[]}),e=v(s.value.search),r=R(()=>I(e.value));Z(e,n=>{s.value.search=n});const c=v([]),u=v([]),b=v(new Map),m=R(()=>s.value.bookFilters.length>0?c.value.filter(n=>{var o,i;return(((o=n.stripped_title)==null?void 0:o.includes(r.value))||((i=n==null?void 0:n.stripped_first_line)==null?void 0:i.includes(r.value))||(n==null?void 0:n.number)==r.value)&&s.value.bookFilters.find(k=>k==n.book.name.short)}).sort((n,o)=>n.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").localeCompare(o.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,""))):e.value===""?[]:c.value.filter(n=>{var o,i;return((o=n.stripped_title)==null?void 0:o.includes(r.value))||((i=n==null?void 0:n.stripped_first_line)==null?void 0:i.includes(r.value))||(n==null?void 0:n.number)==r.value}).sort((n,o)=>n.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"").localeCompare(o.title.replace(/[.,/#!$%^&*;:{}=\-_'"`~()]/g,"")))),d=v(j),M=R(()=>m.value.length-d.value<j?m.value:m.value.slice(0,d.value));J(async()=>{const n=await Q(),o=await tt();u.value.push(...Object.values(n));for(const i of Object.keys(o))for(const k of Object.keys(o[i])){let _=o[i][k];_.title==null&&(_.title=""),c.value.push({title:(_==null?void 0:_.title)??"",number:k,book:n[i],stripped_title:I((_==null?void 0:_.title)??""),stripped_first_line:I((_==null?void 0:_.first_line)??"")})}st.concat(Object.keys(et)).forEach(async i=>{let k=await ot(i);k!=null&&b.value.set(i,k)}),await rt(),it(t.fullPath)});const w=v(!1),A=v(!1);function L(){A.value=!1,setTimeout(()=>{w.value=!1},200)}function h(){w.value?L():(w.value=!0,A.value=!0)}let g=v([]);function f(n){if(w.value=!0,s.value.bookFilters.includes(n)){let o=s.value.bookFilters.findIndex(i=>i==n);s.value.bookFilters.splice(o,1)}else s.value.bookFilters.push(n)}function B(){s.value.bookFilters=[]}function l(n){return n?"./assets/checkmark-circle.svg":"./assets/ellipse-outline.svg"}function x(n){const o=ft(n??"#000000");return(o==null?void 0:o.length)!==3?"":new mt(new q(o[0],o[1],o[2])).solve().filter}const C=v(!1);return E.addListener("keyboardDidShow",()=>{C.value=!0}),E.addListener("keyboardDidHide",()=>{C.value=!1}),(n,o)=>(y(),$(O,null,[o[7]||(o[7]=a("h1",{class:"pagetitle"},"Search",-1)),a("div",_t,[H(a("input",{"onUpdate:modelValue":o[0]||(o[0]=i=>e.value=i),placeholder:"Search for a song title or number...","aria-label":"Search through site content"},null,512),[[nt,e.value]]),o[3]||(o[3]=a("button",{disabled:""},[a("svg",{viewBox:"0 0 1024 1024"},[a("path",{class:"path1",d:"M848.471 928l-263.059-263.059c-48.941 36.706-110.118 55.059-177.412 55.059-171.294 0-312-140.706-312-312s140.706-312 312-312c171.294 0 312 140.706 312 312 0 67.294-24.471 128.471-55.059 177.412l263.059 263.059-79.529 79.529zM189.623 408.078c0 121.364 97.091 218.455 218.455 218.455s218.455-97.091 218.455-218.455c0-121.364-103.159-218.455-218.455-218.455-121.364 0-218.455 97.091-218.455 218.455z"})])],-1))]),H((y(),$("div",bt,[a("a",{onClick:o[1]||(o[1]=i=>h()),class:"dropdown"},o[4]||(o[4]=[a("p",{class:"dropdown-text"},"Filters",-1),a("img",{class:"ionicon filter-icon",src:pt},null,-1)])),H(a("div",gt,[a("div",{class:z(["dropdown-content",{"dropdown-content-active":A.value}])},[a("a",null,[a("div",{class:"dropdown-content-top-item",onClick:B},[a("img",{class:"ionicon checkmark-icon",src:l(D(s).bookFilters.length==0)},null,8,kt),o[5]||(o[5]=a("div",{class:"dropdown-content-text"},"All Hymnals",-1))])]),a("div",{class:z({"dropdown-content-organizer":u.value.length>6})},[(y(!0),$(O,null,N(u.value,i=>(y(),$("a",{key:i.name.medium,onClick:k=>f(i.name.short),ref_for:!0,ref_key:"book_filters",ref:g},[a("div",yt,[a("img",{class:"ionicon",src:l(D(s).bookFilters.includes(i.name.short)),style:V(x(i.primaryColor))},null,12,wt),a("div",Mt,F(i.name.medium),1)])],8,vt))),128))],2)],2)],512),[[at,w.value]])])),[[D(dt),L]]),m.value.length>0?(y(),$("h2",St,"Search Results ("+F(m.value.length)+")",1)):T("",!0),a("div",$t,[(y(!0),$(O,null,N(M.value,i=>(y(),P(D(ct),{key:i.title+i.number+i.book.name.short,to:`/display/${i.book.name.short}/${i.number}`,class:"song",style:V(`background: linear-gradient(135deg, ${i.book.primaryColor}, ${i.book.secondaryColor})`)},{default:lt(()=>[a("div",null,[a("div",At,F(i.title),1),a("div",Ct,F(i.book.name.medium),1)]),a("div",Ft,[a("div",Lt,"#"+F(i.number),1)])]),_:2},1032,["to","style"]))),128)),M.value.length<m.value.length?(y(),$("div",{key:0,onClick:o[2]||(o[2]=i=>d.value+=j),class:"song",style:{background:"var(--blue)","justify-content":"center",cursor:"pointer"}},o[6]||(o[6]=[a("div",{class:"song__title"},"Show more",-1)]))):T("",!0)]),C.value?T("",!0):(y(),P(ut,{key:1,current_page:"search"}))],64))}});export{Ht as default};
