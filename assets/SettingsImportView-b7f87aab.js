import{d as U,r as D,ao as L,U as F,s as W,P as x,ap as o,Q as j,c as l,b as n,w as q,a3 as Q,m as d,aq as T,F as v,A as b,j as z,a1 as $,l as a,f as g,i as C,ar as G,am as E,e as m,N as _,ad as J,_ as K,V as O,as as X,at as Y,au as Z,av as tt,aj as et,ak as st,ai as nt,n as at}from"./index-ed7e1ada.js";import{_ as it}from"./chevron-back-outline-3b18af6c.js";import{_ as ot}from"./close-d0f2b920.js";import{T as i}from"./index-5c9e50ec.js";const lt="/acchymns-dev/assets/enter-outline.svg",rt="/acchymns-dev/assets/arrow-down-circle-outline.svg",ct="/acchymns-dev/assets/trash-outline.svg",ut={class:"menu"},dt={class:"title"},mt={class:"main-content"},ft={class:"input-option reference-option"},pt={key:0},wt={key:1,class:"warning-label-container"},yt=["onClick"],vt={key:2},gt={key:3,class:"warning-label-container"},_t={class:"button-array"},ht=["onClick"],kt=["onClick"],Dt={key:4},xt={class:"button-array"},bt=["onClick"],Ct=U({__name:"SettingsImportView",setup(Et){let r=D(new Map),f=D(new Map);L(async()=>{f.value.forEach(async(e,t)=>{await e.cancel(),r.value.delete(t)})});const p=F("bookSources",[]);let I=W("import_books_tooltip_complete",!1);const w=x(()=>p.value.filter(t=>t.status==o.PREVIEW)),h=x(()=>p.value.filter(e=>e.status==o.IMPORTED)),S=x(()=>p.value.filter(e=>e.status==o.DOWNLOADED)),k=D("");async function P(e,t=!0){let s=p.value.find(u=>u.id==e.id);if(s==null)return!1;if((await O.getStatus()).connected)_.getPlatform()!=="web"&&await X(s);else return await i.show({text:"No internet connection."}),!1;let y=null;try{const u=new AbortController,M=setTimeout(()=>u.abort(),2e3);y=await fetch(s.src+"/summary.json",{method:"HEAD",signal:u.signal}),clearTimeout(M)}catch(u){if(u.name=="TypeError")return await i.show({text:"Failed to load hymnal!"}),!1;if(u.name!="AbortError")throw u}return y==null||!y.ok||y.status!=200?(await i.show({text:"Failed to load hymnal!"}),!1):s.status!=o.IMPORTED?(s.status=o.IMPORTED,t&&await i.show({text:"Successfully imported hymnal!"}),!0):(await i.show({text:"Hymnal already imported!"}),!1)}async function B(e){if(e=e.toUpperCase(),e in $){const t=p.value.find(s=>s.id==e);if(t==null)return;t.status==o.IMPORTED||t.status==o.DOWNLOADED?await i.show({text:`Hymnal (${e}) already imported!`}):await P(t,!1)&&await i.show({text:`Successfully imported hymnal (${e})!`})}else await i.show({text:`Unknown hymnal reference (${e})!`})}async function N(e){if((await O.getStatus()).connected){let t=Y(e,(s,c)=>V(s,c),(s,c)=>H(s,c));f.value.set(e.id,t)}else await i.show({text:"No internet connection."});console.log("Downloads:",f.value)}async function V(e,t){r.value.set(e.id,t)}async function H(e,t){e.src=t,e.status=o.DOWNLOADED,await i.show({text:"Successfully downloaded hymnal!"})}j(()=>{I.value||(I.value=!0)});async function R(e){var t;e.status=Object.keys(Z).includes(e.id)?o.PREVIEW:o.HIDDEN,f.value.has(e.id)&&((t=f.value.get(e.id))==null||t.cancel(),r.value.delete(e.id)),_.getPlatform()!=="web"&&await tt(e),await i.show({text:"Successfully removed hymnal!"})}async function A(e){e.status=o.IMPORTED,e.src=$[e.id],await et.rmdir({directory:st.Documents,path:`Hymnals/${e.id}`,recursive:!0}),r.value.delete(e.id),nt(),await i.show({text:"Successfully deleted hymnal!"})}return(e,t)=>(a(),l(v,null,[n("div",ut,[n("div",dt,[n("img",{onClick:t[0]||(t[0]=s=>e.$router.back()),class:"ionicon title--left",src:it}),t[3]||(t[3]=n("div",{class:"title--center"},[n("h1",null,"Import Hymnals")],-1))])]),n("div",mt,[n("div",ft,[q(n("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),type:"text",class:"search-bar",placeholder:"Book Code"},null,512),[[Q,k.value,void 0,{trim:!0}]]),n("button",{onClick:t[2]||(t[2]=s=>B(k.value)),class:"reference-button"},t[4]||(t[4]=[n("img",{class:"ionicon enter-button-icon",src:lt},null,-1)]))]),w.value.length!=0?(a(),l("h2",pt,"Available Hymnals")):d("",!0),w.value.length!=0?(a(),l("div",wt,t[5]||(t[5]=[n("img",{class:"ionicon warning-icon",src:T},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(v,null,b(w.value,s=>(a(),g(E,{key:s.id,src:s.src,"with-link":!1},{default:C(()=>[n("button",{onClick:c=>P(s)},t[6]||(t[6]=[n("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:G},null,-1)]),8,yt)]),_:2},1032,["src"]))),128))]),h.value.length!=0?(a(),l("h2",vt,"Imported Hymnals")):d("",!0),h.value.length!=0&&w.value.length==0?(a(),l("div",gt,t[7]||(t[7]=[n("img",{class:"ionicon warning-icon",src:T},null,-1),n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)]))):d("",!0),n("div",null,[(a(!0),l(v,null,b(h.value,s=>(a(),g(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:C(()=>[n("div",_t,[(m(r).get(s.id)||0)<1&&m(_).getPlatform()!=="web"?(a(),l("button",{key:0,onClick:c=>N(s)},t[8]||(t[8]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:rt},null,-1)]),8,ht)):d("",!0),(m(r).get(s.id||"")||0)>=1&&(m(r).get(s.id||"")||0)<100&&m(_).getPlatform()!=="web"?(a(),g(J,{key:1,radius:15,progress:m(r).get(s.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress"])):d("",!0),n("button",{onClick:c=>R(s)},t[9]||(t[9]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ot},null,-1)]),8,kt)])]),_:2},1032,["src"]))),128))]),S.value.length!=0?(a(),l("h2",Dt,"Downloaded Hymnals")):d("",!0),n("div",null,[(a(!0),l(v,null,b(S.value,s=>(a(),g(E,{id:"import-book",key:s.id,src:s.src,"with-link":!1},{default:C(()=>[n("div",xt,[n("button",{onClick:c=>A(s)},t[10]||(t[10]=[n("img",{class:"ionicon ionicon-custom add-button-icon",src:ct},null,-1)]),8,bt)])]),_:2},1032,["src"]))),128))]),t[11]||(t[11]=n("div",{style:{"padding-bottom":"200px"}},null,-1))]),z(K,{current_page:"settings"})],64))}});const $t=at(Ct,[["__scopeId","data-v-ca9104e6"]]);export{$t as default};
