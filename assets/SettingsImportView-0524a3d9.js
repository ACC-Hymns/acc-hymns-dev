import{d as F,r as I,ah as W,U as q,b as j,J as b,ai as i,Q as G,k as c,l as n,Z as J,a5 as Q,q as _,F as g,s as C,v as Z,a2 as P,x as a,p as k,w as E,af as S,m,O as x,a9 as z,_ as K,G as X,H as Y,aj as V,V as B,ak as tt,al as et,am as st,an as nt,ao as at,ap as ot,ae as it,aq as lt,I as ct}from"./index-83306a13.js";import{_ as rt}from"./chevron-back-outline-3b18af6c.js";import{_ as dt}from"./close-d0f2b920.js";import{T as o}from"./index-30e90673.js";const ut="/acchymns-dev/assets/enter-outline.svg",_t="/acchymns-dev/assets/arrow-down-circle-outline.svg",mt="/acchymns-dev/assets/trash-outline.svg",l=f=>(X("data-v-68cc60d2"),f=f(),Y(),f),ht={class:"menu"},pt={class:"title"},ft=l(()=>n("h1",{class:"title--center"},"Import Hymnals",-1)),wt={class:"main-content"},vt={class:"input-option reference-option"},yt=["disabled"],gt=l(()=>n("img",{class:"ionicon enter-button-icon",src:ut},null,-1)),kt=[gt],xt={key:0},Dt={key:1,class:"warning-label-container"},It=l(()=>n("img",{class:"ionicon warning-icon",src:V},null,-1)),bt=l(()=>n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Ct=[It,bt],Et=["onClick"],St=l(()=>n("img",{class:"ionicon ionicon-custom booktext--right add-button-icon",src:lt},null,-1)),Tt=[St],$t={key:2},Ot={key:3,class:"warning-label-container"},Pt=l(()=>n("img",{class:"ionicon warning-icon",src:V},null,-1)),Bt=l(()=>n("h5",{class:"warning-label"},"The hymnals below require an internet connection",-1)),Vt=[Pt,Bt],Ht={class:"button-array"},Nt=["onClick"],Rt=l(()=>n("img",{class:"ionicon ionicon-custom add-button-icon",src:_t},null,-1)),Mt=[Rt],Ut=["onClick"],At=l(()=>n("img",{class:"ionicon ionicon-custom add-button-icon",src:dt},null,-1)),Lt=[At],Ft={key:4},Wt={class:"button-array"},qt=["onClick"],jt=l(()=>n("img",{class:"ionicon ionicon-custom add-button-icon",src:mt},null,-1)),Gt=[jt],Jt=l(()=>n("div",{style:{"padding-bottom":"200px"}},null,-1)),Qt=F({__name:"SettingsImportView",setup(f){let r=I(new Map),h=I(new Map);W(async()=>{h.value.forEach(async(t,s)=>{await t.cancel(),r.value.delete(s)})});const p=q("bookSources",[]);let T=j("import_books_tooltip_complete",!1);const w=b(()=>p.value.filter(s=>s.status==i.PREVIEW)),D=b(()=>p.value.filter(t=>t.status==i.IMPORTED)),$=b(()=>p.value.filter(t=>t.status==i.DOWNLOADED)),v=I("");async function O(t,s=!0){let e=p.value.find(u=>u.id==t.id);if(e==null)return!1;if((await B.getStatus()).connected)x.getPlatform()!=="web"&&await tt(e);else return await o.show({text:"No internet connection."}),!1;let y=null;try{const u=new AbortController,L=setTimeout(()=>u.abort(),2e3);y=await fetch(e.src+"/summary.json",{method:"HEAD",signal:u.signal}),clearTimeout(L)}catch(u){if(u.name=="TypeError")return await o.show({text:"Failed to load hymnal!"}),!1;if(u.name!="AbortError")throw u}return y==null||!y.ok||y.status!=200?(await o.show({text:"Failed to load hymnal!"}),!1):e.status!=i.IMPORTED?(e.status=i.IMPORTED,s&&await o.show({text:"Successfully imported hymnal!"}),!0):(await o.show({text:"Hymnal already imported!"}),!1)}async function H(t){if(t=t.toUpperCase(),t in P){const s=p.value.find(e=>e.id==t);if(s==null)return;s.status==i.IMPORTED||s.status==i.DOWNLOADED?await o.show({text:`Hymnal (${t}) already imported!`}):await O(s,!1)&&await o.show({text:`Successfully imported hymnal (${t})!`})}else await o.show({text:`Unknown hymnal reference (${t})!`})}async function N(t){if((await B.getStatus()).connected){let s=et(t,(e,d)=>R(e,d),(e,d)=>M(e,d));h.value.set(t.id,s)}else await o.show({text:"No internet connection."});console.log("Downloads:",h.value)}async function R(t,s){r.value.set(t.id,s)}async function M(t,s){t.src=s,t.status=i.DOWNLOADED,await o.show({text:"Successfully downloaded hymnal!"})}G(()=>{T.value||(T.value=!0)});async function U(t){var s;t.status=Object.keys(st).includes(t.id)?i.PREVIEW:i.HIDDEN,h.value.has(t.id)&&((s=h.value.get(t.id))==null||s.cancel(),r.value.delete(t.id)),x.getPlatform()!=="web"&&await nt(t),await o.show({text:"Successfully removed hymnal!"})}async function A(t){t.status=i.IMPORTED,t.src=P[t.id],await at.rmdir({directory:ot.Documents,path:`Hymnals/${t.id}`,recursive:!0}),r.value.delete(t.id),it(),await o.show({text:"Successfully deleted hymnal!"})}return(t,s)=>(a(),c(g,null,[n("div",ht,[n("div",pt,[n("img",{onClick:s[0]||(s[0]=e=>t.$router.back()),class:"ionicon title--left",src:rt}),ft])]),n("div",wt,[n("div",vt,[J(n("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>v.value=e),type:"text",class:"search-bar",placeholder:"Book Code"},null,512),[[Q,v.value,void 0,{trim:!0}]]),n("a",{disabled:v.value.length===0,onClick:s[2]||(s[2]=e=>H(v.value)),class:"reference-button"},kt,8,yt)]),w.value.length!=0?(a(),c("h2",xt,"Available Hymnals")):_("",!0),w.value.length!=0?(a(),c("div",Dt,Ct)):_("",!0),n("div",null,[(a(!0),c(g,null,C(w.value,e=>(a(),k(S,{key:e.id,src:e.src,"with-link":!1},{default:E(()=>[n("button",{onClick:d=>O(e)},Tt,8,Et)]),_:2},1032,["src"]))),128))]),D.value.length!=0?(a(),c("h2",$t,"Imported Hymnals")):_("",!0),D.value.length!=0&&w.value.length==0?(a(),c("div",Ot,Vt)):_("",!0),n("div",null,[(a(!0),c(g,null,C(D.value,e=>(a(),k(S,{id:"import-book",key:e.id,src:e.src,"with-link":!1},{default:E(()=>[n("div",Ht,[(m(r).get(e.id)||0)<1&&m(x).getPlatform()!=="web"?(a(),c("button",{key:0,onClick:d=>N(e)},Mt,8,Nt)):_("",!0),(m(r).get(e.id||"")||0)>=1&&(m(r).get(e.id||"")||0)<100&&m(x).getPlatform()!=="web"?(a(),k(z,{key:1,radius:15,progress:m(r).get(e.id||"")||0,stroke:3,transform:"rotate(-90) translate(-25 -8)"},null,8,["progress","transform"])):_("",!0),n("button",{onClick:d=>U(e)},Lt,8,Ut)])]),_:2},1032,["src"]))),128))]),$.value.length!=0?(a(),c("h2",Ft,"Downloaded Hymnals")):_("",!0),n("div",null,[(a(!0),c(g,null,C($.value,e=>(a(),k(S,{id:"import-book",key:e.id,src:e.src,"with-link":!1},{default:E(()=>[n("div",Wt,[n("button",{onClick:d=>A(e)},Gt,8,qt)])]),_:2},1032,["src"]))),128))]),Jt]),Z(K,{current_page:"settings"})],64))}});const Yt=ct(Qt,[["__scopeId","data-v-68cc60d2"]]);export{Yt as default};
